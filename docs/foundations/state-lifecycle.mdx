# Stateä¸ç”Ÿå‘½å‘¨æœŸ

import { Tabs, TabItem } from '@docusaurus/theme-common';
import { RiReactjsLine } from 'react-icons/ri';

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ Reactä¸­Stateçš„æ¦‚å¿µã€çŠ¶æ€ç®¡ç†æœºåˆ¶ä»¥åŠç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ç†è§£Stateæ˜¯æŒæ¡Reactçš„æ ¸å¿ƒï¼Œå®ƒå†³å®šäº†ç»„ä»¶å¦‚ä½•å“åº”ç”¨æˆ·äº¤äº’å’Œæ•°æ®å˜åŒ–ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£Reactä¸­Stateçš„æ¦‚å¿µå’Œä½œç”¨
- æŒæ¡useState Hookçš„ä½¿ç”¨æ–¹æ³•
- å­¦ä¹ çŠ¶æ€æ›´æ–°çš„æœºåˆ¶å’Œæ³¨æ„äº‹é¡¹
- ç†è§£ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ
- æŒæ¡useEffect Hookçš„åŸºç¡€ç”¨æ³•
- å­¦ä¼šé¿å…å¸¸è§çš„Stateä½¿ç”¨é”™è¯¯

---

## 1. ä»€ä¹ˆæ˜¯Stateï¼Ÿ

### Stateç®€ä»‹

**Stateï¼ˆçŠ¶æ€ï¼‰**æ˜¯Reactç»„ä»¶ä¸­ç”¨äºå­˜å‚¨å’Œæ›´æ–°æ•°æ®çš„ç‰¹æ®Šå˜é‡ã€‚å½“Stateå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œä»¥åæ˜ æœ€æ–°çš„æ•°æ®ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ å…³é”®æ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    Stateæ˜¯ç»„ä»¶çš„ç§æœ‰æ•°æ®ï¼Œå®ƒå­˜åœ¨äºç»„ä»¶å†…éƒ¨ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ã€‚Stateçš„å˜åŒ–ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚
  </p>
</Box>

### State vs Props

Stateå’ŒPropséƒ½æ˜¯Reactç»„ä»¶çš„é‡è¦æ¦‚å¿µï¼Œä½†å®ƒä»¬æœ‰ä¸åŒçš„ç”¨é€”ï¼š

<Compare>

```jsx
// Props - çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®ï¼ˆåªè¯»ï¼‰
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}

// State - ç»„ä»¶å†…éƒ¨ç®¡ç†çš„æ•°æ®ï¼ˆå¯ä¿®æ”¹ï¼‰
function Counter() {
  const [count, setCount] = React.useState(0);
  return <button onClick={() => setCount(count + 1)}>{count}</button>;
}
```

</Compare>

| ç‰¹æ€§ | Props | State |
|------|-------|-------|
| **æ•°æ®æµå‘** | çˆ¶ç»„ä»¶ â†’ å­ç»„ä»¶ | ç»„ä»¶å†…éƒ¨ |
| **å¯ä¿®æ”¹æ€§** | åªè¯» | å¯ä¿®æ”¹ |
| **è§¦å‘æ¸²æŸ“** | çˆ¶ç»„ä»¶æ›´æ–°æ—¶ | çŠ¶æ€æ”¹å˜æ—¶ |
| **ç”Ÿå‘½å‘¨æœŸ** | ç»„ä»¶é”€æ¯æ—¶ä¸¢å¤± | ç»„ä»¶é”€æ¯æ—¶ä¸¢å¤± |

---

## 2. useState Hookè¯¦è§£

### 2.1 åŸºæœ¬è¯­æ³•

useStateæ˜¯Reactæä¾›çš„Hookï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ Stateã€‚

<LiveCode
  code={`
function MyComponent() {
  // å£°æ˜çŠ¶æ€å˜é‡
  const [count, setCount] = React.useState(0);
  const [step, setStep] = React.useState(1);

  const increment = () => {
    setCount(count + step);
  };

  const decrement = () => {
    setCount(count - step);
  };

  const reset = () => {
    setCount(0);
    setStep(1);
  };

  const changeStep = (newStep) => {
    setStep(newStep);
  };

  return (
    <div style={{ padding: '20px', textAlign: 'center' }}>
      <h2 style={{ color: '#1565c0' }}>âš¡ äº¤äº’å¼è®¡æ•°å™¨</h2>

      <div style={{
        margin: '20px 0',
        padding: '20px',
        backgroundColor: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <p style={{ fontSize: '48px', fontWeight: 'bold', color: '#1565c0', margin: '10px 0' }}>
          {count}
        </p>
        <p style={{ color: '#666', margin: '5px 0' }}>
          æ¯æ¬¡å¢åŠ /å‡å°‘: {step}
        </p>
      </div>

      <div style={{ margin: '20px 0' }}>
        <button
          onClick={decrement}
          style={{
            padding: '15px 30px',
            margin: '5px',
            fontSize: '18px',
            backgroundColor: '#f44336',
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer'
          }}
        >
          -{step}
        </button>

        <button
          onClick={reset}
          style={{
            padding: '15px 30px',
            margin: '5px',
            fontSize: '18px',
            backgroundColor: '#9e9e9e',
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer'
          }}
        >
          é‡ç½®
        </button>

        <button
          onClick={increment}
          style={{
            padding: '15px 30px',
            margin: '5px',
            fontSize: '18px',
            backgroundColor: '#4caf50',
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer'
          }}
        >
          +{step}
        </button>
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        backgroundColor: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ è°ƒæ•´æ­¥é•¿</h4>
        <div style={{ display: 'flex', justifyContent: 'center', gap: '10px', flexWrap: 'wrap' }}>
          {[1, 5, 10, 50].map((s) => (
            <button
              key={s}
              onClick={() => changeStep(s)}
              style={{
                padding: '8px 16px',
                backgroundColor: step === s ? '#ff9800' : '#ffd54f',
                color: '#333',
                border: 'none',
                borderRadius: '5px',
                cursor: 'pointer',
                fontWeight: step === s ? 'bold' : 'normal'
              }}
            >
              æ­¥é•¿: {s}
            </button>
          ))}
        </div>
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        backgroundColor: '#f5f5f5',
        borderRadius: '8px',
        fontSize: '14px',
        color: '#666'
      }}>
        <p style={{ margin: '5px 0' }}>
          <strong>State</strong>æ˜¯ç»„ä»¶å†…éƒ¨çš„ç§æœ‰æ•°æ®ï¼Œå½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ã€‚
        </p>
        <p style={{ margin: '5px 0' }}>
          <strong>useState</strong>è¿”å›å½“å‰çŠ¶æ€å’Œæ›´æ–°çŠ¶æ€çš„å‡½æ•°ã€‚
        </p>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

<Box style={{ padding: '15px', background: '#e8f5e9', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#2e7d32' }}>ğŸ’¡ State vs Props</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>Props</strong>ï¼šçˆ¶ç»„ä»¶ä¼ é€’ï¼Œåªè¯»<br/>
    <strong>State</strong>ï¼šç»„ä»¶å†…éƒ¨ç®¡ç†ï¼Œå¯ä¿®æ”¹
  </p>
</Box>

**è¯­æ³•è§£æï¼š**
```javascript
const [state, setState] = useState(initialValue);
```

- `state`ï¼šå½“å‰çš„çŠ¶æ€å€¼
- `setState`ï¼šæ›´æ–°çŠ¶æ€çš„å‡½æ•°
- `initialValue`ï¼šçŠ¶æ€çš„åˆå§‹å€¼

### 2.2 çŠ¶æ€æ›´æ–°æœºåˆ¶

çŠ¶æ€æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼ŒReactä¼šæ‰¹é‡å¤„ç†å¤šä¸ªçŠ¶æ€æ›´æ–°ä»¥æé«˜æ€§èƒ½ã€‚

<Example>

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    // âŒ é”™è¯¯ - è¿ç»­è°ƒç”¨å¯èƒ½ä¸ä¼šæŒ‰é¢„æœŸå·¥ä½œ
    setCount(count + 1);
    setCount(count + 1);
    setCount(count + 1);
    // ç»“æœï¼šcount åªå¢åŠ  1ï¼Œè€Œä¸æ˜¯ 3

    // âœ… æ­£ç¡® - ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
    setCount(prev => prev + 1);
    setCount(prev => prev + 1);
    setCount(prev => prev + 1);
    // ç»“æœï¼šcount å¢åŠ  3
  };

  return (
    <button onClick={handleClick}>
      Count: {count}
    </button>
  );
}
```

</Example>

<Box style={{ padding: '15px', background: '#fff3e0', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#e65100' }}>ğŸ’¡ æç¤º</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    å½“æ–°çŠ¶æ€ä¾èµ–äºå‰ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<strong>å‡½æ•°å¼æ›´æ–°</strong>ï¼š<code>setCount(prev => prev + 1)</code>
  </p>
</Box>

### 2.3 å¤šä¸ªçŠ¶æ€å˜é‡

ä¸€ä¸ªç»„ä»¶å¯ä»¥æ‹¥æœ‰å¤šä¸ªStateï¼Œæ¯ä¸ªStateå¯ä»¥æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ã€‚

<CodeBlock>

```jsx
function UserProfile() {
  const [name, setName] = useState('Alice');
  const [age, setAge] = useState(25);
  const [isActive, setIsActive] = useState(true);
  const [hobbies, setHobbies] = useState(['é˜…è¯»', 'ç¼–ç¨‹']);

  return (
    <div>
      <h2>{name}</h2>
      <p>å¹´é¾„: {age}</p>
      <p>çŠ¶æ€: {isActive ? 'æ´»è·ƒ' : 'éæ´»è·ƒ'}</p>
      <p>çˆ±å¥½: {hobbies.join(', ')}</p>

      <button onClick={() => setAge(age + 1)}>é•¿å¤§ä¸€å²</button>
      <button onClick={() => setIsActive(!isActive)}>åˆ‡æ¢çŠ¶æ€</button>
      <button onClick={() => setHobbies([...hobbies, 'æ–°çˆ±å¥½'])}>
        æ·»åŠ çˆ±å¥½
      </button>
    </div>
  );
}
```

</CodeBlock>

### 2.4 å¯¹è±¡ç±»å‹çŠ¶æ€

å½“Stateæ˜¯å¯¹è±¡æ—¶ï¼Œéœ€è¦æ³¨æ„å±•å¼€è¿ç®—ç¬¦çš„ä½¿ç”¨ã€‚

<CodeBlock>

```jsx
function UserForm() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    age: ''
  });

  const handleChange = (e) => {
    const { name, value } = e.target;

    // âœ… æ­£ç¡® - ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦
    setUser(prev => ({
      ...prev,
      [name]: value
    }));
  };

  return (
    <form>
      <input
        name="name"
        value={user.name}
        onChange={handleChange}
        placeholder="å§“å"
      />
      <input
        name="email"
        value={user.email}
        onChange={handleChange}
        placeholder="é‚®ç®±"
      />
      <input
        name="age"
        value={user.age}
        onChange={handleChange}
        placeholder="å¹´é¾„"
      />
    </form>
  );
}
```

</CodeBlock>

---

## 3. çŠ¶æ€ç®¡ç†æ¨¡å¼

### 3.1 çŠ¶æ€æå‡

å½“å¤šä¸ªå­ç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€æ—¶ï¼Œå°†Stateæå‡åˆ°æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ã€‚

<Example>

```jsx
// çˆ¶ç»„ä»¶ç®¡ç†å…±äº«çŠ¶æ€
function Parent() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <h1>çˆ¶ç»„ä»¶: {count}</h1>
      <ChildA count={count} />
      <ChildB count={count} setCount={setCount} />
    </div>
  );
}

// å­ç»„ä»¶A - ä»…æ¶ˆè´¹çŠ¶æ€
function ChildA({ count }) {
  return <p>å­ç»„ä»¶A: {count}</p>;
}

// å­ç»„ä»¶B - å¯ä»¥æ›´æ–°çŠ¶æ€
function ChildB({ count, setCount }) {
  return <button onClick={() => setCount(count + 1)}>å¢åŠ </button>;
}
```

</Example>

### 3.2 çŠ¶æ€é™ç»´

é¿å…åˆ›å»ºè¿‡äºå¤æ‚çš„åµŒå¥—çŠ¶æ€ï¼Œä¿æŒçŠ¶æ€æ‰å¹³åŒ–ã€‚

<Compare>

```jsx
// âŒ ä¸å¥½çš„è®¾è®¡ - åµŒå¥—è¿‡æ·±
const [state, setState] = useState({
  user: {
    profile: {
      personal: {
        name: '',
        age: 0
      }
    }
  }
});

// âœ… å¥½çš„è®¾è®¡ - æ‰å¹³åŒ–
const [userName, setUserName] = useState('');
const [userAge, setUserAge] = useState(0);
```

</Compare>

### 3.3 æ´¾ç”ŸçŠ¶æ€

é¿å…å­˜å‚¨å¯ä»¥è®¡ç®—å¾—å‡ºçš„å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨è®¡ç®—å±æ€§ã€‚

<Compare>

```jsx
function TodoList() {
  const [todos, setTodos] = useState([
    { id: 1, text: 'å­¦ä¹ React', completed: true },
    { id: 2, text: 'æ„å»ºåº”ç”¨', completed: false }
  ]);

  // âœ… å¥½çš„åšæ³• - ä½¿ç”¨è®¡ç®—å±æ€§
  const completedCount = todos.filter(todo => todo.completed).length;
  const activeCount = todos.length - completedCount;

  return (
    <div>
      <p>å·²å®Œæˆ: {completedCount}</p>
      <p>è¿›è¡Œä¸­: {activeCount}</p>
    </div>
  );
}
```

</Compare>

---

## 4. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ

### 4.1 ç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ä¼ ç»Ÿçš„ç±»ç»„ä»¶ä¸­ï¼Œç»„ä»¶æœ‰ä¸‰ä¸ªä¸»è¦ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼š
- **æŒ‚è½½ï¼ˆMountingï¼‰**ï¼šç»„ä»¶è¢«åˆ›å»ºå¹¶æ’å…¥DOM
- **æ›´æ–°ï¼ˆUpdatingï¼‰**ï¼šç»„ä»¶æ¥æ”¶æ–°çš„propsæˆ–stateå¹¶é‡æ–°æ¸²æŸ“
- **å¸è½½ï¼ˆUnmountingï¼‰**ï¼šç»„ä»¶ä»DOMä¸­ç§»é™¤

<Process>

1. **ç»„ä»¶åˆ›å»ºä¸åˆå§‹åŒ–**
   - constructor
   - componentDidMount

2. **çŠ¶æ€æˆ–å±æ€§æ›´æ–°**
   - componentDidUpdate

3. **ç»„ä»¶é”€æ¯**
   - componentWillUnmount

</Process>

### 4.2 å‡½æ•°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

å‡½æ•°ç»„ä»¶æ²¡æœ‰ç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½†å¯ä»¥é€šè¿‡useEffect Hookå®ç°ç±»ä¼¼åŠŸèƒ½ã€‚

<Diagram>

```
å‡½æ•°ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆå‡½æ•°å¼ï¼‰

1. ç»„ä»¶é¦–æ¬¡æ¸²æŸ“
   â”œâ”€â”€ useState(initial) - åˆå§‹åŒ–çŠ¶æ€
   â””â”€â”€ useEffect(fn) - æ‰§è¡Œå‰¯ä½œç”¨

2. çŠ¶æ€æˆ–å±æ€§æ›´æ–°
   â”œâ”€â”€ é‡æ–°æ‰§è¡Œç»„ä»¶å‡½æ•°
   â”‚   â”œâ”€â”€ useState(prev) - è¿”å›å½“å‰å€¼
   â”‚   â””â”€â”€ useEffect(fn) - æ£€æŸ¥ä¾èµ–å˜åŒ–
   â””â”€â”€ useEffect(fn) - é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨

3. ç»„ä»¶å¸è½½
   â””â”€â”€ useEffect(() => cleanup) - æ¸…ç†å‰¯ä½œç”¨
```

</Diagram>

---

## 5. useEffect HookåŸºç¡€

### 5.1 ä»€ä¹ˆæ˜¯Effectï¼Ÿ

Effectæ˜¯æ‰§è¡Œ"å‰¯ä½œç”¨"æ“ä½œçš„åœ°æ–¹ï¼Œå‰¯ä½œç”¨æ˜¯å‘ç”Ÿåœ¨æ¸²æŸ“ä¹‹åã€ä¸æ˜¯UIé€»è¾‘çš„æ“ä½œï¼Œå¦‚ï¼š
- æ•°æ®è·å–
- è®¾ç½®è®¢é˜…
- æ‰‹åŠ¨ä¿®æ”¹DOM
- è®°å½•æ—¥å¿—

### 5.2 åŸºæœ¬è¯­æ³•

<CodeBlock>

```jsx
import { useEffect } from 'react';

function MyComponent() {
  useEffect(() => {
    // è¿™é‡Œå†™å‰¯ä½œç”¨é€»è¾‘
    console.log('ç»„ä»¶å·²æŒ‚è½½');

    // è¿”å›æ¸…ç†å‡½æ•°
    return () => {
      console.log('ç»„ä»¶å°†å¸è½½');
    };
  }, []); // ä¾èµ–æ•°ç»„

  return <div>å†…å®¹</div>;
}
```

</CodeBlock>

### 5.3 ä¾èµ–æ•°ç»„çš„ä½œç”¨

ä¾èµ–æ•°ç»„å†³å®šEffectä½•æ—¶é‡æ–°æ‰§è¡Œã€‚

<Table>

| ä¾èµ–æ•°ç»„ | æ‰§è¡Œæ—¶æœº |
|---------|----------|
| `[]` | ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ |
| `[count]` | æŒ‚è½½æ—¶å’Œcountå˜åŒ–æ—¶æ‰§è¡Œ |
| æ— ä¾èµ–æ•°ç»„ | æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ |
| `[a, b, c]` | æŒ‚è½½æ—¶å’Œä»»æ„ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ |

</Table>

<Example>

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);

  // 1. ç»„ä»¶æŒ‚è½½æ—¶è·å–æ•°æ®
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]); // 2. userIdå˜åŒ–æ—¶é‡æ–°è·å–

  // 3. ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
  return user ? <div>{user.name}</div> : <div>åŠ è½½ä¸­...</div>;
}
```

</Example>

### 5.4 å¸¸è§ç”¨ä¾‹

#### 5.4.1 æ•°æ®è·å–

<CodeBlock>

```jsx
function PostList() {
  const [posts, setPosts] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function loadPosts() {
      try {
        const response = await fetch('/api/posts');
        const data = await response.json();
        setPosts(data);
      } catch (error) {
        console.error('è·å–æ–‡ç« å¤±è´¥:', error);
      } finally {
        setLoading(false);
      }
    }

    loadPosts();
  }, []);

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div>
      {posts.map(post => (
        <article key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.summary}</p>
        </article>
      ))}
    </div>
  );
}
```

</CodeBlock>

#### 5.4.2 äº‹ä»¶ç›‘å¬

<CodeBlock>

```jsx
function WindowSize() {
  const [size, setSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });

  useEffect(() => {
    function handleResize() {
      setSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    }

    window.addEventListener('resize', handleResize);

    // æ¸…ç†å‡½æ•° - ç§»é™¤äº‹ä»¶ç›‘å¬
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  return (
    <div>
      <p>çª—å£å®½åº¦: {size.width}px</p>
      <p>çª—å£é«˜åº¦: {size.height}px</p>
    </div>
  );
}
```

</CodeBlock>

#### 5.4.3 å®šæ—¶å™¨

<CodeBlock>

```jsx
function Timer() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const timer = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);

    // æ¸…ç†å‡½æ•° - æ¸…é™¤å®šæ—¶å™¨
    return () => {
      clearInterval(timer);
    };
  }, []);

  return <div>è®¡æ—¶å™¨: {count}ç§’</div>;
}
```

</CodeBlock>

---

## 6. çŠ¶æ€ä¸Effectæœ€ä½³å®è·µ

### 6.1 é¿å…ä¸å¿…è¦çš„æ•ˆæœ

åªå¯¹å¿…è¦çš„ä¾èµ–åˆ›å»ºEffectã€‚

<Compare>

```jsx
// âŒ ä¸å¿…è¦
function UserForm() {
  const [name, setName] = useState('');

  useEffect(() => {
    localStorage.setItem('name', name);
  }, [name]);

  // ç›´æ¥åœ¨äº‹ä»¶å¤„ç†å™¨ä¸­ä¿å­˜
  const handleChange = (e) => {
    setName(e.target.value);
    localStorage.setItem('name', e.target.value);
  };

  return <input value={name} onChange={handleChange} />;
}
```

</Compare>

### 6.2 æ­£ç¡®è®¾ç½®ä¾èµ–

ä¾èµ–æ•°ç»„ä¸­çš„ä¾èµ–å¿…é¡»å…¨éƒ¨åˆ—å‡ºã€‚

<CodeBlock>

```jsx
function SearchResults({ query, page }) {
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    let isMounted = true;

    async function search() {
      setLoading(true);
      const data = await fetchResults(query, page);
      if (isMounted) {
        setResults(data);
        setLoading(false);
      }
    }

    search();

    return () => {
      isMounted = false;
    };
  }, [query, page]); // âœ… æ‰€æœ‰ä¾èµ–éƒ½è¦åˆ—å‡º

  if (loading) return <div>æœç´¢ä¸­...</div>;

  return (
    <ul>
      {results.map(result => (
        <li key={result.id}>{result.title}</li>
      ))}
    </ul>
  );
}
```

</CodeBlock>

### 6.3 æ¡ä»¶æ‰§è¡ŒEffect

åœ¨Effectå†…éƒ¨ä½¿ç”¨æ¡ä»¶è¯­å¥ï¼Œè€Œä¸æ˜¯åœ¨ä¾èµ–æ•°ç»„ä¸­ã€‚

<CodeBlock>

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);

  useEffect(() => {
    if (userId) {
      // åªæœ‰å½“userIdå­˜åœ¨æ—¶æ‰è·å–æ•°æ®
      fetchUser(userId).then(setUser);
    }
  }, [userId]);

  if (!userId) return <div>è¯·é€‰æ‹©ç”¨æˆ·</div>;
  if (!user) return <div>åŠ è½½ä¸­...</div>;

  return <div>{user.name}</div>;
}
```

</CodeBlock>

---

## 7. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šè®¡æ•°å™¨

åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ï¼Œæ”¯æŒï¼š
- æ˜¾ç¤ºå½“å‰æ•°å€¼
- å¢åŠ 1
- å‡å°‘1
- é‡ç½®ä¸º0

<Expandable title="ç‚¹å‡»æŸ¥çœ‹æç¤º">

```jsx
function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <h2>è®¡æ•°å™¨: {count}</h2>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
      <button onClick={() => setCount(count - 1)}>å‡å°‘</button>
      <button onClick={() => setCount(0)}>é‡ç½®</button>
    </div>
  );
}
```

</Expandable>

### ç»ƒä¹ 2ï¼šä¸»é¢˜åˆ‡æ¢

åˆ›å»ºä¸€ä¸ªä¸»é¢˜åˆ‡æ¢ç»„ä»¶ï¼š
- ä¸¤ç§ä¸»é¢˜ï¼šæ˜äº®/æš—é»‘
- ä½¿ç”¨useStateç®¡ç†ä¸»é¢˜çŠ¶æ€
- æ ¹æ®ä¸»é¢˜åŠ¨æ€æ”¹å˜èƒŒæ™¯è‰²

<Expandable title="ç‚¹å‡»æŸ¥çœ‹æç¤º">

```jsx
function ThemeToggle() {
  const [isDark, setIsDark] = useState(false);

  const theme = {
    background: isDark ? '#333' : '#fff',
    color: isDark ? '#fff' : '#333',
    padding: '20px',
    borderRadius: '8px'
  };

  return (
    <div style={theme}>
      <h2>å½“å‰ä¸»é¢˜: {isDark ? 'æš—é»‘' : 'æ˜äº®'}</h2>
      <button onClick={() => setIsDark(!isDark)}>
        åˆ‡æ¢ä¸»é¢˜
      </button>
    </div>
  );
}
```

</Expandable>

### ç»ƒä¹ 3ï¼šå¾…åŠäº‹é¡¹åˆ—è¡¨

åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„å¾…åŠäº‹é¡¹åº”ç”¨ï¼š
- æ·»åŠ æ–°äº‹é¡¹
- æ ‡è®°å®Œæˆ/æœªå®Œæˆ
- ç­›é€‰æ˜¾ç¤ºï¼ˆå…¨éƒ¨/å·²å®Œæˆ/æœªå®Œæˆï¼‰
- åˆ é™¤äº‹é¡¹

<Expandable title="ç‚¹å‡»æŸ¥çœ‹æç¤º">

```jsx
function TodoList() {
  const [todos, setTodos] = useState([]);
  const [filter, setFilter] = useState('all');
  const [input, setInput] = useState('');

  const addTodo = () => {
    if (input.trim()) {
      setTodos([...todos, {
        id: Date.now(),
        text: input,
        completed: false
      }]);
      setInput('');
    }
  };

  const toggleTodo = (id) => {
    setTodos(todos.map(todo =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };

  const filteredTodos = todos.filter(todo => {
    if (filter === 'completed') return todo.completed;
    if (filter === 'active') return !todo.completed;
    return true;
  });

  return (
    <div>
      <h2>å¾…åŠäº‹é¡¹</h2>
      <div>
        <input
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && addTodo()}
        />
        <button onClick={addTodo}>æ·»åŠ </button>
      </div>
      <div>
        <button onClick={() => setFilter('all')}>å…¨éƒ¨</button>
        <button onClick={() => setFilter('active')}>è¿›è¡Œä¸­</button>
        <button onClick={() => setFilter('completed')}>å·²å®Œæˆ</button>
      </div>
      <ul>
        {filteredTodos.map(todo => (
          <li key={todo.id}>
            <span
              style={{
                textDecoration: todo.completed ? 'line-through' : 'none',
                cursor: 'pointer'
              }}
              onClick={() => toggleTodo(todo.id)}
            >
              {todo.text}
            </span>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

</Expandable>

---

## 8. å¸¸è§é”™è¯¯

### 8.1 ç›´æ¥ä¿®æ”¹State

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ç›´æ¥ä¿®æ”¹æ•°ç»„
const [items, setItems] = useState([]);
const addItem = () => {
  items.push(newItem); // ä¸è§¦å‘é‡æ–°æ¸²æŸ“
  setItems(items);
};

// âœ… æ­£ç¡®
const addItem = () => {
  setItems([...items, newItem]);
};
```

</ErrorBox>

### 8.2 å¿˜è®°æ¸…ç†å‰¯ä½œç”¨

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - å†…å­˜æ³„æ¼
useEffect(() => {
  const timer = setInterval(() => {
    setCount(count + 1);
  }, 1000);
  // æ²¡æœ‰æ¸…ç†å®šæ—¶å™¨
}, []);

// âœ… æ­£ç¡®
useEffect(() => {
  const timer = setInterval(() => {
    setCount(count + 1);
  }, 1000);

  return () => {
    clearInterval(timer); // æ¸…ç†å®šæ—¶å™¨
  };
}, []);
```

</ErrorBox>

### 8.3 å¾ªç¯æ›´æ–°

é¿å…åœ¨useEffectä¸­è§¦å‘å¯¼è‡´è‡ªèº«çš„æ›´æ–°ã€‚

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ— é™å¾ªç¯
useEffect(() => {
  setCount(count + 1); // æ¯æ¬¡countå˜åŒ–éƒ½è§¦å‘
}, [count]);

// âœ… æ­£ç¡®
useEffect(() => {
  if (someCondition) {
    setCount(count + 1); // åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ›´æ–°
  }
}, [someCondition]);
```

</ErrorBox>

---

## 9. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… Stateæ˜¯ç»„ä»¶å†…éƒ¨ç®¡ç†çš„æ•°æ®ï¼Œå˜åŒ–æ—¶è§¦å‘é‡æ–°æ¸²æŸ“
- âœ… useStateè¿”å›å½“å‰å€¼å’Œæ›´æ–°å‡½æ•°
- âœ… çŠ¶æ€æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Œä¾èµ–å‰ä¸€ä¸ªçŠ¶æ€æ—¶ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
- âœ… useEffectç”¨äºå¤„ç†å‰¯ä½œç”¨ï¼Œæ¥å—æ¸…ç†å‡½æ•°
- âœ… ä¾èµ–æ•°ç»„å†³å®šEffectä½•æ—¶é‡æ–°æ‰§è¡Œ
- âœ… æ­£ç¡®è®¾ç½®ä¾èµ–ï¼Œé¿å…å†…å­˜æ³„æ¼
- âœ… çŠ¶æ€æå‡åˆ°å…±åŒçˆ¶ç»„ä»¶ä»¥å…±äº«çŠ¶æ€
- âœ… ä¿æŒçŠ¶æ€æ‰å¹³åŒ–ï¼Œä½¿ç”¨æ´¾ç”ŸçŠ¶æ€

</Checklist>

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†Stateå’Œç”Ÿå‘½å‘¨æœŸï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š

1. **[äº‹ä»¶å¤„ç†](events)** - å­¦ä¹ å¦‚ä½•å¤„ç†ç”¨æˆ·äº¤äº’
2. **[æ¡ä»¶æ¸²æŸ“](conditional-rendering)** - æŒæ¡åŠ¨æ€UIæ¸²æŸ“æŠ€å·§
3. **[useStateé«˜çº§ç”¨æ³•](../hooks/basics/useState)** - æ·±å…¥ç†è§£çŠ¶æ€ç®¡ç†

---

## 10. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Stateç®¡ç†](https://react.dev/learn/managing-state) - Reactå®˜æ–¹StateæŒ‡å—
- [useStateå‚è€ƒ](https://react.dev/reference/react/useState) - useState APIæ–‡æ¡£
- [useEffectå‚è€ƒ](https://react.dev/reference/react/useEffect) - useEffect APIæ–‡æ¡£
- [Stateç”Ÿå‘½å‘¨æœŸ](https://react.dev/learn/state-a-components-memory) - æ·±å…¥ç†è§£State

### å®è·µå»ºè®®

1. å¤šç»ƒä¹ ä½¿ç”¨useStateå’ŒuseEffect
2. ç†è§£çŠ¶æ€æ›´æ–°çš„å¼‚æ­¥æœºåˆ¶
3. æŒæ¡useEffectçš„ä¾èµ–è®¾ç½®
4. å­¦ä¼šè¯†åˆ«ä»€ä¹ˆåº”è¯¥æ”¾åœ¨Effectä¸­

---

[â† ä¸Šä¸€ç« ï¼šç»„ä»¶ä¸Props](components-props) | [ä¸‹ä¸€ç« ï¼šäº‹ä»¶å¤„ç† â†’](events)
