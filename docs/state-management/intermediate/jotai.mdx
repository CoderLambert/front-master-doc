# JotaiåŸå­åŒ–çŠ¶æ€ - ç»†ç²’åº¦çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

import { Tabs, TabItem } from '@docusaurus/theme-common';

Jotaiæ˜¯Reactç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªç‹¬ç‰¹çš„è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒé‡‡ç”¨**åŸå­åŒ–çŠ¶æ€**ï¼ˆAtomic Stateï¼‰çš„åˆ›æ–°ç†å¿µã€‚ä¸ä¼ ç»Ÿçš„é›†ä¸­å¼çŠ¶æ€ç®¡ç†ä¸åŒï¼ŒJotaiå°†çŠ¶æ€æ‹†åˆ†ä¸ºæœ€å°ä¸å¯åˆ†çš„åŸå­ï¼ˆAtomsï¼‰ï¼Œæ¯ä¸ªåŸå­ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„çŠ¶æ€ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨Jotaiçš„æ ¸å¿ƒæ¦‚å¿µã€åŸå­åŒ–çŠ¶æ€æ¨¡å¼ã€é«˜çº§ç”¨æ³•å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£Jotaiçš„åŸå­åŒ–çŠ¶æ€ç†å¿µ
- æŒæ¡Jotaiçš„åŸºç¡€ç”¨æ³•å’Œæ ¸å¿ƒæ¦‚å¿µ
- å­¦ä¼šåˆ›å»ºå’Œç®¡ç†åŸå­çŠ¶æ€
- ç†è§£åŸå­ä¾èµ–å’Œè‡ªåŠ¨æ›´æ–°æœºåˆ¶
- æŒæ¡Jotaiçš„é«˜çº§æ¨¡å¼ï¼šè¡ç”ŸåŸå­ã€å¼‚æ­¥åŸå­
- å­¦ä¼šä½¿ç”¨Jotaiè¿›è¡Œæ€§èƒ½ä¼˜åŒ–
- æŒæ¡Jotaiä¸Reactçš„é›†æˆ
- ç†è§£Jotaiçš„æœ€ä½³å®è·µ
- æŒæ¡Jotaiä¸å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„å¯¹æ¯”
- å­¦ä¼šåœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨Jotai

---

## 1. Jotaiæ˜¯ä»€ä¹ˆï¼Ÿ

Jotaiçš„ç†å¿µæ˜¯å°†çŠ¶æ€æ‹†åˆ†ä¸ºæœ€å°ä¸å¯åˆ†çš„å•å…ƒï¼ˆåŸå­ï¼‰ï¼Œæ¯ä¸ªåŸå­å¯ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥ç»„åˆæˆæ›´å¤æ‚çš„çŠ¶æ€ã€‚è¿™ç§è®¾è®¡æä¾›äº†ç»†ç²’åº¦çš„æ§åˆ¶å’Œé«˜æ€§èƒ½çš„æ›´æ–°ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒç†å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>åŸå­åŒ–çŠ¶æ€</strong> - æœ€å°ä¸å¯åˆ†çš„çŠ¶æ€å•å…ƒ<br />
    <strong>ç»„åˆæ€ç»´</strong> - å¤šä¸ªåŸå­å¯ä»¥ç»„åˆæˆå¤æ‚çŠ¶æ€<br />
    <strong>è‡ªåŠ¨è¿½è¸ª</strong> - è‡ªåŠ¨è¿½è¸ªåŸå­é—´çš„ä¾èµ–å…³ç³»<br />
    <strong>ç»†ç²’åº¦æ›´æ–°</strong> - åªæ›´æ–°çœŸæ­£éœ€è¦æ›´æ–°çš„ç»„ä»¶
  </p>
</Box>

<CodeBlock>

```jsx
// Jotaiç¤ºä¾‹ - åŸå­åŒ–çŠ¶æ€
import { atom, useAtom } from 'jotai';

// 1. åˆ›å»ºåŸå­ï¼ˆåŸºç¡€åŸå­ï¼‰
const countAtom = atom(0);

// 2. åˆ›å»ºè¡ç”ŸåŸå­ï¼ˆä»å…¶ä»–åŸå­æ´¾ç”Ÿï¼‰
const doubleAtom = atom((get) => get(countAtom) * 2);

// 3. åˆ›å»ºå¼‚æ­¥åŸå­
const userAtom = atom(async () => {
  const response = await fetch('/api/user');
  return response.json();
});

// 4. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function Counter() {
  const [count, setCount] = useAtom(countAtom);
  const [double] = useAtom(doubleAtom);

  return (
    <div>
      <p>Count: {count}</p>
      <p>Double: {double}</p>
      <button onClick={() => setCount(c => c + 1)}>
        Increment
      </button>
    </div>
  );
}
```

</CodeBlock>

### 1.1 åŸå­åŒ–çŠ¶æ€çš„æ ¸å¿ƒä¼˜åŠ¿

<Grid>

<div>
  <h4>ğŸ¯ ç»†ç²’åº¦æ§åˆ¶</h4>
  <ul>
    <li>æ¯ä¸ªåŸå­ç‹¬ç«‹ç®¡ç†</li>
    <li>æœ€å°åŒ–é‡æ¸²æŸ“</li>
    <li>ç²¾ç¡®çš„çŠ¶æ€æ›´æ–°</li>
    <li>ç»„åˆå¼è®¾è®¡</li>
  </ul>
</div>

<div>
  <h4>âš¡ é«˜æ€§èƒ½</h4>
  <ul>
    <li>è‡ªåŠ¨ä¾èµ–è¿½è¸ª</li>
    <li>åªæ›´æ–°ç›¸å…³ç»„ä»¶</li>
    <li>æ— è¿‡åº¦æ¸²æŸ“</li>
    <li>ä¼˜åŒ–æ›´æ–°è·¯å¾„</li>
  </ul>
</div>

<div>
  <h4>ğŸ”§ çµæ´»æ€§</h4>
  <ul>
    <li>è‡ªç”±ç»„åˆåŸå­</li>
    <li>åŠ¨æ€åŸå­åˆ›å»º</li>
    <li>ç±»å‹å®‰å…¨</li>
    <li>ç®€å•API</li>
  </ul>
</div>

<div>
  <h4>ğŸ“¦ è½»é‡</h4>
  <ul>
    <li>æå°Bundle</li>
    <li>é›¶ä¾èµ–</li>
    <li>TypeScriptå‹å¥½</li>
    <li>å­¦ä¹ æ›²çº¿å¹³ç¼“</li>
  </ul>
</div>

</Grid>

### 1.2 ä¸å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå¯¹æ¯”

<CodeBlock>

```jsx
// å¯¹æ¯”ï¼šçŠ¶æ€ç»“æ„

// âŒ ä¼ ç»Ÿæ–¹æ¡ˆ - é›†ä¸­å¼
const state = {
  user: { name: '', email: '' },
  theme: 'light',
  todos: [],
  // ä»»ä½•å˜åŒ–éƒ½å½±å“æ•´ä¸ªstate
};

// âœ… Jotai - åŸå­åŒ–
const userAtom = atom({ name: '', email: '' });
const themeAtom = atom('light');
const todosAtom = atom([]);
// æ¯ä¸ªåŸå­ç‹¬ç«‹å­˜åœ¨
```

</CodeBlock>

<CodeBlock>

```jsx
// å¯¹æ¯”ï¼šçŠ¶æ€æ›´æ–°

// âŒ Context - æ‰€æœ‰æ¶ˆè´¹è€…é‡æ¸²æŸ“
const StateContext = createContext();
const [state, setState] = useState({ count: 0, text: 'hello' });
// textå˜åŒ–æ—¶ï¼Œè®¢é˜…countçš„ç»„ä»¶ä¹Ÿä¼šé‡æ¸²æŸ“

// âœ… Jotai - åªè®¢é˜…éœ€è¦çš„åŸå­
const countAtom = atom(0);
const textAtom = atom('hello');
// countAtomå˜åŒ–æ—¶ï¼Œåªé‡æ¸²æŸ“è®¢é˜…countAtomçš„ç»„ä»¶
```

</CodeBlock>

<CodeBlock>

```jsx
// å¯¹æ¯”ï¼šæ´¾ç”ŸçŠ¶æ€

// âŒ useMemo - æ‰‹åŠ¨ç®¡ç†ä¾èµ–
const double = useMemo(() => {
  return count * 2;
}, [count]); // éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¾èµ–

// âœ… Jotai - è‡ªåŠ¨è¿½è¸ªä¾èµ–
const doubleAtom = atom((get) => get(countAtom) * 2);
// è‡ªåŠ¨è¿½è¸ªcountAtomä¾èµ–
```

</CodeBlock>

---

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 å®‰è£…Jotai

<CodeBlock>

```bash
# ä½¿ç”¨npm
npm install jotai

# ä½¿ç”¨yarn
yarn add jotai

# ä½¿ç”¨pnpm
pnpm add jotai
```

</CodeBlock>

### 2.2 åŸºç¡€ç”¨æ³•

<CodeBlock>

```jsx
// åŸºç¡€è®¡æ•°å™¨ç¤ºä¾‹
import { atom, useAtom } from 'jotai';

// 1. åˆ›å»ºåŸå­
const countAtom = atom(0);

// 2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function Counter() {
  const [count, setCount] = useAtom(countAtom);

  return (
    <div>
      <h2>Count: {count}</h2>
      <button onClick={() => setCount(c => c + 1)}>
        Increment
      </button>
      <button onClick={() => setCount(c => c - 1)}>
        Decrement
      </button>
      <button onClick={() => setCount(0)}>
        Reset
      </button>
    </div>
  );
}
```

</CodeBlock>

### 2.3 åŸå­ç±»å‹è¯¦è§£

<CodeBlock>

```jsx
import { atom } from 'jotai';

// 1. åŸºç¡€åŸå­ - åŸå§‹å€¼
const countAtom = atom(0);
const textAtom = atom('hello');
const isActiveAtom = atom(true);

// 2. åˆå§‹å€¼å‡½æ•°
const randomAtom = atom(() => Math.random());

// 3. è¯»å–å™¨å‡½æ•°ï¼ˆè¡ç”ŸåŸå­ï¼‰
const doubleAtom = atom((get) => {
  const count = get(countAtom);
  return count * 2;
});

// 4. å†™åŸå­ï¼ˆå¸¦setterï¼‰
const uppercaseAtom = atom(
  (get) => get(textAtom).toUpperCase(),
  (get, set, newText) => {
    set(textAtom, newText);
  }
);

// 5. å¼‚æ­¥åŸå­
const dataAtom = atom(async () => {
  const response = await fetch('/api/data');
  return response.json();
});

// 6. å¸¦å‚æ•°çš„åŸå­ï¼ˆä½¿ç”¨å‡½æ•°è¿”å›åŸå­ï¼‰
const createCounterAtom = (initial) => atom(initial);

// 7. å¯¹è±¡åŸå­
const userAtom = atom({
  name: 'John',
  age: 30,
  email: 'john@example.com'
});
```

</CodeBlock>

---

## 3. æ ¸å¿ƒæ¦‚å¿µæ·±å…¥

### 3.1 åŸºç¡€åŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€åŸå­
const countAtom = atom(0);
const textAtom = atom('hello');
const boolAtom = atom(true);

// ä½¿ç”¨
function Component() {
  const [count, setCount] = useAtom(countAtom);
  const [text, setText] = useAtom(textAtom);
  const [isVisible, setVisible] = useAtom(boolAtom);

  return (
    <div>
      <p>Count: {count}</p>
      <p>Text: {text}</p>
      <p>Visible: {isVisible}</p>
    </div>
  );
}
```

</CodeBlock>

### 3.2 è¡ç”ŸåŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€åŸå­
const countAtom = atom(0);

// è¡ç”ŸåŸå­ - åªè¯»
const doubleAtom = atom((get) => {
  const count = get(countAtom);
  return count * 2;
});

const tripleAtom = atom((get) => {
  const count = get(countAtom);
  return count * 3;
});

// å¤åˆè¡ç”Ÿ
const totalAtom = atom((get) => {
  const double = get(doubleAtom);
  const triple = get(tripleAtom);
  return double + triple;
});

// ä½¿ç”¨
function DerivedCounter() {
  const [count, setCount] = useAtom(countAtom);
  const [double] = useAtom(doubleAtom);
  const [triple] = useAtom(tripleAtom);
  const [total] = useAtom(totalAtom);

  return (
    <div>
      <p>Count: {count}</p>
      <p>Double: {double}</p>
      <p>Triple: {triple}</p>
      <p>Total: {total}</p>
      <button onClick={() => setCount(c => c + 1)}>
        Increment
      </button>
    </div>
  );
}
```

</CodeBlock>

### 3.3 å¯å†™åŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// å¯å†™åŸå­ - è‡ªå®šä¹‰getterå’Œsetter
const counterAtom = atom(
  // getter
  (get) => {
    const count = get(countAtom);
    return count;
  },
  // setter
  (get, set, newValue) => {
    set(countAtom, newValue);
  }
);

// æ›´å¤æ‚çš„å¯å†™åŸå­
const uppercaseTextAtom = atom(
  (get) => get(textAtom).toUpperCase(),
  (get, set, newText) => {
    set(textAtom, newText.toLowerCase());
  }
);

// ä½¿ç”¨å›è°ƒçš„å¯å†™åŸå­
const incrementAtom = atom(null, (get, set) => {
  set(countAtom, get(countAtom) + 1);
});

function WritableCounter() {
  const [count, setCount] = useAtom(counterAtom);
  const [uppercaseText, setUppercaseText] = useAtom(uppercaseTextAtom);
  const [, increment] = useAtom(incrementAtom);

  return (
    <div>
      <p>Count: {count}</p>
      <p>Uppercase: {uppercaseText}</p>
      <button onClick={() => increment()}>
        Increment via Action
      </button>
    </div>
  );
}
```

</CodeBlock>

### 3.4 å¼‚æ­¥åŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// å¼‚æ­¥åŸºç¡€åŸå­
const userAtom = atom(async () => {
  const response = await fetch('/api/user');
  return response.json();
});

// å¸¦åˆå§‹å€¼çš„å¼‚æ­¥åŸå­
const userWithIdAtom = atom(async (get) => {
  const id = get(idAtom);
  const response = await fetch(`/api/users/${id}`);
  return response.json();
});

// å¼‚æ­¥å¯å†™åŸå­
const createUserAtom = atom(
  null,
  async (get, set, userData) => {
    const response = await fetch('/api/users', {
      method: 'POST',
      body: JSON.stringify(userData),
    });
    const newUser = await response.json();
    set(userAtom, newUser);
  }
);

function UserProfile() {
  const [user, { refetch }] = useAtom(userAtom);
  const [, createUser] = useAtom(createUserAtom);

  if (user === undefined) {
    return <div>Loading...</div>;
  }

  if (user === null) {
    return <div>No user found</div>;
  }

  return (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
      <button onClick={() => refetch()}>
        Refresh
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 4. åŸå­ç»„åˆä¸ä¾èµ–

### 4.1 è‡ªåŠ¨ä¾èµ–è¿½è¸ª

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€åŸå­
const aAtom = atom(1);
const bAtom = atom(2);
const cAtom = atom(3);

// è¡ç”ŸåŸå­è‡ªåŠ¨è¿½è¸ªä¾èµ–
const sumABAtom = atom((get) => {
  console.log('Computing sumAB');
  return get(aAtom) + get(bAtom);
});

const totalAtom = atom((get) => {
  console.log('Computing total');
  const sumAB = get(sumABAtom);
  return sumAB + get(cAtom);
});

function Component() {
  // åªè®¢é˜…totalAtom
  const [total] = useAtom(totalAtom);

  // å½“aAtomå˜åŒ–æ—¶ï¼š
  // 1. sumABAtomé‡æ–°è®¡ç®—
  // 2. totalAtomé‡æ–°è®¡ç®—
  // 3. Componenté‡æ–°æ¸²æŸ“

  return <div>Total: {total}</div>;
}
```

</CodeBlock>

### 4.2 æ¡ä»¶è¡ç”Ÿ

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€åŸå­
const countAtom = atom(0);
const thresholdAtom = atom(10);

// æ¡ä»¶è¡ç”Ÿ
const isHighAtom = atom((get) => {
  const count = get(countAtom);
  const threshold = get(thresholdAtom);
  return count > threshold;
});

const messageAtom = atom((get) => {
  const count = get(countAtom);
  const threshold = get(thresholdAtom);
  const isHigh = get(isHighAtom);

  if (count === 0) return 'Start counting!';
  if (isHigh) return `Count (${count}) is high!`;
  return `Current count: ${count}`;
});

function ConditionalDerived() {
  const [count, setCount] = useAtom(countAtom);
  const [threshold] = useAtom(thresholdAtom);
  const [isHigh] = useAtom(isHighAtom);
  const [message] = useAtom(messageAtom);

  return (
    <div>
      <p>{message}</p>
      <p>Is High: {isHigh ? 'Yes' : 'No'}</p>
      <button onClick={() => setCount(c => c + 1)}>
        Increment
      </button>
    </div>
  );
}
```

</CodeBlock>

### 4.3 ç»„åˆå¤šä¸ªåŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// ç”¨æˆ·ç›¸å…³åŸå­
const firstNameAtom = atom('John');
const lastNameAtom = atom('Doe');
const ageAtom = atom(30);

// ç»„åˆåŸå­
const fullNameAtom = atom((get) => {
  const firstName = get(firstNameAtom);
  const lastName = get(lastNameAtom);
  return `${firstName} ${lastName}`;
});

const isAdultAtom = atom((get) => {
  const age = get(ageAtom);
  return age >= 18;
});

const userSummaryAtom = atom((get) => {
  const fullName = get(fullNameAtom);
  const isAdult = get(isAdultAtom);
  const age = get(ageAtom);
  return {
    name: fullName,
    age,
    status: isAdult ? 'Adult' : 'Minor'
  };
});

function UserInfo() {
  const [firstName, setFirstName] = useAtom(firstNameAtom);
  const [lastName, setLastName] = useAtom(lastNameAtom);
  const [age, setAge] = useAtom(ageAtom);
  const [summary] = useAtom(userSummaryAtom);

  return (
    <div>
      <p>Name: {summary.name}</p>
      <p>Age: {summary.age}</p>
      <p>Status: {summary.status}</p>

      <input
        value={firstName}
        onChange={(e) => setFirstName(e.target.value)}
        placeholder="First Name"
      />
      <input
        value={lastName}
        onChange={(e) => setLastName(e.target.value)}
        placeholder="Last Name"
      />
      <input
        type="number"
        value={age}
        onChange={(e) => setAge(Number(e.target.value))}
        placeholder="Age"
      />
    </div>
  );
}
```

</CodeBlock>

---

## 5. Jotaié«˜çº§æ¨¡å¼

### 5.1 åŠ¨æ€åŸå­

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŠ¨æ€åˆ›å»ºåŸå­
const createTodoAtom = (id) => atom({
  id,
  text: `Todo ${id}`,
  completed: false,
});

// ç´¢å¼•åŸå­
const todoIdsAtom = atom([1, 2, 3]);

// è·å–åŠ¨æ€åŸå­
function useTodoAtom(id) {
  const todoAtom = useMemo(() => createTodoAtom(id), [id]);
  return useAtom(todoAtom);
}

function TodoItem({ id }) {
  const [todo, setTodo] = useTodoAtom(id);
  const [ids] = useAtom(todoIdsAtom);

  return (
    <div>
      <input
        type="checkbox"
        checked={todo.completed}
        onChange={(e) =>
          setTodo({
            ...todo,
            completed: e.target.checked,
          })
        }
      />
      <span>{todo.text}</span>
    </div>
  );
}

function TodoList() {
  const [ids, setIds] = useAtom(todoIdsAtom);

  const addTodo = () => {
    const newId = Math.max(...ids) + 1;
    setIds([...ids, newId]);
  };

  return (
    <div>
      <button onClick={addTodo}>Add Todo</button>
      {ids.map((id) => (
        <TodoItem key={id} id={id} />
      ))}
    </div>
  );
}
```

</CodeBlock>

### 5.2 å¼‚æ­¥ä¾èµ–

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// å¼‚æ­¥åŸå­
const userAtom = atom(async () => {
  const response = await fetch('/api/user');
  return response.json();
});

// ä¾èµ–å¼‚æ­¥åŸå­çš„è¡ç”ŸåŸå­
const userNameAtom = atom((get) => {
  const user = get(userAtom);
  return user?.name || 'Unknown';
});

const userEmailAtom = atom((get) => {
  const user = get(userAtom);
  return user?.email || '';
});

// å¼‚æ­¥å¯å†™åŸå­
const updateUserAtom = atom(
  null,
  async (get, set, updates) => {
    const currentUser = get(userAtom);
    const updatedUser = { ...currentUser, ...updates };

    const response = await fetch('/api/user', {
      method: 'PUT',
      body: JSON.stringify(updatedUser),
    });

    set(userAtom, await response.json());
  }
);

function UserProfile() {
  const [user, { refetch }] = useAtom(userAtom);
  const [userName] = useAtom(userNameAtom);
  const [userEmail] = useAtom(userEmailAtom);
  const [, updateUser] = useAtom(updateUserAtom);

  if (user === undefined) {
    return <div>Loading user...</div>;
  }

  return (
    <div>
      <h2>User Profile</h2>
      <p>Name: {userName}</p>
      <p>Email: {userEmail}</p>
      <button onClick={() => refetch()}>
        Refresh
      </button>
      <button onClick={() => updateUser({ name: 'New Name' })}>
        Update Name
      </button>
    </div>
  );
}
```

</CodeBlock>

### 5.3 åŸå­ä¸­ä»‹è€…æ¨¡å¼

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€åŸå­
const actionAtom = atom(null);
const statusAtom = atom('idle');
const resultAtom = atom(null);

// ä¸­ä»‹è€…åŸå­ï¼ˆç›‘å¬actionå¹¶æ›´æ–°statuså’Œresultï¼‰
const mediatorAtom = atom(null, (get, set, action) => {
  set(actionAtom, action);
  set(statusAtom, 'processing');

  // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
  setTimeout(() => {
    if (action === 'save') {
      set(resultAtom, 'Saved successfully');
      set(statusAtom, 'success');
    } else if (action === 'delete') {
      set(resultAtom, 'Deleted successfully');
      set(statusAtom, 'success');
    } else {
      set(resultAtom, 'Unknown action');
      set(statusAtom, 'error');
    }
  }, 1000);
});

function ActionHandler() {
  const [status, setStatus] = useAtom(statusAtom);
  const [result, setResult] = useAtom(resultAtom);
  const [, trigger] = useAtom(mediatorAtom);

  const handleSave = () => trigger('save');
  const handleDelete = () => trigger('delete');
  const handleReset = () => {
    setStatus('idle');
    setResult(null);
    set(actionAtom, null);
  };

  return (
    <div>
      <p>Status: {status}</p>
      <p>Result: {result}</p>

      <button onClick={handleSave} disabled={status === 'processing'}>
        Save
      </button>
      <button onClick={handleDelete} disabled={status === 'processing'}>
        Delete
      </button>
      <button onClick={handleReset} disabled={status === 'processing'}>
        Reset
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 6. Jotaiæœ€ä½³å®è·µ

### 6.1 åŸå­è®¾è®¡åŸåˆ™

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// âœ… å¥½çš„å®è·µ1ï¼šä¿æŒåŸå­ç®€å•
const userNameAtom = atom('John');
const userAgeAtom = atom(30);

// âŒ é¿å…ï¼šè¿‡åº¦å¤æ‚åŒ–åŸå­
const userAtom = atom({
  name: 'John',
  age: 30,
  address: {
    street: '',
    city: '',
    country: ''
  },
  preferences: {
    theme: 'light',
    language: 'en'
  }
});

// âœ… å¥½çš„å®è·µ2ï¼šæ‹†åˆ†å¤æ‚çŠ¶æ€
const userIdAtom = atom('');
const userProfileAtom = atom(async (get) => {
  const id = get(userIdAtom);
  const response = await fetch(`/api/users/${id}`);
  return response.json();
});

const themeAtom = atom('light');
const languageAtom = atom('en');
```

</CodeBlock>

### 6.2 æ€§èƒ½ä¼˜åŒ–

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// âœ… ä½¿ç”¨useAtomValueé¿å…ä¸å¿…è¦çš„setter
import { useAtomValue } from 'jotai';

function OptimizedComponent() {
  // åªè¯»å–ï¼Œä¸è®¾ç½®
  const count = useAtomValue(countAtom);
  const double = useAtomValue(doubleAtom);

  return <div>Count: {count}, Double: {double}</div>;
}

// âœ… ä½¿ç”¨useSetAtomé¿å…è¯»å–å€¼
import { useSetAtom } from 'jotai';

function ActionsComponent() {
  // åªè®¾ç½®ï¼Œä¸è¯»å–
  const setCount = useSetAtom(countAtom);

  return (
    <button onClick={() => setCount(c => c + 1)}>
      Increment
    </button>
  );
}

// âœ… ä½¿ç”¨useAtomå¯¹å€¼è¿›è¡ŒmemoåŒ–
function useOptimizedAtom(atom) {
  return useAtom(
    atom,
    // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼ˆé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼‰
    (a, b) => a === b
  );
}
```

</CodeBlock>

### 6.3 ç±»å‹å®‰å…¨

<CodeBlock>

```jsx
import { atom } from 'jotai';
import type { Atom } from 'jotai';

// 1. åŸºç¡€ç±»å‹åŸå­
const countAtom = atom<number>(0);
const textAtom = atom<string>('hello');
const boolAtom = atom<boolean>(true);

// 2. å¯¹è±¡åŸå­
interface User {
  name: string;
  age: number;
  email: string;
}

const userAtom = atom<User>({
  name: 'John',
  age: 30,
  email: 'john@example.com'
});

// 3. è¡ç”ŸåŸå­ç±»å‹
const upperTextAtom = atom<string>((get) => {
  const text = get(textAtom);
  return text.toUpperCase();
});

// 4. å¼‚æ­¥åŸå­ç±»å‹
const fetchUserAtom = atom<User, void>(async () => {
  const response = await fetch('/api/user');
  return response.json();
});

// 5. å¯å†™åŸå­ç±»å‹
const setUserAtom = atom<User, User>(
  (get) => get(userAtom),
  (get, set, newUser) => {
    set(userAtom, newUser);
  }
);
```

</CodeBlock>

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1 è´­ç‰©è½¦ç³»ç»Ÿ

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// è´­ç‰©è½¦å•†å“åŸå­
const createCartItemAtom = (id) => atom({
  id,
  name: `Product ${id}`,
  price: 10 * id,
  quantity: 1,
});

const cartItemIdsAtom = atom<number[]>([]);

// è´­ç‰©è½¦æ“ä½œåŸå­
const addToCartAtom = atom(null, (get, set, productId: number) => {
  const currentIds = get(cartItemIdsAtom);
  if (!currentIds.includes(productId)) {
    set(cartItemIdsAtom, [...currentIds, productId]);
  }
});

const removeFromCartAtom = atom(null, (get, set, productId: number) => {
  const currentIds = get(cartItemIdsAtom);
  set(cartItemIdsAtom, currentIds.filter(id => id !== productId));
});

const updateQuantityAtom = atom(null, (get, set, { productId, quantity }) => {
  // é€šè¿‡åŠ¨æ€åŸå­æ›´æ–°
});

// è·å–è´­ç‰©è½¦å•†å“
function useCartItem(productId: number) {
  const cartItemAtom = useMemo(() => createCartItemAtom(productId), [productId]);
  return useAtom(cartItemAtom);
}

function CartItem({ productId }) {
  const [item, setItem] = useCartItem(productId);
  const [, remove] = useAtom(removeFromCartAtom);

  return (
    <div className="cart-item">
      <h3>{item.name}</h3>
      <p>Price: ${item.price}</p>
      <p>Quantity: {item.quantity}</p>
      <button onClick={() => remove(productId)}>
        Remove
      </button>
    </div>
  );
}

function Cart() {
  const [ids] = useAtom(cartItemIdsAtom);
  const [, add] = useAtom(addToCartAtom);

  return (
    <div className="cart">
      <h2>Shopping Cart</h2>

      <button onClick={() => add(1)}>
        Add Product 1
      </button>
      <button onClick={() => add(2)}>
        Add Product 2
      </button>

      <div className="cart-items">
        {ids.map((id) => (
          <CartItem key={id} productId={id} />
        ))}
      </div>
    </div>
  );
}
```

</CodeBlock>

### 7.2 è¡¨å•ç®¡ç†

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// è¡¨å•å­—æ®µåŸå­
const createFieldAtom = (name: string) => atom<string>('');

const nameAtom = createFieldAtom('name');
const emailAtom = createFieldAtom('email');
const passwordAtom = createFieldAtom('password');

// éªŒè¯åŸå­
const nameErrorAtom = atom((get) => {
  const name = get(nameAtom);
  if (!name) return 'Name is required';
  if (name.length < 2) return 'Name must be at least 2 characters';
  return null;
});

const emailErrorAtom = atom((get) => {
  const email = get(emailAtom);
  if (!email) return 'Email is required';
  if (!email.includes('@')) return 'Invalid email';
  return null;
});

const passwordErrorAtom = atom((get) => {
  const password = get(passwordAtom);
  if (!password) return 'Password is required';
  if (password.length < 8) return 'Password must be at least 8 characters';
  return null;
});

// æ•´ä½“è¡¨å•éªŒè¯
const formErrorAtom = atom((get) => {
  const nameError = get(nameErrorAtom);
  const emailError = get(emailErrorAtom);
  const passwordError = get(passwordErrorAtom);
  return {
    name: nameError,
    email: emailError,
    password: passwordError,
  };
});

// è¡¨å•æäº¤åŸå­
const submitFormAtom = atom(null, async (get, set) => {
  const errors = get(formErrorAtom);
  if (errors.name || errors.email || errors.password) {
    return { success: false, errors };
  }

  const formData = {
    name: get(nameAtom),
    email: get(emailAtom),
    password: get(passwordAtom),
  };

  const response = await fetch('/api/submit', {
    method: 'POST',
    body: JSON.stringify(formData),
  });

  return { success: response.ok };
});

function FormField({ label, atom: fieldAtom, errorAtom }) {
  const [value, setValue] = useAtom(fieldAtom);
  const [error] = useAtom(errorAtom);

  return (
    <div className="form-field">
      <label>{label}</label>
      <input
        type="text"
        value={value}
        onChange={(e) => setValue(e.target.value)}
      />
      {error && <span className="error">{error}</span>}
    </div>
  );
}

function Form() {
  const [errors, setErrors] = useAtom(formErrorAtom);
  const [, submit] = useAtom(submitFormAtom);

  const handleSubmit = async (e) => {
    e.preventDefault();
    const result = await submit();
    if (result.success) {
      alert('Form submitted!');
    } else {
      console.log('Form errors:', result.errors);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <FormField
        label="Name"
        atom={nameAtom}
        errorAtom={nameErrorAtom}
      />
      <FormField
        label="Email"
        atom={emailAtom}
        errorAtom={emailErrorAtom}
      />
      <FormField
        label="Password"
        atom={passwordAtom}
        errorAtom={passwordErrorAtom}
      />
      <button type="submit">Submit</button>
    </form>
  );
}
```

</CodeBlock>

### 7.3 å¼‚æ­¥æ•°æ®ç®¡ç†

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// æ•°æ®è·å–åŸå­
const createDataAtom = (key: string) => atom(async () => {
  const response = await fetch(`/api/data/${key}`);
  return response.json();
});

// ç¼“å­˜ç®¡ç†
const cacheAtom = atom<Record<string, any>>({});

const fetchWithCacheAtom = atom(null, async (get, set, key: string) => {
  const cache = get(cacheAtom);
  const dataAtom = createDataAtom(key);

  // è§¦å‘æ•°æ®è·å–
  const data = await new Promise((resolve) => {
    const unsubscribe = dataAtom.onMount?.((setter) => {
      dataAtom.read(get).then(resolve);
    });
  });

  // æ›´æ–°ç¼“å­˜
  set(cacheAtom, { ...cache, [key]: data });
});

// çŠ¶æ€ç®¡ç†
const createDataStatusAtom = (key: string) => atom<'idle' | 'loading' | 'error' | 'success'>('idle');

function useAsyncData(key: string) {
  const dataAtom = useMemo(() => createDataAtom(key), [key]);
  const statusAtom = useMemo(() => createDataStatusAtom(key), [key]);

  const [data] = useAtom(dataAtom);
  const [status, setStatus] = useAtom(statusAtom);
  const [, fetchData] = useAtom(fetchWithCacheAtom);

  const load = async () => {
    setStatus('loading');
    try {
      await fetchData(key);
      setStatus('success');
    } catch (error) {
      setStatus('error');
    }
  };

  return { data, status, load };
}

function DataComponent({ dataKey }) {
  const { data, status, load } = useAsyncData(dataKey);

  if (status === 'loading') {
    return <div>Loading...</div>;
  }

  if (status === 'error') {
    return <div>Error loading data</div>;
  }

  return (
    <div>
      <pre>{JSON.stringify(data, null, 2)}</pre>
      <button onClick={load}>Reload</button>
    </div>
  );
}
```

</CodeBlock>

---

## 8. Jotai vs å…¶ä»–æ–¹æ¡ˆ

### 8.1 Jotai vs Zustand

<Compare>

| ç‰¹æ€§ | Jotai | Zustand |
|------|-------|---------|
| **èŒƒå¼** | åŸå­åŒ–çŠ¶æ€ | é›†ä¸­å¼Store |
| **ç²’åº¦** | æç»†ç²’åº¦ | ç²—ç²’åº¦ |
| **å­¦ä¹ æˆæœ¬** | ä¸­ç­‰ | ä½ |
| **æ€§èƒ½** | ä¼˜ç§€ | ä¼˜ç§€ |
| **ç±»å‹å®‰å…¨** | ä¼˜ç§€ | è‰¯å¥½ |
| **åŠ¨æ€æ€§** | å¼º | å¼± |
| **ä¾èµ–è¿½è¸ª** | è‡ªåŠ¨ | æ‰‹åŠ¨é€‰æ‹©å™¨ |

</Compare>

<CodeBlock>

```jsx
// èŒƒå¼å¯¹æ¯”

// âœ… Jotai - åŸå­åŒ–
const countAtom = atom(0);
const doubleAtom = atom((get) => get(countAtom) * 2);

function Component() {
  const [double] = useAtom(doubleAtom);
  // countAtomå˜åŒ–æ—¶ï¼ŒdoubleAtomè‡ªåŠ¨æ›´æ–°
}

// âœ… Zustand - é›†ä¸­å¼
const useStore = create((set) => ({
  count: 0,
  double: 0,
  increment: () => set((state) => ({
    count: state.count + 1,
    double: (state.count + 1) * 2,
  })),
}));

function Component() {
  const { double } = useStore((state) => ({
    double: state.double,
  }));
  // éœ€è¦æ‰‹åŠ¨æ›´æ–°double
}
```

</CodeBlock>

### 8.2 Jotai vs Redux

<Compare>

| ç‰¹æ€§ | Jotai | Redux |
|------|-------|-------|
| **å¤æ‚åº¦** | ç®€å• | å¤æ‚ |
| **æ ·æ¿ä»£ç ** | æå°‘ | è¾ƒå¤š |
| **ä¸­é—´ä»¶** | æ—  | ä¸°å¯Œ |
| **DevTools** | åŸºç¡€ | å¼ºå¤§ |
| **TypeScript** | ä¼˜ç§€ | è‰¯å¥½ |
| **çŠ¶æ€ç»“æ„** | åˆ†æ•£ | é›†ä¸­ |
| **å­¦ä¹ æ›²çº¿** | å¹³ç¼“ | é™¡å³­ |

</Compare>

### 8.3 Jotai vs Context

<Compare>

| ç‰¹æ€§ | Jotai | Context |
|------|-------|---------|
| **æ›´æ–°ç²’åº¦** | ç²¾ç¡® | ç²—ç²’åº¦ |
| **æ€§èƒ½** | ä¼˜ç§€ | éœ€ä¼˜åŒ– |
| **å­¦ä¹ æˆæœ¬** | ä½ | ä½ |
| **åŠŸèƒ½** | ä¸°å¯Œ | åŸºç¡€ |
| **ç±»å‹å®‰å…¨** | ä¼˜ç§€ | è‰¯å¥½ |
| **ä½¿ç”¨åœºæ™¯** | å¤æ‚çŠ¶æ€ | ç®€å•çŠ¶æ€ |

</Compare>

<CodeBlock>

```jsx
// æ€§èƒ½å¯¹æ¯”

// âŒ Context - æ‰€æœ‰æ¶ˆè´¹è€…é‡æ¸²æŸ“
const AppContext = createContext();

function AppProvider({ children }) {
  const [count, setCount] = useState(0);
  return (
    <AppContext.Provider value={{ count, setCount }}>
      {children}
    </AppContext.Provider>
  );
}

// ä»»ä½•Contextå˜åŒ–ï¼Œæ‰€æœ‰Consumeré‡æ¸²æŸ“
function Consumer() {
  const { count } = useContext(AppContext);
  return <div>{count}</div>;
}

// âœ… Jotai - åªè®¢é˜…éœ€è¦çš„åŸå­
const countAtom = atom(0);

function OptimizedConsumer() {
  const [count] = useAtom(countAtom);
  // åªæœ‰countAtomå˜åŒ–æ—¶æ‰é‡æ¸²æŸ“
  return <div>{count}</div>;
}
```

</CodeBlock>

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 é€‰æ‹©æ€§è®¢é˜…

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// âŒ é¿å…ï¼šè®¢é˜…æ•´ä¸ªå¤§å¯¹è±¡
const largeObjectAtom = atom({
  data1: {},
  data2: {},
  data3: {},
  // 100ä¸ªå­—æ®µ
});

function Component() {
  // ä»»ä½•å­—æ®µå˜åŒ–éƒ½ä¼šå¯¼è‡´é‡æ¸²æŸ“
  const [obj] = useAtom(largeObjectAtom);
  return <div>{obj.data1}</div>;
}

// âœ… æ­£ç¡®ï¼šæ‹†åˆ†åŸå­
const data1Atom = atom({});
const data2Atom = atom({});
const data3Atom = atom({});

function OptimizedComponent() {
  // åªè®¢é˜…éœ€è¦çš„åŸå­
  const [data1] = useAtom(data1Atom);
  return <div>{data1}</div>;
}
```

</CodeBlock>

### 9.2 è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°

<CodeBlock>

```jsx
import { atom, useAtom } from 'jotai';

// åŸºç¡€æ•°ç»„åŸå­
const itemsAtom = atom<number[]>([1, 2, 3]);

// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•° - é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const compareArrays = (a: number[], b: number[]) => {
  if (a.length !== b.length) return false;
  for (let i = 0; i < a.length; i++) {
    if (a[i] !== b[i]) return false;
  }
  return true;
};

function OptimizedList() {
  const [items, setItems] = useAtom(
    itemsAtom,
    compareArrays // è‡ªå®šä¹‰æ¯”è¾ƒ
  );

  const addItem = () => {
    setItems((prev) => [...prev, prev.length + 1]);
  };

  return (
    <div>
      <button onClick={addItem}>Add Item</button>
      <ul>
        {items.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
    </div>
  );
}
```

</CodeBlock>

### 9.3 æ‡’åŠ è½½åŸå­

<CodeBlock>

```jsx
import { atom } from 'jotai';

// æ‡’åŠ è½½å¤§å‹æ•°æ®
const createHeavyDataAtom = (id: string) => atom(async () => {
  // åªåœ¨éœ€è¦æ—¶åŠ è½½
  const response = await fetch(`/api/heavy-data/${id}`);
  return response.json();
});

function HeavyDataComponent({ dataId }) {
  // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶åˆ›å»ºåŸå­
  const dataAtom = useMemo(
    () => createHeavyDataAtom(dataId),
    [dataId]
  );

  const [data, { refetch }] = useAtom(dataAtom);

  if (data === undefined) {
    return <div>Loading heavy data...</div>;
  }

  return (
    <div>
      <pre>{JSON.stringify(data, null, 2)}</pre>
      <button onClick={() => refetch()}>
        Reload
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 10. å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ

### é™·é˜±1ï¼šåŸå­è¿‡äºå¤æ‚

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - å¤æ‚çš„å¤§åŸå­
const complexAtom = atom({
  user: {
    profile: {
      name: '',
      email: '',
      address: {
        street: '',
        city: '',
        country: ''
      }
    },
    preferences: {
      theme: 'light',
      language: 'en',
      notifications: {
        email: true,
        push: true
      }
    }
  },
  settings: {
    privacy: {},
    security: {}
  }
});

// âœ… æ­£ç¡® - æ‹†åˆ†åŸå­
const userProfileNameAtom = atom('');
const userProfileEmailAtom = atom('');
const userProfileAddressAtom = atom({
  street: '',
  city: '',
  country: ''
});
const preferencesThemeAtom = atom('light');
const preferencesLanguageAtom = atom('en');
// ... ç»§ç»­æ‹†åˆ†
```

</ErrorBox>

### é™·é˜±2ï¼šå¿˜è®°ä¾èµ–è¿½è¸ª

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ä¾èµ–æœªæ­£ç¡®è¿½è¸ª
const countAtom = atom(0);
const textAtom = atom('hello');

const mixedAtom = atom((get) => {
  const count = get(countAtom);
  // å¿˜è®°è·å–textAtomï¼Œä½†å®é™…éœ€è¦å®ƒ
  const text = get(textAtom); // âŒ æ¼æ‰äº†è¿™è¡Œ
  return `${count}:${text}`;
});

// âœ… æ­£ç¡® - æ˜ç¡®æ‰€æœ‰ä¾èµ–
const mixedAtom = atom((get) => {
  const count = get(countAtom);
  const text = get(textAtom); // âœ… æ˜ç¡®è·å–
  return `${count}:${text}`;
});
```

</ErrorBox>

### é™·é˜±3ï¼šå¼‚æ­¥åŸå­å¤„ç†é”™è¯¯

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æœªå¤„ç†å¼‚æ­¥é”™è¯¯
const userAtom = atom(async () => {
  const response = await fetch('/api/user');
  // æœªå¤„ç†é”™è¯¯æƒ…å†µ
  return response.json();
});

// âœ… æ­£ç¡® - å¤„ç†é”™è¯¯çŠ¶æ€
const userAtom = atom(async () => {
  try {
    const response = await fetch('/api/user');
    if (!response.ok) {
      throw new Error('Failed to fetch');
    }
    return response.json();
  } catch (error) {
    throw error; // é‡æ–°æŠ›å‡ºé”™è¯¯
  }
});

function UserProfile() {
  const [user, { refetch }] = useAtom(userAtom);

  if (user instanceof Error) {
    return (
      <div>
        <p>Error: {user.message}</p>
        <button onClick={() => refetch()}>
          Retry
        </button>
      </div>
    );
  }

  if (user === undefined) {
    return <div>Loading...</div>;
  }

  return <div>{user.name}</div>;
}
```

</ErrorBox>

### é™·é˜±4ï¼šè¿‡åº¦ä½¿ç”¨åŠ¨æ€åŸå­

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ¯ä¸ªç»„ä»¶éƒ½åˆ›å»ºæ–°åŸå­
function TodoItem({ id }) {
  // æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°åŸå­ï¼
  const todoAtom = atom({
    id,
    text: `Todo ${id}`,
    completed: false,
  });

  const [todo] = useAtom(todoAtom);
  return <div>{todo.text}</div>;
}

// âœ… æ­£ç¡® - ä½¿ç”¨å·¥å‚å‡½æ•°
const createTodoAtom = (id) => atom({
  id,
  text: `Todo ${id}`,
  completed: false,
});

function TodoItem({ id }) {
  const todoAtom = useMemo(
    () => createTodoAtom(id),
    [id] // åªåœ¨idå˜åŒ–æ—¶é‡æ–°åˆ›å»º
  );

  const [todo] = useAtom(todoAtom);
  return <div>{todo.text}</div>;
}
```

</ErrorBox>

---

## 11. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå®ç°åŸå­åŒ–è®¡æ•°å™¨

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- åˆ›å»ºåŸºç¡€è®¡æ•°å™¨åŸå­
- åˆ›å»ºè¡ç”ŸåŸå­ï¼šdoubleã€triple
- åˆ›å»ºå¯å†™åŸå­ï¼šincrementã€decrement
- å®ç°æ¡ä»¶è¡ç”Ÿ

**å®ç°è¦æ±‚**ï¼š
```javascript
// éœ€è¦å®ç°çš„åŠŸèƒ½
const countAtom = atom(0); // åŸºç¡€åŸå­
const doubleAtom = atom((get) => get(countAtom) * 2); // è¡ç”ŸåŸå­
const incrementAtom = atom(null, (get, set) => {
  // å®ç°incrementé€»è¾‘
});
```

**æç¤º**ï¼š
- ä½¿ç”¨getå’Œsetå‡½æ•°
- ç†è§£åªè¯»å’Œå¯å†™åŸå­
- è‡ªåŠ¨ä¾èµ–è¿½è¸ª

</Expandable>

### ç»ƒä¹ 2ï¼šå®ç°å¾…åŠäº‹é¡¹åˆ—è¡¨

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- åˆ›å»ºåŠ¨æ€å¾…åŠäº‹é¡¹åŸå­
- å®ç°æ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢åŠŸèƒ½
- ç»Ÿè®¡ä¿¡æ¯è¡ç”ŸåŸå­
- è¿‡æ»¤åŠŸèƒ½

**å®ç°è¦æ±‚**ï¼š
```javascript
// éœ€è¦å®ç°çš„åŠŸèƒ½
const createTodoAtom = (id) => atom({
  id,
  text: `Todo ${id}`,
  completed: false,
});
const todoIdsAtom = atom([]);
const activeFilterAtom = atom('all'); // 'all', 'active', 'completed'

// è¡ç”ŸåŸå­
const filteredTodosAtom = atom((get) => {
  // å®ç°è¿‡æ»¤é€»è¾‘
});
```

**æç¤º**ï¼š
- ä½¿ç”¨åŠ¨æ€åŸå­
- ç†è§£è¡ç”ŸåŸç”Ÿçš„è‡ªåŠ¨æ›´æ–°
- å®ç°å¤æ‚æ¡ä»¶é€»è¾‘

</Expandable>

### ç»ƒä¹ 3ï¼šå®ç°æ•°æ®è·å–ä¸ç¼“å­˜

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- åˆ›å»ºå¼‚æ­¥æ•°æ®åŸå­
- å®ç°æ•°æ®ç¼“å­˜
- å¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€
- å®ç°åˆ·æ–°åŠŸèƒ½

**å®ç°è¦æ±‚**ï¼š
```javascript
// éœ€è¦å®ç°çš„åŠŸèƒ½
const createDataAtom = (key) => atom(async () => {
  // å®ç°æ•°æ®è·å–é€»è¾‘
});
const cacheAtom = atom({});
const isLoadingAtom = atom(false);

// å¼‚æ­¥åŸå­
const fetchDataAtom = atom(null, async (get, set, key) => {
  // å®ç°è·å–å’Œç¼“å­˜é€»è¾‘
});
```

**æç¤º**ï¼š
- ç†è§£å¼‚æ­¥åŸå­
- å®ç°ç¼“å­˜æœºåˆ¶
- å¤„ç†é”™è¯¯çŠ¶æ€

</Expandable>

### ç»ƒä¹ 4ï¼šå®ç°è¡¨å•éªŒè¯ç³»ç»Ÿ

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- åˆ›å»ºè¡¨å•å­—æ®µåŸå­
- å®ç°éªŒè¯è§„åˆ™
- ç»Ÿè®¡éªŒè¯é”™è¯¯
- åŠ¨æ€æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

**å®ç°è¦æ±‚**ï¼š
```javascript
// éœ€è¦å®ç°çš„åŠŸèƒ½
const createFieldAtom = (name) => atom('');
const fieldErrorsAtom = atom({});
const formErrorsAtom = atom((get) => {
  // å®ç°èšåˆé”™è¯¯é€»è¾‘
});

// éªŒè¯è§„åˆ™
const validateNameAtom = atom((get) => {
  const name = get(nameAtom);
  if (!name) return 'Name is required';
  return null;
});
```

**æç¤º**ï¼š
- ä½¿ç”¨å¤šä¸ªåŸå­
- å®ç°éªŒè¯é€»è¾‘
- ç†è§£è¡ç”ŸåŸç”Ÿçš„è‡ªåŠ¨æ›´æ–°

</Expandable>

---

## 12. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… Jotaié‡‡ç”¨åŸå­åŒ–çŠ¶æ€ç†å¿µ
- âœ… æœ€å°ä¸å¯åˆ†çš„çŠ¶æ€å•å…ƒ
- âœ… è‡ªåŠ¨è¿½è¸ªä¾èµ–å…³ç³»
- âœ… ç»†ç²’åº¦æ€§èƒ½ä¼˜åŒ–
- âœ… ç®€å•æ˜“ç”¨çš„API
- âœ… ä¼˜ç§€çš„TypeScriptæ”¯æŒ
- âœ… è‡ªç”±ç»„åˆåŸå­
- âœ… æ”¯æŒå¼‚æ­¥æ“ä½œ
- âœ… ç±»å‹å®‰å…¨
- âœ… çµæ´»çš„åŠ¨æ€åŸå­

</Checklist>

### Jotaiæœ€ä½³å®è·µ

<BestPractices>

1. **ä¿æŒåŸå­ç®€å•** - é¿å…å¤æ‚çš„å¤§åŸå­
2. **åˆç†æ‹†åˆ†** - å°†å¤æ‚çŠ¶æ€æ‹†åˆ†ä¸ºå¤šä¸ªåŸå­
3. **ä½¿ç”¨è¡ç”ŸåŸå­** - å……åˆ†åˆ©ç”¨è‡ªåŠ¨ä¾èµ–è¿½è¸ª
4. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨useAtomValueå’ŒuseSetAtom
5. **ç±»å‹å®‰å…¨** - å……åˆ†åˆ©ç”¨TypeScript
6. **å¼‚æ­¥å¤„ç†** - æ­£ç¡®å¤„ç†å¼‚æ­¥åŸå­çš„é”™è¯¯
7. **åŠ¨æ€åŸå­** - ä½¿ç”¨å·¥å‚å‡½æ•°åˆ›å»º
8. **é¿å…è¿‡åº¦è®¾è®¡** - ä¸è¦ä¸ºæ‰€æœ‰çŠ¶æ€åˆ›å»ºåŸå­

</BestPractices>

### ä½•æ—¶ä½¿ç”¨Jotai

<BestPractices>

**æ¨èä½¿ç”¨Jotaiçš„åœºæ™¯**ï¼š
- éœ€è¦ç»†ç²’åº¦çŠ¶æ€æ§åˆ¶
- æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åº”ç”¨
- TypeScripté¡¹ç›®
- çŠ¶æ€é—´æœ‰å¤æ‚ä¾èµ–
- åŠ¨æ€åˆ›å»ºçŠ¶æ€
- ç»„ä»¶é—´éœ€è¦ç²¾ç¡®å…±äº«

**è€ƒè™‘å…¶ä»–æ–¹æ¡ˆçš„åœºæ™¯**ï¼š
- ç®€å•çš„å…¨å±€çŠ¶æ€ï¼ˆContextè¶³å¤Ÿï¼‰
- éœ€è¦ä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€ï¼ˆReduxï¼‰
- å›¢é˜Ÿä¸ç†Ÿæ‚‰æ–°èŒƒå¼
- éœ€è¦æˆç†Ÿçš„è°ƒè¯•å·¥å…·

**Jotaiä¸é€‚åˆçš„åœºæ™¯**ï¼š
- æç®€çŠ¶æ€ç®¡ç†
- éœ€è¦æ—¶é—´æ—…è¡Œè°ƒè¯•
- å¤§é‡ç¬¬ä¸‰æ–¹æ’ä»¶éœ€æ±‚

</BestPractices>

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†Jotaiçš„åŸå­åŒ–çŠ¶æ€ç®¡ç†ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[çŠ¶æ€ç®¡ç†å¯¹æ¯”åˆ†æ]** - å…¨é¢å¯¹æ¯”å„ç§æ–¹æ¡ˆ
2. **[æ€§èƒ½ä¼˜åŒ–åŸºç¡€](../performance/react-memo)** - çŠ¶æ€æ›´æ–°æ€§èƒ½ä¼˜åŒ–
3. **[è‡ªå®šä¹‰Hooksè¿›é˜¶](../hooks/advanced/custom-hooks)** - é€»è¾‘å¤ç”¨æ¨¡å¼

---

## 13. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Jotaiå®˜æ–¹æ–‡æ¡£](https://jotai.org/) - å®Œæ•´çš„APIå‚è€ƒ
- [Jotai Examples](https://github.com/pmndrs/jotai/tree/main/examples) - å®é™…åº”ç”¨ç¤ºä¾‹
- [Jotai Middleware](https://jotai.org/guides/extensions) - æ‰©å±•åˆ—è¡¨

### æ¨èé˜…è¯»

- [Jotaiè®¾è®¡åŸç†](https://jotai.org/guides/philosophy) - è®¾è®¡ç†å¿µ
- [Jotaiæ€§èƒ½æŒ‡å—](https://jotai.org/guides/performance) - æ€§èƒ½ä¼˜åŒ–
- [Jotai TypeScriptæŒ‡å—](https://jotai.org/guides/types) - ç±»å‹ç³»ç»Ÿ

### ç›¸å…³è¯é¢˜

- [ReduxåŸºç¡€](./redux-fundamentals) - ä¼ ç»ŸçŠ¶æ€ç®¡ç†
- [Context API](../context-api) - Reactå†…ç½®çŠ¶æ€ç®¡ç†
- [Zustand](./zustand) - è½»é‡çº§çŠ¶æ€ç®¡ç†
- [çŠ¶æ€ç®¡ç†å¯¹æ¯”] - å„æ–¹æ¡ˆè¯¦ç»†å¯¹æ¯”

---

[â† ä¸Šä¸€ç« ï¼šZustandè½»é‡æ–¹æ¡ˆ](zustand) | [ä¸‹ä¸€ç« ï¼šçŠ¶æ€ç®¡ç†å¯¹æ¯”åˆ†æ â†’](../)
