# ReduxåŸºç¡€ - å·¥ä¸šçº§çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆ

import { Tabs, TabItem } from '@docusaurus/theme-common';

Reduxæ˜¯Reactç”Ÿæ€ç³»ç»Ÿä¸­æœ€æˆç†Ÿçš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸ºJavaScriptåº”ç”¨æä¾›äº†å¯é¢„æµ‹çš„çŠ¶æ€å®¹å™¨ã€‚è™½ç„¶å­¦ä¹ æ›²çº¿ç›¸å¯¹è¾ƒé™¡ï¼Œä½†Reduxæä¾›äº†å¼ºå¤§çš„æ—¶é—´æ—…è¡Œè°ƒè¯•ã€ä¸­é—´ä»¶æ”¯æŒå’Œä¸å¯å˜æ•°æ®æ›´æ–°ï¼Œä½¿å…¶æˆä¸ºå¤æ‚ä¼ä¸šçº§åº”ç”¨çš„é¦–é€‰ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£Reduxçš„æ ¸å¿ƒæ¦‚å¿µï¼šStoreã€Actionã€Reducer
- æŒæ¡Redux Toolkitçš„ç°ä»£ç”¨æ³•
- å­¦ä¼šä½¿ç”¨Reduxè¿›è¡ŒçŠ¶æ€ç®¡ç†
- ç†è§£ä¸å¯å˜æ•°æ®æ›´æ–°çš„é‡è¦æ€§
- æŒæ¡Redux DevToolsçš„ä½¿ç”¨
- å­¦ä¼šä½¿ç”¨Reduxä¸­é—´ä»¶å¤„ç†å‰¯ä½œç”¨
- ç†è§£Reduxçš„å¼‚æ­¥æ•°æ®æµ
- æŒæ¡Reduxæœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼
- ç†è§£Reduxä¸å…¶ä»–çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„å¯¹æ¯”
- å­¦ä¼šåœ¨å¤§å‹é¡¹ç›®ä¸­ç»„ç»‡Reduxä»£ç 

---

## 1. Reduxæ ¸å¿ƒæ¦‚å¿µ

ReduxåŸºäºä¸‰ä¸ªåŸºæœ¬åŸåˆ™ï¼šå•ä¸€æ•°æ®æºã€çŠ¶æ€æ˜¯åªè¯»çš„ã€ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹çŠ¶æ€ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒç†å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>å•ä¸€æ•°æ®æº</strong> - æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€å­˜å‚¨åœ¨ä¸€ä¸ªJavaScriptå¯¹è±¡ä¸­<br />
    <strong>çŠ¶æ€æ˜¯åªè¯»çš„</strong> - åªèƒ½é€šè¿‡Actionæ¥æ”¹å˜çŠ¶æ€<br />
    <strong>ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹</strong> - Reducerå¿…é¡»æ˜¯çº¯å‡½æ•°
  </p>
</Box>

<CodeBlock>

```jsx
// Reduxæ ¸å¿ƒæ¦‚å¿µç¤ºä¾‹
// 1. Action - æè¿°å‘ç”Ÿäº†ä»€ä¹ˆçš„å¯¹è±¡
const increment = {
  type: 'counter/increment',
  payload: 1
};

const addTodo = {
  type: 'todos/addTodo',
  payload: {
    id: 1,
    text: 'Learn Redux',
    completed: false
  }
};

// 2. Reducer - æ ¹æ®Actionæ›´æ–°çŠ¶æ€çš„çº¯å‡½æ•°
function counterReducer(state = 0, action) {
  switch (action.type) {
    case 'counter/increment':
      return state + action.payload;
    default:
      return state;
  }
}

function todosReducer(state = [], action) {
  switch (action.type) {
    case 'todos/addTodo':
      return [...state, action.payload];
    default:
      return state;
  }
}

// 3. Store - å­˜å‚¨çŠ¶æ€çš„åœ°æ–¹
import { createStore } from 'redux';

const store = createStore(counterReducer);

// 4. è·å–çŠ¶æ€
console.log(store.getState()); // 0

// 5. ç›‘å¬çŠ¶æ€å˜åŒ–
store.subscribe(() => {
  console.log('State changed:', store.getState());
});

// 6. æ´¾å‘Action
store.dispatch(increment); // State: 1
store.dispatch(increment); // State: 2
```

</CodeBlock>

### 1.1 Reduxå·¥ä½œæµç¨‹

<Grid>

<div>
  <h4>æ•°æ®æµå‘</h4>
  <ol>
    <li>1. ç”¨æˆ·ä¸UIäº¤äº’</li>
    <li>2. ç»„ä»¶è°ƒç”¨ store.dispatch(action)</li>
    <li>3. Reduxè°ƒç”¨ reducer(oldState, action)</li>
    <li>4. reducerè¿”å›æ–°çŠ¶æ€</li>
    <li>5. é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…</li>
    <li>6. UIæ ¹æ®æ–°çŠ¶æ€é‡æ–°æ¸²æŸ“</li>
  </ol>
</div>

<div>
  <h4>å…³é”®ç»„ä»¶</h4>
  <ul>
    <li><strong>Action</strong> - äº‹ä»¶å¯¹è±¡</li>
    <li><strong>Action Creator</strong> - åˆ›å»ºActionçš„å‡½æ•°</li>
    <li><strong>Reducer</strong> - çŠ¶æ€æ›´æ–°å‡½æ•°</li>
    <li><strong>Store</strong> - çŠ¶æ€å®¹å™¨</li>
    <li><strong>Dispatch</strong> - æ´¾å‘Actionçš„æ–¹æ³•</li>
    <li><strong>Subscribe</strong> - ç›‘å¬çŠ¶æ€å˜åŒ–</li>
  </ul>
</div>

</Grid>

<CodeBlock>

```jsx
// Action Creatorç¤ºä¾‹
// ä¼ ç»Ÿçš„Action Creator
function addTodo(text) {
  return {
    type: 'todos/addTodo',
    payload: {
      id: Date.now(),
      text,
      completed: false
    }
  };
}

// ä½¿ç”¨
store.dispatch(addTodo('Learn Redux'));

// Redux Toolkitçš„createActionï¼ˆæ›´ç°ä»£çš„æ–¹å¼ï¼‰
import { createAction } from '@reduxjs/toolkit';

const addTodo = createAction('todos/addTodo', (text) => {
  return {
    payload: {
      id: Date.now(),
      text,
      completed: false
    }
  };
});

// ä½¿ç”¨æ–¹å¼ç›¸åŒï¼Œä½†æ›´å¼ºå¤§
store.dispatch(addTodo('Learn Redux Toolkit'));
```

</CodeBlock>

---

## 2. Redux Toolkit - ç°ä»£Redux

Redux Toolkitæ˜¯å®˜æ–¹æ¨èçš„ä½¿ç”¨Reduxçš„æ–¹å¼ï¼Œå®ƒç®€åŒ–äº†é…ç½®ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç ã€‚

<CodeBlock>

```jsx
// ä½¿ç”¨Redux Toolkitåˆ›å»ºStore
import { configureStore } from '@reduxjs/toolkit';
import { createSlice } from '@reduxjs/toolkit';

// 1. åˆ›å»ºSlice
const counterSlice = createSlice({
  name: 'counter',
  initialState: {
    value: 0
  },
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    }
  }
});

const { actions, reducer } = counterSlice;
const { increment, decrement, incrementByAmount } = actions;

// 2. åˆ›å»ºStore
const store = configureStore({
  reducer: {
    counter: reducer
  }
});

// 3. ä½¿ç”¨
store.dispatch(increment()); // { value: 1 }
store.dispatch(incrementByAmount(5)); // { value: 6 }
store.dispatch(decrement()); // { value: 5 }
```

</CodeBlock>

### 2.1 å¤šä¸ªSliceç»„åˆ

<CodeBlock>

```jsx
// å®Œæ•´çš„Redux Toolkitç¤ºä¾‹
import { configureStore } from '@reduxjs/toolkit';
import { createSlice } from '@reduxjs/toolkit';

// 1. Counter Slice
const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => { state.value += 1; },
    decrement: (state) => { state.value -= 1; },
    incrementByAmount: (state, action) => {
      state.value += action.payload;
    }
  }
});

// 2. Todos Slice
const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => {
      state.push({
        id: Date.now(),
        text: action.payload,
        completed: false
      });
    },
    toggleTodo: (state, action) => {
      const todo = state.find(t => t.id === action.payload);
      if (todo) {
        todo.completed = !todo.completed;
      }
    },
    removeTodo: (state, action) => {
      return state.filter(t => t.id !== action.payload);
    }
  }
});

// 3. User Slice
const userSlice = createSlice({
  name: 'user',
  initialState: { name: '', age: 0 },
  reducers: {
    setUser: (state, action) => {
      state.name = action.payload.name;
      state.age = action.payload.age;
    },
    clearUser: (state) => {
      state.name = '';
      state.age = 0;
    }
  }
});

// 4. ç»„åˆæ‰€æœ‰Slice
const store = configureStore({
  reducer: {
    counter: counterSlice.reducer,
    todos: todosSlice.reducer,
    user: userSlice.reducer
  }
});

// 5. å¯¼å‡ºactions
export const { increment, decrement, incrementByAmount } = counterSlice.actions;
export const { addTodo, toggleTodo, removeTodo } = todosSlice.actions;
export const { setUser, clearUser } = userSlice.actions;

// 6. å¯¼å‡ºstore
export default store;

// 7. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { useDispatch, useSelector } from 'react-redux';
import { increment, addTodo } from './store';

function Counter() {
  const count = useSelector(state => state.counter.value);
  const dispatch = useDispatch();

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={() => dispatch(increment())}>
        Increment
      </button>
    </div>
  );
}
```

</CodeBlock>

### 2.2 å¼‚æ­¥æ“ä½œ - createAsyncThunk

<CodeBlock>

```jsx
// ä½¿ç”¨createAsyncThunkå¤„ç†å¼‚æ­¥æ“ä½œ
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

// 1. åˆ›å»ºå¼‚æ­¥Action
export const fetchUsers = createAsyncThunk(
  'users/fetchUsers',
  async () => {
    const response = await fetch('https://jsonplaceholder.typicode.com/users');
    return await response.json();
  }
);

// 2. åˆ›å»ºSlice
const usersSlice = createSlice({
  name: 'users',
  initialState: {
    items: [],
    loading: false,
    error: null
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchUsers.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchUsers.fulfilled, (state, action) => {
        state.loading = false;
        state.items = action.payload;
      })
      .addCase(fetchUsers.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      });
  }
});

// 3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function UsersList() {
  const dispatch = useDispatch();
  const { items, loading, error } = useSelector(state => state.users);

  useEffect(() => {
    dispatch(fetchUsers());
  }, [dispatch]);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <ul>
      {items.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

</CodeBlock>

---

## 3. åœ¨Reactä¸­ä½¿ç”¨Redux

### 3.1 Providerè®¾ç½®

<CodeBlock>

```jsx
// index.js - åº”ç”¨å…¥å£
import React from 'react';
import ReactDOM from 'react-dom';
import { Provider } from 'react-redux';
import store from './store';
import App from './App';

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById('root')
);
```

</CodeBlock>

### 3.2 useSelectorå’ŒuseDispatch

<CodeBlock>

```jsx
// ä½¿ç”¨React-Redux Hooks
import { useSelector, useDispatch } from 'react-redux';
import { increment, decrement } from './store';

function Counter() {
  // useSelector - ä»Storeè¯»å–æ•°æ®
  const count = useSelector(state => state.counter.value);
  const todos = useSelector(state => state.todos);

  // useDispatch - æ´¾å‘Actions
  const dispatch = useDispatch();

  return (
    <div>
      <h1>Count: {count}</h1>
      <button onClick={() => dispatch(increment())}>
        +
      </button>
      <button onClick={() => dispatch(decrement())}>
        -
      </button>

      <h2>Todos ({todos.length})</h2>
      {todos.map(todo => (
        <div key={todo.id}>
          {todo.text} - {todo.completed ? 'Done' : 'Pending'}
        </div>
      ))}
    </div>
  );
}
```

</CodeBlock>

### 3.3 å¤šä¸ªé€‰æ‹©å™¨

<CodeBlock>

```jsx
// é€‰æ‹©å™¨çš„é«˜çº§ç”¨æ³•
import { useSelector } from 'react-redux';

// 1. åŸºç¡€é€‰æ‹©å™¨
const count = useSelector(state => state.counter.value);

// 2. è®¡ç®—å‹é€‰æ‹©å™¨
const totalTodos = useSelector(state => state.todos.length);
const completedTodos = useSelector(state =>
  state.todos.filter(t => t.completed).length
);

// 3. é€‰æ‹©å™¨å‡½æ•°
const selectUserById = (state, userId) =>
  state.users.items.find(user => user.id === userId);

function UserProfile({ userId }) {
  const user = useSelector(state => selectUserById(state, userId));

  if (!user) return <div>Loading...</div>;

  return (
    <div>
      <h2>{user.name}</h2>
      <p>Email: {user.email}</p>
    </div>
  );
}

// 4. ä½¿ç”¨reselectåˆ›å»ºè®°å¿†åŒ–é€‰æ‹©å™¨
import { createSelector } from '@reduxjs/toolkit';

const selectTodos = state => state.todos;
const selectFilter = state => state.filter;

const selectFilteredTodos = createSelector(
  [selectTodos, selectFilter],
  (todos, filter) => {
    switch (filter) {
      case 'active':
        return todos.filter(t => !t.completed);
      case 'completed':
        return todos.filter(t => t.completed);
      default:
        return todos;
    }
  }
);

function TodoList() {
  const todos = useSelector(selectFilteredTodos);

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>{todo.text}</li>
      ))}
    </ul>
  );
}
```

</CodeBlock>

---

## 4. ä¸å¯å˜æ•°æ®æ›´æ–°

Reduxè¦æ±‚çŠ¶æ€æ›´æ–°å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸èƒ½ç›´æ¥ä¿®æ”¹ç°æœ‰çŠ¶æ€ã€‚

<Compare>

```jsx
// âŒ é”™è¯¯ - ç›´æ¥ä¿®æ”¹çŠ¶æ€
function todosReducer(state = [], action) {
  switch (action.type) {
    case 'addTodo':
      state.push({
        id: Date.now(),
        text: action.payload,
        completed: false
      });
      return state; // è¿”å›åŒä¸€ä¸ªæ•°ç»„å¼•ç”¨ï¼

    case 'toggleTodo':
      const todo = state.find(t => t.id === action.payload);
      if (todo) {
        todo.completed = !todo.completed; // ç›´æ¥ä¿®æ”¹
      }
      return state;

    default:
      return state;
  }
}

// âœ… æ­£ç¡® - ä½¿ç”¨ä¸å¯å˜æ›´æ–°
function todosReducer(state = [], action) {
  switch (action.type) {
    case 'addTodo':
      return [
        ...state,
        {
          id: Date.now(),
          text: action.payload,
          completed: false
        }
      ];

    case 'toggleTodo':
      return state.map(todo =>
        todo.id === action.payload
          ? { ...todo, completed: !todo.completed }
          : todo
      );

    case 'removeTodo':
      return state.filter(todo => todo.id !== action.payload);

    default:
      return state;
  }
}
```

</Compare>

### 4.1 åµŒå¥—å¯¹è±¡æ›´æ–°

<CodeBlock>

```jsx
// æ›´æ–°åµŒå¥—å¯¹è±¡çš„æ¨¡å¼
function userReducer(state = { profile: { name: '', settings: {} } }, action) {
  switch (action.type) {
    case 'updateProfile':
      return {
        ...state,
        profile: {
          ...state.profile,
          name: action.payload.name
        }
      };

    case 'updateSettings':
      return {
        ...state,
        profile: {
          ...state.profile,
          settings: {
            ...state.profile.settings,
            ...action.payload
          }
        }
      };

    case 'updateNestedSetting':
      return {
        ...state,
        profile: {
          ...state.profile,
          settings: {
            ...state.profile.settings,
            theme: {
              ...state.profile.settings.theme,
              [action.payload.key]: action.payload.value
            }
          }
        }
      };

    default:
      return state;
  }
}
```

</CodeBlock>

### 4.2 ä½¿ç”¨Immerç®€åŒ–ä¸å¯å˜æ›´æ–°

<CodeBlock>

```jsx
// Redux Toolkitå†…ç½®Immerï¼Œå¯ä»¥ç›´æ¥"ä¿®æ”¹"çŠ¶æ€
import { createSlice } from '@reduxjs/toolkit';

const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => {
      // çœ‹èµ·æ¥åƒåœ¨ä¿®æ”¹ï¼Œä½†Immerä¼šå¤„ç†ä¸å¯å˜æ›´æ–°
      state.push({
        id: Date.now(),
        text: action.payload,
        completed: false
      });
    },

    toggleTodo: (state, action) => {
      const todo = state.find(t => t.id === action.payload);
      if (todo) {
        todo.completed = !todo.completed;
      }
    },

    removeTodo: (state, action) => {
      // Immerçš„filterä¹Ÿæ”¯æŒ
      return state.filter(t => t.id !== action.payload);
    }
  }
});

// Immerä¼šè‡ªåŠ¨å°†"ä¿®æ”¹"è½¬æ¢ä¸ºä¸å¯å˜æ›´æ–°
// ç­‰ä»·äºï¼š
// return [...state, newTodo];
// return state.map(t => ...);
// return state.filter(t => ...);
```

</CodeBlock>

---

## 5. ä¸­é—´ä»¶

ä¸­é—´ä»¶æä¾›æ‰©å±•ReduxåŠŸèƒ½çš„èƒ½åŠ›ï¼Œæœ€å¸¸ç”¨çš„æ˜¯å¤„ç†å¼‚æ­¥æ“ä½œã€‚

<CodeBlock>

```jsx
// è‡ªå®šä¹‰ä¸­é—´ä»¶
import { configureStore } from '@reduxjs/toolkit';

// æ—¥å¿—ä¸­é—´ä»¶
const loggerMiddleware = store => next => action => {
  console.log('Dispatching:', action);
  const result = next(action);
  console.log('Next state:', store.getState());
  return result;
};

// å¼‚æ­¥ä¸­é—´ä»¶
const asyncActionMiddleware = store => next => action => {
  if (typeof action === 'function') {
    return action(store.dispatch, store.getState);
  }
  return next(action);
};

// åˆ›å»ºStoreæ—¶åº”ç”¨ä¸­é—´ä»¶
const store = configureStore({
  reducer: {
    counter: counterReducer,
    todos: todosReducer
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(
      loggerMiddleware,
      asyncActionMiddleware
    )
});

// ä½¿ç”¨
store.dispatch((dispatch, getState) => {
  dispatch({ type: 'fetch/start' });

  fetch('/api/data')
    .then(response => response.json())
    .then(data => dispatch({ type: 'fetch/success', payload: data }))
    .catch(error => dispatch({ type: 'fetch/error', error }));
});
```

</CodeBlock>

### 5.1 Redux Thunk - æœ€æµè¡Œçš„ä¸­é—´ä»¶

<CodeBlock>

```jsx
// ä½¿ç”¨Redux Thunkå¤„ç†å¼‚æ­¥
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import axios from 'axios';

// æ–¹å¼1ï¼šä½¿ç”¨createAsyncThunk
export const fetchUser = createAsyncThunk(
  'user/fetchUser',
  async (userId) => {
    const response = await axios.get(`/api/users/${userId}`);
    return response.data;
  }
);

const userSlice = createSlice({
  name: 'user',
  initialState: { data: null, status: 'idle', error: null },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchUser.pending, (state) => {
        state.status = 'loading';
      })
      .addCase(fetchUser.fulfilled, (state, action) => {
        state.status = 'succeeded';
        state.data = action.payload;
      })
      .addCase(fetchUser.rejected, (state, action) => {
        state.status = 'failed';
        state.error = action.error.message;
      });
  }
});

// æ–¹å¼2ï¼šä½¿ç”¨Thunkæ‰‹åŠ¨å¤„ç†
export const fetchUserManual = (userId) => {
  return async (dispatch, getState) => {
    dispatch({ type: 'user/fetchUser/pending' });

    try {
      const response = await axios.get(`/api/users/${userId}`);
      dispatch({
        type: 'user/fetchUser/fulfilled',
        payload: response.data
      });
    } catch (error) {
      dispatch({
        type: 'user/fetchUser/rejected',
        error: error.message
      });
    }
  };
};

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function UserProfile({ userId }) {
  const dispatch = useDispatch();
  const { data, status, error } = useSelector(state => state.user);

  useEffect(() => {
    dispatch(fetchUser(userId));
  }, [userId, dispatch]);

  if (status === 'loading') return <Spinner />;
  if (status === 'failed') return <Error>{error}</Error>;

  return <div>{data.name}</div>;
}
```

</CodeBlock>

---

## 6. Redux DevTools

Redux DevToolsæä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ—¶é—´æ—…è¡Œå’ŒçŠ¶æ€æ£€æŸ¥ã€‚

<CodeBlock>

```jsx
// é…ç½®Redux DevTools
import { configureStore } from '@reduxjs/toolkit';

const store = configureStore({
  reducer: {
    counter: counterReducer,
    todos: todosReducer
  },
  // DevToolsé…ç½®
  devTools: process.env.NODE_ENV !== 'production'
});

// æˆ–è€…æ›´é«˜çº§çš„é…ç½®
const store = configureStore({
  reducer: {
    counter: counterReducer,
    todos: todosReducer
  },
  devTools: {
    name: 'My App',
    trace: true,
    traceLimit: 25
  }
});

// åœ¨æµè§ˆå™¨ä¸­å®‰è£…Redux DevToolsæ‰©å±•
// ç„¶åå¯ä»¥ï¼š
// 1. æŸ¥çœ‹æ‰€æœ‰æ´¾å‘çš„action
// 2. æŸ¥çœ‹æ¯ä¸ªactionåçš„çŠ¶æ€å˜åŒ–
// 3. æ—¶é—´æ—…è¡Œ - æ’¤é”€å’Œé‡åšaction
// 4. æ‰‹åŠ¨æ´¾å‘action
// 5. å¯¼å‡ºå’Œå¯¼å…¥çŠ¶æ€
```

</CodeBlock>

---

## 7. æ–‡ä»¶ç»“æ„ç»„ç»‡

### 7.1 ä¼ ç»Ÿæ–¹å¼ï¼ˆæŒ‰ç±»å‹ç»„ç»‡ï¼‰

<CodeBlock>

```jsx
// æ–‡ä»¶ç»“æ„
src/
â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ index.js          // Storeé…ç½®
â”‚   â”œâ”€â”€ counter/
â”‚   â”‚   â”œâ”€â”€ actions.js
â”‚   â”‚   â”œâ”€â”€ reducer.js
â”‚   â”‚   â””â”€â”€ selectors.js
â”‚   â”œâ”€â”€ todos/
â”‚   â”‚   â”œâ”€â”€ actions.js
â”‚   â”‚   â”œâ”€â”€ reducer.js
â”‚   â”‚   â””â”€â”€ selectors.js
â”‚   â””â”€â”€ user/
â”‚       â”œâ”€â”€ actions.js
â”‚       â”œâ”€â”€ reducer.js
â”‚       â””â”€â”€ selectors.js
â””â”€â”€ components/
    â”œâ”€â”€ Counter.js
    â”œâ”€â”€ TodoList.js
    â””â”€â”€ UserProfile.js

// store/counter/actions.js
const increment = () => ({ type: 'counter/increment' });
const decrement = () => ({ type: 'counter/decrement' });

// store/counter/reducer.js
const counterReducer = (state = 0, action) => {
  switch (action.type) {
    case 'counter/increment':
      return state + 1;
    case 'counter/decrement':
      return state - 1;
    default:
      return state;
  }
};

// store/counter/selectors.js
const selectCount = state => state.counter;

// store/index.js
import { createStore } from 'redux';
import counterReducer from './counter/reducer';
import todosReducer from './todos/reducer';

const store = createStore({
  counter: counterReducer,
  todos: todosReducer
});

export default store;
```

</CodeBlock>

### 7.2 ç°ä»£æ–¹å¼ï¼ˆæŒ‰ç‰¹æ€§ç»„ç»‡ - æ¨èï¼‰

<CodeBlock>

```jsx
// æ–‡ä»¶ç»“æ„ - Redux Toolkit
src/
â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ index.js              // Storeé…ç½®
â”‚   â”œâ”€â”€ counter/
â”‚   â”‚   â””â”€â”€ counterSlice.js   // åŒ…å«actionså’Œreducer
â”‚   â”œâ”€â”€ todos/
â”‚   â”‚   â””â”€â”€ todosSlice.js
â”‚   â””â”€â”€ user/
â”‚       â””â”€â”€ userSlice.js
â””â”€â”€ components/
    â”œâ”€â”€ Counter.js
    â”œâ”€â”€ TodoList.js
    â””â”€â”€ UserProfile.js

// store/counter/counterSlice.js
import { createSlice } from '@reduxjs/toolkit';

const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => { state.value += 1; },
    decrement: (state) => { state.value -= 1; }
  }
});

export const { increment, decrement } = counterSlice.actions;
export default counterSlice.reducer;

// store/todos/todosSlice.js
import { createSlice } from '@reduxjs/toolkit';

const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => {
      state.push({
        id: Date.now(),
        text: action.payload,
        completed: false
      });
    }
  }
});

export const { addTodo } = todosSlice.actions;
export default todosSlice.reducer;

// store/index.js
import { configureStore } from '@reduxjs/toolkit';
import counterReducer from './counter/counterSlice';
import todosReducer from './todos/todosSlice';

const store = configureStore({
  reducer: {
    counter: counterReducer,
    todos: todosReducer
  }
});

export default store;
```

</CodeBlock>

---

## 8. å®é™…åº”ç”¨æ¡ˆä¾‹

### 8.1 è´­ç‰©è½¦

<CodeBlock>

```jsx
// è´­ç‰©è½¦åŠŸèƒ½å®ç°
import { createSlice, createSelector } from '@reduxjs/toolkit';
import { createAsyncThunk } from '@reduxjs/toolkit';

const initialState = {
  items: [],
  total: 0,
  loading: false,
  error: null
};

const cartSlice = createSlice({
  name: 'cart',
  initialState,
  reducers: {
    addItem: (state, action) => {
      const existingItem = state.items.find(
        item => item.id === action.payload.id
      );

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        state.items.push({ ...action.payload, quantity: 1 });
      }
    },

    removeItem: (state, action) => {
      state.items = state.items.filter(
        item => item.id !== action.payload
      );
    },

    updateQuantity: (state, action) => {
      const { id, quantity } = action.payload;
      const item = state.items.find(item => item.id === id);
      if (item) {
        item.quantity = quantity;
      }
    },

    clearCart: (state) => {
      state.items = [];
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(checkout.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(checkout.fulfilled, (state) => {
        state.loading = false;
        state.items = [];
      })
      .addCase(checkout.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      });
  }
});

// å¼‚æ­¥æ“ä½œ
export const checkout = createAsyncThunk(
  'cart/checkout',
  async (_, { getState }) => {
    const cart = getState().cart;
    const response = await api.checkout(cart.items);
    return response.data;
  }
);

// é€‰æ‹©å™¨
const selectCartItems = state => state.cart.items;
const selectCartTotal = createSelector(
  [selectCartItems],
  (items) => items.reduce((total, item) =>
    total + (item.price * item.quantity), 0
  )
);

export const { addItem, removeItem, updateQuantity, clearCart } =
  cartSlice.actions;

export { selectCartItems, selectCartTotal };

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function Cart() {
  const items = useSelector(selectCartItems);
  const total = useSelector(selectCartTotal);
  const dispatch = useDispatch();

  const handleRemove = (id) => {
    dispatch(removeItem(id));
  };

  return (
    <div>
      <h2>Cart ({items.length} items)</h2>
      {items.map(item => (
        <div key={item.id}>
          {item.name} - ${item.price} x {item.quantity}
          <button onClick={() => handleRemove(item.id)}>
            Remove
          </button>
        </div>
      ))}
      <div>Total: ${total.toFixed(2)}</div>
      <button onClick={() => dispatch(clearCart())}>
        Clear Cart
      </button>
    </div>
  );
}
```

</CodeBlock>

### 8.2 ç”¨æˆ·è®¤è¯çŠ¶æ€

<CodeBlock>

```jsx
// ç”¨æˆ·è®¤è¯å®ç°
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

const initialState = {
  user: null,
  token: localStorage.getItem('token'),
  isAuthenticated: false,
  loading: false,
  error: null
};

export const login = createAsyncThunk(
  'auth/login',
  async (credentials, { rejectWithValue }) => {
    try {
      const response = await api.login(credentials);
      localStorage.setItem('token', response.token);
      return response;
    } catch (error) {
      return rejectWithValue(error.response.data);
    }
  }
);

export const logout = createAsyncThunk('auth/logout', async () => {
  localStorage.removeItem('token');
});

const authSlice = createSlice({
  name: 'auth',
  initialState,
  reducers: {
    clearError: (state) => {
      state.error = null;
    }
  },
  extraReducers: (builder) => {
    builder
      .addCase(login.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(login.fulfilled, (state, action) => {
        state.loading = false;
        state.isAuthenticated = true;
        state.user = action.payload.user;
        state.token = action.payload.token;
      })
      .addCase(login.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload?.message;
      })
      .addCase(logout.fulfilled, (state) => {
        state.isAuthenticated = false;
        state.user = null;
        state.token = null;
      });
  }
});

// Protected Routeç¤ºä¾‹
function ProtectedRoute({ children }) {
  const { isAuthenticated, loading } = useSelector(state => state.auth);

  if (loading) return <Spinner />;

  if (!isAuthenticated) {
    return <Navigate to="/login" />;
  }

  return children;
}

export const { clearError } = authSlice.actions;
export default authSlice.reducer;
```

</CodeBlock>

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 ä½¿ç”¨Reselectåˆ›å»ºè®°å¿†åŒ–é€‰æ‹©å™¨

<CodeBlock>

```jsx
// è®°å¿†åŒ–é€‰æ‹©å™¨ - é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
import { createSelector } from '@reduxjs/toolkit';

const selectTodos = state => state.todos;
const selectFilter = state => state.filter;

// åŸºç¡€é€‰æ‹©å™¨
const selectFilteredTodos = createSelector(
  [selectTodos, selectFilter],
  (todos, filter) => {
    console.log('Computing filtered todos');
    switch (filter) {
      case 'completed':
        return todos.filter(t => t.completed);
      case 'active':
        return todos.filter(t => !t.completed);
      default:
        return todos;
    }
  }
);

// å¤æ‚è®¡ç®—
const selectStats = createSelector(
  [selectTodos],
  (todos) => {
    const total = todos.length;
    const completed = todos.filter(t => t.completed).length;
    const active = total - completed;

    return { total, completed, active, percent: total ? (completed / total) * 100 : 0 };
  }
);

function TodoStats() {
  const todos = useSelector(selectFilteredTodos);
  const stats = useSelector(selectStats);

  // åªåœ¨todosæˆ–filterå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
  return (
    <div>
      <p>Total: {stats.total}</p>
      <p>Completed: {stats.completed}</p>
      <p>Active: {stats.active}</p>
    </div>
  );
}
```

</CodeBlock>

### 9.2 ç»„ä»¶ä¼˜åŒ–

<CodeBlock>

```jsx
// ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶
import { memo, useCallback } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { toggleTodo } from './store';

// ç»„ä»¶æœ¬èº«ä¸ä¼˜åŒ– - æ¯æ¬¡çˆ¶ç»„ä»¶é‡æ¸²æŸ“éƒ½ä¼šé‡æ–°æ¸²æŸ“
function TodoItem({ todo, onToggle }) {
  return (
    <li>
      <span
        style={{
          textDecoration: todo.completed ? 'line-through' : 'none'
        }}
        onClick={() => onToggle(todo.id)}
      >
        {todo.text}
      </span>
    </li>
  );
}

// ä½¿ç”¨React.memoä¼˜åŒ–
const MemoizedTodoItem = memo(TodoItem);

function TodoList() {
  const todos = useSelector(state => state.todos);
  const dispatch = useDispatch();

  // ä½¿ç”¨useCallbacké¿å…å‡½æ•°é‡æ–°åˆ›å»º
  const handleToggle = useCallback((id) => {
    dispatch(toggleTodo(id));
  }, [dispatch]);

  return (
    <ul>
      {todos.map(todo => (
        <MemoizedTodoItem
          key={todo.id}
          todo={todo}
          onToggle={handleToggle}
        />
      ))}
    </ul>
  );
}
```

</CodeBlock>

---

## 10. æœ€ä½³å®è·µ

<BestPractices>

```jsx
// Reduxæœ€ä½³å®è·µ

// 1. ä¿æŒStateæ‰å¹³åŒ–
// âŒ ä¸å¥½çš„ç»“æ„
const state = {
  user: {
    profile: {
      personal: {
        name: '',
        email: ''
      }
    }
  }
};

// âœ… å¥½çš„ç»“æ„
const state = {
  user: {
    name: '',
    email: ''
  }
};

// 2. ä½¿ç”¨Symbolä½œä¸ºTypeå¸¸é‡
const REdux = require('redux');
const { createSlice } = require('@reduxjs/toolkit');

const actionTypes = {
  increment: Symbol('counter/increment'),
  decrement: Symbol('counter/decrement')
};

// 3. ä¿æŒActionç®€å•
// âŒ å¤æ‚Action
const action = {
  type: 'todos/update',
  payload: {
    updateType: 'toggle',
    todoId: 1,
    newData: { completed: true }
  }
};

// âœ… ç®€å•Action
const toggleTodo = createAction('todos/toggle', (id) => ({
  payload: id
}));

// 4. ä½¿ç”¨Redux Toolkit
// âŒ ä¼ ç»ŸReduxï¼ˆæ ·æ¿ä»£ç å¤šï¼‰
const INCREMENT = 'counter/increment';
function counterReducer(state = 0, action) {
  if (action.type === INCREMENT) return state + 1;
  return state;
}

// âœ… Redux Toolkitï¼ˆç®€æ´ï¼‰
const counterSlice = createSlice({
  name: 'counter',
  initialState: 0,
  reducers: {
    increment: (state) => state + 1
  }
});

// 5. é€‚å½“æ‹†åˆ†State
// âŒ æ‰€æœ‰Stateåœ¨ä¸€ä¸ªSlice
const appSlice = createSlice({
  name: 'app',
  initialState: {
    counter: 0,
    todos: [],
    user: null
  },
  reducers: {
    increment: (state) => { state.counter += 1; }
    // æ··åˆçš„reduceréš¾ä»¥ç»´æŠ¤
  }
});

// âœ… æ¯ä¸ªç‰¹æ€§ä¸€ä¸ªSlice
const counterSlice = createSlice({
  name: 'counter',
  initialState: 0,
  reducers: { increment: (state) => state + 1 }
});

const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => { state.push(action.payload); }
  }
});

// 6. ä½¿ç”¨å¼‚æ­¥Thunk
// âŒ åœ¨ç»„ä»¶ä¸­å¤„ç†å¼‚æ­¥
function Component() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch('/api/data')
      .then(res => res.json())
      .then(setData);
  }, []);
}

// âœ… åœ¨Reduxä¸­å¤„ç†å¼‚æ­¥
const fetchData = createAsyncThunk('data/fetch', async () => {
  const response = await fetch('/api/data');
  return response.json();
});
```

</BestPractices>

---

## 11. Redux vs Context vs å…¶ä»–æ–¹æ¡ˆ

<Table>

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ€§èƒ½ |
|------|----------|------|------|------|
| **Redux** | å¤æ‚åº”ç”¨ã€å›¢é˜Ÿåä½œã€æ—¶é—´æ—…è¡Œè°ƒè¯• | æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿã€å¼ºå¤§çš„DevToolsã€ä¸­é—´ä»¶æ”¯æŒã€å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç† | å­¦ä¹ æ›²çº¿é™¡å³­ã€æ ·æ¿ä»£ç å¤šï¼ˆè™½ç„¶RTKæ”¹å–„äº†ï¼‰ | é«˜ï¼ˆéœ€è¦æ­£ç¡®ä¼˜åŒ–ï¼‰ |
| **Context** | ç®€å•åˆ°ä¸­ç­‰å¤æ‚åº¦å…¨å±€çŠ¶æ€ | Reactå†…ç½®ã€æ— éœ€é¢å¤–ä¾èµ–ã€ä½¿ç”¨ç®€å• | æ€§èƒ½éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–ã€é¢‘ç¹æ›´æ–°æœ‰æ€§èƒ½é—®é¢˜ | ä¸­ç­‰ |
| **Zustand** | è½»é‡çº§åº”ç”¨ã€ç®€å•çŠ¶æ€ç®¡ç† | APIç®€æ´ã€æ ·æ¿ä»£ç å°‘ã€æ€§èƒ½å¥½ | ç”Ÿæ€ç³»ç»Ÿå°ã€ç¤¾åŒºæ”¯æŒå°‘ | é«˜ |
| **MobX** | å“åº”å¼ç¼–ç¨‹ã€å¤æ‚çŠ¶æ€ä¾èµ– | è‡ªåŠ¨è¿½è¸ªã€å“åº”å¼æ›´æ–°ã€ä»£ç ç®€æ´ | éœ€è¦ç†è§£å“åº”å¼æ¦‚å¿µã€è°ƒè¯•å›°éš¾ | é«˜ |
| **Recoil** | Facebookå†…éƒ¨ä½¿ç”¨ã€åŸå­åŒ–çŠ¶æ€ | åŸå­åŒ–ã€ä¾èµ–è¿½è¸ªã€çµæ´» | ä¸ç¨³å®šã€æ–‡æ¡£å°‘ | ä¸­ç­‰ |
| **Jotai** | ç»†ç²’åº¦çŠ¶æ€ã€å¤æ‚ä¾èµ– | åŸå­åŒ–ã€TypeScriptå‹å¥½ã€ä¾èµ–è¿½è¸ªç²¾ç»† | æ¦‚å¿µæ–°é¢–ã€è°ƒè¯•å›°éš¾ | é«˜ |

</Table>

<CodeBlock>

```jsx
// é€‰æ‹©å†³ç­–æŒ‡å—
function chooseStateManagement(requirements) {
  const {
    teamSize,
    complexity,
    needTimeTravel,
    needMiddleware,
    learningCurve
  } = requirements;

  // å°å›¢é˜Ÿï¼Œç®€å•åº”ç”¨
  if (teamSize <= 3 && complexity === 'low') {
    if (requirements.preference === 'simple') {
      return 'Context API';
    }
    return 'Zustand';
  }

  // å¤§å›¢é˜Ÿï¼Œå¤æ‚åº”ç”¨
  if (teamSize > 5 || complexity === 'high') {
    if (needTimeTravel || needMiddleware) {
      return 'Redux Toolkit';
    }
    return 'Zustand or Redux Toolkit';
  }

  // éœ€è¦é«˜çº§åŠŸèƒ½
  if (needTimeTravel || needDevTools) {
    return 'Redux Toolkit';
  }

  if (needMiddleware) {
    return 'Zustand';
  }

  // é»˜è®¤æ¨è
  return 'Context API';
}
```

</CodeBlock>

---

## 12. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå®ç°å¾…åŠäº‹é¡¹åº”ç”¨

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢å¾…åŠäº‹é¡¹
- è¿‡æ»¤å¾…åŠäº‹é¡¹ï¼ˆå…¨éƒ¨ã€æ´»è·ƒã€å·²å®Œæˆï¼‰
- ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€å·²å®Œæˆæ•°ã€æ´»è·ƒæ•°ï¼‰
- æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–

**å®ç°è¦æ±‚**ï¼š
```javascript
// storeé…ç½®
import { configureStore } from '@reduxjs/toolkit';

// åˆ›å»ºtodos slice
const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => { /* ... */ },
    toggleTodo: (state, action) => { /* ... */ },
    removeTodo: (state, action) => { /* ... */ },
    updateTodo: (state, action) => { /* ... */ }
  }
});

// åˆ›å»ºfilters slice
const filtersSlice = createSlice({
  name: 'filter',
  initialState: 'all',
  reducers: {
    setFilter: (state, action) => { /* ... */ }
  }
});

// ç»„åˆstore
const store = configureStore({
  reducer: {
    todos: todosSlice.reducer,
    filter: filtersSlice.reducer
  }
});
```

**æç¤º**ï¼š
- ä½¿ç”¨createSliceç®€åŒ–ä»£ç 
- è€ƒè™‘ä½¿ç”¨createSelectorä¼˜åŒ–é€‰æ‹©å™¨
- æ·»åŠ localStorageæŒä¹…åŒ–
- ä½¿ç”¨React.memoä¼˜åŒ–ç»„ä»¶

</Expandable>

### ç»ƒä¹ 2ï¼šå®ç°è´­ç‰©è½¦

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
- ä¿®æ”¹å•†å“æ•°é‡
- åˆ é™¤å•†å“
- è®¡ç®—æ€»ä»·å’Œæ•°é‡
- æ¸…ç©ºè´­ç‰©è½¦

**å®ç°è¦æ±‚**ï¼š
```javascript
// è´­ç‰©è½¦Slice
const cartSlice = createSlice({
  name: 'cart',
  initialState: {
    items: [],
    total: 0
  },
  reducers: {
    addItem: (state, action) => { /* æ·»åŠ å•†å“ */ },
    removeItem: (state, action) => { /* åˆ é™¤å•†å“ */ },
    updateQuantity: (state, action) => { /* æ›´æ–°æ•°é‡ */ },
    clearCart: (state) => { /* æ¸…ç©ºè´­ç‰©è½¦ */ }
  }
});

// å¼‚æ­¥æ“ä½œ - ç»“ç®—
export const checkout = createAsyncThunk(
  'cart/checkout',
  async (cartItems) => {
    const response = await api.checkout(cartItems);
    return response.data;
  }
);
```

**æç¤º**ï¼š
- å¤„ç†å•†å“é‡å¤æ·»åŠ 
- ä½¿ç”¨createSelectorè®¡ç®—æ€»ä»·
- è´­ç‰©è½¦æ•°æ®æŒä¹…åŒ–åˆ°localStorage

</Expandable>

### ç»ƒä¹ 3ï¼šå®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- ç”¨æˆ·ç™»å½•/æ³¨å†Œ
- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
- ç™»å½•çŠ¶æ€æŒä¹…åŒ–
- å—ä¿æŠ¤çš„è·¯ç”±
- ç™»å‡ºåŠŸèƒ½

**å®ç°è¦æ±‚**ï¼š
```javascript
// è®¤è¯Slice
const authSlice = createSlice({
  name: 'auth',
  initialState: {
    user: null,
    token: localStorage.getItem('token'),
    isAuthenticated: false,
    loading: false,
    error: null
  },
  reducers: {
    // åŒæ­¥actions
  },
  extraReducers: (builder) => {
    builder
      .addCase(login.pending, (state) => { /* ... */ })
      .addCase(login.fulfilled, (state, action) => { /* ... */ })
      .addCase(login.rejected, (state, action) => { /* ... */ });
  }
});

// å¼‚æ­¥thunk
export const login = createAsyncThunk(
  'auth/login',
  async (credentials) => {
    const response = await api.login(credentials);
    localStorage.setItem('token', response.token);
    return response;
  }
);

// ProtectedRouteç»„ä»¶
function ProtectedRoute({ children }) {
  const { isAuthenticated } = useSelector(state => state.auth);

  if (!isAuthenticated) {
    return <Navigate to="/login" />;
  }

  return children;
}
```

**æç¤º**ï¼š
- ä½¿ç”¨axiosæ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ token
- å¤„ç†tokenè¿‡æœŸ
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

</Expandable>

### ç»ƒä¹ 4ï¼šå®ç°æ•°æ®è·å–å’Œç¼“å­˜

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- å¼‚æ­¥è·å–æ•°æ®
- åŠ è½½çŠ¶æ€
- é”™è¯¯å¤„ç†
- ç¼“å­˜æ•°æ®
- æ‰‹åŠ¨åˆ·æ–°

**å®ç°è¦æ±‚**ï¼š
```javascript
// æ•°æ®Slice
const dataSlice = createSlice({
  name: 'data',
  initialState: {
    items: [],
    loading: false,
    error: null,
    lastFetched: null
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchData.pending, (state) => { /* ... */ })
      .addCase(fetchData.fulfilled, (state, action) => { /* ... */ })
      .addCase(fetchData.rejected, (state, action) => { /* ... */ });
  }
});

// å¼‚æ­¥thunk with cache
export const fetchData = createAsyncThunk(
  'data/fetch',
  async (force = false, { getState }) => {
    const { lastFetched } = getState().data;

    // å¦‚æœç¼“å­˜å­˜åœ¨ä¸”æœªè¿‡æœŸï¼Œä¸”ä¸å¼ºåˆ¶åˆ·æ–°
    if (lastFetched && !force) {
      const timeElapsed = Date.now() - lastFetched;
      if (timeElapsed < 5 * 60 * 1000) { // 5åˆ†é’Ÿ
        return null; // ä¸é‡æ–°è·å–
      }
    }

    const response = await api.getData();
    return response;
  }
);
```

**æç¤º**ï¼š
- å®ç°ç¼“å­˜ç­–ç•¥
- æ·»åŠ åˆ·æ–°æŒ‰é’®
- å¤„ç†ç½‘ç»œé”™è¯¯

</Expandable>

---

## 13. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… ReduxåŸºäºä¸‰ä¸ªåŸåˆ™ï¼šå•ä¸€æ•°æ®æºã€çŠ¶æ€æ˜¯åªè¯»çš„ã€ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹
- âœ… Redux Toolkitæ˜¯ç°ä»£Reduxå¼€å‘çš„æ ‡å‡†æ–¹å¼
- âœ… createSliceç®€åŒ–äº†Actionå’ŒReducerçš„åˆ›å»º
- âœ… ä¸å¯å˜æ€§æ˜¯Reduxçš„æ ¸å¿ƒè¦æ±‚
- âœ… ä¸­é—´ä»¶æ‰©å±•äº†Reduxçš„åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¼‚æ­¥æ“ä½œ
- âœ… Redux DevToolsæä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½
- âœ… é€‰æ‹©å™¨å¸®åŠ©ä¼˜åŒ–æ€§èƒ½å’Œä»£ç å¤ç”¨
- âœ… æŒ‰ç‰¹æ€§ç»„ç»‡æ–‡ä»¶ç»“æ„æ˜¯æœ€å¥½çš„å®è·µ
- âœ… Reselectæä¾›è®°å¿†åŒ–é€‰æ‹©å™¨ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—
- âœ… Reduxé€‚ç”¨äºå¤æ‚åº”ç”¨å’Œå¤§å‹å›¢é˜Ÿ

</Checklist>

### Reduxæœ€ä½³å®è·µ

<BestPractices>

1. **ä½¿ç”¨Redux Toolkit** - ç®€åŒ–ä»£ç ï¼Œå‡å°‘æ ·æ¿
2. **ä¿æŒStateæ‰å¹³** - é¿å…æ·±å±‚åµŒå¥—
3. **ä½¿ç”¨Action Creator** - é¿å…é‡å¤å’Œé”™è¯¯
4. **é€‚å½“æ‹†åˆ†Slice** - æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡
5. **ä½¿ç”¨å¼‚æ­¥Thunk** - é›†ä¸­å¤„ç†å‰¯ä½œç”¨
6. **ä½¿ç”¨é€‰æ‹©å™¨** - ä¼˜åŒ–æ€§èƒ½å’Œä»£ç å¤ç”¨
7. **ä½¿ç”¨Reselect** - è®°å¿†åŒ–å¤æ‚è®¡ç®—
8. **é…ç½®DevTools** - æé«˜è°ƒè¯•æ•ˆç‡
9. **æ–‡ä»¶ç»“æ„æ¸…æ™°** - æŒ‰ç‰¹æ€§ç»„ç»‡è€Œä¸æ˜¯æŒ‰ç±»å‹
10. **æµ‹è¯•è¦†ç›–ç‡** - æµ‹è¯•reducersã€actionså’Œé€‰æ‹©å™¨

</BestPractices>

###ä½•æ—¶ä½¿ç”¨Redux

<BestPractices>

**æ¨èä½¿ç”¨Reduxçš„åœºæ™¯**ï¼š
- å¤æ‚çš„å¤§å‹åº”ç”¨
- éœ€è¦æ—¶é—´æ—…è¡Œè°ƒè¯•
- å›¢é˜Ÿåä½œå¼€å‘
- éœ€è¦ä¸­é—´ä»¶å¤„ç†å‰¯ä½œç”¨
- çŠ¶æ€æ›´æ–°é€»è¾‘å¤æ‚
- éœ€è¦å¼ºå¤§çš„å¼€å‘è€…å·¥å…·
- éœ€è¦çŠ¶æ€å†å²è®°å½•
- åº”ç”¨éœ€è¦ä¸¥æ ¼çš„æ¶æ„

**å¯ä»¥è€ƒè™‘å…¶ä»–æ–¹æ¡ˆçš„åœºæ™¯**ï¼š
- ç®€å•çš„ä¸ªäººé¡¹ç›®
- å¿«é€ŸåŸå‹å¼€å‘
- çŠ¶æ€ç®¡ç†éœ€æ±‚ç®€å•
- å›¢é˜Ÿä¸ç†Ÿæ‚‰Redux
- æ€§èƒ½è¦æ±‚æé«˜

</BestPractices>

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†ReduxåŸºç¡€ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[Zustandè½»é‡æ–¹æ¡ˆ](../zustand)** - ç°ä»£è½»é‡çº§çŠ¶æ€ç®¡ç†
2. **[JotaiåŸå­åŒ–çŠ¶æ€](../jotai)** - åŸå­åŒ–çŠ¶æ€ç®¡ç†
3. **[Reduxä¸­é—´ä»¶æ·±å…¥]** - é«˜çº§ReduxæŠ€å·§
4. **[çŠ¶æ€ç®¡ç†æ€§èƒ½ä¼˜åŒ–]** - æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

---

## 14. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Reduxå®˜æ–¹æ–‡æ¡£](https://redux.js.org/) - Reduxæ ¸å¿ƒæ¦‚å¿µ
- [Redux Toolkitæ–‡æ¡£](https://redux-toolkit.js.org/) - ç°ä»£Reduxå¼€å‘
- [React-Reduxæ–‡æ¡£](https://react-redux.js.org/) - Reacté›†æˆæŒ‡å—

### æ¨èé˜…è¯»

- [Reduxæœ€ä½³å®è·µ](https://redux.js.org/style-guide/style-guide) - å®˜æ–¹é£æ ¼æŒ‡å—
- [Reduxå¼‚æ­¥æ•°æ®æµ](https://redux.js.org/tutorials/fundamentals/part-6-async-logic) - æ·±å…¥å¼‚æ­¥
- [Reduxæ€§èƒ½ä¼˜åŒ–](https://redux.js.org/faq/performance) - æ€§èƒ½ä¼˜åŒ–æŒ‡å—

### ç›¸å…³è¯é¢˜

- [Context API](../context-api) - Reactå†…ç½®çŠ¶æ€ç®¡ç†
- [Zustand](../zustand) - è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆ
- [çŠ¶æ€ç®¡ç†å¯¹æ¯”] - å„æ–¹æ¡ˆå¯¹æ¯”åˆ†æ
- [Reduxä¸­é—´ä»¶] - æ·±å…¥ä¸­é—´ä»¶å¼€å‘

---

[â† ä¸Šä¸€ç« ï¼šContext APIæ·±åº¦è§£æ](../context-api) | [ä¸‹ä¸€ç« ï¼šZustandè½»é‡æ–¹æ¡ˆ â†’](../zustand)
