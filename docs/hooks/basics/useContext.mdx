# useContext - è·¨ç»„ä»¶çŠ¶æ€å…±äº«

import { Tabs, TabItem } from '@docusaurus/theme-common';

`useContext`æ˜¯React Hooksç³»ç»Ÿä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå…è®¸ä½ åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®ï¼Œè€Œæ— éœ€æ‰‹åŠ¨é€šè¿‡propså±‚å±‚ä¼ é€’ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨Contextçš„ä½¿ç”¨æ–¹æ³•ã€æœ€ä½³å®è·µä»¥åŠæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£Contextçš„ä½œç”¨å’Œé€‚ç”¨åœºæ™¯
- æŒæ¡createContextå’ŒuseContextçš„ä½¿ç”¨æ–¹æ³•
- å­¦ä¼šåˆ›å»ºå’Œä½¿ç”¨Context Provider
- ç†è§£Contextçš„æ›´æ–°æœºåˆ¶
- æŒæ¡Contextæ€§èƒ½ä¼˜åŒ–æŠ€å·§
- é¿å…Contextçš„å¸¸è§é™·é˜±
- å­¦ä¼šä¸useStateå’ŒuseEffectç»“åˆä½¿ç”¨

---

## 1. ä»€ä¹ˆæ˜¯Contextï¼Ÿ

Contextæä¾›äº†ä¸€ç§é€šè¿‡ç»„ä»¶æ ‘ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸€å±‚æ‰‹åŠ¨åœ°å‘ä¸‹ä¼ é€’propsã€‚å®ƒè§£å†³çš„æ˜¯"Props drilling"ï¼ˆpropsç©¿é€ï¼‰é—®é¢˜ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>Context</strong>å°±åƒä¸€ä¸ªå…¨å±€çš„"æ•°æ®ä»“åº“"ï¼Œæ‰€æœ‰å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥è®¿é—®å…¶ä¸­çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡ä¸­é—´ç»„ä»¶ä¼ é€’ã€‚
  </p>
</Box>

### 1.1 é—®é¢˜åœºæ™¯ï¼šProps Drilling

<ErrorBox>

```jsx
// âŒ é—®é¢˜ - éœ€è¦å±‚å±‚ä¼ é€’props
function App() {
  const theme = 'dark';
  return <Toolbar theme={theme} />;
}

function Toolbar({ theme }) {
  return (
    <div>
      <ThemeSwitcher theme={theme} />
    </div>
  );
}

function ThemeSwitcher({ theme }) {
  return <button className={theme}>åˆ‡æ¢ä¸»é¢˜</button>;  // éœ€è¦theme prop
}
```

</ErrorBox>

### 1.2 è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Context

<BestPractices>

```jsx
// âœ… ä½¿ç”¨Context
// 1. åˆ›å»ºContext
const ThemeContext = createContext('light');

// 2. åœ¨é¡¶å±‚æä¾›Context
function App() {
  const [theme, setTheme] = useState('light');
  return (
    <ThemeContext.Provider value={theme}>
      <Toolbar />
    </ThemeContext.Provider>
  );
}

// 3. åœ¨ä»»æ„ç»„ä»¶ä¸­ä½¿ç”¨Context
function ThemeSwitcher() {
  const theme = useContext(ThemeContext);  // ç›´æ¥è·å–
  return <button className={theme}>åˆ‡æ¢ä¸»é¢˜</button>;
}
```

</BestPractices>

---

## 2. äº¤äº’å¼ç¤ºä¾‹ï¼šä¸»é¢˜åˆ‡æ¢å™¨

<LiveCode
  code={`
function ThemeToggle() {
  // åˆ›å»ºThemeContext
  const ThemeContext = React.createContext();

  // ThemeProviderç»„ä»¶
  function ThemeProvider({ children }) {
    const [theme, setTheme] = React.useState('light');

    const toggleTheme = () => {
      setTheme(prev => prev === 'light' ? 'dark' : 'light');
    };

    return (
      <ThemeContext.Provider value={{ theme, toggleTheme }}>
        {children}
      </ThemeContext.Provider>
    );
  }

  // ä½¿ç”¨Contextçš„Hook
  function useTheme() {
    const context = React.useContext(ThemeContext);
    if (!context) {
      throw new Error('useTheme must be used within ThemeProvider');
    }
    return context;
  }

  // å¤´éƒ¨ç»„ä»¶
  function Header() {
    const { theme, toggleTheme } = useTheme();

    return (
      <div style={{
        backgroundColor: theme === 'dark' ? '#2c3e50' : '#3498db',
        color: '#fff',
        padding: '20px',
        borderRadius: '8px',
        marginBottom: '20px',
        textAlign: 'center'
      }}>
        <h1 style={{ margin: 0 }}>ğŸŒ™ ä¸»é¢˜åˆ‡æ¢å™¨</h1>
        <p style={{ margin: '10px 0 0 0' }}>å½“å‰ä¸»é¢˜: {theme === 'light' ? 'â˜€ï¸ æµ…è‰²' : 'ğŸŒ™ æ·±è‰²'}</p>
        <button
          onClick={toggleTheme}
          style={{
            marginTop: '15px',
            padding: '10px 20px',
            fontSize: '16px',
            backgroundColor: 'rgba(255, 255, 255, 0.2)',
            color: 'white',
            border: '2px solid white',
            borderRadius: '6px',
            cursor: 'pointer',
            transition: 'all 0.3s'
          }}
        >
          åˆ‡æ¢ä¸»é¢˜
        </button>
      </div>
    );
  }

  // å†…å®¹ç»„ä»¶
  function Content() {
    const { theme } = useTheme();

    return (
      <div style={{
        backgroundColor: theme === 'dark' ? '#34495e' : '#ecf0f1',
        color: theme === 'dark' ? '#ecf0f1' : '#2c3e50',
        padding: '20px',
        borderRadius: '8px',
        textAlign: 'center'
      }}>
        <h2>ç¤ºä¾‹å†…å®¹åŒºåŸŸ</h2>
        <p>è¿™ä¸ªåŒºåŸŸçš„å†…å®¹ä¼šæ ¹æ®ä¸»é¢˜è‡ªåŠ¨è°ƒæ•´é¢œè‰²</p>
        <div style={{
          display: 'flex',
          justifyContent: 'center',
          gap: '10px',
          marginTop: '20px'
        }}>
          <span style={{
            backgroundColor: theme === 'dark' ? '#e74c3c' : '#e67e22',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '4px'
          }}>
            æ ‡ç­¾1
          </span>
          <span style={{
            backgroundColor: theme === 'dark' ? '#27ae60' : '#2ecc71',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '4px'
          }}>
            æ ‡ç­¾2
          </span>
          <span style={{
            backgroundColor: theme === 'dark' ? '#9b59b6' : '#8e44ad',
            color: 'white',
            padding: '8px 16px',
            borderRadius: '4px'
          }}>
            æ ‡ç­¾3
          </span>
        </div>
      </div>
    );
  }

  return (
    <ThemeProvider>
      <div style={{ maxWidth: '600px', margin: '0 auto' }}>
        <Header />
        <Content />
      </div>
    </ThemeProvider>
  );
}
  `}
/>

è¿™ä¸ªäº¤äº’å¼ç¤ºä¾‹å±•ç¤ºäº†ï¼š
- âœ… ä½¿ç”¨ `createContext` åˆ›å»ºContext
- âœ… ä½¿ç”¨ `Provider` æä¾›æ•°æ®
- âœ… ä½¿ç”¨ `useContext` åœ¨å­ç»„ä»¶ä¸­è·å–æ•°æ®
- âœ… å¤šä¸ªç»„ä»¶å…±äº«çŠ¶æ€
- âœ… è‡ªåŠ¨æ›´æ–°UI

---

## 3. åŸºæœ¬ç”¨æ³•

### 3.1 åˆ›å»ºContext

<CodeBlock>

```jsx
import { createContext } from 'react';

// åˆ›å»ºContextï¼Œå¹¶æä¾›é»˜è®¤å€¼
const UserContext = createContext({
  name: 'Guest',
  age: 0,
  email: ''
});

// åˆ›å»ºå¸¦ç±»å‹çš„Contextï¼ˆTypeScriptï¼‰
// const UserContext = createContext<UserType | undefined>(undefined);
```

</CodeBlock>

### 2.2 ä½¿ç”¨Context Provider

<CodeBlock>

```jsx
import { createContext, useContext, useState } from 'react';

// 1. åˆ›å»ºContext
const ThemeContext = createContext();

// 2. åˆ›å»ºProviderç»„ä»¶
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// 3. åœ¨åº”ç”¨æ ¹ç»„ä»¶ä½¿ç”¨
function App() {
  return (
    <ThemeProvider>
      <MainContent />
    </ThemeProvider>
  );
}
```

</CodeBlock>

### 2.3 ä½¿ç”¨useContext

<CodeBlock>

```jsx
// 4. åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨useContext
function Header() {
  const { theme, setTheme } = useContext(ThemeContext);

  return (
    <header className={theme}>
      <h1>æˆ‘çš„åº”ç”¨</h1>
      <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
        åˆ‡æ¢ä¸»é¢˜
      </button>
    </header>
  );
}

// åµŒå¥—ç»„ä»¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨
function MainContent() {
  const { theme } = useContext(ThemeContext);

  return (
    <main className={theme}>
      <p>å½“å‰ä¸»é¢˜: {theme}</p>
    </main>
  );
}
```

</CodeBlock>

---

## 3. å®é™…åº”ç”¨åœºæ™¯

### 3.1 ä¸»é¢˜åˆ‡æ¢

<CodeBlock>

```jsx
import { createContext, useContext, useState } from 'react';

// åˆ›å»ºä¸»é¢˜Context
const ThemeContext = createContext();

// Providerç»„ä»¶
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// è‡ªå®šä¹‰Hook
function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }
  return context;
}

// ä½¿ç”¨ç»„ä»¶
function App() {
  return (
    <ThemeProvider>
      <Header />
      <Content />
    </ThemeProvider>
  );
}

function Header() {
  const { theme, toggleTheme } = useTheme();

  return (
    <div style={{
      backgroundColor: theme === 'dark' ? '#333' : '#fff',
      color: theme === 'dark' ? '#fff' : '#333',
      padding: '20px'
    }}>
      <h1>ä¸»é¢˜ç¤ºä¾‹</h1>
      <button onClick={toggleTheme}>
        åˆ‡æ¢åˆ°{theme === 'light' ? 'æ·±è‰²' : 'æµ…è‰²'}æ¨¡å¼
      </button>
    </div>
  );
}

function Content() {
  const { theme } = useTheme();

  return (
    <div style={{
      backgroundColor: theme === 'dark' ? '#666' : '#f0f0f0',
      color: theme === 'dark' ? '#fff' : '#333',
      padding: '20px',
      margin: '20px',
      borderRadius: '8px'
    }}>
      <p>è¿™æ˜¯å†…å®¹åŒºåŸŸ</p>
      <p>å½“å‰ä¸»é¢˜: {theme}</p>
    </div>
  );
}
```

</CodeBlock>

### 3.2 ç”¨æˆ·è®¤è¯çŠ¶æ€

<CodeBlock>

```jsx
import { createContext, useContext, useState, useEffect } from 'react';

// åˆ›å»ºè®¤è¯Context
const AuthContext = createContext();

// Providerç»„ä»¶
function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // æ£€æŸ¥localStorageä¸­çš„ç”¨æˆ·ä¿¡æ¯
    const savedUser = localStorage.getItem('user');
    if (savedUser) {
      setUser(JSON.parse(savedUser));
    }
    setLoading(false);
  }, []);

  const login = async (credentials) => {
    setLoading(true);
    try {
      const response = await fetch('/api/login', {
        method: 'POST',
        body: JSON.stringify(credentials)
      });
      const userData = await response.json();
      setUser(userData);
      localStorage.setItem('user', JSON.stringify(userData));
    } catch (error) {
      throw error;
    } finally {
      setLoading(false);
    }
  };

  const logout = () => {
    setUser(null);
    localStorage.removeItem('user');
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

// è‡ªå®šä¹‰Hook
function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}

// ä½¿ç”¨ç»„ä»¶
function App() {
  return (
    <AuthProvider>
      <Header />
      <Main />
    </AuthProvider>
  );
}

function Header() {
  const { user, logout } = useAuth();

  return (
    <nav>
      {user ? (
        <>
          <span>æ¬¢è¿, {user.name}</span>
          <button onClick={logout}>é€€å‡º</button>
        </>
      ) : (
        <button>ç™»å½•</button>
      )}
    </nav>
  );
}

function ProtectedRoute({ children }) {
  const { user, loading } = useAuth();

  if (loading) return <p>åŠ è½½ä¸­...</p>;
  if (!user) return <p>è¯·å…ˆç™»å½•</p>;

  return children;
}
```

</CodeBlock>

### 3.3 è¯­è¨€/å›½é™…åŒ–

<CodeBlock>

```jsx
import { createContext, useContext, useState } from 'react';

// åˆ›å»ºè¯­è¨€Context
const LanguageContext = createContext();

// ç¿»è¯‘æ•°æ®
const translations = {
  en: {
    hello: 'Hello',
    goodbye: 'Goodbye',
    welcome: 'Welcome'
  },
  zh: {
    hello: 'ä½ å¥½',
    goodbye: 'å†è§',
    welcome: 'æ¬¢è¿'
  }
};

// Providerç»„ä»¶
function LanguageProvider({ children }) {
  const [language, setLanguage] = useState('zh');

  const t = (key) => {
    return translations[language][key] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
}

// è‡ªå®šä¹‰Hook
function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within LanguageProvider');
  }
  return context;
}

// ä½¿ç”¨ç»„ä»¶
function App() {
  return (
    <LanguageProvider>
      <Header />
      <Content />
    </LanguageProvider>
  );
}

function Header() {
  const { language, setLanguage } = useLanguage();

  return (
    <header>
      <select
        value={language}
        onChange={(e) => setLanguage(e.target.value)}
      >
        <option value="zh">ä¸­æ–‡</option>
        <option value="en">English</option>
      </select>
    </header>
  );
}

function Content() {
  const { t } = useLanguage();

  return (
    <main>
      <h1>{t('welcome')}</h1>
      <p>{t('hello')}</p>
      <p>{t('goodbye')}</p>
    </main>
  );
}
```

</CodeBlock>

---

## 4. å¤æ‚çŠ¶æ€ç®¡ç†

### 4.1 ç»„åˆå¤šä¸ªçŠ¶æ€

<CodeBlock>

```jsx
import { createContext, useContext, useState, useReducer } from 'react';

// åˆ›å»ºApp Context
const AppContext = createContext();

// çŠ¶æ€ç±»å‹
// { user: User | null, theme: string, language: string }

// Reducer
function appReducer(state, action) {
  switch (action.type) {
    case 'SET_USER':
      return { ...state, user: action.payload };
    case 'SET_THEME':
      return { ...state, theme: action.payload };
    case 'SET_LANGUAGE':
      return { ...state, language: action.payload };
    case 'RESET':
      return { user: null, theme: 'light', language: 'zh' };
    default:
      return state;
  }
}

// Providerç»„ä»¶
function AppProvider({ children }) {
  const [state, dispatch] = useReducer(appReducer, {
    user: null,
    theme: 'light',
    language: 'zh'
  });

  // ç»„åˆæ‰€æœ‰éœ€è¦çš„çŠ¶æ€å’Œæ–¹æ³•
  const value = {
    user: state.user,
    theme: state.theme,
    language: state.language,
    setUser: (user) => dispatch({ type: 'SET_USER', payload: user }),
    setTheme: (theme) => dispatch({ type: 'SET_THEME', payload: theme }),
    setLanguage: (language) => dispatch({ type: 'SET_LANGUAGE', payload: language }),
    reset: () => dispatch({ type: 'RESET' })
  };

  return (
    <AppContext.Provider value={value}>
      {children}
    </AppContext.Provider>
  );
}

// è‡ªå®šä¹‰Hook
function useApp() {
  const context = useContext(AppContext);
  if (!context) {
    throw new Error('useApp must be used within AppProvider');
  }
  return context;
}
```

</CodeBlock>

### 4.2 åµŒå¥—Provider

<CodeBlock>

```jsx
// å¯ä»¥åµŒå¥—å¤šä¸ªProvider
function App() {
  return (
    <AuthProvider>
      <ThemeProvider>
        <LanguageProvider>
          <MainContent />
        </LanguageProvider>
      </ThemeProvider>
    </AuthProvider>
  );
}

// æ¯ä¸ªProviderç®¡ç†è‡ªå·±çš„çŠ¶æ€
function MainContent() {
  const { user } = useAuth();
  const { theme } = useTheme();
  const { language } = useLanguage();

  return (
    <div className={theme}>
      <h1>{language === 'zh' ? 'æˆ‘çš„åº”ç”¨' : 'My App'}</h1>
      {user && <p>Hello, {user.name}!</p>}
    </div>
  );
}
```

</CodeBlock>

---

## 5. æ€§èƒ½ä¼˜åŒ–

### 5.1 é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

<Box style={{ padding: '20px', background: '#fff3e0', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#e65100' }}>âš ï¸ é‡è¦æç¤º</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    Contextçš„valueå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥Contextçš„ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚éœ€è¦è°¨æ…è®¾è®¡ä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚
  </p>
</Box>

#### 5.1.1 æ‹†åˆ†Context

<Compare>

```jsx
// âŒ ä¸å¥½ - å¤šä¸ªä¸ç›¸å…³çŠ¶æ€åœ¨ä¸€ä¸ªContextä¸­
const AppContext = createContext();

function AppProvider() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [notifications, setNotifications] = useState([]);

  return (
    <AppContext.Provider value={{
      user, setUser,
      theme, setTheme,
      notifications, setNotifications
    }}>
      {children}
    </AppContext.Provider>
  );
}

// âœ… æ›´å¥½ - æ‹†åˆ†Context
const UserContext = createContext();
const ThemeContext = createContext();
const NotificationContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  return (
    <UserContext.Provider value={{ user, setUser }}>
      {children}
    </UserContext.Provider>
  );
}

function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}
```

</Compare>

#### 5.1.2 ä½¿ç”¨useMemoä¼˜åŒ–

<CodeBlock>

```jsx
import { useMemo } from 'react';

function OptimizedProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');

  // ä½¿ç”¨useMemoç¼“å­˜valueå¯¹è±¡
  const userValue = useMemo(() => ({ user, setUser }), [user]);
  const themeValue = useMemo(() => ({ theme, setTheme }), [theme]);

  return (
    <UserContext.Provider value={userValue}>
      <ThemeContext.Provider value={themeValue}>
        {children}
      </ThemeContext.Provider>
    </UserContext.Provider>
  );
}
```

</CodeBlock>

#### 5.1.3 ä½¿ç”¨useCallback

<CodeBlock>

```jsx
function OptimizedProvider({ children }) {
  const [count, setCount] = useState(0);

  // ä½¿ç”¨useMemoç¼“å­˜å‡½æ•°
  const increment = useCallback(() => {
    setCount(prev => prev + 1);
  }, []);

  const value = useMemo(() => ({
    count,
    increment
  }), [count, increment]);

  return (
    <CounterContext.Provider value={value}>
      {children}
    </CounterContext.Provider>
  );
}
```

</CodeBlock>

### 5.2 ä½¿ç”¨React.memo

<CodeBlock>

```jsx
// åŒ…è£…ç»„ä»¶é¿å…ä¸å¿…è¦æ¸²æŸ“
const ExpensiveComponent = React.memo(({ value }) => {
  console.log('ç»„ä»¶æ¸²æŸ“äº†');
  return <div>{value}</div>;
});

function App() {
  const { theme } = useTheme();
  return (
    <ExpensiveComponent value={theme} />
  );
}
```

</CodeBlock>

---

## 6. é«˜çº§æŠ€å·§

### 6.1 åŠ¨æ€Context

<CodeBlock>

```jsx
import { useContext } from 'react';

// åŠ¨æ€Contextæ ¹æ®ç±»å‹è¿”å›ä¸åŒå€¼
function DynamicContext({ type }) {
  const allThemes = useContext(ThemeContext);

  // æ ¹æ®ç±»å‹è¿”å›ç‰¹å®šä¸»é¢˜
  const contextValue = allThemes[type];

  return (
    <ThemeContext.Provider value={contextValue}>
      {children}
    </ThemeContext.Provider>
  );
}
```

</CodeBlock>

### 6.2 å¤šä¸ªContextç»„åˆ

<CodeBlock>

```jsx
// ç»„åˆå¤šä¸ªContext
function CombinedContextProvider({ children }) {
  const authValue = useAuth();
  const themeValue = useTheme();

  return (
    <AuthContext.Provider value={authValue}>
      <ThemeContext.Provider value={themeValue}>
        <AppContext.Provider value={{ authValue, themeValue }}>
          {children}
        </AppContext.Provider>
      </ThemeContext.Provider>
    </AuthContext.Provider>
  );
}
```

</CodeBlock>

### 6.3 Contextä¸useState

<CodeBlock>

```jsx
// Providerå†…éƒ¨ä½¿ç”¨useState
function CounterProvider({ children }) {
  const [count, setCount  = useState(0);

  const value = {
    count,
    increment: () => setCount(count + 1),
    decrement: () => setCount(count - 1),
    reset: () => setCount(0)
  };

  return (
    <CounterContext.Provider value={value}>
      {children}
    </CounterContext.Provider>
  );
}
```

</CodeBlock>

### 6.4 Contextä¸useReducer

<CodeBlock>

```jsx
import { useReducer } from 'react';

// ä½¿ç”¨useReducerç®¡ç†å¤æ‚çŠ¶æ€
function TodosProvider({ children }) {
  const [todos, dispatch] = useReducer(todosReducer, []);

  const value = {
    todos,
    addTodo: (text) => dispatch({ type: 'ADD', payload: text }),
    removeTodo: (id) => dispatch({ type: 'REMOVE', payload: id }),
    toggleTodo: (id) => dispatch({ type: 'TOGGLE', payload: id })
  };

  return (
    <TodosContext.Provider value={value}>
      {children}
    </TodosContext.Provider>
  );
}
```

</CodeBlock>

---

## 7. å¸¸è§é”™è¯¯ä¸é™·é˜±

### 7.1 Contextåœ¨Providerå¤–éƒ¨ä½¿ç”¨

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - åœ¨Providerå¤–éƒ¨ä½¿ç”¨Context
const MyContext = createContext();

function BadComponent() {
  const value = useContext(MyContext);  // æŠ›å‡ºé”™è¯¯ï¼
  return <div>{value}</div>;
}

// æ²¡æœ‰ä½¿ç”¨ProvideråŒ…è£…
function App() {
  return <BadComponent />;  // Error: Context is undefined
}

// âœ… æ­£ç¡®
function GoodComponent() {
  const value = useContext(MyContext);  // æ­£ç¡®
  return <div>{value}</div>;
}

function App() {
  return (
    <MyContext.Provider value="some value">
      <GoodComponent />
    </MyContext.Provider>
  );
}
```

</ErrorBox>

### 7.2 å¿˜è®°ä½¿ç”¨Provider

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ²¡æœ‰Provider
function App() {
  return (
    <MyContext.Provider value="value">
      <Component1 />
    </MyContext.Provider>
    // Component2åœ¨Providerå¤–éƒ¨ï¼
  );
}

function Component2() {
  const value = useContext(MyContext);  // é”™è¯¯ï¼
  return <div>{value}</div>;
}

// âœ… æ­£ç¡® - ç¡®ä¿æ‰€æœ‰ä½¿ç”¨Contextçš„ç»„ä»¶éƒ½åœ¨Providerå†…éƒ¨
function App() {
  return (
    <MyContext.Provider value="value">
      <Component1 />
      <Component2 />  // éƒ½åœ¨Providerå†…éƒ¨
    </MyContext.Provider>
  );
}
```

</ErrorBox>

### 7.3 é¢‘ç¹æ›´æ–°Context

<ErrorBox>

```jsx
// âŒ ä¸å¥½ - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
function BadProvider() {
  const [count, setCount] = useState(0);

  return (
    <BadContext.Provider value={{
      count,  // æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
      setCount
    }}>
      {children}
    </BadContext.Provider>
  );
}

// âœ… æ›´å¥½ - ä½¿ç”¨useMemoç¼“å­˜
function GoodProvider() {
  const [count, setCount] = useState(0);

  const value = useMemo(() => ({
    count,
    setCount
  }), [count]);

  return (
    <GoodContext.Provider value={value}>
      {children}
    </GoodContext.Provider>
  );
}
```

</ErrorBox>

### 7.4 ä½¿ç”¨ä¸ç¨³å®šçš„å€¼ä½œä¸ºContext

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ä½¿ç”¨å†…è”å‡½æ•°/å¯¹è±¡
function BadProvider({ children }) {
  const [count, setCount] = useState(0);

  return (
    <BadContext.Provider value={{
      // è¿™äº›å‡½æ•°æ¯æ¬¡éƒ½é‡æ–°åˆ›å»º
      onClick: () => setCount(count + 1),
      style: { color: 'red' }
    }}>
      {children}
    </BadContext.Provider>
  );
}

// âœ… æ­£ç¡® - ä½¿ç”¨useCallback/useMemo
function GoodProvider({ children }) {
  const [count, setCount] = useState(0);

  const onClick = useCallback(() => {
    setCount(count + 1);
  }, [count]);

  const style = useMemo(() => ({ color: 'red' }), []);

  return (
    <GoodContext.Provider value={{ onClick, style }}>
      {children}
    </GoodContext.Provider>
  );
}
```

</ErrorBox>

---

## 8. å®é™…åº”ç”¨åœºæ™¯

### 8.1 è´­ç‰©è½¦çŠ¶æ€

<CodeBlock>

```jsx
import { createContext, useContext, useState } from 'react';

const CartContext = createContext();

function CartProvider({ children }) {
  const [items, setItems] = useState([]);

  const addItem = (product) => {
    setItems(prev => {
      const existingItem = prev.find(item => item.id === product.id);
      if (existingItem) {
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prev, { ...product, quantity: 1 }];
    });
  };

  const removeItem = (id) => {
    setItems(prev => prev.filter(item => item.id !== id));
  };

  const updateQuantity = (id, quantity) => {
    if (quantity <= 0) {
      removeItem(id);
      return;
    }
    setItems(prev =>
      prev.map(item =>
        item.id === id ? { ...item, quantity } : item
      )
    );
  };

  const clearCart = () => {
    setItems([]);
  };

  const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);

  return (
    <CartContext.Provider value={{
      items,
      addItem,
      removeItem,
      updateQuantity,
      clearCart,
      total,
      itemCount: items.reduce((sum, item) => sum + item.quantity, 0)
    }}>
      {children}
    </CartContext.Provider>
  );
}

function useCart() {
  const context = useContext(CartContext);
  if (!context) {
    throw new Error('useCart must be used within CartProvider');
  }
  return context;
}
```

</CodeBlock>

### 8.2 å…¨å±€åŠ è½½çŠ¶æ€

<CodeBlock>

```jsx
import { createContext, useContext, useState, useCallback } from 'react';

const LoadingContext = createContext();

function LoadingProvider({ children }) {
  const [loadingStates, setLoadingStates] = useState({});

  const setLoading = useCallback((key, isLoading) => {
    setLoadingStates(prev => ({
      ...prev,
      [key]: isLoading
    }));
  }, []);

  const isLoading = useCallback((key) => {
    return !!loadingStates[key];
  }, [loadingStates]);

  const isAnyLoading = Object.values(loadingStates).some(Boolean);

  return (
    <LoadingContext.Provider value={{
      setLoading,
      isLoading,
      isAnyLoading,
      loadingStates
    }}>
      {children}
    </LoadingContext.Provider>
  );
}

function useLoading() {
  const context = useContext(LoadingContext);
  if (!context) {
    throw new Error('useLoading must be used within LoadingProvider');
  }
  return context;
}

// ä½¿ç”¨ç¤ºä¾‹
function DataComponent() {
  const { setLoading, isLoading } = useLoading();

  const fetchData = async () => {
    setLoading('data', true);
    try {
      await fetch('/api/data');
    } finally {
      setLoading('data', false);
    }
  };

  if (isLoading('data')) return <p>åŠ è½½ä¸­...</p>;
  return <button onClick={fetchData}>è·å–æ•°æ®</button>;
}
```

</CodeBlock>

---

## 9. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå…¨å±€é€šçŸ¥ç³»ç»Ÿ

åˆ›å»ºä¸€ä¸ªå…¨å±€é€šçŸ¥Contextï¼Œæ”¯æŒæ˜¾ç¤ºæˆåŠŸã€è­¦å‘Šå’Œé”™è¯¯æ¶ˆæ¯ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ·»åŠ é€šçŸ¥ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯/ä¿¡æ¯ï¼‰
- è‡ªåŠ¨éšè—é€šçŸ¥ï¼ˆå¯é…ç½®æ—¶é—´ï¼‰
- æ¸…é™¤å•ä¸ªé€šçŸ¥
- æ¸…é™¤æ‰€æœ‰é€šçŸ¥
- å †å æ˜¾ç¤ºå¤šä¸ªé€šçŸ¥

**æç¤º**ï¼š
- ä½¿ç”¨useStateç®¡ç†é€šçŸ¥æ•°ç»„
- æ¯ä¸ªé€šçŸ¥æœ‰idã€typeã€messageã€durationå±æ€§
- ä½¿ç”¨useEffectå®ç°è‡ªåŠ¨éšè—
- æä¾›ä¾¿æ·çš„success/warning/error/infoæ–¹æ³•

</Expandable>

### ç»ƒä¹ 2ï¼šç”¨æˆ·åå¥½è®¾ç½®

åˆ›å»ºä¸€ä¸ªç”¨æˆ·åå¥½Contextï¼Œç®¡ç†ç”¨æˆ·çš„ä¸»é¢˜ã€è¯­è¨€ã€å­—ä½“å¤§å°ç­‰è®¾ç½®ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- ä¿å­˜åˆ°localStorage
- é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¯»å–
- å®æ—¶åº”ç”¨è®¾ç½®
- é‡ç½®ä¸ºé»˜è®¤å€¼
- å¯æ‰©å±•ï¼ˆå®¹æ˜“æ·»åŠ æ–°è®¾ç½®ï¼‰

**æç¤º**ï¼š
- å®šä¹‰åå¥½è®¾ç½®å¯¹è±¡ç»“æ„
- åˆå§‹åŒ–æ—¶ä»localStorageè¯»å–
- ä¿®æ”¹è®¾ç½®æ—¶ä¿å­˜åˆ°localStorage
- æä¾›resetæ–¹æ³•é‡ç½®æ‰€æœ‰è®¾ç½®

</Expandable>

### ç»ƒä¹ 3ï¼šåª’ä½“æŸ¥è¯¢å“åº”å¼

åˆ›å»ºä¸€ä¸ªContextè·Ÿè¸ªå½“å‰è§†å£å°ºå¯¸ï¼Œæ”¯æŒç§»åŠ¨ç«¯/å¹³æ¿/æ¡Œé¢ç«¯ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- ç›‘å¬çª—å£resizeäº‹ä»¶
- æ ¹æ®å®½åº¦åˆ†ç±»ï¼ˆmobile/tablet/desktopï¼‰
- æä¾›breakpointä¿¡æ¯
- ä¼˜åŒ–æ€§èƒ½ï¼ˆé˜²æŠ–ï¼‰

**æç¤º**ï¼š
- ä½¿ç”¨useEffectç›‘å¬resizeäº‹ä»¶
- ä½¿ç”¨useStateå­˜å‚¨å½“å‰å®½åº¦
- è®¡ç®—å½“å‰è®¾å¤‡ç±»å‹
- ä½¿ç”¨useCallbackä¼˜åŒ–äº‹ä»¶å¤„ç†

</Expandable>

### ç»ƒä¹ 4ï¼šWebSocketè¿æ¥ç®¡ç†

åˆ›å»ºä¸€ä¸ªContextç®¡ç†WebSocketè¿æ¥ï¼Œæ”¯æŒæ–­çº¿é‡è¿ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- è‡ªåŠ¨è¿æ¥WebSocket
- æ–­çº¿é‡è¿æœºåˆ¶
- å‘é€/æ¥æ”¶æ¶ˆæ¯
- è¿æ¥çŠ¶æ€ç®¡ç†
- é”™è¯¯å¤„ç†

**æç¤º**ï¼š
- ä½¿ç”¨useEffectç®¡ç†è¿æ¥
- å®ç°é‡è¿é€»è¾‘
- å­˜å‚¨è¿æ¥çŠ¶æ€å’Œæ¶ˆæ¯å†å²
- æä¾›sendæ–¹æ³•

</Expandable>

---

## 10. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… Contextè§£å†³Props Drillingé—®é¢˜
- âœ… ä½¿ç”¨`createContext()`åˆ›å»ºContext
- âœ… ä½¿ç”¨`Context.Provider`æä¾›æ•°æ®
- âœ… ä½¿ç”¨`useContext()`åœ¨ç»„ä»¶ä¸­æ¶ˆè´¹Context
- âœ… æ‰€æœ‰å­ç»„ä»¶éƒ½å¯ä»¥è®¿é—®Contextæ•°æ®
- âœ… Contextå˜åŒ–ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹è€…é‡æ–°æ¸²æŸ“
- âœ… åº”è¯¥æ‹†åˆ†Contexté¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
- âœ… ä½¿ç”¨useMemoå’ŒuseCallbackä¼˜åŒ–æ€§èƒ½
- âœ… å§‹ç»ˆåœ¨Providerå†…éƒ¨ä½¿ç”¨Context

</Checklist>

### æœ€ä½³å®è·µ

<BestPractices>

1. **æ‹†åˆ†Context** - å°†ä¸ç›¸å…³çš„çŠ¶æ€åˆ†ç¦»åˆ°ä¸åŒçš„Context
2. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨useMemoç¼“å­˜Contextçš„value
3. **è‡ªå®šä¹‰Hook** - ä¸ºæ¯ä¸ªContextåˆ›å»ºè‡ªå®šä¹‰Hookæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒ
4. **é”™è¯¯è¾¹ç•Œ** - æ•è·Providerå¤–éƒ¨ä½¿ç”¨Contextçš„é”™è¯¯
5. **ç±»å‹å®‰å…¨** - åœ¨TypeScriptä¸­ä½¿ç”¨æ³›å‹ä¿è¯ç±»å‹å®‰å…¨
6. **é€‚åº¦ä½¿ç”¨** - ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½éœ€è¦Contextï¼Œä¼˜å…ˆä½¿ç”¨æœ¬åœ°çŠ¶æ€

</BestPractices>

### ä½¿ç”¨åœºæ™¯

**é€‚åˆä½¿ç”¨Contextçš„åœºæ™¯**ï¼š
- å…¨å±€ç”¨æˆ·è®¤è¯çŠ¶æ€
- ä¸»é¢˜/è¯­è¨€è®¾ç½®
- è´­ç‰©è½¦çŠ¶æ€
- é€šçŸ¥ç³»ç»Ÿ
- å…¨å±€åŠ è½½çŠ¶æ€

**ä¸é€‚åˆä½¿ç”¨Contextçš„åœºæ™¯**ï¼š
- é¢‘ç¹å˜åŒ–çš„æ•°æ®
- å±€éƒ¨çš„ã€ä¸´æ—¶çš„çŠ¶æ€
- å¯ä»¥é€šè¿‡propsä¼ é€’çš„ç®€å•æ•°æ®

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†useContextï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š

1. **[useReducer](advanced/useReducer)** - æŒæ¡å¤æ‚çŠ¶æ€é€»è¾‘
2. **[useCallback](advanced/useCallback)** - æ€§èƒ½ä¼˜åŒ–
3. **[useMemo](advanced/useMemo)** - æ€§èƒ½ä¼˜åŒ–

---

## 11. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Context API](https://react.dev/reference/react/createContext) - Reactå®˜æ–¹æ–‡æ¡£
- [useContext](https://react.dev/reference/react/useContext) - useContextå‚è€ƒ
- [Contextä¸æ€§èƒ½](https://react.dev/learn/passing-data-deeply-with-context) - æ€§èƒ½ä¼˜åŒ–æŒ‡å—

### æ¨èé˜…è¯»

- [ReactçŠ¶æ€ç®¡ç†æŒ‡å—](https://kentcdodds.com/blog/application-state-management-with-react) - çŠ¶æ€ç®¡ç†ç­–ç•¥
- [Contextæœ€ä½³å®è·µ](https://kentcdodds.com/blog/how-to-use-react-context-effectively) - æœ‰æ•ˆä½¿ç”¨Context
- [é¿å…Contexté™·é˜±](https://kentcdodds.com/blog/please-stop-using-context-for-state) - ä½•æ—¶é¿å…ä½¿ç”¨Context

---

[â† ä¸Šä¸€ç« ï¼šuseEffect](useEffect) | [ä¸‹ä¸€ç« ï¼šuseReducer â†’](advanced/useReducer)
