# useCallback - å‡½æ•°è®°å¿†åŒ–

import { Tabs, TabItem } from '@docusaurus/theme-common';

`useCallback`æ˜¯Reactæä¾›çš„æ€§èƒ½ä¼˜åŒ–Hookï¼Œç”¨äºç¼“å­˜å‡½æ•°å®ä¾‹ã€‚å½“ç»„ä»¶é¢‘ç¹æ¸²æŸ“æ—¶ï¼Œä½¿ç”¨useCallbackå¯ä»¥é¿å…åˆ›å»ºæ–°çš„å‡½æ•°å®ä¾‹ï¼Œä»è€Œå‡å°‘å­ç»„ä»¶çš„ä¸å¿…è¦é‡æ–°æ¸²æŸ“ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ useCallbackçš„å·¥ä½œåŸç†ã€ä½¿ç”¨åœºæ™¯ã€æ€§èƒ½å½±å“ä»¥åŠæœ€ä½³å®è·µã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£useCallbackçš„ä½œç”¨å’ŒåŸç†
- æŒæ¡useCallbackçš„è¯­æ³•å’Œå‚æ•°
- å­¦ä¼šåˆ¤æ–­ä½•æ—¶ä½¿ç”¨useCallback
- ç†è§£ä¾èµ–æ•°ç»„çš„ä½œç”¨
- æŒæ¡useCallbackä¸useEffectçš„é…åˆ
- ç†è§£useCallback vs useMemoçš„åŒºåˆ«
- å­¦ä¼šåœ¨ç»„ä»¶ä¸­æ­£ç¡®åº”ç”¨useCallback
- é¿å…useCallbackçš„è¯¯ç”¨å’Œè¿‡åº¦ä½¿ç”¨

---

## 1. ä»€ä¹ˆæ˜¯useCallbackï¼Ÿ

useCallbackæ˜¯Reactçš„Hookï¼Œå®ƒè¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒå‡½æ•°ã€‚å½“ç»„ä»¶é¢‘ç¹é‡æ–°æ¸²æŸ“æ—¶ï¼ŒuseCallbackå¯ä»¥ç¡®ä¿å‡½æ•°å¼•ç”¨åœ¨ä¾èµ–é¡¹ä¸å˜æ—¶ä¿æŒä¸å˜ã€‚

<Box style={{ padding: '20px', background: '#e8f5e9', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#2e7d32' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>è®°å¿†åŒ–ï¼ˆMemoizationï¼‰</strong>æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚<br/>
    <strong>useCallback</strong>ç¼“å­˜å‡½æ•°ï¼Œ<strong>useMemo</strong>ç¼“å­˜å€¼ï¼Œ<strong>React.memo</strong>ç¼“å­˜ç»„ä»¶ã€‚
  </p>
</Box>

### 1.1 åŸºæœ¬è¯­æ³•

```javascript
const memoizedCallback = useCallback(
  () => {
    // å‡½æ•°é€»è¾‘
  },
  [dependency1, dependency2]
);
```

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦ç¼“å­˜çš„å‡½æ•°
- ç¬¬äºŒä¸ªå‚æ•°ï¼šä¾èµ–æ•°ç»„
- è¿”å›å€¼ï¼šè®°å¿†åŒ–çš„å‡½æ•°ï¼ˆä»…åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶æ›´æ–°ï¼‰

### 1.2 ç®€å•ç¤ºä¾‹

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function CallbackExample() {
  const [count, setCount] = useState(0);

  // ä¸ä½¿ç”¨useCallback - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
  const handleClick1 = () => {
    console.log('ç‚¹å‡»æ¬¡æ•°:', count);
  };

  // ä½¿ç”¨useCallback - ä¾èµ–é¡¹ä¸å˜æ—¶ä¸é‡æ–°åˆ›å»º
  const handleClick2 = useCallback(() => {
    console.log('ç‚¹å‡»æ¬¡æ•°:', count);
  }, [count]);  // ä»…å½“countå˜åŒ–æ—¶é‡æ–°åˆ›å»º

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        å¢åŠ 
      </button>
      <button onClick={handleClick1}>
        äº‹ä»¶1 (æœªç¼“å­˜)
      </button>
      <button onClick={handleClick2}>
        äº‹ä»¶2 (å·²ç¼“å­˜)
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 2. æ·±å…¥ç†è§£useCallback

### 2.1 å‡½æ•°åˆ›å»ºvså‡½æ•°è°ƒç”¨

<CodeBlock>

```jsx
function WithoutUseCallback() {
  const [count, setCount] = useState(0);

  // æ¯æ¬¡ç»„ä»¶æ¸²æŸ“éƒ½åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°
  const handleClick = () => {
    console.log('Count:', count);
  };

  // å°†å‡½æ•°ä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶æ—¶
  return (
    <ChildComponent onClick={handleClick} />
  );
}

function WithUseCallback() {
  const [count, setCount] = useState(0);

  // åªæœ‰å½“countå˜åŒ–æ—¶æ‰é‡æ–°åˆ›å»ºå‡½æ•°
  const handleClick = useCallback(() => {
    console.log('Count:', count);
  }, [count]);

  return (
    <ChildComponent onClick={handleClick} />
  );
}
```

</CodeBlock>

### 2.2 ä¾èµ–æ•°ç»„çš„ä½œç”¨

<CodeBlock>

```jsx
function DependencyExamples() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState('');

  // 1. ç©ºä¾èµ–æ•°ç»„ - åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º
  const callback1 = useCallback(() => {
    console.log('æŒ‰é’®1ç‚¹å‡»');
  }, []);  // æ°¸è¿œä¸ä¼šé‡æ–°åˆ›å»º

  // 2. ä¾èµ–count - countå˜åŒ–æ—¶é‡æ–°åˆ›å»º
  const callback2 = useCallback(() => {
    console.log('Count:', count);
  }, [count]);  // countå˜åŒ–æ—¶é‡æ–°åˆ›å»º

  // 3. ä¾èµ–å¤šä¸ªå€¼ - ä»»æ„ä¸€ä¸ªå˜åŒ–éƒ½é‡æ–°åˆ›å»º
  const callback3 = useCallback(() => {
    console.log('Count:', count, 'Text:', text);
  }, [count, text]);  // countæˆ–textå˜åŒ–æ—¶é‡æ–°åˆ›å»º

  // 4. æ— ä¾èµ–æ•°ç»„ - æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°åˆ›å»ºï¼ˆä¸ä¸ç”¨useCallbackç›¸åŒï¼‰
  const callback4 = useCallback(() => {
    console.log('æŒ‰é’®4ç‚¹å‡»');
  });  // ä¸æ¨èï¼Œç›¸å½“äºä¸ç”¨useCallback

  return (
    <div>
      <button onClick={callback1}>æŒ‰é’®1</button>
      <button onClick={callback2}>æŒ‰é’®2</button>
      <button onClick={callback3}>æŒ‰é’®3</button>
      <button onClick={callback4}>æŒ‰é’®4</button>
    </div>
  );
}
```

</CodeBlock>

---

## 3. ä½¿ç”¨åœºæ™¯

### 3.1 ä¼ é€’ç»™å­ç»„ä»¶çš„å›è°ƒ

<Compare>

```jsx
// âŒ ä¸ä½¿ç”¨useCallback - æ¯æ¬¡çˆ¶ç»„ä»¶æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•°
function Parent() {
  const [count, setCount] = useState(0);

  return (
    <Child
      onIncrement={() => setCount(count + 1)}  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å‡½æ•°
    />
  );
}

// âœ… ä½¿ç”¨useCallback - é¿å…ä¸å¿…è¦æ¸²æŸ“
function Parent() {
  const [count, setCount] = useState(0);

  const handleIncrement = useCallback(() => {
    setCount(prev => prev + 1);  // ä½¿ç”¨å‡½æ•°å¼æ›´æ–°æ›´å¥½
  }, []);  // ç©ºä¾èµ–ï¼Œå› ä¸ºä¸éœ€è¦countçš„å€¼

  return <Child onIncrement={handleIncrement} />;
}

// å­ç»„ä»¶ä½¿ç”¨React.memoä¼˜åŒ–
const Child = React.memo(({ onIncrement }) => {
  console.log('Childæ¸²æŸ“äº†');
  return <button onClick={onIncrement}>å¢åŠ </button>;
});
```

</Compare>

### 3.2 äº‹ä»¶å¤„ç†å™¨ä¼˜åŒ–

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function TodoList() {
  const [todos, setTodos] = useState([]);
  const [text, setText] = useState('');

  const handleAddTodo = useCallback((todo) => {
    setTodos(prev => [...prev, todo]);
  }, []);  // ä¾èµ–ç©ºæ•°ç»„ï¼Œå› ä¸ºå‡½æ•°ä¸ä½¿ç”¨ä»»ä½•propsæˆ–state

  const handleToggleTodo = useCallback((id) => {
    setTodos(prev =>
      prev.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      )
    );
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  const handleDeleteTodo = useCallback((id) => {
    setTodos(prev => prev.filter(todo => todo.id !== id));
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  return (
    <div>
      <input
        value={text}
        onChange={(e) => setText(e.target.value)}
        onKeyPress={(e) => {
          if (e.key === 'Enter' && text.trim()) {
            handleAddTodo({ id: Date.now(), text, completed: false });
            setText('');
          }
        }}
      />
      <TodoItems
        todos={todos}
        onToggle={handleToggleTodo}
        onDelete={handleDeleteTodo}
      />
    </div>
  );
}
```

</CodeBlock>

### 3.3 åœ¨useEffectä¸­ä½¿ç”¨å›è°ƒ

<CodeBlock>

```jsx
import { useState, useCallback, useEffect } from 'react';

function EffectWithCallback() {
  const [data, setData] = useState(null);
  const [filter, setFilter] = useState('');

  // åœ¨useCallbackä¸­å®šä¹‰å‰¯ä½œç”¨å¤„ç†
  const fetchData = useCallback(async () => {
    const response = await fetch(`/api/data?filter=${filter}`);
    const result = await response.json();
    setData(result);
  }, [filter]);

  // åœ¨useEffectä¸­ä½¿ç”¨
  useEffect(() => {
    fetchData();
  }, [fetchData]);  // fetchDataå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ

  return (
    <div>
      <input
        value={filter}
        onChange={(e) => setFilter(e.target.value)}
        placeholder="ç­›é€‰..."
      />
      <button onClick={fetchData}>æ‰‹åŠ¨åˆ·æ–°</button>
      {data && <p>æ•°æ®å·²åŠ è½½</p>}
    </div>
  );
}
```

</CodeBlock>

---

## 4. æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

### 4.1 é¿å…å­ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“

<CodeBlock>

```jsx
import { useState, useCallback, memo } from 'react';

// ä½¿ç”¨memoä¼˜åŒ–å­ç»„ä»¶
const ExpensiveChild = memo(function ExpensiveChild({ onClick, count }) {
  console.log('ExpensiveChild æ¸²æŸ“äº†');
  return (
    <button onClick={onClick}>
      ç‚¹å‡» ({count}æ¬¡)
    </button>
  );
});

function Parent() {
  const [count1, setCount1] = useState(0);
  const [count2, setCount2] = useState(0);

  // ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°
  const handleClick1 = useCallback(() => {
    setCount1(count1 + 1);
  }, [count1]);

  const handleClick2 = useCallback(() => {
    setCount2(count2 + 1);
  }, [count2]);

  return (
    <div>
      <p>Parentæ¸²æŸ“ï¼Œcount1: {count1}, count2: {count2}</p>
      {/* åªæœ‰å¯¹åº”çš„countå˜åŒ–æ—¶ï¼Œå­ç»„ä»¶æ‰ä¼šé‡æ–°æ¸²æŸ“ */}
      <ExpensiveChild onClick={handleClick1} count={count1} />
      <ExpensiveChild onClick={handleClick2} count={count2} />
    </div>
  );
}
```

</CodeBlock>

### 4.2 è¡¨å•ä¼˜åŒ–

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function OptimizedForm() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    message: ''
  });

  // ç¼“å­˜æ¯ä¸ªå­—æ®µçš„æ›´æ–°å‡½æ•°
  const updateField = useCallback((field) => (e) => {
    setFormData(prev => ({
      ...prev,
      [field]: e.target.value
    }));
  }, []);  // ä¾èµ–ç©ºæ•°ç»„ï¼Œå‡½æ•°æœ¬èº«ä¸ä¾èµ–ä»»ä½•å€¼

  // ç¼“å­˜æäº¤å‡½æ•°
  const handleSubmit = useCallback((e) => {
    e.preventDefault();
    console.log('æäº¤æ•°æ®:', formData);
  }, [formData]);  // ä¾èµ–formData

  // ç¼“å­˜é‡ç½®å‡½æ•°
  const handleReset = useCallback(() => {
    setFormData({
      name: '',
      email: '',
      message: ''
    });
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        placeholder="å§“å"
        value={formData.name}
        onChange={updateField('name')}
      />
      <input
        type="email"
        placeholder="é‚®ç®±"
        value={formData.email}
        onChange={updateField('email')}
      />
      <textarea
        placeholder="ç•™è¨€"
        value={formData.message}
        onChange={updateField('message')}
      />
      <button type="submit">æäº¤</button>
      <button type="button" onClick={handleReset}>é‡ç½®</button>
    </form>
  );
}
```

</CodeBlock>

---

## 5. ä¸useMemoçš„åŒºåˆ«

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ åŒºåˆ«æ€»ç»“</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>useCallback(fn, deps)</strong> = <code>useMemo(() => fn, deps)</code><br/>
    ä¸¤è€…æœ¬è´¨ç›¸åŒï¼Œåªæ˜¯useCallbackæ›´è¯­ä¹‰åŒ–ï¼Œä¸“é—¨ç”¨äºå‡½æ•°ã€‚
  </p>
</Box>

### 5.1 å¯¹æ¯”ç¤ºä¾‹

<CodeBlock>

```jsx
function CallbackVsMemo() {
  const [count, setCount] = useState(0);

  // ä½¿ç”¨useCallback - ç¼“å­˜å‡½æ•°
  const handleClickWithCallback = useCallback(() => {
    console.log('Count:', count);
  }, [count]);

  // ä½¿ç”¨useMemo - ç¼“å­˜å‡½æ•°ï¼ˆæ•ˆæœç›¸åŒï¼‰
  const handleClickWithMemo = useMemo(() => {
    return () => {
      console.log('Count:', count);
    };
  }, [count]);

  return (
    <div>
      <button onClick={handleClickWithCallback}>
        useCallback
      </button>
      <button onClick={handleClickWithMemo}>
        useMemo
      </button>
    </div>
  );
}
```

</CodeBlock>

### 5.2 å®é™…åº”ç”¨åœºæ™¯

<Compare>

```jsx
// åœºæ™¯1ï¼šä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•° - æ¨èuseCallback
function Parent() {
  const [value, setValue] = useState(0);

  const handleClick = useCallback(() => {
    console.log('ç‚¹å‡»äº†', value);
  }, [value]);

  return <Child onClick={handleClick} />;
}

// åœºæ™¯2ï¼šéœ€è¦è®¡ç®—å¤æ‚å€¼çš„å‡½æ•° - æ¨èuseMemo
function ExpensiveComponent() {
  const [list, setList] = useState([1, 2, 3, 4, 5]);

  const expensiveValue = useMemo(() => {
    return list.reduce((sum, item) => sum + item, 0);
  }, [list]);  // è®¡ç®—æ€»å’Œ

  return <div>æ€»å’Œ: {expensiveValue}</div>;
}

// åœºæ™¯3ï¼šæ—¢æœ‰è®¡ç®—åˆæœ‰å›è°ƒ - ä¸¤è€…ç»“åˆ
function ComplexComponent() {
  const [data, setData] = useState([1, 2, 3]);

  const processedData = useMemo(() => {
    return data.map(x => x * 2);
  }, [data]);  // è®¡ç®—å€¼

  const handleItemClick = useCallback((item) => {
    console.log('ç‚¹å‡»äº†', item);
  }, []);  // å›è°ƒå‡½æ•°

  return (
    <List
      data={processedData}
      onClick={handleItemClick}
    />
  );
}
```

</Compare>

---

## 6. é«˜çº§ç”¨æ³•

### 6.1 å‡½æ•°å¼æ›´æ–°

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function FunctionalUpdateExample() {
  const [count, setCount] = useState(0);

  // ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼Œå‡å°‘ä¾èµ–
  const increment = useCallback(() => {
    setCount(prev => prev + 1);
  }, []);  // ä¾èµ–ç©ºæ•°ç»„ï¼Œä¸éœ€è¦count

  const decrement = useCallback(() => {
    setCount(prev => prev - 1);
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  const reset = useCallback(() => {
    setCount(0);
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={increment}>+1</button>
      <button onClick={decrement}>-1</button>
      <button onClick={reset}>é‡ç½®</button>
    </div>
  );
}
```

</CodeBlock>

### 6.2 useCallbackåµŒå¥—useCallback

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function NestedCallbacks() {
  const [user, setUser] = useState({ name: 'Alice', age: 25 });

  // å†…å±‚å›è°ƒ - ä¸ä¾èµ–ä»»ä½•å€¼
  const handleNameChange = useCallback((name) => {
    setUser(prev => ({ ...prev, name }));
  }, []);

  // å¤–å±‚å›è°ƒ - ä¾èµ–å†…å±‚å›è°ƒï¼ˆå®é™…ä¸Šä¹Ÿä¾èµ–ç©ºæ•°ç»„ï¼‰
  const handleUpdate = useCallback((name, age) => {
    handleNameChange(name);
    setUser(prev => ({ ...prev, age }));
  }, [handleNameChange]);  // ä¾èµ–handleNameChangeï¼Œä½†å®ƒæ˜¯ç¨³å®šçš„

  return (
    <div>
      <p>{user.name}, {user.age}å²</p>
      <button onClick={() => handleUpdate('Bob', 30)}>
        æ›´æ–°
      </button>
    </div>
  );
}
```

</CodeBlock>

### 6.3 æ¡ä»¶æ€§useCallback

<CodeBlock>

```jsx
import { useState, useCallback } from 'react';

function ConditionalCallback() {
  const [isEnabled, setIsEnabled] = useState(true);
  const [count, setCount] = useState(0);

  // æ¡ä»¶æ€§åˆ›å»ºcallback
  const handleClick = useCallback(() => {
    if (isEnabled) {
      console.log('Count:', count);
    }
  }, [isEnabled, count]);  // æœ‰æ¡ä»¶ä½†ä»éœ€æ­£ç¡®åˆ—å‡ºä¾èµ–

  // æˆ–è€…åœ¨callbackå†…éƒ¨å¤„ç†æ¡ä»¶
  const handleClick2 = useCallback(() => {
    console.log('Count:', count);
  }, [count]);  // ç›´æ¥ä¾èµ–count

  return (
    <div>
      <p>{isEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</p>
      <p>è®¡æ•°: {count}</p>
      <button onClick={() => setIsEnabled(!isEnabled)}>
        åˆ‡æ¢
      </button>
      <button onClick={handleClick}>ç‚¹å‡»1</button>
      <button onClick={handleClick2}>ç‚¹å‡»2</button>
    </div>
  );
}
```

</CodeBlock>

---

## 7. å¸¸è§é”™è¯¯ä¸é™·é˜±

### 7.1 å¿˜è®°ä¾èµ–æ•°ç»„

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ç¼ºå°‘ä¾èµ–æ•°ç»„
function BadExample() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    console.log('Count:', count);
  });  // ç¼ºå°‘ä¾èµ–æ•°ç»„ï¼

  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// âœ… æ­£ç¡®
function GoodExample() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    console.log('Count:', count);
  }, [count]);  // æ·»åŠ ä¾èµ–æ•°ç»„

  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

</ErrorBox>

### 7.2 ä¾èµ–æ•°ç»„è¿‡å¤š

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ä¸å¿…è¦çš„ä¾èµ–
function BadExample() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    console.log('æŒ‰é’®ç‚¹å‡»');
  }, [count]);  // countæœªä½¿ç”¨ï¼

  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}

// âœ… æ­£ç¡®
function GoodExample() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    console.log('æŒ‰é’®ç‚¹å‡»');
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  return <button onClick={handleClick}>ç‚¹å‡»</button>;
}
```

</ErrorBox>

### 7.3 è¿‡åº¦ä½¿ç”¨useCallback

<ErrorBox>

```jsx
// âŒ ä¸å¥½ - è¿‡åº¦ä¼˜åŒ–
function OverOptimized() {
  const [count, setCount] = useState(0);

  // å¤§å¤šæ•°æƒ…å†µä¸‹ä¸éœ€è¦useCallback
  const increment = useCallback(() => {
    setCount(count + 1);
  }, [count]);

  const decrement = useCallback(() => {
    setCount(count - 1);
  }, [count]);

  // è¿™ç§ç®€å•åœºæ™¯useStateæ›´ç®€æ´
  return (
    <div>
      <p>{count}</p>
      <button onClick={increment}>+1</button>
      <button onClick={decrement}>-1</button>
    </div>
  );
}

// âœ… ç®€å•åœºæ™¯ - ä¸ä½¿ç”¨useCallback
function SimpleCase() {
  const [count, setCount] = useState(0);

  // ç®€æ´æ˜äº†ï¼Œä¸éœ€è¦useCallback
  return (
    <div>
      <p>{count}</p>
      <button onClick={() => setCount(count + 1)}>
        +1
      </button>
      <button onClick={() => setCount(count - 1)}>
        -1
      </button>
    </div>
  );
}
```

</ErrorBox>

### 7.4 ä½¿ç”¨å†…è”å‡½æ•°

<ErrorBox>

```jsx
// âŒ ä¸å¥½ - å†…è”å‡½æ•°æ¯æ¬¡éƒ½åˆ›å»º
function BadExample() {
  const [count, setCount] = useState(0);

  return (
    <button onClick={() => setCount(count + 1)}>
      ç‚¹å‡» {count}
    </button>
  );
}

// âœ… æ›´å¥½ - æå–åˆ°useCallback
function GoodExample() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    setCount(count + 1);
  }, [count]);

  return (
    <button onClick={handleClick}>
      ç‚¹å‡» {count}
    </button>
  );
}

// ä½†å¯¹äºç®€å•åœºæ™¯ï¼ŒReactæ¨èå†…è”å‡½æ•°
function BestPractice() {
  const [count, setCount] = useState(0);

  return (
    <button onClick={() => setCount(count + 1)}>
      ç‚¹å‡» {count}
    </button>
  );
}
```

</ErrorBox>

---

## 8. æ€§èƒ½è€ƒé‡

### 8.1 ä½•æ—¶ä½¿ç”¨useCallback

<Rules>

1. **å°†å‡½æ•°ä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶**ä¸”å­ç»„ä»¶ä½¿ç”¨`React.memo`ä¼˜åŒ–æ—¶
2. **åœ¨useEffectä¸­ä½œä¸ºä¾èµ–**çš„å‡½æ•°
3. **å‡½æ•°è¢«å¤šæ¬¡ä½¿ç”¨**ï¼Œåˆ›å»ºæˆæœ¬é«˜
4. **é¿å…é—­åŒ…é™·é˜±**æ—¶ï¼ˆä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼‰

</Rules>

### 8.2 æ€§èƒ½å½±å“

<CodeBlock>

```jsx
import { useCallback, useState } from 'react';

function PerformanceComparison() {
  const [count, setCount] = useState(0);
  const [text, setText] = useState('');

  // åœºæ™¯1ï¼šç®€å•åœºæ™¯ - å†…è”å‡½æ•°æ›´ç®€æ´
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>
        ç®€å•åœºæ™¯ - å†…è”
      </button>
    </div>
  );

  // åœºæ™¯2ï¼šå¤æ‚äº‹ä»¶å¤„ç† - useCallbackæ›´å¥½
  const handleComplexEvent = useCallback((event) => {
    // å¤æ‚é€»è¾‘
    if (event.type === 'click') {
      setCount(count + 1);
    } else if (event.type === 'change') {
      setText(event.target.value);
    }
  }, [count]);

  return (
    <div>
      <button onClick={(e) => handleComplexEvent(e)}>
        å¤æ‚åœºæ™¯ - useCallback
      </button>
    </div>
  );
}
```

</CodeBlock>

### 8.3 useCallbackçš„ä»£ä»·

<Box style={{ padding: '20px', background: '#fff3e0', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#e65100' }}>âš ï¸ æ€§èƒ½æƒè¡¡</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    useCallbackæœ¬èº«ä¹Ÿæœ‰æ€§èƒ½å¼€é”€ï¼ˆè®°å¿†åŒ–ã€æ£€æŸ¥ä¾èµ–ç­‰ï¼‰ã€‚å¯¹äºç®€å•å‡½æ•°ï¼Œ<strong>å†…è”å‡½æ•°å¯èƒ½æ›´å¿«</strong>ã€‚åªæœ‰åœ¨éœ€è¦é¿å…ä¸å¿…è¦æ¸²æŸ“æ—¶å†ä½¿ç”¨ã€‚
  </p>
</Box>

---

## 9. å®é™…åº”ç”¨åœºæ™¯

### 9.1 åˆ—è¡¨ä¼˜åŒ–

<CodeBlock>

```jsx
import { useState, useCallback, memo } from 'react';

// å­ç»„ä»¶ - ä½¿ç”¨memoä¼˜åŒ–
const ListItem = memo(function ListItem({ item, onToggle, onDelete }) {
  console.log('ListItemæ¸²æŸ“:', item.id);
  return (
    <li>
      <input
        type="checkbox"
        checked={item.completed}
        onChange={() => onToggle(item.id)}
      />
      <span style={{ textDecoration: item.completed ? 'line-through' : 'none' }}>
        {item.text}
      </span>
      <button onClick={() => onDelete(item.id)}>åˆ é™¤</button>
    </li>
  );
});

function TodoList() {
  const [todos, setTodos] = useState([
    { id: 1, text: 'å­¦ä¹ React', completed: false },
    { id: 2, text: 'æ„å»ºåº”ç”¨', completed: false }
  ]);

  // ç¼“å­˜å›è°ƒï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“
  const handleToggle = useCallback((id) => {
    setTodos(prev =>
      prev.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      )
    );
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  const handleDelete = useCallback((id) => {
    setTodos(prev => prev.filter(todo => todo.id !== id));
  }, []);  // ä¾èµ–ç©ºæ•°ç»„

  return (
    <ul>
      {todos.map(todo => (
        <ListItem
          key={todo.id}
          item={todo}
          onToggle={handleToggle}
          onDelete={handleDelete}
        />
      ))}
    </ul>
  );
}
```

</CodeBlock>

### 9.2 æœç´¢é˜²æŠ–

<CodeBlock>

```jsx
import { useState, useCallback, useEffect } from 'react';

function SearchBox({ onSearch }) {
  const [query, setQuery] = useState('');

  // é˜²æŠ–å‡½æ•°
  const debounce = (func, delay) => {
    let timeoutId;
    return (...args) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func(...args), delay);
    };
  };

  // ç¼“å­˜æœç´¢å‡½æ•°
  const debouncedSearch = useCallback(
    debounce((searchQuery) => {
      onSearch(searchQuery);
    }, 300),
    [onSearch]
  );

  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    debouncedSearch(value);
  };

  return (
    <input
      type="text"
      value={query}
      onChange={handleChange}
      placeholder="æœç´¢..."
    />
  );
}
```

</CodeBlock>

### 9.3 WebSocketè¿æ¥

<CodeBlock>

```jsx
import { useState, useCallback, useEffect, useRef } from 'react';

function ChatComponent() {
  const [messages, setMessages] = useState([]);
  const [status, setStatus] = useState('disconnected');
  const wsRef = useRef(null);

  // ç¼“å­˜æ¶ˆæ¯å‘é€å‡½æ•°
  const sendMessage = useCallback((message) => {
    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
      wsRef.current.send(JSON.stringify({
        type: 'message',
        content: message,
        timestamp: Date.now()
      }));
    }
  }, []);

  // ç¼“å­˜æ¶ˆæ¯æ¥æ”¶å¤„ç†
  const handleMessage = useCallback((event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'message') {
      setMessages(prev => [...prev, data]);
    }
  }, []);

  // ç¼“å­˜è¿æ¥å‡½æ•°
  const connect = useCallback(() => {
    const ws = new WebSocket('ws://localhost:8080');
    wsRef.current = ws;

    ws.onopen = () => setStatus('connected');
    ws.onclose = () => setStatus('disconnected');
    ws.onmessage = handleMessage;

    return ws;
  }, [handleMessage]);

  useEffect(() => {
    const ws = connect();
    return () => ws.close();
  }, [connect]);

  return (
    <div>
      <p>çŠ¶æ€: {status}</p>
      <ul>
        {messages.map(msg => (
          <li key={msg.timestamp}>{msg.content}</li>
        ))}
      </ul>
      <button onClick={() => sendMessage('Hello!')}>
        å‘é€æ¶ˆæ¯
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 10. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šä¼˜åŒ–å­ç»„ä»¶æ¸²æŸ“

åˆ›å»ºçˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ï¼Œä¼ é€’å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œè§‚å¯ŸuseCallbackå¯¹æ€§èƒ½çš„å½±å“ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**è¦æ±‚**ï¼š
- çˆ¶ç»„ä»¶æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„state
- ä¼ é€’å¤šä¸ªå›è°ƒå‡½æ•°ç»™å­ç»„ä»¶
- ä½¿ç”¨React.memoä¼˜åŒ–å­ç»„ä»¶
- å¯¹æ¯”ä½¿ç”¨å’Œä¸ä½¿ç”¨useCallbackçš„æ€§èƒ½

**æç¤º**ï¼š
- åœ¨å­ç»„ä»¶ä¸­æ·»åŠ console.logæ¥è§‚å¯Ÿæ¸²æŸ“æ¬¡æ•°
- ä¸€ä¸ªstateå˜åŒ–æ—¶ï¼Œåªæœ‰ç›¸å…³çš„å­ç»„ä»¶æ‰åº”è¯¥é‡æ–°æ¸²æŸ“
- ä½¿ç”¨useCallbackç¼“å­˜ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°

</Expandable>

### ç»ƒä¹ 2ï¼šè¡¨å•çŠ¶æ€ç®¡ç†

åˆ›å»ºä¸€ä¸ªå¤æ‚è¡¨å•ï¼ŒåŒ…å«å¤šä¸ªå­—æ®µå’ŒéªŒè¯ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- å¤šä¸ªè¾“å…¥å­—æ®µ
- å®æ—¶éªŒè¯
- ä¿å­˜è‰ç¨¿åŠŸèƒ½
- æäº¤åŠŸèƒ½
- é‡ç½®åŠŸèƒ½

**è¦æ±‚**ï¼š
- ä½¿ç”¨useCallbackä¼˜åŒ–äº‹ä»¶å¤„ç†å‡½æ•°
- é¿å…è¡¨å•ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- å°†éªŒè¯é€»è¾‘åˆ†ç¦»åˆ°ç‹¬ç«‹å‡½æ•°

**æç¤º**ï¼š
- æ¯ä¸ªå­—æ®µçš„onChangeä½¿ç”¨useCallback
- æäº¤å’Œé‡ç½®å‡½æ•°ä¹Ÿéœ€è¦ä½¿ç”¨useCallback
- è€ƒè™‘ä½¿ç”¨useMemoç¼“å­˜éªŒè¯ç»“æœ

</Expandable>

### ç»ƒä¹ 3ï¼šå¼‚æ­¥æ•°æ®è·å–

åˆ›å»ºä¸€ä¸ªæ•°æ®è·å–ç»„ä»¶ï¼Œæ”¯æŒæœç´¢å’Œåˆ†é¡µã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æœç´¢è¾“å…¥æ¡†ï¼ˆæ”¯æŒé˜²æŠ–ï¼‰
- é¡µé¢åˆ‡æ¢
- æ•°æ®åˆ—è¡¨å±•ç¤º
- åŠ è½½çŠ¶æ€
- é”™è¯¯å¤„ç†

**è¦æ±‚**ï¼š
- ä½¿ç”¨useCallbackä¼˜åŒ–æœç´¢å‡½æ•°
- ç¼“å­˜APIè¯·æ±‚å‡½æ•°
- é¿å…ä¸å¿…è¦çš„è¯·æ±‚

**æç¤º**ï¼š
- æœç´¢ä½¿ç”¨é˜²æŠ–å’ŒuseCallback
- APIè¯·æ±‚å‡½æ•°ä½¿ç”¨useCallback
- åˆ†é¡µå‡½æ•°ä¹Ÿéœ€è¦ä¼˜åŒ–

</Expandable>

### ç»ƒä¹ 4ï¼šæ‹–æ‹½æ’åº

åˆ›å»ºä¸€ä¸ªå¯æ‹–æ‹½æ’åºçš„åˆ—è¡¨ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- åˆ—è¡¨é¡¹å¯æ‹–æ‹½
- å®æ—¶é¢„è§ˆæ’åºç»“æœ
- ç¡®è®¤æ’åºåæ›´æ–°æ•°æ®
- æ”¯æŒæ’¤é”€

**è¦æ±‚**ï¼š
- æ‹–æ‹½äº‹ä»¶å¤„ç†å‡½æ•°ä½¿ç”¨useCallback
- é¿å…æ‹–æ‹½æ—¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- æ€§èƒ½ä¼˜åŒ–åˆ—è¡¨é¡¹

**æç¤º**ï¼š
- æ‹–æ‹½å¼€å§‹ã€ç§»åŠ¨ã€ç»“æŸéƒ½éœ€è¦å›è°ƒ
- åˆ—è¡¨é¡¹ç»„ä»¶ä½¿ç”¨React.memo
- ä½¿ç”¨useCallbacké¿å…é—­åŒ…é—®é¢˜

</Expandable>

---

## 11. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… useCallbackè¿”å›è®°å¿†åŒ–çš„å›è°ƒå‡½æ•°
- âœ… åªæœ‰åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶ï¼Œå‡½æ•°æ‰ä¼šé‡æ–°åˆ›å»º
- âœ… ä¸»è¦ç”¨äºå°†å‡½æ•°ä½œä¸ºpropsä¼ é€’ç»™å­ç»„ä»¶æ—¶
- âœ… é¿å…å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- âœ… ä¾èµ–æ•°ç»„å¿…é¡»æ­£ç¡®åˆ—å‡ºæ‰€æœ‰ä¾èµ–
- âœ… ä¸React.memoé…åˆä½¿ç”¨æ•ˆæœæœ€ä½³
- âœ… useCallback(fn, deps) = useMemo(() => fn, deps)
- âœ… ä¸è¦è¿‡åº¦ä½¿ç”¨useCallbackï¼Œç®€å•åœºæ™¯ç”¨å†…è”å‡½æ•°å³å¯

</Checklist>

### æœ€ä½³å®è·µ

<BestPractices>

1. **ä¼˜å…ˆä½¿ç”¨å‡½æ•°å¼æ›´æ–°** - å‡å°‘useCallbackçš„ä¾èµ–é¡¹
2. **åªåœ¨å¿…è¦æ—¶ä½¿ç”¨** - å°†å‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶æ—¶
3. **æ­£ç¡®åˆ—å‡ºä¾èµ–** - æ‰€æœ‰ç”¨åˆ°çš„å€¼éƒ½è¦åœ¨ä¾èµ–æ•°ç»„ä¸­
4. **ä¿æŒå‡½æ•°ç®€æ´** - å¤æ‚çš„é€»è¾‘å•ç‹¬æå–
5. **é…åˆReact.memo** - æœ€å¤§åŒ–æ€§èƒ½ä¼˜åŒ–æ•ˆæœ
6. **é¿å…è¿‡åº¦ä¼˜åŒ–** - ç®€å•åœºæ™¯ä¸éœ€è¦useCallback

</BestPractices>

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**ä½•æ—¶ä½¿ç”¨**ï¼š
- å‡½æ•°ä½œä¸ºpropsä¼ é€’ç»™ä½¿ç”¨memoçš„å­ç»„ä»¶
- å‡½æ•°åœ¨useEffectçš„ä¾èµ–æ•°ç»„ä¸­
- å‡½æ•°åˆ›å»ºæˆæœ¬é«˜ä¸”é¢‘ç¹ä½¿ç”¨

**ä½•æ—¶ä¸ç”¨**ï¼š
- ç®€å•çš„å†…è”äº‹ä»¶å¤„ç†å™¨
- ä»…åœ¨çˆ¶ç»„ä»¶å†…éƒ¨ä½¿ç”¨çš„å‡½æ•°
- æ€§èƒ½å¼€é”€å¤§äºæ”¶ç›Šæ—¶

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†useCallbackï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ ï¼š

1. **[useMemo](useMemo)** - ä¼˜åŒ–è®¡ç®—å€¼
2. **[è‡ªå®šä¹‰Hooks](custom-hooks)** - åˆ›å»ºå¯å¤ç”¨çš„é€»è¾‘
3. **[ç»„ä»¶æ€§èƒ½ä¼˜åŒ–](../performance/optimization)** - ç»¼åˆæ€§èƒ½ä¼˜åŒ–

---

## 12. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [useCallback APIå‚è€ƒ](https://react.dev/reference/react/useCallback) - Reactå®˜æ–¹æ–‡æ¡£
- [æ€§èƒ½ä¼˜åŒ–](https://react.dev/learn/render-and-commit) - æ¸²æŸ“å’Œæ€§èƒ½
- [useCallback vs useMemo](https://kentcdodds.com/blog/usememo-and-usecallback) - ä½•æ—¶ä½¿ç”¨å“ªä¸ª

### æ¨èé˜…è¯»

- [Reactä¼˜åŒ–æŒ‡å—](https://kentcdodds.com/blog/application-state-management-with-react) - çŠ¶æ€ç®¡ç†å’Œä¼˜åŒ–
- [useCallbackåæ¨¡å¼](https://kentcdodds.com/blog/dont-use-usecallback-as-a-performance-optimization-in-react) - é¿å…è¯¯ç”¨
- [æ€§èƒ½ä¼˜åŒ–æŠ€å·§](https://react.dev/learn/rendering-lists) - åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–

---

[â† ä¸Šä¸€ç« ï¼šuseReducer](useReducer) | [ä¸‹ä¸€ç« ï¼šuseMemo â†’](useMemo)
