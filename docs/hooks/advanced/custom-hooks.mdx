# è‡ªå®šä¹‰Hooks - é€»è¾‘å¤ç”¨

import { Tabs, TabItem } from '@docusaurus/theme-common';

è‡ªå®šä¹‰Hookæ˜¯React Hooksç³»ç»Ÿçš„å¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ å°†ç»„ä»¶é€»è¾‘æå–ä¸ºå¯é‡ç”¨çš„å‡½æ•°ã€‚é€šè¿‡è‡ªå®šä¹‰Hookï¼Œä½ å¯ä»¥å°†çŠ¶æ€é€»è¾‘ã€å‰¯ä½œç”¨é€»è¾‘ç­‰åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº«ï¼Œè€Œæ— éœ€ä½¿ç”¨é«˜é˜¶ç»„ä»¶æˆ–render propsã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ å¦‚ä½•è®¾è®¡ã€åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰Hookã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£è‡ªå®šä¹‰Hookçš„æ¦‚å¿µå’Œä½œç”¨
- æŒæ¡è‡ªå®šä¹‰Hookçš„å‘½åè§„åˆ™å’Œçº¦å®š
- å­¦ä¼šåˆ›å»ºå„ç§ç±»å‹çš„è‡ªå®šä¹‰Hook
- æŒæ¡è‡ªå®šä¹‰Hookçš„è®¾è®¡æ¨¡å¼
- ç†è§£Hookè°ƒç”¨è§„åˆ™
- å­¦ä¼šåœ¨è‡ªå®šä¹‰Hookä¸­ä½¿ç”¨å…¶ä»–Hook
- æŒæ¡è‡ªå®šä¹‰Hookçš„æµ‹è¯•æ–¹æ³•
- äº†è§£å¸¸è§è‡ªå®šä¹‰Hookæ¨¡å¼

---

## 1. ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰Hookï¼Ÿ

è‡ªå®šä¹‰Hookæ˜¯ä»¥`use`å¼€å¤´çš„JavaScriptå‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨å†…éƒ¨è°ƒç”¨å…¶ä»–Hookã€‚è‡ªå®šä¹‰Hookä¸æ˜¯React APIï¼Œè€Œæ˜¯JavaScriptå‡½æ•°çš„å‘½åçº¦å®šï¼Œå®ƒè®©ä½ èƒ½å¤Ÿå°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚

<Box style={{ padding: '20px', background: '#e8f5e9', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#2e7d32' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>è‡ªå®šä¹‰Hook</strong>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°åä»¥<code>use</code>å¼€å¤´ï¼Œå†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–Hookï¼ˆå¦‚useStateã€useEffectç­‰ï¼‰ã€‚
  </p>
</Box>

### 1.1 åŸºæœ¬è§„åˆ™

<Rules>

1. **å‘½åçº¦å®š** - å‡½æ•°åå¿…é¡»ä»¥`use`å¼€å¤´
2. **Hookè°ƒç”¨** - å¯ä»¥è°ƒç”¨å…¶ä»–React Hook
3. **çº¯é€»è¾‘** - è´Ÿè´£å¤„ç†é€»è¾‘ï¼Œä¸å…³å¿ƒUI
4. **å¯å¤ç”¨** - å¯åœ¨å¤šä¸ªç»„ä»¶ä¸­ä½¿ç”¨
5. **æ¡ä»¶è°ƒç”¨** - ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨

</Rules>

### 1.2 ç®€å•ç¤ºä¾‹

<CodeBlock>

```jsx
import { useState, useEffect } from 'react';

// è‡ªå®šä¹‰Hookï¼šè®¡æ•°å™¨
function useCounter(initialValue = 0) {
  const [count, setCount] = useState(initialValue);

  const increment = () => setCount(prev => prev + 1);
  const decrement = () => setCount(prev => prev - 1);
  const reset = () => setCount(initialValue);

  return {
    count,
    increment,
    decrement,
    reset
  };
}

// ä½¿ç”¨è‡ªå®šä¹‰Hook
function CounterComponent() {
  const { count, increment, decrement, reset } = useCounter(10);

  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={increment}>+1</button>
      <button onClick={decrement}>-1</button>
      <button onClick={reset}>é‡ç½®</button>
    </div>
  );
}

// åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­å¤ç”¨
function AnotherCounter() {
  const { count, increment } = useCounter(0);

  return (
    <div>
      <p>å¦ä¸€ä¸ªè®¡æ•°å™¨: {count}</p>
      <button onClick={increment}>å¢åŠ </button>
    </div>
  );
}
```

</CodeBlock>

---

## 2. è‡ªå®šä¹‰Hookè®¾è®¡æ¨¡å¼

### 2.1 çŠ¶æ€ç®¡ç†Hook

<CodeBlock>

```jsx
// 1. ç®€å•çš„çŠ¶æ€Hook
function useToggle(initialValue = false) {
  const [value, setValue] = useState(initialValue);
  const toggle = useCallback(() => setValue(v => !v), []);
  return [value, toggle];
}

// ä½¿ç”¨
function ToggleComponent() {
  const [isOn, toggleIsOn] = useToggle();

  return (
    <button
      onClick={toggleIsOn}
      style={{ backgroundColor: isOn ? 'green' : 'gray' }}
    >
      {isOn ? 'å¼€' : 'å…³'}
    </button>
  );
}

// 2. æœ¬åœ°å­˜å‚¨Hook
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      return initialValue;
    }
  });

  const setValue = (value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue, setValue];
}

// ä½¿ç”¨
function LocalStorageComponent() {
  const [name, setName] = useLocalStorage('name', 'Alice');

  return (
    <input
      value={name}
      onChange={(e) => setName(e.target.value)}
      placeholder="è¾“å…¥åå­—..."
    />
  );
}
```

</CodeBlock>

### 2.2 å‰¯ä½œç”¨Hook

<CodeBlock>

```jsx
// 1. å¼‚æ­¥æ•°æ®è·å–Hook
function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    if (!url) return;

    const fetchData = async () => {
      setLoading(true);
      setError(null);

      try {
        const response = await fetch(url);
        const result = await response.json();
        setData(result);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [url]);

  return { data, loading, error };
}

// ä½¿ç”¨
function UserProfile({ userId }) {
  const { data: user, loading, error } = useFetch(`/api/users/${userId}`);

  if (loading) return <p>åŠ è½½ä¸­...</p>;
  if (error) return <p>é”™è¯¯: {error}</p>;
  if (!user) return <p>ç”¨æˆ·ä¸å­˜åœ¨</p>;

  return (
    <div>
      <h1>{user.name}</h1>
      <p>é‚®ç®±: {user.email}</p>
    </div>
  );
}

// 2. çª—å£å°ºå¯¸Hook
function useWindowSize() {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });

  useEffect(() => {
    const handleResize = () => {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    };

    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return windowSize;
}

// ä½¿ç”¨
function ResponsiveComponent() {
  const { width, height } = useWindowSize();

  return (
    <p>
      çª—å£å°ºå¯¸: {width} x {height}
    </p>
  );
}
```

</CodeBlock>

### 2.3 è¡¨å•å¤„ç†Hook

:::warning é‡è¦è¯´æ˜
**ä¸ºä»€ä¹ˆéœ€è¦æ”¹è¿›ï¼Ÿ**

åŸå§‹çš„ `useForm` Hook æœ‰ä¸€ä¸ªè‡´å‘½ç¼ºé™·ï¼š

```javascript
// âŒ é”™è¯¯çš„å®ç°
isValid: Object.keys(errors).length === 0
```

**é—®é¢˜æ‰€åœ¨ï¼š**
- å¦‚æœä¸€ä¸ªå­—æ®µä»æœªè¢«ç”¨æˆ·"è§¦ç¢°"è¿‡ï¼Œå®ƒå°±ä¸ä¼šæœ‰é”™è¯¯è®°å½•åœ¨ `errors` ä¸­
- å› æ­¤ `isValid` å¯èƒ½é”™è¯¯åœ°è¿”å› `true`ï¼Œå¯¼è‡´ç©ºè¡¨å•ä¹Ÿèƒ½æäº¤
- æŒ‰é’®çŠ¶æ€ä¸å¯é ï¼Œå¯èƒ½è¯¯å¯¼ç”¨æˆ·

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ·»åŠ  `isSubmitting` çŠ¶æ€æ¥æ§åˆ¶æäº¤è¿‡ç¨‹
2. æ·»åŠ  `validateAllFields()` æ–¹æ³•ï¼Œåœ¨æäº¤æ—¶å¼ºåˆ¶éªŒè¯æ‰€æœ‰å­—æ®µ
3. æ·»åŠ  `submit()` æ–¹æ³•ï¼Œå†…ç½®å®Œæ•´çš„éªŒè¯å’Œæäº¤æµç¨‹
4. æ”¹è¿› `isValid` é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½ç»è¿‡éªŒè¯

è¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰æ‰€æœ‰å­—æ®µéƒ½çœŸæ­£æœ‰æ•ˆæ—¶ï¼Œè¡¨å•æ‰èƒ½æäº¤ã€‚
:::

<CodeBlock>

```jsx
// æ”¹è¿›çš„è¡¨å•Hook - è§£å†³isValidç¼ºé™·
function useForm(initialValues = {}, validationRules = {}) {
  const [values, setValues] = useState(initialValues);
  const [errors, setErrors] = useState({});
  const [touched, setTouched] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false); // æ–°å¢ï¼šæäº¤çŠ¶æ€

  // éªŒè¯å•ä¸ªå­—æ®µ
  const validateField = (name, value) => {
    const rule = validationRules[name];
    if (!rule) return '';

    if (rule.required && !value) {
      return `${name}æ˜¯å¿…å¡«é¡¹`;
    }

    if (rule.minLength && value.length < rule.minLength) {
      return `${name}è‡³å°‘éœ€è¦${rule.minLength}ä¸ªå­—ç¬¦`;
    }

    if (rule.pattern && !rule.pattern.test(value)) {
      return `${name}æ ¼å¼ä¸æ­£ç¡®`;
    }

    return '';
  };

  // éªŒè¯æ‰€æœ‰å­—æ®µ - æ–°å¢ï¼šå…¨é‡éªŒè¯æ–¹æ³•
  const validateAllFields = () => {
    const newErrors = {};
    let isValid = true;
    for (const fieldName in validationRules) {
      const error = validateField(fieldName, values[fieldName]);
      if (error) {
        newErrors[fieldName] = error;
        isValid = false;
      }
    }
    setErrors(newErrors);
    setTouched(Object.keys(validationRules).reduce((acc, key) => ({ ...acc, [key]: true }), {}));
    return isValid;
  };

  // å¤„ç†è¾“å…¥å˜åŒ–
  const handleChange = (name) => (e) => {
    const value = e.target.value;
    setValues(prev => ({ ...prev, [name]: value }));

    // å®æ—¶éªŒè¯
    const error = validateField(name, value);
    setErrors(prev => ({ ...prev, [name]: error }));
  };

  // å¤„ç†å¤±ç„¦
  const handleBlur = (name) => () => {
    setTouched(prev => ({ ...prev, [name]: true }));
    const error = validateField(name, values[name]);
    setErrors(prev => ({ ...prev, [name]: error }));
  };

  // æ–°å¢ï¼šæ™ºèƒ½æäº¤æ–¹æ³•
  const submit = (callback) => {
    setIsSubmitting(true);
    const isFormValid = validateAllFields();
    if (isFormValid) {
      // éªŒè¯é€šè¿‡ï¼Œæ‰§è¡Œå›è°ƒ
      callback(values);
    }
    setIsSubmitting(false);
  };

  // é‡ç½®è¡¨å•
  const reset = () => {
    setValues(initialValues);
    setErrors({});
    setTouched({});
    setIsSubmitting(false);
  };

  return {
    values,
    errors,
    touched,
    handleChange,
    handleBlur,
    reset,
    submit,           // è¿”å›æ–°çš„submitæ–¹æ³•
    isSubmitting,     // è¿”å›æäº¤çŠ¶æ€
    isValid: Object.keys(errors).every(key => !errors[key]) // æ”¹è¿›ï¼šæ£€æŸ¥æ‰€æœ‰å­—æ®µæ˜¯å¦æ— é”™è¯¯
  };
}

// æ”¹è¿›åçš„ä½¿ç”¨æ–¹å¼
function RegistrationForm() {
  const {
    values,
    errors,
    touched,
    handleChange,
    handleBlur,
    reset,
    submit,       // ä½¿ç”¨æ–°çš„submitæ–¹æ³•
    isSubmitting  // ä½¿ç”¨æ–°çš„isSubmittingçŠ¶æ€
  } = useForm(
    { name: '', email: '', password: '' },
    {
      name: { required: true, minLength: 2 },
      email: { required: true, pattern: /^\S+@\S+\.\S+$/ },
      password: { required: true, minLength: 6 }
    }
  );

  // ä½¿ç”¨æ–°çš„submitæ–¹æ³•æäº¤è¡¨å•
  const handleSubmit = (e) => {
    e.preventDefault();
    // è°ƒç”¨submitæ–¹æ³•ï¼Œä¼ å…¥æäº¤æˆåŠŸåçš„å›è°ƒ
    submit((submittedValues) => {
      console.log('æäº¤æ•°æ®:', submittedValues);
      // è¿™é‡Œå¯ä»¥è·³è½¬é¡µé¢ã€æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ç­‰
    });
  };

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <input
          type="text"
          name="name"
          value={values.name}
          onChange={handleChange('name')}
          onBlur={handleBlur('name')}
          placeholder="å§“å"
        />
        {touched.name && errors.name && <p>{errors.name}</p>}
      </div>

      <div>
        <input
          type="email"
          name="email"
          value={values.email}
          onChange={handleChange('email')}
          onBlur={handleBlur('email')}
          placeholder="é‚®ç®±"
        />
        {touched.email && errors.email && <p>{errors.email}</p>}
      </div>

      <div>
        <input
          type="password"
          name="password"
          value={values.password}
          onChange={handleChange('password')}
          onBlur={handleBlur('password')}
          placeholder="å¯†ç "
        />
        {touched.password && errors.password && <p>{errors.password}</p>}
      </div>

      {/* æŒ‰é’®çŠ¶æ€ç”±isSubmittingæ§åˆ¶ */}
      <button type="submit" disabled={isSubmitting}>
        {isSubmitting ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ'}
      </button>
      <button type="button" onClick={reset} disabled={isSubmitting}>
        é‡ç½®
      </button>
    </form>
  );
}
```

</CodeBlock>

---

## 3. é«˜çº§è‡ªå®šä¹‰Hook

### 3.1 é˜²æŠ–Hook

<CodeBlock>

```jsx
// é˜²æŠ–Hook
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

// ä½¿ç”¨
function SearchComponent() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const debouncedQuery = useDebounce(query, 300);

  useEffect(() => {
    if (debouncedQuery) {
      // æ‰§è¡Œæœç´¢
      fetch(`/api/search?q=${debouncedQuery}`)
        .then(res => res.json())
        .then(data => setResults(data));
    }
  }, [debouncedQuery]);

  return (
    <div>
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="æœç´¢..."
      />
      <ul>
        {results.map(result => (
          <li key={result.id}>{result.title}</li>
        ))}
      </ul>
    </div>
  );
}
```

</CodeBlock>

### 3.2 åª’ä½“æŸ¥è¯¢Hook

<CodeBlock>

```jsx
// åª’ä½“æŸ¥è¯¢Hook
function useMediaQuery(query) {
  const [matches, setMatches] = useState(() => {
    // æœåŠ¡ç«¯æ¸²æŸ“æ—¶çš„é»˜è®¤å€¼
    if (typeof window !== 'undefined') {
      return window.matchMedia(query).matches;
    }
    return false;
  });

  useEffect(() => {
    const mediaQuery = window.matchMedia(query);

    const handler = (event) => {
      setMatches(event.matches);
    };

    // è®¾ç½®åˆå§‹å€¼
    setMatches(mediaQuery.matches);

    // è®¢é˜…åª’ä½“æŸ¥è¯¢å˜åŒ–
    mediaQuery.addEventListener('change', handler);

    return () => {
      mediaQuery.removeEventListener('change', handler);
    };
  }, [query]);

  return matches;
}

// ä½¿ç”¨
function ResponsiveLayout() {
  const isMobile = useMediaQuery('(max-width: 768px)');
  const isTablet = useMediaQuery('(max-width: 1024px)');

  return (
    <div style={{ display: isMobile ? 'block' : 'flex' }}>
      {isMobile ? <MobileLayout /> : <DesktopLayout />}
      {isTablet && <TabletFeatures />}
    </div>
  );
}
```

</CodeBlock>

### 3.3 WebSocket Hook

<CodeBlock>

```jsx
// WebSocket Hook
function useWebSocket(url, options = {}) {
  const { onMessage, onOpen, onClose, onError } = options;
  const [socket, setSocket] = useState(null);
  const [isConnected, setIsConnected] = useState(false);
  const [lastMessage, setLastMessage] = useState(null);
  const [retryCount, setRetryCount] = useState(0);

  useEffect(() => {
    if (!url) return;

    let ws;
    let retryTimer;

    const connect = () => {
      ws = new WebSocket(url);

      ws.onopen = () => {
        setIsConnected(true);
        setRetryCount(0);
        onOpen && onOpen();
      };

      ws.onmessage = (event) => {
        setLastMessage(event.data);
        onMessage && onMessage(event.data);
      };

      ws.onclose = () => {
        setIsConnected(false);
        onClose && onClose();

        // é‡è¿é€»è¾‘
        if (retryCount < 5) {
          retryTimer = setTimeout(() => {
            setRetryCount(prev => prev + 1);
            connect();
          }, 1000 * Math.pow(2, retryCount));
        }
      };

      ws.onerror = (error) => {
        onError && onError(error);
      };

      setSocket(ws);
    };

    connect();

    return () => {
      if (ws) {
        ws.close();
      }
      if (retryTimer) {
        clearTimeout(retryTimer);
      }
    };
  }, [url, onMessage, onOpen, onClose, onError, retryCount]);

  const sendMessage = (message) => {
    if (socket && isConnected) {
      socket.send(message);
    }
  };

  const disconnect = () => {
    if (socket) {
      socket.close();
    }
  };

  return {
    isConnected,
    lastMessage,
    sendMessage,
    disconnect,
    retryCount
  };
}

// ä½¿ç”¨
function ChatComponent() {
  const [messages, setMessages] = useState([]);
  const { isConnected, lastMessage, sendMessage } = useWebSocket(
    'ws://localhost:8080',
    {
      onMessage: (message) => {
        setMessages(prev => [...prev, { id: Date.now(), text: message }]);
      }
    }
  );

  const handleSend = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const message = formData.get('message');
    if (message) {
      sendMessage(message);
      e.target.reset();
    }
  };

  return (
    <div>
      <p>çŠ¶æ€: {isConnected ? 'å·²è¿æ¥' : 'å·²æ–­å¼€'}</p>
      <ul>
        {messages.map(msg => (
          <li key={msg.id}>{msg.text}</li>
        ))}
      </ul>
      <form onSubmit={handleSend}>
        <input name="message" placeholder="è¾“å…¥æ¶ˆæ¯..." />
        <button type="submit">å‘é€</button>
      </form>
    </div>
  );
}
```

</CodeBlock>

### 3.4 å†å²è®°å½•Hook

<CodeBlock>

```jsx
// å†å²è®°å½•Hook
function useHistory(initialValue) {
  const [past, setPast] = useState([]);
  const [present, setPresent] = useState(initialValue);
  const [future, setFuture] = useState([]);

  const canUndo = past.length > 0;
  const canRedo = future.length > 0;

  const setValue = (newValue) => {
    const newPresent = typeof newValue === 'function' ? newValue(present) : newValue;

    setPast(prev => [...prev, present]);
    setPresent(newPresent);
    setFuture([]);
  };

  const undo = () => {
    if (!canUndo) return;

    const previous = past[past.length - 1];
    const newPast = past.slice(0, past.length - 1);

    setFuture(prev => [present, ...prev]);
    setPresent(previous);
    setPast(newPast);
  };

  const redo = () => {
    if (!canRedo) return;

    const next = future[0];
    const newFuture = future.slice(1);

    setPast(prev => [...prev, present]);
    setPresent(next);
    setFuture(newFuture);
  };

  const reset = (initialValue) => {
    setPast([]);
    setPresent(initialValue);
    setFuture([]);
  };

  return {
    present,
    setValue,
    undo,
    redo,
    canUndo,
    canRedo,
    reset
  };
}

// ä½¿ç”¨
function EditorWithHistory() {
  const { present, setValue, undo, redo, canUndo, canRedo } = useHistory('');

  return (
    <div>
      <textarea
        value={present}
        onChange={(e) => setValue(e.target.value)}
        rows="10"
        cols="50"
      />
      <div>
        <button onClick={undo} disabled={!canUndo}>
          æ’¤é”€
        </button>
        <button onClick={redo} disabled={!canRedo}>
          é‡åš
        </button>
      </div>
    </div>
  );
}
```

</CodeBlock>

---

## 4. æ¡ä»¶æ¸²æŸ“Hook

### 4.1 è®¾å¤‡æ£€æµ‹Hook

<CodeBlock>

```jsx
// è®¾å¤‡æ£€æµ‹Hook
function useDevice() {
  const [device, setDevice] = useState('desktop');

  useEffect(() => {
    const userAgent = navigator.userAgent.toLowerCase();
    const isMobile = /mobile|android|iphone|ipad/.test(userAgent);
    const isTablet = /tablet|ipad/.test(userAgent);

    if (isTablet) {
      setDevice('tablet');
    } else if (isMobile) {
      setDevice('mobile');
    } else {
      setDevice('desktop');
    }
  }, []);

  const isMobile = device === 'mobile';
  const isTablet = device === 'tablet';
  const isDesktop = device === 'desktop';

  return { device, isMobile, isTablet, isDesktop };
}

// ä½¿ç”¨
function DeviceSpecificComponent() {
  const { isMobile, isTablet, device } = useDevice();

  if (isMobile) {
    return <MobileLayout />;
  }

  if (isTablet) {
    return <TabletLayout />;
  }

  return <DesktopLayout />;
}
```

</CodeBlock>

### 4.2 æƒé™æ£€æŸ¥Hook

<CodeBlock>

```jsx
// æƒé™Hook
function usePermissions() {
  const [permissions, setPermissions] = useState([]);

  useEffect(() => {
    // æ¨¡æ‹Ÿè·å–ç”¨æˆ·æƒé™
    const fetchPermissions = async () => {
      const userPermissions = await api.getUserPermissions();
      setPermissions(userPermissions);
    };
    fetchPermissions();
  }, []);

  const hasPermission = (permission) => {
    return permissions.includes(permission);
  };

  const hasAnyPermission = (permissionList) => {
    return permissionList.some(p => permissions.includes(p));
  };

  const hasAllPermissions = (permissionList) => {
    return permissionList.every(p => permissions.includes(p));
  };

  return {
    permissions,
    hasPermission,
    hasAnyPermission,
    hasAllPermissions
  };
}

// ä½¿ç”¨
function AdminPanel() {
  const { hasPermission } = usePermissions();

  if (!hasPermission('admin')) {
    return <p>æ²¡æœ‰æƒé™è®¿é—®</p>;
  }

  return (
    <div>
      <h1>ç®¡ç†å‘˜é¢æ¿</h1>
      {hasPermission('user:create') && <button>åˆ›å»ºç”¨æˆ·</button>}
      {hasPermission('user:delete') && <button>åˆ é™¤ç”¨æˆ·</button>}
    </div>
  );
}
```

</CodeBlock>

---

## 5. è‡ªå®šä¹‰Hookæœ€ä½³å®è·µ

### 5.1 å‘½åçº¦å®š

<CodeBlock>

```jsx
// âœ… å¥½çš„å‘½å
function useCounter(initialValue) { }
function useFetch(url) { }
function useLocalStorage(key, initialValue) { }
function useDebounce(value, delay) { }
function useMediaQuery(query) { }

// âŒ é¿å…çš„å‘½å
function counter(initialValue) { }  // ç¼ºå°‘useå‰ç¼€
function getFetch(url) { }  // ç¼ºå°‘useå‰ç¼€
function storageHelper(key, value) { }  // ç¼ºå°‘useå‰ç¼€
```

</CodeBlock>

### 5.2 å•ä¸€èŒè´£åŸåˆ™

<Compare>

```jsx
// âŒ ä¸å¥½ - HookèŒè´£è¿‡å¤š
function useUserData(userId) {
  const [user, setUser] = useState(null);
  const [posts, setPosts] = useState([]);
  const [loading, setLoading] = useState(true);

  // æ—¢å¤„ç†ç”¨æˆ·æ•°æ®åˆå¤„ç†æ–‡ç« æ•°æ®
  useEffect(() => {
    // è·å–ç”¨æˆ·
    fetchUser(userId).then(setUser);
    // è·å–æ–‡ç« 
    fetchPosts(userId).then(setPosts);
    setLoading(false);
  }, [userId]);

  return { user, posts, loading };
}

// âœ… æ›´å¥½ - åˆ†ç¦»èŒè´£
function useUser(userId) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUser(userId).then(setUser);
    setLoading(false);
  }, [userId]);

  return { user, loading };
}

function useUserPosts(userId) {
  const [posts, setPosts] = useState([]);

  useEffect(() => {
    fetchPosts(userId).then(setPosts);
  }, [userId]);

  return posts;
}
```

</Compare>

### 5.3 é”™è¯¯å¤„ç†

<CodeBlock>

```jsx
// âœ… åŒ…å«é”™è¯¯å¤„ç†çš„Hook
function useAsync(asyncFunction, immediate = true) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(immediate);
  const [error, setError] = useState(null);

  const execute = useCallback(async (...args) => {
    setLoading(true);
    setError(null);

    try {
      const result = await asyncFunction(...args);
      setData(result);
      setLoading(false);
      return result;
    } catch (error) {
      setError(error);
      setLoading(false);
      throw error;
    }
  }, [asyncFunction]);

  return { data, loading, error, execute };
}

// ä½¿ç”¨
function DataComponent() {
  const fetchUser = useCallback(async (id) => {
    const response = await fetch(`/api/users/${id}`);
    if (!response.ok) {
      throw new Error('è·å–ç”¨æˆ·å¤±è´¥');
    }
    return response.json();
  }, []);

  const { data: user, loading, error, execute } = useAsync(fetchUser);

  if (loading) return <p>åŠ è½½ä¸­...</p>;
  if (error) return <p>é”™è¯¯: {error.message}</p>;
  if (user) return <p>ç”¨æˆ·: {user.name}</p>;

  return <button onClick={() => execute(1)}>åŠ è½½ç”¨æˆ·</button>;
}
```

</CodeBlock>

### 5.4 ç±»å‹å®šä¹‰ï¼ˆTypeScriptï¼‰

<CodeBlock>

```typescript
// TypeScriptç‰ˆæœ¬çš„è‡ªå®šä¹‰Hook
function useCounter(initialValue: number = 0) {
  const [count, setCount] = useState<number>(initialValue);

  const increment = useCallback(() => {
    setCount(prev => prev + 1);
  }, []);

  const decrement = useCallback(() => {
    setCount(prev => prev - 1);
  }, []);

  const reset = useCallback(() => {
    setCount(initialValue);
  }, [initialValue]);

  return {
    count,
    increment,
    decrement,
    reset
  };
}

// ä½¿ç”¨
function CounterComponent() {
  const { count, increment } = useCounter(10);
  // countç±»å‹ä¸ºnumberï¼Œincrementç±»å‹ä¸º() => void
}
```

</CodeBlock>

---

## 6. å¸¸è§è‡ªå®šä¹‰Hookæ¨¡å¼

### 6.1 æ•°æ®ç¼“å­˜æ¨¡å¼

<CodeBlock>

```jsx
// ç¼“å­˜Hook
function useCache(key, fetcher, options = {}) {
  const { ttl = 60000 } = options; // é»˜è®¤ç¼“å­˜60ç§’
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [lastFetch, setLastFetch] = useState(0);

  const fetchData = useCallback(async (force = false) => {
    const now = Date.now();

    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    if (!force && data && now - lastFetch < ttl) {
      return;
    }

    setLoading(true);
    setError(null);

    try {
      const result = await fetcher();
      setData(result);
      setLastFetch(now);
    } catch (err) {
      setError(err);
    } finally {
      setLoading(false);
    }
  }, [data, lastFetch, fetcher, ttl]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return { data, loading, error, refetch: () => fetchData(true) };
}

// ä½¿ç”¨
function CachedUserProfile({ userId }) {
  const { data: user, loading, error, refetch } = useCache(
    `user-${userId}`,
    () => fetch(`/api/users/${userId}`).then(r => r.json()),
    { ttl: 300000 } // ç¼“å­˜5åˆ†é’Ÿ
  );

  if (loading) return <p>åŠ è½½ä¸­...</p>;
  if (error) return <p>é”™è¯¯: {error.message}</p>;
  if (!user) return <p>ç”¨æˆ·ä¸å­˜åœ¨</p>;

  return (
    <div>
      <h1>{user.name}</h1>
      <button onClick={refetch}>åˆ·æ–°</button>
    </div>
  );
}
```

</CodeBlock>

### 6.2 äº‹ä»¶ç›‘å¬æ¨¡å¼

<CodeBlock>

```jsx
// äº‹ä»¶ç›‘å¬Hook
function useEventListener(eventType, handler, element = window) {
  useEffect(() => {
    if (!element || !element.addEventListener) return;

    const eventListener = (event) => {
      handler(event);
    };

    element.addEventListener(eventType, eventListener);

    return () => {
      element.removeEventListener(eventType, eventListener);
    };
  }, [eventType, handler, element]);
}

// ä½¿ç”¨
function MouseTracker() {
  const [coordinates, setCoordinates] = useState({ x: 0, y: 0 });

  useEventListener('mousemove', (e) => {
    setCoordinates({
      x: e.clientX,
      y: e.clientY
    });
  });

  return (
    <p>
      é¼ æ ‡ä½ç½®: ({coordinates.x}, {coordinates.y})
    </p>
  );
}
```

</CodeBlock>

### 6.3 çŠ¶æ€æœºæ¨¡å¼

<CodeBlock>

```jsx
// çŠ¶æ€æœºHook
function useStateMachine(initialState, states) {
  const [currentState, setCurrentState] = useState(initialState);
  const [context, setContext] = useState({});

  const transition = useCallback((newState, newContext = {}) => {
    if (!states[currentState] || !states[currentState].transitions[newState]) {
      console.error(`æ— æ•ˆçš„è½¬æ¢: ${currentState} -> ${newState}`);
      return;
    }

    setCurrentState(newState);
    setContext(prev => ({ ...prev, ...newContext }));
  }, [currentState, states]);

  const state = states[currentState] || {};

  return {
    state: state.data || {},
    currentState,
    transition,
    context
  };
}

// ä½¿ç”¨
function LoginForm() {
  const {
    state: formData,
    currentState,
    transition
  } = useStateMachine('idle', {
    idle: {
      data: {},
      transitions: {
        submitting: 'loading'
      }
    },
    loading: {
      data: {},
      transitions: {
        success: 'success',
        error: 'error'
      }
    },
    success: {
      data: { message: 'ç™»å½•æˆåŠŸ' },
      transitions: {
        reset: 'idle'
      }
    },
    error: {
      data: { message: 'ç™»å½•å¤±è´¥' },
      transitions: {
        reset: 'idle'
      }
    }
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    transition('submitting');

    try {
      await login(formData);
      transition('success');
    } catch (error) {
      transition('error', { error: error.message });
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {currentState === 'error' && (
        <p style={{ color: 'red' }}>{formData.message}</p>
      )}
      {currentState === 'success' && (
        <p style={{ color: 'green' }}>{formData.message}</p>
      )}
      {/* è¡¨å•å­—æ®µ */}
      <button type="submit" disabled={currentState === 'loading'}>
        {currentState === 'loading' ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
      </button>
    </form>
  );
}
```

</CodeBlock>

---

## 7. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šåˆ›å»ºå®Œæ•´çš„è¡¨å•Hook

åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è¡¨å•Hookï¼Œæ”¯æŒéªŒè¯ã€é”™è¯¯å¤„ç†ã€é‡ç½®ç­‰åŠŸèƒ½ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ”¯æŒå¤šç§è¾“å…¥ç±»å‹ï¼ˆtextã€emailã€passwordã€numberç­‰ï¼‰
- å®æ—¶éªŒè¯å’Œå¤±ç„¦éªŒè¯
- è‡ªå®šä¹‰éªŒè¯è§„åˆ™
- é”™è¯¯æ¶ˆæ¯è‡ªå®šä¹‰
- è¡¨å•é‡ç½®åŠŸèƒ½
- æ”¯æŒæ¡ä»¶å­—æ®µ

**Hookè®¾è®¡**ï¼š
```javascript
function useForm(options) {
  // options: { initialValues, validationRules, validateOnChange, validateOnBlur }
  return {
    values,
    errors,
    touched,
    handleChange,
    handleBlur,
    handleSubmit,
    reset,
    isValid,
    setValue
  };
}
```

**æç¤º**ï¼š
- åŒºåˆ†ä¸åŒéªŒè¯æ—¶æœº
- æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥éªŒè¯
- å¤„ç†å¤æ‚åµŒå¥—å­—æ®µ
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

</Expandable>

### ç»ƒä¹ 2ï¼šåˆ›å»ºæ•°æ®ç¼“å­˜Hook

åˆ›å»ºä¸€ä¸ªæ™ºèƒ½ç¼“å­˜Hookï¼Œæ”¯æŒè¿‡æœŸæ—¶é—´ã€æ‰‹åŠ¨åˆ·æ–°ã€å¤šæ•°æ®æºç­‰ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- å†…å­˜ç¼“å­˜æœºåˆ¶
- è¿‡æœŸæ—¶é—´æ§åˆ¶
- æ‰‹åŠ¨åˆ·æ–°
- ä¹è§‚æ›´æ–°
- é”™è¯¯é‡è¯•
- å¹¶å‘è¯·æ±‚åˆå¹¶

**Hookè®¾è®¡**ï¼š
```javascript
function useCache(key, fetcher, options) {
  // options: { ttl, retries, retryDelay, optimisticUpdate }
  return {
    data,
    loading,
    error,
    refetch,
    setOptimisticData
  };
}
```

**æç¤º**ï¼š
- ä½¿ç”¨Mapå­˜å‚¨ç¼“å­˜
- å®ç°LRUæ·˜æ±°ç­–ç•¥
- å¤„ç†ç½‘ç»œé”™è¯¯
- ä¹è§‚æ›´æ–°ä¸å›æ»š

</Expandable>

### ç»ƒä¹ 3ï¼šåˆ›å»ºæƒé™ç®¡ç†Hook

åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æƒé™ç³»ç»ŸHookï¼Œæ”¯æŒè§’è‰²ã€æƒé™ã€åŠ¨æ€æ£€æŸ¥ç­‰ã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- ç”¨æˆ·è§’è‰²ç®¡ç†
- æƒé™æ£€æŸ¥
- æ¡ä»¶æ¸²æŸ“
- æƒé™ç¼“å­˜
- å®æ—¶æƒé™æ›´æ–°
- æƒé™ç»§æ‰¿

**Hookè®¾è®¡**ï¼š
```javascript
function usePermissions(user, permissions) {
  return {
    hasPermission,
    hasAnyPermission,
    hasAllPermissions,
    canAccess,
    canPerform
  };
}
```

**æç¤º**ï¼š
- è§’è‰²å’Œæƒé™çš„å±‚æ¬¡ç»“æ„
- åŠ¨æ€æƒé™æ£€æŸ¥
- æƒé™ç¼“å­˜ä¼˜åŒ–
- å®æ—¶æ›´æ–°æœºåˆ¶

</Expandable>

### ç»ƒä¹ 4ï¼šåˆ›å»ºåª’ä½“æŸ¥è¯¢Hookåº“

åˆ›å»ºä¸€ç³»åˆ—åª’ä½“æŸ¥è¯¢ç›¸å…³çš„Hookã€‚

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- çª—å£å°ºå¯¸ç›‘å¬
- æ–­ç‚¹æ£€æµ‹
- è®¾å¤‡æ–¹å‘æ£€æµ‹
- åª’ä½“æŸ¥è¯¢åŒ¹é…
- è‡ªå®šä¹‰æ–­ç‚¹

**Hookè®¾è®¡**ï¼š
```javascript
function useBreakpoint(breakpoints) {
  // breakpoints: { sm: 640, md: 768, lg: 1024 }
  return { current, isSm, isMd, isLg };
}

function useOrientation() {
  return { orientation, isPortrait, isLandscape };
}

function useMedia(query) {
  return matches;
}
```

**æç¤º**ï¼š
- ä½¿ç”¨matchMedia API
- å“åº”å¼æ–­ç‚¹ç®¡ç†
- SSRå…¼å®¹æ€§
- æ€§èƒ½ä¼˜åŒ–

</Expandable>

---

## 8. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… è‡ªå®šä¹‰Hookæ˜¯ä»¥`use`å¼€å¤´çš„å‡½æ•°ï¼Œå†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–Hook
- âœ… Hookè´Ÿè´£é€»è¾‘å¤„ç†ï¼Œç»„ä»¶è´Ÿè´£UIæ¸²æŸ“
- âœ… ä¸€ä¸ªHookåº”è¯¥åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰
- âœ… è‡ªå®šä¹‰Hookå¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨
- âœ… Hookä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨
- âœ… ä½¿ç”¨useCallbackä¼˜åŒ–ä¼ é€’ç»™Hookçš„å‡½æ•°
- âœ… æ­£ç¡®å¤„ç†Hookçš„æ¸…ç†å’Œé‡ç½®é€»è¾‘
- âœ… ä¸ºè‡ªå®šä¹‰Hookæä¾›æ¸…æ™°çš„TypeScriptç±»å‹

</Checklist>

### æœ€ä½³å®è·µ

<BestPractices>

1. **æ¸…æ™°å‘½å** - ä½¿ç”¨æè¿°æ€§çš„åç§°ï¼Œå‡†ç¡®è¡¨è¾¾Hookçš„ç”¨é€”
2. **å•ä¸€èŒè´£** - æ¯ä¸ªHookåªè´Ÿè´£ä¸€ä¸ªå…·ä½“åŠŸèƒ½
3. **æ–‡æ¡£åŒ–** - ä¸ºè‡ªå®šä¹‰Hookç¼–å†™æ¸…æ™°çš„æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
4. **ç±»å‹å®‰å…¨** - åœ¨TypeScriptä¸­ä¸ºHookæä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰
5. **é”™è¯¯å¤„ç†** - å¦¥å–„å¤„ç†å„ç§é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæƒ…å†µ
6. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨useCallbackå’ŒuseMemoä¼˜åŒ–Hookæ€§èƒ½
7. **æµ‹è¯•è¦†ç›–** - ä¸ºè‡ªå®šä¹‰Hookç¼–å†™å•å…ƒæµ‹è¯•
8. **å¯æµ‹è¯•æ€§** - è®¾è®¡Hookæ—¶è€ƒè™‘å¯æµ‹è¯•æ€§

</BestPractices>

### å¸¸è§Hookæ¨¡å¼

**çŠ¶æ€ç®¡ç†**ï¼š
- useCounter - ç®€å•çš„æ•°å€¼çŠ¶æ€
- useToggle - å¸ƒå°”å€¼çŠ¶æ€
- useLocalStorage - æœ¬åœ°å­˜å‚¨åŒæ­¥

**å‰¯ä½œç”¨**ï¼š
- useFetch - å¼‚æ­¥æ•°æ®è·å–
- useInterval - å®šæ—¶å™¨ç®¡ç†
- useEventListener - äº‹ä»¶ç›‘å¬

**è¡¨å•å¤„ç†**ï¼š
- useForm - è¡¨å•çŠ¶æ€ç®¡ç†
- useInput - è¾“å…¥æ¡†ç®¡ç†

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- useDebounce - é˜²æŠ–
- useThrottle - èŠ‚æµ
- useMemoize - è®°å¿†åŒ–

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†è‡ªå®šä¹‰Hooksï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[çŠ¶æ€ç®¡ç†è¿›é˜¶](../state-management)** - å…¨å±€çŠ¶æ€ç®¡ç†
2. **[ç»„ä»¶æ€§èƒ½ä¼˜åŒ–](../performance)** - ç»¼åˆæ€§èƒ½ä¼˜åŒ–
3. **[å®é™…é¡¹ç›®åº”ç”¨](../projects)** - çœŸå®é¡¹ç›®å®è·µ

---

## 9. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [è‡ªå®šä¹‰Hook](https://react.dev/learn/reusing-logic-with-custom-hooks) - Reactå®˜æ–¹æ–‡æ¡£
- [Hook APIå‚è€ƒ](https://react.dev/reference/react) - æ‰€æœ‰Hookçš„API
- [Hookè§„åˆ™](https://react.dev/reference/rules-of-hooks) - Hookä½¿ç”¨è§„åˆ™

### æ¨èé˜…è¯»

- [è‡ªå®šä¹‰Hookæœ€ä½³å®è·µ](https://kentcdodds.com/blog/how-to-build-custom-react-hooks) - æ„å»ºè‡ªå®šä¹‰Hook
- [Hookæ¨¡å¼](https://usehooks.com/) - å¸¸è§Hookæ¨¡å¼åº“
- [React HooksæŠ€å·§](https://github.com/streamich/react-use) - React Hookså·¥å…·åº“

### ä¼˜ç§€Hookåº“

- [React Use](https://github.com/streamich/react-use) - å¤§é‡å®ç”¨è‡ªå®šä¹‰Hook
- [useHooks](https://usehooks.com/) - Hookç¤ºä¾‹å’Œæ•™ç¨‹
- [ahooks](https://github.com/alibaba/hooks) - é˜¿é‡Œå¼€æºçš„Hookåº“

---

[â† ä¸Šä¸€ç« ï¼šuseMemo](useMemo) | [Hooksæ¨¡å—å®Œæˆï¼ğŸ‰]
