# Context æ¨¡å¼ - çŠ¶æ€å…±äº«ä¸ä½œç”¨åŸŸç®¡ç†

import { Tabs, TabItem } from '@docusaurus/theme-common';

Context æ¨¡å¼æ˜¯Reactä¸­ç”¨äºåœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®çš„é«˜çº§æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§æ— éœ€é€šè¿‡propså±‚å±‚ä¼ é€’å³å¯åœ¨ç»„ä»¶æ ‘é—´å…±äº«çŠ¶æ€çš„æ–¹æ³•ã€‚Contextéå¸¸é€‚åˆç®¡ç†å…¨å±€çŠ¶æ€ã€ä¸»é¢˜ã€ç”¨æˆ·ä¿¡æ¯ç­‰æ•°æ®ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Contextçš„æ¦‚å¿µã€å®ç°æ–¹å¼ã€æœ€ä½³å®è·µå’Œä½¿ç”¨åœºæ™¯ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£Context APIçš„æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œåŸç†
- æŒæ¡Contextçš„åˆ›å»ºã€æä¾›å’Œä½¿ç”¨
- å­¦ä¼šå®ç°å¤šContextç»„åˆ
- ç†è§£Contextä¸çŠ¶æ€ç®¡ç†åº“çš„å…³ç³»
- æŒæ¡Contextçš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- å­¦ä¼šé¿å…Contextçš„å¸¸è§é™·é˜±
- ç†è§£Contextçš„é€‚ç”¨åœºæ™¯å’Œé™åˆ¶
- æŒæ¡Contextçš„å®é™…åº”ç”¨æ¡ˆä¾‹

---

## 1. ä»€ä¹ˆæ˜¯Contextï¼Ÿ

Contextæ˜¯Reactæä¾›çš„ä¸€ç§åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®çš„æ–¹å¼ï¼Œå®ƒè§£å†³äº†props drillingï¼ˆå±‚å±‚ä¼ é€’propsï¼‰çš„é—®é¢˜ã€‚é€šè¿‡Contextï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸­çš„ä»»ä½•ä½ç½®è®¿é—®æ•°æ®ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å°†æ•°æ®ä½œä¸ºpropsä¼ é€’åˆ°æ¯ä¸ªå±‚çº§ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>Context</strong>æ˜¯ä¸€ä¸ªæä¾›è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ã€‚æ•°æ®é€šè¿‡<strong>Provider</strong>åœ¨ç»„ä»¶æ ‘é¡¶å±‚æä¾›ï¼Œå­ç»„ä»¶é€šè¿‡<strong>useContext</strong>æˆ–<strong>Consumer</strong>è®¿é—®è¿™äº›æ•°æ®ã€‚
  </p>
</Box>

<CodeBlock>

```jsx
// åŸºç¡€Contextä½¿ç”¨
const ThemeContext = React.createContext();

// Provideræä¾›æ•°æ®
function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

// Consumerä½¿ç”¨æ•°æ®
function Button() {
  const { theme, setTheme } = useContext(ThemeContext);
  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      Current theme: {theme}
    </button>
  );
}

// ä½¿ç”¨
<ThemeProvider>
  <Button />
</ThemeProvider>
```

</CodeBlock>

### 1.1 Contextè§£å†³çš„é—®é¢˜

<Grid>

<div>
  <h4>Props Drillingé—®é¢˜</h4>
  <ul>
    <li>âŒ éœ€è¦å±‚å±‚ä¼ é€’props</li>
    <li>âŒ ä¸­é—´ç»„ä»¶è¢«è¿«æ¥æ”¶ä¸éœ€è¦çš„props</li>
    <li>âŒ ä»£ç éš¾ä»¥ç»´æŠ¤å’Œç†è§£</li>
    <li>âŒ é‡æ„å›°éš¾</li>
  </ul>
</div>

<div>
  <h4>Contextè§£å†³æ–¹æ¡ˆ</h4>
  <ul>
    <li>âœ… æ•°æ®ç›´è¾¾ç›®æ ‡ç»„ä»¶</li>
    <li>âœ… ä¸­é—´ç»„ä»¶æ— éœ€å…³å¿ƒæ•°æ®</li>
    <li>âœ… ä»£ç ç®€æ´æ¸…æ™°</li>
    <li>âœ… æ˜“äºç»´æŠ¤å’Œé‡æ„</li>
  </ul>
</div>

</Grid>

### 1.2 Contextçš„ç»„æˆ

<CodeBlock>

```jsx
// 1. åˆ›å»ºContext
const MyContext = React.createContext();

// 2. Provider - æä¾›æ•°æ®
<MyContext.Provider value={/* æ•°æ® */}>
  {/* å­ç»„ä»¶ */}
</MyContext.Provider>

// 3. Consumer - æ¶ˆè´¹æ•°æ®ï¼ˆç±»ç»„ä»¶ï¼‰
<MyContext.Consumer>
  {value => /* ä½¿ç”¨value */}
</MyContext.Consumer>

// 4. useContext - æ¶ˆè´¹æ•°æ®ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰
const value = useContext(MyContext);
```

</CodeBlock>

---

## 2. ContextåŸºç¡€å®ç°

### 2.1 ç®€å•çš„Context

<CodeBlock>

```jsx
// åˆ›å»ºUserContext
const UserContext = React.createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // æ¨¡æ‹Ÿè·å–ç”¨æˆ·ä¿¡æ¯
    fetchUser().then(userData => {
      setUser(userData);
      setLoading(false);
    });
  }, []);

  const value = {
    user,
    loading,
    setUser,
    login: (credentials) => {
      // ç™»å½•é€»è¾‘
      return loginUser(credentials).then(setUser);
    },
    logout: () => {
      // ç™»å‡ºé€»è¾‘
      return logoutUser().then(() => setUser(null));
    }
  };

  return (
    <UserContext.Provider value={value}>
      {children}
    </UserContext.Provider>
  );
}

// ä½¿ç”¨Context
function Profile() {
  const { user, loading, logout } = useContext(UserContext);

  if (loading) return <div>Loading...</div>;
  if (!user) return <div>Please log in</div>;

  return (
    <div>
      <h1>Welcome, {user.name}</h1>
      <button onClick={logout}>Logout</button>
    </div>
  );
}

// ä½¿ç”¨
<UserProvider>
  <Profile />
</UserProvider>
```

</CodeBlock>

### 2.2 å¤šä¸ªContextç»„åˆ

<CodeBlock>

```jsx
// ä¸»é¢˜Context
const ThemeContext = React.createContext();
const UserContext = React.createContext();

function App() {
  return (
    <ThemeProvider>
      <UserProvider>
        <Dashboard />
      </UserProvider>
    </ThemeProvider>
  );
}

function Dashboard() {
  const { theme, toggleTheme } = useContext(ThemeContext);
  const { user, logout } = useContext(UserContext);

  return (
    <div className={theme === 'dark' ? 'dark' : 'light'}>
      <h1>Welcome {user.name}</h1>
      <button onClick={toggleTheme}>Toggle Theme</button>
      <button onClick={logout}>Logout</button>
    </div>
  );
}

// æ›´ç®€æ´çš„ç»„åˆæ–¹å¼
function App() {
  return (
    <ThemeProvider>
      <UserProvider>
        <CombinedComponent />
      </UserProvider>
    </ThemeProvider>
  );
}

function CombinedComponent() {
  const theme = useContext(ThemeContext);
  const user = useContext(UserContext);
  // ä½¿ç”¨themeå’Œuser
}
```

</CodeBlock>

### 2.3 è‡ªå®šä¹‰Hookå°è£…Context

<CodeBlock>

```jsx
// åˆ›å»ºContext
const UserContext = React.createContext();

// è‡ªå®šä¹‰Hook
function useUser() {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser must be used within UserProvider');
  }
  return context;
}

// Provider
function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  // ...é€»è¾‘

  return (
    <UserContext.Provider value={{ user, setUser }}>
      {children}
    </UserContext.Provider>
  );
}

// ä½¿ç”¨
function Profile() {
  const { user, logout } = useUser();
  // ...
}
```

</CodeBlock>

---

## 3. é«˜çº§Contextæ¨¡å¼

### 3.1 ContextçŠ¶æ€ç®¡ç†

<CodeBlock>

```jsx
// å¤æ‚çŠ¶æ€ç®¡ç†
const TodosContext = React.createContext();

function TodosProvider({ children }) {
  const [todos, setTodos] = useState([]);
  const [filter, setFilter] = useState('all');

  const addTodo = (text) => {
    setTodos(prev => [
      ...prev,
      { id: Date.now(), text, completed: false }
    ]);
  };

  const toggleTodo = (id) => {
    setTodos(prev =>
      prev.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      )
    );
  };

  const deleteTodo = (id) => {
    setTodos(prev => prev.filter(todo => todo.id !== id));
  };

  const filteredTodos = todos.filter(todo => {
    if (filter === 'active') return !todo.completed;
    if (filter === 'completed') return todo.completed;
    return true;
  });

  const value = {
    todos: filteredTodos,
    filter,
    setFilter,
    addTodo,
    toggleTodo,
    deleteTodo
  };

  return (
    <TodosContext.Provider value={value}>
      {children}
    </TodosContext.Provider>
  );
}

// ä½¿ç”¨
function TodoList() {
  const { todos, filter, setFilter, addTodo, toggleTodo } = useTodos();

  return (
    <div>
      <select value={filter} onChange={(e) => setFilter(e.target.value)}>
        <option value="all">All</option>
        <option value="active">Active</option>
        <option value="completed">Completed</option>
      </select>
      <TodoInput onAdd={addTodo} />
      <ul>
        {todos.map(todo => (
          <TodoItem
            key={todo.id}
            todo={todo}
            onToggle={toggleTodo}
          />
        ))}
      </ul>
    </div>
  );
}
```

</CodeBlock>

### 3.2 åŠ¨æ€Contextå€¼

<CodeBlock>

```jsx
// æ ¹æ®æ¡ä»¶æä¾›ä¸åŒå€¼
function DataProvider({ dataType, children }) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData(dataType).then(setData).finally(() => setLoading(false));
  }, [dataType]);

  // æ ¹æ®dataTypeæä¾›ä¸åŒçš„contextå€¼
  const contextValue = useMemo(() => {
    if (dataType === 'users') {
      return { users: data, loading };
    } else if (dataType === 'posts') {
      return { posts: data, loading };
    }
    return { data, loading };
  }, [data, loading, dataType]);

  return (
    <DataContext.Provider value={contextValue}>
      {children}
    </DataContext.Provider>
  );
}

// ä½¿ç”¨
<DataProvider dataType="users">
  <UserList />
</DataProvider>

<DataProvider dataType="posts">
  <PostList />
</DataProvider>
```

</CodeBlock>

### 3.3 åµŒå¥—Context

<CodeBlock>

```jsx
// åµŒå¥—Provider
const AuthContext = React.createContext();
const PermissionContext = React.createContext();

function App() {
  return (
    <AuthProvider>
      <PermissionProvider>
        <MainApp />
      </PermissionProvider>
    </AuthProvider>
  );
}

function PermissionProvider({ children }) {
  const { user } = useAuth();

  const permissions = useMemo(() => {
    if (!user) return [];
    return getUserPermissions(user.role);
  }, [user]);

  const hasPermission = (permission) => {
    return permissions.includes(permission);
  };

  const value = {
    permissions,
    hasPermission,
    isAdmin: user?.role === 'admin',
    isModerator: user?.role === 'moderator'
  };

  return (
    <PermissionContext.Provider value={value}>
      {children}
    </PermissionContext.Provider>
  );
}

// ä½¿ç”¨
function AdminPanel() {
  const { hasPermission, isAdmin } = usePermissions();

  if (!isAdmin) {
    return <div>Access Denied</div>;
  }

  return (
    <div>
      {hasPermission('manage_users') && <UserManagement />}
      {hasPermission('manage_settings') && <SettingsPanel />}
    </div>
  );
}
```

</CodeBlock>

### 3.4 Contextæ‡’åŠ è½½

<CodeBlock>

```jsx
// æ‡’åŠ è½½Context
const LazyContext = React.createContext();

function LazyProvider({ children }) {
  const [isLoaded, setIsLoaded] = useState(false);
  const [data, setData] = useState(null);

  useEffect(() => {
    // æ‡’åŠ è½½æ•°æ®
    loadData().then(result => {
      setData(result);
      setIsLoaded(true);
    });
  }, []);

  if (!isLoaded) {
    return <LoadingSpinner />;
  }

  return (
    <LazyContext.Provider value={data}>
      {children}
    </LazyContext.Provider>
  );
}

// Suspenseç‰ˆæœ¬
const LazyDataContext = React.createContext();

function LazyDataProvider({ children }) {
  const data = use(fetchData()); // å‡è®¾useæ˜¯Reactçš„æ–°ç‰¹æ€§

  return (
    <LazyDataContext.Provider value={data}>
      {children}
    </LazyDataContext.Provider>
  );
}

// ä½¿ç”¨Suspense
<Suspense fallback={<LoadingSpinner />}>
  <LazyDataProvider>
    <Component />
  </LazyDataProvider>
</Suspense>
```

</CodeBlock>

---

## 4. å®é™…åº”ç”¨æ¡ˆä¾‹

### 4.1 ä¸»é¢˜ç³»ç»Ÿ

<CodeBlock>

```jsx
// å®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿ
const ThemeContext = React.createContext();

function ThemeProvider({ children, defaultTheme = 'light' }) {
  const [theme, setTheme] = useState(defaultTheme);
  const [systemTheme, setSystemTheme] = useState('light');

  // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setSystemTheme(mediaQuery.matches ? 'dark' : 'light');

    const handler = (e) => setSystemTheme(e.matches ? 'dark' : 'light');
    mediaQuery.addEventListener('change', handler);
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  // åº”ç”¨ä¸»é¢˜åˆ°DOM
  useEffect(() => {
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);

  const value = {
    theme,
    setTheme,
    systemTheme,
    actualTheme: theme === 'system' ? systemTheme : theme,
    isDark: (theme === 'system' ? systemTheme : theme) === 'dark',
    toggleTheme: () => {
      setTheme(prev => prev === 'light' ? 'dark' : 'light');
    },
    setSystemTheme: () => setTheme('system')
  };

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
}

// ä½¿ç”¨
function ThemeToggle() {
  const { theme, toggleTheme, setSystemTheme } = useTheme();

  return (
    <div className="theme-toggle">
      <button onClick={toggleTheme}>
        {theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸'}
      </button>
      <button onClick={() => setSystemTheme()}>
        System
      </button>
    </div>
  );
}
```

</CodeBlock>

### 4.2 å¤šè¯­è¨€å›½é™…åŒ–

<CodeBlock>

```jsx
// å›½é™…åŒ–Context
const I18nContext = React.createContext();

function I18nProvider({ children, defaultLocale = 'en' }) {
  const [locale, setLocale] = useState(defaultLocale);
  const [translations, setTranslations] = useState({});

  useEffect(() => {
    // åŠ è½½ç¿»è¯‘æ–‡ä»¶
    loadTranslations(locale).then(setTranslations);
  }, [locale]);

  const t = (key) => {
    return translations[key] || key;
  };

  const value = {
    locale,
    setLocale,
    t,
    translations
  };

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
}

// ä½¿ç”¨
function Header() {
  const { locale, setLocale, t } = useI18n();

  return (
    <header>
      <h1>{t('title')}</h1>
      <select
        value={locale}
        onChange={(e) => setLocale(e.target.value)}
      >
        <option value="en">English</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="es">EspaÃ±ol</option>
      </select>
    </header>
  );
}
```

</CodeBlock>

### 4.3 è´­ç‰©è½¦çŠ¶æ€

<CodeBlock>

```jsx
// è´­ç‰©è½¦Context
const CartContext = React.createContext();

function CartProvider({ children }) {
  const [items, setItems] = useState([]);
  const [isOpen, setIsOpen] = useState(false);

  const addItem = (product, quantity = 1) => {
    setItems(prev => {
      const existingItem = prev.find(item => item.id === product.id);
      if (existingItem) {
        return prev.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + quantity }
            : item
        );
      }
      return [...prev, { ...product, quantity }];
    });
  };

  const removeItem = (productId) => {
    setItems(prev => prev.filter(item => item.id !== productId));
  };

  const updateQuantity = (productId, quantity) => {
    if (quantity <= 0) {
      removeItem(productId);
      return;
    }
    setItems(prev =>
      prev.map(item =>
        item.id === productId ? { ...item, quantity } : item
      )
    );
  };

  const clearCart = () => {
    setItems([]);
  };

  const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
  const totalPrice = items.reduce(
    (sum, item) => sum + item.price * item.quantity,
    0
  );

  const value = {
    items,
    isOpen,
    setIsOpen,
    addItem,
    removeItem,
    updateQuantity,
    clearCart,
    totalItems,
    totalPrice
  };

  return (
    <CartContext.Provider value={value}>
      {children}
    </CartContext.Provider>
  );
}

// ä½¿ç”¨
function ProductCard({ product }) {
  const { addItem } = useCart();

  return (
    <div className="product-card">
      <h3>{product.name}</h3>
      <p>${product.price}</p>
      <button onClick={() => addItem(product)}>
        Add to Cart
      </button>
    </div>
  );
}
```

</CodeBlock>

---

## 5. Contextæ€§èƒ½ä¼˜åŒ–

### 5.1 é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

<CodeBlock>

```jsx
// âŒ é”™è¯¯ - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
function BadProvider({ children }) {
  const [count, setCount] = useState(0);

  return (
    <Context.Provider value={{ count, setCount }}>
      {children}
    </Context.Provider>
  );
}

// âœ… æ­£ç¡® - ä½¿ç”¨useMemoç¼“å­˜
function GoodProvider({ children }) {
  const [count, setCount] = useState(0);

  const value = useMemo(() => ({
    count,
    setCount,
    increment: () => setCount(c => c + 1)
  }), [count]);

  return (
    <Context.Provider value={value}>
      {children}
    </Context.Provider>
  );
}

// âœ… æ›´å¥½çš„æ–¹å¼ - æ‹†åˆ†Context
const CountContext = React.createContext();
const ActionsContext = React.createContext();

function Provider({ children }) {
  const [count, setCount] = useState(0);

  return (
    <CountContext.Provider value={count}>
      <ActionsContext.Provider value={{ setCount }}>
        {children}
      </ActionsContext.Provider>
    </CountContext.Provider>
  );
}
```

</CodeBlock>

### 5.2 ä½¿ç”¨React.memoä¼˜åŒ–Consumer

<CodeBlock>

```jsx
// ä¼˜åŒ–Consumerç»„ä»¶
const ExpensiveContext = React.createContext();

function ExpensiveProvider({ children }) {
  const [data, setData] = useState(null);
  const [count, setCount] = useState(0);

  const value = useMemo(() => ({
    data,
    setData,
    count,
    setCount
  }), [data, count]);

  return (
    <ExpensiveContext.Provider value={value}>
      {children}
    </ExpensiveContext.Provider>
  );
}

// ä½¿ç”¨React.memoä¼˜åŒ–
const ExpensiveConsumer = React.memo(function ExpensiveConsumer() {
  const { data, count } = useContext(ExpensiveContext);
  return <div>{/* æ¸²æŸ“é€»è¾‘ */}</div>;
});
```

</CodeBlock>

### 5.3 é€‰æ‹©æ€§è®¢é˜…

<CodeBlock>

```jsx
// åªè®¢é˜…éœ€è¦çš„Contextéƒ¨åˆ†
const MultiContext = React.createContext();

function Provider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [notifications, setNotifications] = useState([]);

  return (
    <MultiContext.Provider value={{
      user,
      setUser,
      theme,
      setTheme,
      notifications,
      setNotifications
    }}>
      {children}
    </MultiContext.Provider>
  );
}

// åªè®¢é˜…ç”¨æˆ·ä¿¡æ¯
function UserProfile() {
  const { user } = useContext(MultiContext);
  // å³ä½¿themeæ”¹å˜ï¼Œè¿™ä¸ªç»„ä»¶ä¹Ÿä¸ä¼šé‡æ¸²æŸ“
  return <div>{user?.name}</div>;
}

// è®¢é˜…å¤šä¸ªContext
function Header() {
  const user = useContext(MultiContext).user;
  const theme = useContext(MultiContext).theme;
  return (
    <div className={theme}>
      <h1>{user?.name}</h1>
    </div>
  );
}
```

</CodeBlock>

---

## 6. Context vs çŠ¶æ€ç®¡ç†åº“

### 6.1 ä½•æ—¶ä½¿ç”¨Context

<Compare>

```jsx
// é€‚åˆContextçš„åœºæ™¯
1. å…¨å±€çŠ¶æ€ï¼š
   - ç”¨æˆ·è®¤è¯ä¿¡æ¯
   - ä¸»é¢˜è®¾ç½®
   - å›½é™…åŒ–è¯­è¨€åå¥½
   - å½“å‰é€‰ä¸­çš„æ•°æ®

2. è·¨ç»„ä»¶æ ‘çš„æ•°æ®ï¼š
   - è·¯ç”±ä¿¡æ¯
   - å½“å‰ç”¨æˆ·æƒé™
   - å…¨å±€åŠ è½½çŠ¶æ€

3. éœ€è¦é¿å…props drillingï¼š
   - æ·±å±‚æ¬¡ç»„ä»¶æ ‘
   - å¤šä¸ªä¸­é—´å±‚ä¸éœ€è¦çš„æ•°æ®

// é€‚åˆçŠ¶æ€ç®¡ç†åº“çš„åœºæ™¯
1. å¤æ‚çš„çŠ¶æ€é€»è¾‘ï¼š
   - å¤šä¸ªreducer
   - å¼‚æ­¥æ•°æ®æµ
   - çŠ¶æ€æŒä¹…åŒ–

2. è°ƒè¯•å’Œå¼€å‘å·¥å…·ï¼š
   - Redux DevTools
   - æ—¶é—´æ—…è¡Œè°ƒè¯•

3. å¤§å‹å›¢é˜Ÿåä½œï¼š
   - æ ‡å‡†åŒ–çŠ¶æ€ç®¡ç†
   - ä¸­é—´ä»¶ç”Ÿæ€
```

</Compare>

### 6.2 Context + Reducerç»„åˆ

<CodeBlock>

```jsx
// ç»“åˆuseReducer
const TodosContext = React.createContext();

function todosReducer(state, action) {
  switch (action.type) {
    case 'ADD_TODO':
      return [...state, action.payload];
    case 'TOGGLE_TODO':
      return state.map(todo =>
        todo.id === action.payload
          ? { ...todo, completed: !todo.completed }
          : todo
      );
    case 'DELETE_TODO':
      return state.filter(todo => todo.id !== action.payload);
    default:
      return state;
  }
}

function TodosProvider({ children }) {
  const [todos, dispatch] = useReducer(todosReducer, []);

  const value = {
    todos,
    addTodo: (text) => dispatch({ type: 'ADD_TODO', payload: { id: Date.now(), text } }),
    toggleTodo: (id) => dispatch({ type: 'TOGGLE_TODO', payload: id }),
    deleteTodo: (id) => dispatch({ type: 'DELETE_TODO', payload: id })
  };

  return (
    <TodosContext.Provider value={value}>
      {children}
    </TodosContext.Provider>
  );
}
```

</CodeBlock>

---

## 7. æœ€ä½³å®è·µ

### 7.1 Contextå‘½åå’Œç»„ç»‡

<CodeBlock>

```jsx
// âœ… å¥½çš„å‘½å
const AuthContext = React.createContext();
const UserContext = React.createContext();
const CartContext = React.createContext();
const ThemeContext = React.createContext();

// âœ… ä½¿ç”¨Hookå‘½å
function useAuth() {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
}

// âœ… Providerå‘½å
function AuthProvider({ children }) {
  // ...
}

function UserProvider({ children }) {
  // ...
}
```

</CodeBlock>

### 7.2 é”™è¯¯å¤„ç†

<CodeBlock>

```jsx
// æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
function useContextSafely(context, hookName, providerName) {
  const contextValue = useContext(context);
  if (!contextValue) {
    throw new Error(
      `${hookName} must be used within a ${providerName}. ` +
      `Make sure all ${hookName.replace('use', '')} components ` +
      `are wrapped in a <${providerName}> component.`
    );
  }
  return contextValue;
}

// ä½¿ç”¨
function useUser() {
  return useContextSafely(UserContext, 'useUser', 'UserProvider');
}
```

</CodeBlock>

### 7.3 ç±»å‹å®‰å…¨

<CodeBlock>

```tsx
// TypeScriptç±»å‹å®šä¹‰
interface User {
  id: string;
  name: string;
  email: string;
}

interface UserContextType {
  user: User | null;
  loading: boolean;
  login: (credentials: LoginCredentials) => Promise<void>;
  logout: () => Promise<void>;
}

const UserContext = React.createContext<UserContextType | undefined>(undefined);

function UserProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  // å®ç°...

  const value: UserContextType = {
    user,
    loading,
    login,
    logout
  };

  return (
    <UserContext.Provider value={value}>
      {children}
    </UserContext.Provider>
  );
}

function useUser(): UserContextType {
  const context = useContext(UserContext);
  if (context === undefined) {
    throw new Error('useUser must be used within UserProvider');
  }
  return context;
}
```

</CodeBlock>

---

## 8. å¸¸è§é™·é˜±

### é™·é˜±1ï¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶åˆ›å»ºæ–°å¯¹è±¡

<ErrorBox>

```jsx
// âŒ é”™è¯¯
function BadProvider({ children }) {
  const [count, setCount] = useState(0);

  return (
    <Context.Provider value={{ count, setCount }}>
      {children}
    </Context.Provider>
  );
}

// âœ… æ­£ç¡®
function GoodProvider({ children }) {
  const [count, setCount] = useState(0);

  const value = useMemo(() => ({ count, setCount }), [count]);

  return (
    <Context.Provider value={value}>
      {children}
    </Context.Provider>
  );
}
```

</ErrorBox>

### é™·é˜±2ï¼šContextè¿‡åº¦ä½¿ç”¨

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ä¸ºæ¯ä¸ªå°æ•°æ®åˆ›å»ºContext
const CountContext = React.createContext();
const IsLoadingContext = React.createContext();
const UserNameContext = React.createContext();

// âœ… æ­£ç¡® - åˆç†åˆ†ç»„
const UserContext = React.createContext({
  count: 0,
  isLoading: false,
  userName: '',
  setCount: () => {},
  setIsLoading: () => {},
  setUserName: () => {}
});
```

</ErrorBox>

### é™·é˜±3ï¼šå¿˜è®°å¤„ç†undefined

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ²¡æœ‰æ£€æŸ¥context
function BadComponent() {
  const value = useContext(MyContext);
  return <div>{value.something}</div>; // å¯èƒ½æŠ¥é”™
}

// âœ… æ­£ç¡® - æ£€æŸ¥æˆ–æä¾›é»˜è®¤å€¼
function GoodComponent() {
  const value = useContext(MyContext) || { something: 'default' };
  return <div>{value.something}</div>;
}

// æˆ–ä½¿ç”¨è‡ªå®šä¹‰Hook
function useMyContext() {
  const context = useContext(MyContext);
  if (!context) {
    throw new Error('useMyContext must be used within MyProvider');
  }
  return context;
}
```

</ErrorBox>

### é™·é˜±4ï¼šContextå€¼è¿‡äºå¤æ‚

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - ContextåŒ…å«å¤ªå¤šä¸ç›¸å…³æ•°æ®
function BadProvider() {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [todos, setTodos] = useState([]);
  const [notifications, setNotifications] = useState([]);

  return (
    <AppContext.Provider value={{
      user, setUser,
      theme, setTheme,
      todos, setTodos,
      notifications, setNotifications
    }}>
      {children}
    </AppContext.Provider>
  );
}

// âœ… æ­£ç¡® - æ‹†åˆ†å¤šä¸ªContext
function App() {
  return (
    <UserProvider>
      <ThemeProvider>
        <TodosProvider>
          <NotificationsProvider>
            <MainApp />
          </NotificationsProvider>
        </TodosProvider>
      </ThemeProvider>
    </UserProvider>
  );
}
```

</ErrorBox>

---

## 9. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå®ç°å…¨å±€é€šçŸ¥ç³»ç»Ÿ

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- å…¨å±€é€šçŸ¥çŠ¶æ€ç®¡ç†
- æ”¯æŒå¤šç§ç±»å‹ï¼šsuccess, error, warning, info
- è‡ªåŠ¨æ¶ˆå¤±å’Œæ‰‹åŠ¨å…³é—­
- é€šçŸ¥é˜Ÿåˆ—

**å®ç°è¦æ±‚**ï¼š
```javascript
const NotificationContext = createContext();

function NotificationProvider({ children }) {
  const [notifications, setNotifications] = useState([]);

  const addNotification = (notification) => {
    // æ·»åŠ é€šçŸ¥
  };

  const removeNotification = (id) => {
    // ç§»é™¤é€šçŸ¥
  };

  return (
    <NotificationContext.Provider value={{ notifications, addNotification, removeNotification }}>
      {children}
      <NotificationContainer />
    </NotificationContext.Provider>
  );
}
```

**æç¤º**ï¼š
- ä½¿ç”¨useStateç®¡ç†é€šçŸ¥åˆ—è¡¨
- æ·»åŠ å”¯ä¸€ID
- ä½¿ç”¨useEffectè‡ªåŠ¨ç§»é™¤
- æ”¯æŒå¤šä¸ªå¹¶å‘é€šçŸ¥

</Expandable>

### ç»ƒä¹ 2ï¼šå®ç°å¤šçº§è¡¨å•çŠ¶æ€ç®¡ç†

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- å¤æ‚è¡¨å•çŠ¶æ€ç®¡ç†
- å­—æ®µåˆ†ç»„å’ŒéªŒè¯
- åˆ†æ­¥ä¿å­˜
- è¡¨å•æ•°æ®æŒä¹…åŒ–

**å®ç°è¦æ±‚**ï¼š
```javascript
const FormContext = createContext();

function FormProvider({ initialData, onSubmit }) {
  const [formData, setFormData] = useState(initialData);
  const [errors, setErrors] = useState({});
  const [step, setStep] = useState(0);

  const updateField = (field, value) => {
    // æ›´æ–°å­—æ®µ
  };

  const validate = (fields) => {
    // éªŒè¯
  };

  return (
    <FormContext.Provider value={{ formData, errors, step, updateField, validate }}>
      {children}
    </FormContext.Provider>
  );
}
```

**æç¤º**ï¼š
- æ·±å±‚åµŒå¥—è¡¨å•ç»“æ„
- å®æ—¶éªŒè¯
- æ•°æ®æŒä¹…åŒ–
- åˆ†æ­¥å¯¼èˆª

</Expandable>

### ç»ƒä¹ 3ï¼šå®ç°å®æ—¶èŠå¤©ç³»ç»Ÿ

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- WebSocketè¿æ¥ç®¡ç†
- æ¶ˆæ¯å†å²
- åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
- æˆ¿é—´ç®¡ç†

**å®ç°è¦æ±‚**ï¼š
```javascript
const ChatContext = createContext();

function ChatProvider({ userId }) {
  const [socket, setSocket] = useState(null);
  const [messages, setMessages] = useState([]);
  const [users, setUsers] = useState([]);

  useEffect(() => {
    // å»ºç«‹WebSocketè¿æ¥
    const ws = new WebSocket(`ws://...`);
    setSocket(ws);
  }, []);

  const sendMessage = (text) => {
    // å‘é€æ¶ˆæ¯
  };

  return (
    <ChatContext.Provider value={{ messages, users, sendMessage }}>
      {children}
    </ChatContext.Provider>
  );
}
```

**æç¤º**ï¼š
- WebSocketè¿æ¥ç®¡ç†
- æ¶ˆæ¯å»é‡
- ç”¨æˆ·åœ¨çº¿çŠ¶æ€
- é‡è¿æœºåˆ¶

</Expandable>

### ç»ƒä¹ 4ï¼šå®ç°è®¾è®¡ç³»ç»Ÿ

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- è®¾è®¡Tokenç®¡ç†
- ç»„ä»¶ä¸»é¢˜å˜ä½“
- å“åº”å¼æ–­ç‚¹
- æ·±è‰²/æµ…è‰²æ¨¡å¼

**å®ç°è¦æ±‚**ï¼š
```javascript
const DesignSystemContext = createContext();

function DesignSystemProvider({ children }) {
  const [tokens, setTokens] = useState({
    colors: { primary: '#...', secondary: '...' },
    spacing: { xs: '4px', sm: '8px', ... },
    breakpoints: { mobile: '480px', tablet: '768px', ... }
  });

  const updateToken = (category, key, value) => {
    // æ›´æ–°Token
  };

  return (
    <DesignSystemContext.Provider value={{ tokens, updateToken }}>
      {children}
    </DesignSystemContext.Provider>
  );
}
```

**æç¤º**ï¼š
- è®¾è®¡Tokenç»“æ„
- åŠ¨æ€ä¸»é¢˜åˆ‡æ¢
- ç»„ä»¶åº“é›†æˆ
- CSSå˜é‡ç”Ÿæˆ

</Expandable>

---

## 10. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… Contextæä¾›ç»„ä»¶æ ‘å…¨å±€æ•°æ®å…±äº«
- âœ… ä½¿ç”¨createContext()åˆ›å»ºContext
- âœ… Provideræä¾›æ•°æ®ï¼ŒConsumeræ¶ˆè´¹æ•°æ®
- âœ… useContextæ˜¯æ¶ˆè´¹Contextçš„é¦–é€‰æ–¹å¼
- âœ… ä½¿ç”¨useMemoé¿å…ä¸å¿…è¦é‡æ¸²æŸ“
- âœ… è‡ªå®šä¹‰Hookç®€åŒ–Contextä½¿ç”¨
- âœ… æ‹†åˆ†å¤šä¸ªContexté¿å…è¿‡åº¦è€¦åˆ
- âœ… åˆç†é€‰æ‹©Context vs çŠ¶æ€ç®¡ç†åº“
- âœ… TypeScriptå¢å¼ºContextç±»å‹å®‰å…¨
- âœ… æ³¨æ„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§

</Checklist>

### Contextä½¿ç”¨æŒ‡å—

<BestPractices>

1. **æ˜ç¡®ä½¿ç”¨åœºæ™¯** - å…¨å±€çŠ¶æ€ã€é¿å…props drilling
2. **åˆç†æ‹†åˆ†Context** - æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†
3. **ä¼˜åŒ–æ€§èƒ½** - ä½¿ç”¨useMemoç¼“å­˜å€¼
4. **é”™è¯¯å¤„ç†** - æä¾›æœ‰ç”¨é”™è¯¯ä¿¡æ¯
5. **ç±»å‹å®‰å…¨** - TypeScriptå®šä¹‰å®Œæ•´ç±»å‹
6. **æµ‹è¯•è¦†ç›–** - æµ‹è¯•Providerå’ŒConsumer
7. **æ–‡æ¡£å®Œæ•´** - è®°å½•Context APIå’Œç”¨æ³•
8. **é¿å…æ»¥ç”¨** - ä¸éœ€è¦æ—¶ä¸è¦ä½¿ç”¨Context

</BestPractices>

### å¸¸è§Contextç±»å‹

**ç³»ç»Ÿçº§**ï¼š
- `AuthProvider` - è®¤è¯ä¿¡æ¯
- `ThemeProvider` - ä¸»é¢˜è®¾ç½®
- `I18nProvider` - å›½é™…åŒ–

**åŠŸèƒ½çº§**ï¼š
- `CartProvider` - è´­ç‰©è½¦
- `NotificationProvider` - é€šçŸ¥
- `ModalProvider` - æ¨¡æ€æ¡†

**ä¸šåŠ¡çº§**ï¼š
- `UserProvider` - ç”¨æˆ·æ•°æ®
- `SettingsProvider` - åº”ç”¨è®¾ç½®
- `DataProvider` - å…±äº«æ•°æ®

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†Contextæ¨¡å¼ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[é”™è¯¯è¾¹ç•Œ](../advanced/error-boundaries)** - æ·±å…¥Reacté”™è¯¯å¤„ç†
2. **[Hooksæ¨¡å¼](../advanced/hooks-patterns)** - ç°ä»£é€»è¾‘å¤ç”¨æ–¹å¼
3. **[çŠ¶æ€ç®¡ç†](../state-management/)** - å¤æ‚çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆ
4. **[æ€§èƒ½ä¼˜åŒ–](../performance/)** - Contextæ€§èƒ½ä¼˜åŒ–

---

## 11. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Context API](https://react.dev/reference/react) - Reactå®˜æ–¹æ–‡æ¡£
- [useContext](https://react.dev/reference/react/useContext) - useContextæŒ‡å—
- [åŠ¨æ€Context](https://react.dev/reference/react) - ContextåŠ¨æ€å€¼

### æ¨èé˜…è¯»

- [React Contextæ€§èƒ½ä¼˜åŒ–](https://kentcdodds.com/blog/application-state-management-with-react) - çŠ¶æ€ç®¡ç†
- [Context vs Redux](https://blog.logrocket.com/context-api-react-google-1cdbe1e35f6a/) - æ–¹æ¡ˆå¯¹æ¯”
- [ReactçŠ¶æ€æ¨¡å¼](https://reactpatterns.com/) - Reactæ¨¡å¼é›†åˆ

### ç›¸å…³è¯é¢˜

- [Contextæ¨¡å¼](https://kentcdodds.com/blog/how-to-use-react-context-effectively) - æœ€ä½³å®è·µ
- [çŠ¶æ€æå‡](../foundations/state-lifecycle) - çŠ¶æ€ç®¡ç†åŸºç¡€
- [è‡ªå®šä¹‰Hooks](../hooks/advanced/custom-hooks) - é€»è¾‘å¤ç”¨

---

[â† ä¸Šä¸€ç« ï¼šå®¹å™¨-å±•ç¤ºæ¨¡å¼](../basics/container-presentational) | [ä¸‹ä¸€ç« ï¼šHooksæ¨¡å¼ â†’](hooks-patterns)
