# é«˜é˜¶ç»„ä»¶ (HOC) - é€»è¾‘å¤ç”¨æ¨¡å¼

import { Tabs, TabItem } from '@docusaurus/theme-common';

é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentï¼Œç®€ç§°HOCï¼‰æ˜¯Reactä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„é«˜çº§æ¨¡å¼ã€‚è™½ç„¶Hookså·²ç»æˆä¸ºäº†å¤ç”¨é€»è¾‘çš„é¦–é€‰æ–¹å¼ï¼Œä½†HOCåœ¨æŸäº›åœºæ™¯ä¸‹ä»ç„¶æœ‰å®ƒçš„ä»·å€¼ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨HOCçš„æ¦‚å¿µã€å®ç°æ–¹å¼ã€ä½¿ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£é«˜é˜¶ç»„ä»¶çš„æ¦‚å¿µå’ŒåŸç†
- æŒæ¡HOCçš„å®ç°æ–¹å¼å’Œè¯­æ³•
- å­¦ä¼šç¼–å†™å¯å¤ç”¨çš„HOC
- ç†è§£HOCä¸Hooksçš„å¯¹æ¯”å’Œé€‰æ‹©
- æŒæ¡HOCçš„å¸¸è§ä½¿ç”¨åœºæ™¯
- å­¦ä¼šé¿å…HOCçš„å¸¸è§é™·é˜±
- ç†è§£HOCçš„å‘½åçº¦å®šå’Œæœ€ä½³å®è·µ

---

## 1. ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼Ÿ

é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚HOCæ˜¯Reactä¸­ç”¨äºå…±äº«é€»è¾‘çš„æ¨¡å¼ï¼Œå®ƒå°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯å¤ç”¨çš„å‡½æ•°ä¸­ã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>é«˜é˜¶ç»„ä»¶</strong>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¢å¼ºçš„æ–°ç»„ä»¶ã€‚ç±»ä¼¼äºJavaScriptä¸­çš„<strong>é«˜é˜¶å‡½æ•°</strong>ã€‚
  </p>
</Box>

<CodeBlock>

```jsx
// é«˜é˜¶ç»„ä»¶çš„æœ¬è´¨
const EnhancedComponent = higherOrderComponent(WrappedComponent);

// å®é™…ä¾‹å­
const UserListWithLoading = withLoading(UserList);
const UserListWithAuth = withAuth(UserList);
```

</CodeBlock>

### 1.1 HOC vs é«˜é˜¶å‡½æ•°

<CodeBlock>

```jsx
// JavaScripté«˜é˜¶å‡½æ•°ç¤ºä¾‹
const numbers = [1, 2, 3, 4, 5];

// mapæ˜¯é«˜é˜¶å‡½æ•°
const doubled = numbers.map(n => n * 2);

// Reacté«˜é˜¶ç»„ä»¶ç¤ºä¾‹
const enhancedComponent = withLoading(WrappedComponent);
```

</CodeBlock>

### 1.2 ä¸ºä»€ä¹ˆä½¿ç”¨HOCï¼Ÿ

<Grid>

<div>
  <h4>é€‚ç”¨åœºæ™¯</h4>
  <ul>
    <li>ğŸ”„ é€»è¾‘å¤ç”¨ï¼ˆæœªä½¿ç”¨Hooksä¹‹å‰ï¼‰</li>
    <li>ğŸ”’ æƒé™æ§åˆ¶</li>
    <li>ğŸ”Œ æ•°æ®è®¢é˜…</li>
    <li>ğŸ“Š çŠ¶æ€ç®¡ç†</li>
    <li>ğŸ¨ æ ·å¼å¢å¼º</li>
    <li>ğŸ“ Propsè½¬æ¢</li>
  </ul>
</div>

<div>
  <h4>å†å²èƒŒæ™¯</h4>
  <ul>
    <li>ğŸ“… React 0.14+ å¼•å…¥</li>
    <li>ğŸ“… ç”¨äºå¤ç”¨ç±»ç»„ä»¶é€»è¾‘</li>
    <li>ğŸ“… Reduxã€React Routerä½¿ç”¨HOC</li>
    <li>ğŸ“… React 16.8+ Hookså‡ºç°</li>
    <li>ğŸ“… ç°åœ¨æ¨èä½¿ç”¨Hooks</li>
    <li>ğŸ“… ä»ç”¨äºåº“å¼€å‘</li>
  </ul>
</div>

</Grid>

---

## 2. HOCå®ç°åŸºç¡€

### 2.1 æœ€ç®€å•çš„HOC

<LiveCode
  code={`
function HOCBasicsDemo() {
  // æœ€åŸºç¡€çš„HOC - æ·»åŠ é¢å¤–prop
  const withExtraProp = (WrappedComponent) => {
    return (props) => {
      // æ·»åŠ é¢å¤–prop
      const enhancedProps = {
        ...props,
        extraProp: 'This is added by HOC'
      };

      // ä¼ é€’ç»™åŒ…è£…ç»„ä»¶
      return <WrappedComponent {...enhancedProps} />;
    };
  };

  // åŸå§‹ç»„ä»¶
  const OriginalComponent = ({ name, extraProp }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>Original Component</h4>
        <p>Hello {name}! {extraProp}</p>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const EnhancedComponent = withExtraProp(OriginalComponent);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ”§ æœ€ç®€å•çš„HOCç¤ºä¾‹</h3>

      <div style={{ marginBottom: '20px' }}>
        <h4>åŸå§‹ç»„ä»¶ï¼š</h4>
        <OriginalComponent name="Alice" />
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>é€šè¿‡HOCå¢å¼ºåï¼š</h4>
        <EnhancedComponent name="Bob" />
      </div>

      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '6px',
        fontSize: '14px'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>ğŸ’¡ å·¥ä½œåŸç†</h4>
        <ul style={{ margin: 0, paddingLeft: '20px' }}>
          <li>HOCæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶</li>
          <li>è¿”å›ä¸€ä¸ªæ–°çš„å¢å¼ºç»„ä»¶</li>
          <li>å¯ä»¥æ·»åŠ é¢å¤–çš„propsæˆ–é€»è¾‘</li>
          <li>ä¿æŒåŸç»„ä»¶çš„æ¥å£ä¸å˜</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 2.2 ç®­å¤´å‡½æ•°ç‰ˆæœ¬

<LiveCode
  code={`
function ArrowFunctionHOCDemo() {
  // ä½¿ç”¨ç®­å¤´å‡½æ•°çš„æ›´ç®€æ´è¯­æ³•
  const withExtraProp = (WrappedComponent) => (props) => {
    return <WrappedComponent {...props} extraProp="Added by Arrow Function HOC" />;
  };

  // ä¼ é€’é¢å¤–å‚æ•°
  const withCustomProp = (WrappedComponent, extraValue) => (props) => {
    return <WrappedComponent {...props} customData={extraValue} />;
  };

  // åŸå§‹ç»„ä»¶
  const UserProfile = ({ name, extraProp, customData }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#f0f0f0',
        borderRadius: '8px',
        border: '2px solid #4caf50',
        marginBottom: '10px'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>User Profile</h4>
        <p><strong>Name:</strong> {name}</p>
        <p><strong>Extra Prop:</strong> {extraProp}</p>
        <p><strong>Custom Data:</strong> {customData}</p>
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const BasicEnhanced = withExtraProp(UserProfile);
  const AdvancedEnhanced = withCustomProp(withExtraProp(UserProfile), 'Advanced Data');

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¯ ç®­å¤´å‡½æ•°HOCç¤ºä¾‹</h3>

      <div style={{ marginBottom: '20px' }}>
        <h4>1. åŸºç¡€ç®­å¤´å‡½æ•°HOCï¼š</h4>
        <BasicEnhanced name="Alice Johnson" />
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>2. é“¾å¼HOCï¼ˆç»„åˆå¤šä¸ªå¢å¼ºï¼‰ï¼š</h4>
        <AdvancedEnhanced name="Bob Smith" />
      </div>

      <div style={{
        padding: '15px',
        background: '#e8f5e9',
        borderRadius: '8px',
        border: '2px solid #4caf50'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#2e7d32' }}>ğŸ’¡ ç®­å¤´å‡½æ•°ä¼˜åŠ¿</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6' }}>
          <li>æ›´ç®€æ´çš„è¯­æ³•ï¼Œä¸€è¡Œå®šä¹‰</li>
          <li>è‡ªç„¶åœ°è¿”å›å‡½æ•°ç»„ä»¶</li>
          <li>å¯ä»¥è½»æ¾ç»„åˆå¤šä¸ªHOC</li>
          <li>ä¿æŒç›¸åŒçš„é—­åŒ…è¡Œä¸º</li>
          <li>ç°ä»£Reactå¼€å‘æ¨èæ–¹å¼</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 2.3 å¤„ç†WrappedComponentçš„åç§°

<LiveCode
  code={`
function DisplayNameDemo() {
  // è·å–æ˜¾ç¤ºåç§°çš„è¾…åŠ©å‡½æ•°
  function getDisplayName(WrappedComponent) {
    return WrappedComponent.displayName || WrappedComponent.name || 'Component';
  }

  // å¢å¼ºç»„ä»¶åç§°ä»¥ä¾¿è°ƒè¯•
  function withName(WrappedComponent) {
    const EnhancedComponent = (props) => <WrappedComponent {...props} />;

    // è®¾ç½®displayName
    EnhancedComponent.displayName = \`withName(\${getDisplayName(WrappedComponent)})\`;

    return EnhancedComponent;
  }

  // åŸå§‹ç»„ä»¶
  const UserCard = ({ name }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800',
        display: 'inline-block',
        margin: '10px'
      }}>
        <h4 style={{ margin: 0, color: '#e65100' }}>ğŸ‘¤ {name}</h4>
      </div>
    );
  };

  const ProfileCard = ({ username }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#f3e5f5',
        borderRadius: '8px',
        border: '2px solid #9c27b0',
        display: 'inline-block',
        margin: '10px'
      }}>
        <h4 style={{ margin: 0, color: '#6a1b9a' }}>ğŸ“Š @{username}</h4>
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const EnhancedUserCard = withName(UserCard);
  const EnhancedProfileCard = withName(ProfileCard);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ·ï¸ DisplayNameæ¼”ç¤º</h3>

      <div style={{
        padding: '20px',
        background: '#f5f5f5',
        borderRadius: '8px',
        marginBottom: '20px'
      }}>
        <h4 style={{ margin: '0 0 15px 0' }}>åŸå§‹ç»„ä»¶ï¼š</h4>
        <UserCard name="Alice" />
        <ProfileCard username="alice_dev" />
      </div>

      <div style={{
        padding: '20px',
        background: '#e3f2fd',
        borderRadius: '8px',
        marginBottom: '20px'
      }}>
        <h4 style={{ margin: '0 0 15px 0' }}>å¢å¼ºç»„ä»¶ï¼š</h4>
        <EnhancedUserCard name="Bob" />
        <EnhancedProfileCard username="bob_builder" />
      </div>

      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ DisplayNameä¼˜åŠ¿</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6' }}>
          <li><strong>React DevTools</strong>ä¸­æ˜¾ç¤ºå®Œæ•´ç»„ä»¶åç§°</li>
          <li><strong>è°ƒè¯•</strong>æ—¶å¿«é€Ÿè¯†åˆ«ç»„ä»¶æ¥æº</li>
          <li><strong>é”™è¯¯è¿½è¸ª</strong>æ›´æ¸…æ™°ç›´è§‚</li>
          <li><strong>å±‚çº§ç»“æ„</strong>æ›´å®¹æ˜“ç†è§£</li>
          <li><strong>å¼€å‘ä½“éªŒ</strong>æ˜¾è‘—æå‡</li>
        </ul>
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '6px',
        fontFamily: 'monospace',
        fontSize: '14px'
      }}>
        <div><strong>EnhancedUserCard.displayName:</strong></div>
        <div style={{ color: '#2196f3', marginTop: '5px' }}>
          "{EnhancedUserCard.displayName}"
        </div>
        <div style={{ marginTop: '10px' }}><strong>EnhancedProfileCard.displayName:</strong></div>
        <div style={{ color: '#2196f3', marginTop: '5px' }}>
          "{EnhancedProfileCard.displayName}"
        </div>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 3. å¸¸è§HOCæ¨¡å¼

### 3.1 æ¡ä»¶æ¸²æŸ“HOC

<LiveCode
  code={`
function ConditionalRenderingHOCDemo() {
  const [user, setUser] = React.useState({
    isAuthenticated: false,
    role: 'guest',
    name: 'Guest User'
  });

  const [isAdmin, setIsAdmin] = React.useState(false);

  // æ¡ä»¶æ¸²æŸ“HOC
  function withCondition(WrappedComponent, condition) {
    return function EnhancedComponent(props) {
      if (!condition(props)) {
        return (
          <div style={{
            padding: '20px',
            background: '#f5f5f5',
            borderRadius: '8px',
            textAlign: 'center',
            color: '#999'
          }}>
            â³ æ¡ä»¶æœªæ»¡è¶³ï¼Œæ— æ³•æ˜¾ç¤ºå†…å®¹
          </div>
        );
      }
      return <WrappedComponent {...props} />;
    };
  }

  // æƒé™æ§åˆ¶HOC
  function withAuth(WrappedComponent) {
    return function AuthenticatedComponent(props) {
      const { isAuthenticated, user, role } = props;

      if (!isAuthenticated) {
        return (
          <div style={{
            padding: '20px',
            background: '#ffebee',
            borderRadius: '8px',
            border: '2px solid #f44336',
            textAlign: 'center'
          }}>
            <h4 style={{ margin: '0 0 10px 0', color: '#c62828' }}>ğŸ”’ éœ€è¦ç™»å½•</h4>
            <p style={{ margin: 0, color: '#666' }}>è¯·å…ˆç™»å½•ä»¥è®¿é—®æ­¤å†…å®¹</p>
          </div>
        );
      }

      if (role && role !== 'admin') {
        return (
          <div style={{
            padding: '20px',
            background: '#fff3e0',
            borderRadius: '8px',
            border: '2px solid #ff9800',
            textAlign: 'center'
          }}>
            <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>â›” è®¿é—®å—é™</h4>
            <p style={{ margin: 0, color: '#666' }}>éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æŸ¥çœ‹</p>
          </div>
        );
      }

      return <WrappedComponent {...props} />;
    };
  }

  // æ¨¡æ‹Ÿç»„ä»¶
  const Dashboard = ({ user, role }) => (
    <div style={{
      padding: '20px',
      background: '#e8f5e9',
      borderRadius: '8px',
      border: '2px solid #4caf50'
    }}>
      <h4 style={{ margin: '0 0 10px 0', color: '#2e7d32' }}>ğŸ“Š ä»ªè¡¨ç›˜</h4>
      <p style={{ margin: 0 }}>æ¬¢è¿, {user?.name}! æ‚¨çš„è§’è‰²: {role}</p>
    </div>
  );

  const AdminPanel = ({ user }) => (
    <div style={{
      padding: '20px',
      background: '#f3e5f5',
      borderRadius: '8px',
      border: '2px solid #9c27b0'
    }}>
      <h4 style={{ margin: '0 0 10px 0', color: '#6a1b9a' }}>ğŸ‘‘ ç®¡ç†å‘˜é¢æ¿</h4>
      <p style={{ margin: 0 }}>ç®¡ç†å‘˜åŠŸèƒ½ä»…å¯¹ {user?.name} å¼€æ”¾</p>
    </div>
  );

  // å¢å¼ºç»„ä»¶
  const ProtectedDashboard = withAuth(Dashboard);
  const AdminDashboard = withAuth(AdminPanel);
  const ConditionalDashboard = withCondition(Dashboard, ({ user }) => user?.isAuthenticated);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ” æ¡ä»¶æ¸²æŸ“HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        display: 'flex',
        gap: '10px',
        flexWrap: 'wrap'
      }}>
        <button
          onClick={() => setUser({
            isAuthenticated: false,
            role: 'guest',
            name: 'Guest User'
          })}
          style={{
            padding: '8px 16px',
            background: user.isAuthenticated ? '#e0e0e0' : '#2196f3',
            color: user.isAuthenticated ? '#999' : 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘¤ æœªç™»å½•
        </button>
        <button
          onClick={() => setUser({
            isAuthenticated: true,
            role: 'user',
            name: 'Alice'
          })}
          style={{
            padding: '8px 16px',
            background: user.isAuthenticated && user.role === 'user' ? '#2196f3' : '#e0e0e0',
            color: user.isAuthenticated && user.role === 'user' ? 'white' : '#999',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘¤ æ™®é€šç”¨æˆ·
        </button>
        <button
          onClick={() => setUser({
            isAuthenticated: true,
            role: 'admin',
            name: 'Admin User'
          })}
          style={{
            padding: '8px 16px',
            background: user.isAuthenticated && user.role === 'admin' ? '#4caf50' : '#e0e0e0',
            color: user.isAuthenticated && user.role === 'admin' ? 'white' : '#999',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘‘ ç®¡ç†å‘˜
        </button>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>1. åŸºç¡€è®¤è¯ä¿æŠ¤ï¼š</h4>
        <ProtectedDashboard user={user} role={user.role} />
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>2. ç®¡ç†å‘˜ä¸“å±å†…å®¹ï¼š</h4>
        <AdminDashboard user={user} />
      </div>

      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1565c0' }}>ğŸ’¡ æ¡ä»¶æ¸²æŸ“æ¨¡å¼</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6' }}>
          <li><strong>è®¤è¯æ£€æŸ¥</strong> - ç¡®ä¿ç”¨æˆ·å·²ç™»å½•</li>
          <li><strong>æƒé™æ§åˆ¶</strong> - æ ¹æ®ç”¨æˆ·è§’è‰²æ˜¾ç¤ºä¸åŒå†…å®¹</li>
          <li><strong>æ¡ä»¶æ¸²æŸ“</strong> - æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦æ¸²æŸ“ç»„ä»¶</li>
          <li><strong>å®‰å…¨å¢å¼º</strong> - åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å¯ä½¿ç”¨</li>
          <li><strong>é”™è¯¯å¤„ç†</strong> - æä¾›å‹å¥½çš„é™çº§UI</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 3.2 æ•°æ®è·å–HOC

<LiveCode
  code={`
function DataFetchingHOCDemo() {
  const [userId, setUserId] = React.useState('user1');

  // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
  const userDatabase = {
    user1: { id: 'user1', name: 'Alice Johnson', email: 'alice@example.com', role: 'Admin' },
    user2: { id: 'user2', name: 'Bob Smith', email: 'bob@example.com', role: 'User' },
    user3: { id: 'user3', name: 'Charlie Brown', email: 'charlie@example.com', role: 'Moderator' }
  };

  // æ¨¡æ‹ŸAPIè°ƒç”¨
  const fetchUser = async ({ userId }) => {
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(userDatabase[userId] || null);
      }, 1000);
    });
  };

  // æ•°æ®è·å–HOC
  function withData(WrappedComponent, dataSource) {
    return function EnhancedComponent(props) {
      const [data, setData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState(null);

      React.useEffect(() => {
        const fetchData = async () => {
          try {
            setLoading(true);
            setError(null);
            const result = await dataSource(props);
            setData(result);
          } catch (err) {
            setError(err);
          } finally {
            setLoading(false);
          }
        };

        fetchData();
      }, [props.userId]); // ä¾èµ–propå˜åŒ–

      return (
        <WrappedComponent
          {...props}
          data={data}
          loading={loading}
          error={error}
          refetch={() => {
            setData(null);
            setLoading(true);
            dataSource(props).then(setData).catch(setError).finally(() => setLoading(false));
          }}
        />
      );
    };
  }

  // ç”¨æˆ·èµ„æ–™ç»„ä»¶
  const UserProfile = ({ data, loading, error, refetch, userId }) => {
    if (loading) {
      return (
        <div style={{
          padding: '20px',
          background: '#fff',
          borderRadius: '8px',
          border: '2px solid #2196f3',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '24px' }}>â³</div>
          <p style={{ margin: '10px 0 0 0', color: '#666' }}>æ­£åœ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯...</p>
        </div>
      );
    }

    if (error) {
      return (
        <div style={{
          padding: '20px',
          background: '#ffebee',
          borderRadius: '8px',
          border: '2px solid #f44336'
        }}>
          <h4 style={{ margin: '0 0 10px 0', color: '#c62828' }}>âŒ åŠ è½½å¤±è´¥</h4>
          <p style={{ margin: '0 0 10px 0', color: '#666' }}>é”™è¯¯: {error.message}</p>
          <button
            onClick={refetch}
            style={{
              padding: '8px 16px',
              background: '#f44336',
              color: 'white',
              border: 'none',
              borderRadius: '6px',
              cursor: 'pointer'
            }}
          >
            ğŸ”„ é‡è¯•
          </button>
        </div>
      );
    }

    if (!data) {
      return (
        <div style={{
          padding: '20px',
          background: '#f5f5f5',
          borderRadius: '8px',
          textAlign: 'center',
          color: '#999'
        }}>
          æœªæ‰¾åˆ°ç”¨æˆ·
        </div>
      );
    }

    return (
      <div style={{
        padding: '20px',
        background: '#e8f5e9',
        borderRadius: '8px',
        border: '2px solid #4caf50'
      }}>
        <div style={{ display: 'flex', alignItems: 'center', marginBottom: '15px' }}>
          <div style={{
            width: '60px',
            height: '60px',
            borderRadius: '50%',
            background: '#4caf50',
            color: 'white',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            fontSize: '24px',
            marginRight: '15px'
          }}>
            {data.name.charAt(0)}
          </div>
          <div>
            <h4 style={{ margin: '0 0 5px 0', color: '#2e7d32' }}>{data.name}</h4>
            <p style={{ margin: 0, color: '#666' }}>{data.email}</p>
          </div>
        </div>
        <div style={{
          padding: '10px',
          background: 'white',
          borderRadius: '6px',
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center'
        }}>
          <span style={{ color: '#666' }}>è§’è‰²:</span>
          <span style={{
            padding: '4px 12px',
            background: data.role === 'Admin' ? '#f44336' :
                      data.role === 'Moderator' ? '#ff9800' : '#2196f3',
            color: 'white',
            borderRadius: '12px',
            fontSize: '12px',
            fontWeight: 'bold'
          }}>
            {data.role}
          </span>
        </div>
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const UserProfileWithData = withData(UserProfile, fetchUser);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ“¡ æ•°æ®è·å–HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        display: 'flex',
        gap: '10px',
        flexWrap: 'wrap'
      }}>
        <button
          onClick={() => setUserId('user1')}
          style={{
            padding: '8px 16px',
            background: userId === 'user1' ? '#2196f3' : 'white',
            color: userId === 'user1' ? 'white' : '#333',
            border: '2px solid #2196f3',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘¤ Alice (Admin)
        </button>
        <button
          onClick={() => setUserId('user2')}
          style={{
            padding: '8px 16px',
            background: userId === 'user2' ? '#2196f3' : 'white',
            color: userId === 'user2' ? 'white' : '#333',
            border: '2px solid #2196f3',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘¤ Bob (User)
        </button>
        <button
          onClick={() => setUserId('user3')}
          style={{
            padding: '8px 16px',
            background: userId === 'user3' ? '#2196f3' : 'white',
            color: userId === 'user3' ? 'white' : '#333',
            border: '2px solid #2196f3',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          ğŸ‘¤ Charlie (Moderator)
        </button>
        <button
          onClick={() => setUserId('invalid')}
          style={{
            padding: '8px 16px',
            background: userId === 'invalid' ? '#f44336' : 'white',
            color: userId === 'invalid' ? 'white' : '#333',
            border: '2px solid #f44336',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          âŒ æ— æ•ˆç”¨æˆ·
        </button>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>ç”¨æˆ·èµ„æ–™ï¼š</h4>
        <UserProfileWithData userId={userId} />
      </div>

      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1565c0' }}>ğŸ’¡ æ•°æ®è·å–æ¨¡å¼</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6' }}>
          <li><strong>è‡ªåŠ¨æ•°æ®è·å–</strong> - åŸºäºpropå˜åŒ–è‡ªåŠ¨è§¦å‘</li>
          <li><strong>åŠ è½½çŠ¶æ€</strong> - æ˜¾ç¤ºloadingå ä½ç¬¦</li>
          <li><strong>é”™è¯¯å¤„ç†</strong> - ä¼˜é›…å¤„ç†é”™è¯¯å’Œé‡è¯•</li>
          <li><strong>ç¼“å­˜æœºåˆ¶</strong> - å¯æ‰©å±•ç¼“å­˜é€»è¾‘</li>
          <li><strong>å¤ç”¨æ€§</strong> - ä»»ä½•ç»„ä»¶éƒ½å¯å¿«é€Ÿæ·»åŠ æ•°æ®è·å–èƒ½åŠ›</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 3.3 æ ·å¼å¢å¼ºHOC

<LiveCode
  code={`
function StyleEnhancementHOCDemo() {
  // æ ·å¼å¢å¼ºHOC - æ·»åŠ åŠ¨æ€æ ·å¼å’Œäº¤äº’çŠ¶æ€
  const withStyles = (WrappedComponent, options) => {
    return function StyledComponent(props) {
      const [isActive, setIsActive] = React.useState(false);
      const [isHovered, setIsHovered] = React.useState(false);

      // åˆå¹¶æ ·å¼
      const containerStyle = {
        padding: '15px',
        margin: '10px 0',
        borderRadius: '8px',
        border: isActive
          ? '3px solid #2196f3'
          : isHovered
          ? '2px solid #64b5f6'
          : '2px solid #ddd',
        background: isActive
          ? 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)'
          : isHovered
          ? '#f5f5f5'
          : '#fff',
        transition: 'all 0.3s ease',
        transform: isActive ? 'scale(1.02)' : 'scale(1)',
        boxShadow: isActive
          ? '0 4px 12px rgba(33, 150, 243, 0.3)'
          : '0 2px 4px rgba(0,0,0,0.1)',
        cursor: 'pointer'
      };

      const buttonStyle = {
        padding: '8px 16px',
        background: isActive ? '#2196f3' : '#4caf50',
        color: 'white',
        border: 'none',
        borderRadius: '6px',
        cursor: 'pointer',
        fontSize: '14px',
        fontWeight: 'bold',
        marginRight: '10px',
        transition: 'all 0.2s'
      };

      const resetButtonStyle = {
        ...buttonStyle,
        background: '#ff9800'
      };

      return (
        <div
          style={containerStyle}
          onMouseEnter={() => setIsHovered(true)}
          onMouseLeave={() => setIsHovered(false)}
        >
          <div style={{ marginBottom: '15px' }}>
            <h4 style={{ margin: '0 0 10px 0', color: '#333' }}>
              çŠ¶æ€: {isActive ? 'ğŸŸ¢ æ¿€æ´»' : 'âšª é™æ­¢'}
            </h4>
            <p style={{ margin: '0', color: '#666', fontSize: '14px' }}>
              æ‚¬åœ: {isHovered ? 'æ˜¯' : 'å¦'}
            </p>
          </div>

          <WrappedComponent
            {...props}
            isActive={isActive}
            isHovered={isHovered}
            onToggle={() => setIsActive(!isActive)}
            onReset={() => {
              setIsActive(false);
              setIsHovered(false);
            }}
            styles={{ buttonStyle, resetButtonStyle }}
          />
        </div>
      );
    };
  };

  // åŸå§‹å¡ç‰‡ç»„ä»¶
  const Card = ({ title, content, isActive, onToggle, onReset, styles }) => {
    return (
      <div>
        <h3 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>{title}</h3>
        <p style={{ margin: '0 0 15px 0', color: '#555' }}>{content}</p>
        <div>
          <button
            style={styles.buttonStyle}
            onClick={onToggle}
          >
            {isActive ? 'å–æ¶ˆæ¿€æ´»' : 'æ¿€æ´»æ ·å¼'}
          </button>
          <button
            style={styles.resetButtonStyle}
            onClick={onReset}
          >
            é‡ç½®
          </button>
        </div>
        {isActive && (
          <div style={{
            marginTop: '10px',
            padding: '10px',
            background: '#e8f5e9',
            borderRadius: '4px',
            fontSize: '13px',
            color: '#2e7d32'
          }}>
            âœ¨ æ ·å¼å·²æ¿€æ´»ï¼ç»„ä»¶ç°åœ¨å…·æœ‰ç‰¹æ®Šçš„è§†è§‰å¤–è§‚ã€‚
          </div>
        )}
      </div>
    );
  };

  // ç®€å•çš„ç±»åå¢å¼ºHOCç¤ºä¾‹
  const withClassName = (WrappedComponent, className) => {
    return function EnhancedComponent(props) {
      const enhancedStyle = {
        padding: '15px',
        border: '2px dashed #9c27b0',
        borderRadius: '8px',
        background: '#f3e5f5',
        margin: '10px 0'
      };

      return (
        <div style={enhancedStyle}>
          <div style={{
            fontSize: '12px',
            color: '#6a1b9a',
            marginBottom: '8px',
            fontWeight: 'bold'
          }}>
            ğŸ¨ ç±»å: {className}
          </div>
          <WrappedComponent {...props} />
        </div>
      );
    };
  };

  // ç®€å•çš„å®¹å™¨ç»„ä»¶
  const SimpleMessage = ({ message }) => {
    return (
      <div style={{
        padding: '10px',
        background: 'white',
        borderRadius: '4px',
        textAlign: 'center',
        fontSize: '14px',
        color: '#333'
      }}>
        {message}
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const StyledCard = withStyles(Card, {
    active: 'active-style',
    base: 'base-style'
  });

  const CenteredMessage = withClassName(SimpleMessage, 'mx-auto max-w-md');

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¨ æ ·å¼å¢å¼ºHOCæ¼”ç¤º</h3>

      <div style={{ marginBottom: '30px' }}>
        <h4>1. åŠ¨æ€æ ·å¼HOC (å¸¦äº¤äº’çŠ¶æ€):</h4>
        <StyledCard
          title="ğŸ“¦ äº§å“å¡ç‰‡"
          content="è¿™æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡HOCå¢å¼ºæ ·å¼çš„å¡ç‰‡ç»„ä»¶ã€‚ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹æ ·å¼å˜åŒ–ã€‚"
        />
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>2. ç±»åå¢å¼ºHOC (ç®€å•ç‰ˆæœ¬):</h4>
        <CenteredMessage message="âœ¨ è¿™ä¸ªç»„ä»¶é€šè¿‡HOCæ·»åŠ äº†ç´«è‰²è¾¹æ¡†æ ·å¼" />
      </div>

      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        marginTop: '20px'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1565c0' }}>ğŸ’¡ æ ·å¼å¢å¼ºHOCçš„ç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>åŠ¨æ€æ ·å¼</strong> - æ ¹æ®çŠ¶æ€æ”¹å˜ç»„ä»¶å¤–è§‚</li>
          <li><strong>äº¤äº’åé¦ˆ</strong> - æ‚¬åœã€ç‚¹å‡»ç­‰çŠ¶æ€çš„å¯è§†åŒ–</li>
          <li><strong>æ ·å¼å¤ç”¨</strong> - ä¸€æ¬¡å®šä¹‰ï¼Œå¤šå¤„ä½¿ç”¨</li>
          <li><strong>ç±»åæ³¨å…¥</strong> - ç®€åŒ–CSSç±»åç®¡ç†</li>
          <li><strong>ä¸»é¢˜åˆ‡æ¢</strong> - æ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 3.4 çŠ¶æ€ç®¡ç†HOC

<LiveCode
  code={`
function StateManagementHOCDemo() {
  // çŠ¶æ€æå‡HOC
  const withState = (WrappedComponent, initialState, stateName = 'state', setStateName = 'setState') => {
    return function EnhancedComponent(props) {
      const [state, setState] = React.useState(initialState);

      const enhancedProps = {
        ...props,
        [stateName]: state,
        [setStateName]: setState
      };

      return <WrappedComponent {...enhancedProps} />;
    };
  };

  // è®¡æ•°å™¨ç»„ä»¶
  const Counter = ({ count, setCount }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>è®¡æ•°å™¨ç»„ä»¶</h4>
        <p style={{ fontSize: '18px', fontWeight: 'bold', margin: '10px 0' }}>Count: {count}</p>
        <div style={{ display: 'flex', gap: '10px' }}>
          <button
            onClick={() => setCount(count + 1)}
            style={{
              padding: '8px 16px',
              background: '#4caf50',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            +1
          </button>
          <button
            onClick={() => setCount(count - 1)}
            style={{
              padding: '8px 16px',
              background: '#f44336',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            -1
          </button>
          <button
            onClick={() => setCount(0)}
            style={{
              padding: '8px 16px',
              background: '#ff9800',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            é‡ç½®
          </button>
        </div>
      </div>
    );
  };

  // æ›´çµæ´»çš„è¡¨å•çŠ¶æ€HOC
  const withFormState = (WrappedComponent, initialValues) => {
    return function EnhancedFormComponent(props) {
      const [values, setValues] = React.useState(initialValues);
      const [touched, setTouched] = React.useState({});
      const [errors, setErrors] = React.useState({});

      const handleChange = (name, value) => {
        setValues(prev => ({ ...prev, [name]: value }));
      };

      const handleBlur = (name) => {
        setTouched(prev => ({ ...prev, [name]: true }));
      };

      return (
        <WrappedComponent
          {...props}
          values={values}
          touched={touched}
          errors={errors}
          handleChange={handleChange}
          handleBlur={handleBlur}
        />
      );
    };
  };

  // è¡¨å•ç»„ä»¶
  const LoginForm = ({ values, touched, errors, handleChange, handleBlur }) => {
    return (
      <div style={{
        padding: '20px',
        background: '#f5f5f5',
        borderRadius: '8px',
        border: '2px solid #9c27b0',
        maxWidth: '400px'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: '#6a1b9a' }}>ç™»å½•è¡¨å• (withFormState)</h4>

        <div style={{ marginBottom: '15px' }}>
          <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
            ç”¨æˆ·å
          </label>
          <input
            type="text"
            value={values.username || ''}
            onChange={(e) => handleChange('username', e.target.value)}
            onBlur={() => handleBlur('username')}
            placeholder="è¾“å…¥ç”¨æˆ·å"
            style={{
              width: '100%',
              padding: '8px',
              border: touched.username && errors.username ? '2px solid #f44336' : '1px solid #ddd',
              borderRadius: '4px',
              fontSize: '14px'
            }}
          />
          {touched.username && errors.username && (
            <p style={{ color: '#f44336', fontSize: '12px', margin: '5px 0 0 0' }}>
              {errors.username}
            </p>
          )}
        </div>

        <div style={{ marginBottom: '15px' }}>
          <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
            å¯†ç 
          </label>
          <input
            type="password"
            value={values.password || ''}
            onChange={(e) => handleChange('password', e.target.value)}
            onBlur={() => handleBlur('password')}
            placeholder="è¾“å…¥å¯†ç "
            style={{
              width: '100%',
              padding: '8px',
              border: touched.password && errors.password ? '2px solid #f44336' : '1px solid #ddd',
              borderRadius: '4px',
              fontSize: '14px'
            }}
          />
          {touched.password && errors.password && (
            <p style={{ color: '#f44336', fontSize: '12px', margin: '5px 0 0 0' }}>
              {errors.password}
            </p>
          )}
        </div>

        <div style={{
          marginTop: '20px',
          padding: '10px',
          background: 'white',
          borderRadius: '4px',
          fontSize: '14px'
        }}>
          <strong>è¡¨å•å€¼ï¼š</strong>
          <pre style={{ margin: '5px 0', fontSize: '12px', color: '#666' }}>
            {JSON.stringify(values, null, 2)}
          </pre>
        </div>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const EnhancedCounter = withState(Counter, 0, 'count', 'setCount');
  const EnhancedForm = withFormState(LoginForm, { username: '', password: '' });

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ”„ çŠ¶æ€ç®¡ç†HOCæ¼”ç¤º</h3>

      <div style={{ marginBottom: '30px' }}>
        <h4>1. åŸºç¡€çŠ¶æ€HOC (withState):</h4>
        <EnhancedCounter />
      </div>

      <div>
        <h4>2. è¡¨å•çŠ¶æ€HOC (withFormState):</h4>
        <EnhancedForm />
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ çŠ¶æ€ç®¡ç†HOCç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>çŠ¶æ€æå‡</strong> - å°†çŠ¶æ€é€»è¾‘æå–åˆ°HOCä¸­</li>
          <li><strong>å¯é…ç½®</strong> - æ”¯æŒè‡ªå®šä¹‰çŠ¶æ€åç§°</li>
          <li><strong>è¡¨å•å¤„ç†</strong> - ä¸“é—¨å¤„ç†è¡¨å•çŠ¶æ€å’ŒéªŒè¯</li>
          <li><strong>å¤ç”¨æ€§å¼º</strong> - ä»»ä½•ç»„ä»¶éƒ½å¯ä»¥å¿«é€Ÿæ·»åŠ çŠ¶æ€ç®¡ç†</li>
          <li><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong> - çŠ¶æ€é€»è¾‘ä¸UIåˆ†ç¦»</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 3.5 äº‹ä»¶å¤„ç†HOC

<LiveCode
  code={`
function EventHandlingHOCDemo() {
  // æ¨¡æ‹Ÿåˆ†ææœåŠ¡
  const analytics = {
    clicks: [],
    track: (event, data) => {
      analytics.clicks.push({ event, data, timestamp: new Date().toLocaleTimeString() });
    }
  };

  // äº‹ä»¶å¤„ç†HOC
  const withClickAnalytics = (WrappedComponent, analyticsService) => {
    return function EnhancedComponent(props) {
      const handleClick = React.useCallback((event) => {
        // è°ƒç”¨åŸå§‹å¤„ç†å‡½æ•°
        if (props.onClick) {
          props.onClick(event);
        }

        // å‘é€åˆ†ææ•°æ®
        analyticsService.track('component_clicked', {
          component: WrappedComponent.name || 'Anonymous',
          timestamp: new Date().toLocaleTimeString()
        });
      }, [props.onClick, analyticsService]);

      return <WrappedComponent {...props} onClick={handleClick} />;
    };
  };

  // é”®ç›˜å¿«æ·é”®HOC
  const withKeyboardShortcuts = (WrappedComponent, shortcuts) => {
    return function EnhancedComponent(props) {
      React.useEffect(() => {
        const handleKeyPress = (event) => {
          const key = event.key.toLowerCase();
          if (shortcuts[key]) {
            event.preventDefault();
            shortcuts[key](props);
          }
        };

        document.addEventListener('keydown', handleKeyPress);
        return () => document.removeEventListener('keydown', handleKeyPress);
      }, [shortcuts, props]);

      return <WrappedComponent {...props} />;
    };
  };

  // æŒ‰é’®ç»„ä»¶
  const Button = ({ onClick, children, variant = 'primary' }) => {
    const buttonStyle = {
      primary: { background: '#2196f3', color: 'white' },
      success: { background: '#4caf50', color: 'white' },
      danger: { background: '#f44336', color: 'white' }
    };

    return (
      <button
        onClick={onClick}
        style={{
          padding: '10px 20px',
          border: 'none',
          borderRadius: '4px',
          cursor: 'pointer',
          fontSize: '14px',
          fontWeight: 'bold',
          ...buttonStyle[variant]
        }}
      >
        {children}
      </button>
    );
  };

  // å¿«æ·é”®å¤„ç†å‡½æ•°
  const shortcuts = {
    's': () => {
      alert('ğŸ’¾ Save action triggered (S key)');
      analytics.track('shortcut_used', { key: 's', action: 'save' });
    },
    'd': () => {
      alert('ğŸ—‘ï¸ Delete action triggered (D key)');
      analytics.track('shortcut_used', { key: 'd', action: 'delete' });
    },
    'h': () => {
      alert('â„¹ï¸ Help opened (H key)');
      analytics.track('shortcut_used', { key: 'h', action: 'help' });
    }
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const TrackedButton = withClickAnalytics(Button, analytics);
  const ShortcutEnabledComponent = withKeyboardShortcuts(({ onShortcutUsed }) => {
    const [count, setCount] = React.useState(0);

    return (
      <div style={{
        padding: '20px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: '#1976d2' }}>
          ğŸ¹ å¿«æ·é”®ç›‘å¬ç»„ä»¶ (æŒ‰ S/D/H é”®æµ‹è¯•)
        </h4>
        <p style={{ margin: '10px 0' }}>ç‚¹å‡»æ¬¡æ•°: {count}</p>
        <div style={{ display: 'flex', gap: '10px' }}>
          <button
            onClick={() => setCount(count + 1)}
            style={{
              padding: '8px 16px',
              background: '#4caf50',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            ç‚¹å‡»æˆ‘
          </button>
        </div>
        <p style={{ marginTop: '15px', fontSize: '14px', color: '#666' }}>
          ğŸ’¡ æç¤º: æŒ‰é”®ç›˜ä¸Šçš„ <strong>S</strong> (ä¿å­˜)ã€<strong>D</strong> (åˆ é™¤)ã€<strong>H</strong> (å¸®åŠ©) é”®
        </p>
      </div>
    );
  }, shortcuts);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>âš¡ äº‹ä»¶å¤„ç†HOCæ¼”ç¤º</h3>

      <div style={{ marginBottom: '30px' }}>
        <h4>1. ç‚¹å‡»è¿½è¸ªHOC (withClickAnalytics):</h4>
        <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
          <TrackedButton
            variant="primary"
            onClick={() => alert('ç‚¹å‡»äº†ä¸»è¦æŒ‰é’®ï¼')}
          >
            è¿½è¸ªç‚¹å‡»
          </TrackedButton>
          <TrackedButton
            variant="success"
            onClick={() => alert('æˆåŠŸæŒ‰é’®è¢«ç‚¹å‡»ï¼')}
          >
            æˆåŠŸæŒ‰é’®
          </TrackedButton>
          <TrackedButton
            variant="danger"
            onClick={() => alert('å±é™©æŒ‰é’®ï¼')}
          >
            å±é™©æŒ‰é’®
          </TrackedButton>
        </div>

        {analytics.clicks.length > 0 && (
          <div style={{
            marginTop: '15px',
            padding: '15px',
            background: 'white',
            borderRadius: '6px',
            border: '1px solid #ddd',
            maxWidth: '500px'
          }}>
            <h5 style={{ margin: '0 0 10px 0' }}>ğŸ“Š ç‚¹å‡»æ—¥å¿—:</h5>
            <div style={{ fontSize: '12px', color: '#666', maxHeight: '150px', overflow: 'auto' }}>
              {analytics.clicks.map((log, index) => (
                <div key={index} style={{ marginBottom: '5px', padding: '5px', background: '#f5f5f5', borderRadius: '3px' }}>
                  <strong>{log.event}</strong> - {log.data.component} at {log.data.timestamp}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>2. é”®ç›˜å¿«æ·é”®HOC (withKeyboardShortcuts):</h4>
        <ShortcutEnabledComponent />
      </div>

      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        border: '2px solid #9c27b0'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#6a1b9a' }}>ğŸ’¡ äº‹ä»¶å¤„ç†HOCç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>ç‚¹å‡»è¿½è¸ª</strong> - è‡ªåŠ¨è¿½è¸ªç»„ä»¶ç‚¹å‡»äº‹ä»¶</li>
          <li><strong>å¿«æ·é”®æ”¯æŒ</strong> - ä¸ºç»„ä»¶æ·»åŠ é”®ç›˜å¿«æ·é”®</li>
          <li><strong>åˆ†æé›†æˆ</strong> - é›†æˆç¬¬ä¸‰æ–¹åˆ†ææœåŠ¡</li>
          <li><strong>äº‹ä»¶å¢å¼º</strong> - åœ¨ä¸ä¿®æ”¹åŸç»„ä»¶çš„æƒ…å†µä¸‹å¢å¼ºäº‹ä»¶å¤„ç†</li>
          <li><strong>å¯å¤ç”¨</strong> - ä¸€æ¬¡å®šä¹‰ï¼Œå¤šå¤„ä½¿ç”¨</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 4. é«˜çº§HOCæ¨¡å¼

### 4.1 é“¾å¼HOC

<LiveCode
  code={`
function ChainedHOCHDemo() {
  // æ¨¡æ‹Ÿå„ç§HOC
  const withStyles = (WrappedComponent, color) => {
    return function StyledComponent(props) {
      return (
        <div style={{
          padding: '20px',
          border: '3px solid ' + color,
          borderRadius: '8px',
          margin: '10px',
          background: '#f9f9f9'
        }}>
          <WrappedComponent {...props} />
        </div>
      );
    };
  };

  const withLoading = (WrappedComponent) => {
    return function LoadingComponent(props) {
      const [isLoading, setIsLoading] = React.useState(false);

      return (
        <div>
          <button
            onClick={() => setIsLoading(!isLoading)}
            style={{
              marginBottom: '10px',
              padding: '8px 16px',
              background: isLoading ? '#ff9800' : '#4caf50',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            {isLoading ? 'æ˜¾ç¤ºåŠ è½½ä¸­...' : 'æ˜¾ç¤ºç»„ä»¶'}
          </button>
          {isLoading ? (
            <div style={{ padding: '20px', textAlign: 'center', color: '#666' }}>
              â³ åŠ è½½ä¸­...
            </div>
          ) : (
            <WrappedComponent {...props} />
          )}
        </div>
      );
    };
  };

  const withBadge = (WrappedComponent) => {
    return function BadgedComponent(props) {
      return (
        <div style={{ position: 'relative' }}>
          <WrappedComponent {...props} />
          <div style={{
            position: 'absolute',
            top: '-10px',
            right: '-10px',
            background: '#f44336',
            color: 'white',
            borderRadius: '50%',
            width: '24px',
            height: '24px',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            fontSize: '12px',
            fontWeight: 'bold'
          }}>
            !
          </div>
        </div>
      );
    };
  };

  // composeå‡½æ•° - ç»„åˆå¤šä¸ªHOC
  const compose = (...hocs) => (component) =>
    hocs.reduce((wrapped, hoc) => hoc(wrapped), component);

  // åŸå§‹ç»„ä»¶
  const MyComponent = ({ name }) => {
    return (
      <div style={{ padding: '15px', background: 'white', borderRadius: '4px' }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#333' }}>ğŸ“¦ åŸå§‹ç»„ä»¶</h4>
        <p style={{ margin: 0, color: '#666' }}>Hello, {name}!</p>
      </div>
    );
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ”— é“¾å¼HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ é“¾å¼HOCåŸç†</h4>
        <p style={{ margin: '5px 0', fontSize: '14px' }}>
          <strong>composeå‡½æ•°</strong>ä»å³åˆ°å·¦ä¾æ¬¡åº”ç”¨HOCï¼š
        </p>
        <p style={{ margin: '5px 0', fontSize: '14px', fontFamily: 'monospace', background: '#fff', padding: '10px', borderRadius: '4px' }}>
          enhance = withBadge âˆ˜ withLoading âˆ˜ withStyles âˆ˜ MyComponent
        </p>
        <p style={{ margin: '5px 0', fontSize: '14px' }}>
          ç­‰åŒäºï¼šwithBadge(withLoading(withStyles(MyComponent)))
        </p>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>æ–¹æ³•1: æ‰‹åŠ¨é“¾å¼ç»„åˆ</h4>
        <div style={{ marginTop: '10px' }}>
          {(() => {
            // æ‰‹åŠ¨é“¾å¼ç»„åˆ
            const StyledComponent = withStyles(MyComponent, '#4caf50');
            const StyledWithLoading = withLoading(StyledComponent);
            const FinalComponent = withBadge(StyledWithLoading);

            return <FinalComponent name="æ‰‹åŠ¨é“¾å¼" />;
          })()}
        </div>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>æ–¹æ³•2: ä½¿ç”¨composeå‡½æ•°</h4>
        <div style={{ marginTop: '10px' }}>
          {(() => {
            // ä½¿ç”¨composeç»„åˆ
            const enhance = compose(
              withBadge,
              withLoading,
              (WrappedComponent) => withStyles(WrappedComponent, '#9c27b0')
            );

            const EnhancedComponent = enhance(MyComponent);
            return <EnhancedComponent name="ä½¿ç”¨compose" />;
          })()}
        </div>
      </div>

      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1565c0' }}>ğŸ’¡ composeå‡½æ•°å®ç°</h4>
        <pre style={{ margin: 0, fontSize: '13px', color: '#333' }}>
{\`const compose = (...hocs) => (component) =>
  hocs.reduce((wrapped, hoc) => hoc(wrapped), component);\`}
        </pre>
        <p style={{ margin: '10px 0 0 0', fontSize: '13px', color: '#666' }}>
          <strong>reduceè¿‡ç¨‹ï¼š</strong>ä»å³åˆ°å·¦ä¾æ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡å°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªHOC
        </p>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 4.2 ä¼ é€’Refs

<LiveCode
  code={`
function RefForwardingDemo() {
  // åŸå§‹Inputç»„ä»¶
  const Input = forwardRef((props, ref) => {
    return (
      <input
        ref={ref}
        {...props}
        style={{
          padding: '10px 15px',
          fontSize: '16px',
          border: '2px solid #2196f3',
          borderRadius: '6px',
          outline: 'none',
          transition: 'all 0.3s',
          width: '100%',
          maxWidth: '300px'
        }}
        onFocus={(e) => {
          e.target.style.borderColor = '#4caf50';
          e.target.style.boxShadow = '0 0 0 3px rgba(76, 175, 80, 0.1)';
        }}
        onBlur={(e) => {
          e.target.style.borderColor = '#2196f3';
          e.target.style.boxShadow = 'none';
        }}
      />
    );
  });

  // ä½¿ç”¨forwardRefçš„HOC
  const withRef = (WrappedComponent) => {
    const EnhancedComponent = forwardRef((props, ref) => {
      return <WrappedComponent ref={ref} {...props} />;
    });

    EnhancedComponent.displayName = \`withRef(\${WrappedComponent.displayName || WrappedComponent.name || 'Component'})\`;
    return EnhancedComponent;
  };

  // åˆ›å»ºå¢å¼ºçš„Inputç»„ä»¶
  const EnhancedInput = withRef(Input);

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ”— Refè½¬å‘ç¤ºä¾‹</h3>

      <p style={{ margin: '10px 0', fontSize: '14px', color: '#666' }}>
        <strong>åŠŸèƒ½ï¼š</strong>é€šè¿‡forwardRefè½¬å‘refsï¼Œä½¿çˆ¶ç»„ä»¶å¯ä»¥è®¿é—®å­ç»„ä»¶çš„DOMèŠ‚ç‚¹
      </p>

      <div style={{ marginTop: '20px' }}>
        <EnhancedInput placeholder="æˆ‘å¯ä»¥è¢«è‡ªåŠ¨èšç„¦ï¼" />
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ å·¥ä½œåŸç†</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>forwardRef</strong> - Reactæä¾›çš„refè½¬å‘API</li>
          <li><strong>ä¼ é€’ref</strong> - HOCå°†refä¼ é€’ç»™åŒ…è£…ç»„ä»¶</li>
          <li><strong>è®¿é—®DOM</strong> - çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥æ“ä½œå­ç»„ä»¶çš„DOM</li>
          <li><strong>displayName</strong> - ä¾¿äºè°ƒè¯•çš„ç»„ä»¶åç§°</li>
        </ul>
      </div>

      <div style={{
        marginTop: '15px',
        padding: '12px',
        background: '#fff3e0',
        borderRadius: '6px',
        fontSize: '13px',
        color: '#e65100'
      }}>
        <strong>ğŸ’¡ æç¤ºï¼š</strong> åˆ·æ–°é¡µé¢å¯ä»¥çœ‹åˆ°è¾“å…¥æ¡†è‡ªåŠ¨è·å¾—ç„¦ç‚¹
      </div>
    </div>
  );
}
`}
  scope={{ React, forwardRef }}
/>

### 4.3 ç»§æ‰¿Propsä»£ç†æ¨¡å¼

<LiveCode
  code={`
function PropsProxyDemo() {
  // Propsä»£ç†HOC - æ“ä½œprops
  const withPropsProxy = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      // 1. æ“ä½œä¼ å…¥çš„props
      const modifiedProps = {
        ...props,
        className: \`enhanced \${props.className || ''}\`,
        style: {
          ...props.style,
          background: '#2196f3',
          color: 'white',
          border: 'none',
          borderRadius: '8px',
          padding: '12px 24px',
          fontSize: '16px',
          fontWeight: 'bold',
          cursor: 'pointer',
          transition: 'all 0.3s',
          boxShadow: '0 4px 6px rgba(33, 150, 243, 0.3)',
          transform: 'scale(1)',
          ...props.style
        },
        onClick: (e) => {
          // å¢å¼ºç‚¹å‡»äº‹ä»¶
          console.log('ğŸš€ Enhanced click triggered!');
          if (props.onClick) {
            props.onClick(e);
          }
        }
      };

      // 2. æ·»åŠ é¢å¤–props
      const addedProps = {
        'data-enhanced': 'true',
        'data-theme': 'enhanced',
        title: 'This is an enhanced button!'
      };

      // 3. æ¸²æŸ“åŒ…è£…ç»„ä»¶
      return <WrappedComponent {...modifiedProps} {...addedProps} />;
    };
  };

  // åŸå§‹Buttonç»„ä»¶
  const Button = ({ children, className, style, onClick, title, ...rest }) => {
    return (
      <button
        className={className}
        style={style}
        onClick={onClick}
        title={title}
        {...rest}
      >
        {children}
      </button>
    );
  };

  // åˆ›å»ºå¢å¼ºButton
  const EnhancedButton = withPropsProxy(Button);

  // çŠ¶æ€
  const [clickCount, setClickCount] = React.useState(0);
  const [logs, setLogs] = React.useState([]);

  const handleOriginalClick = () => {
    setClickCount(c => c + 1);
    setLogs(prev => [...prev, { time: new Date().toLocaleTimeString(), type: 'original', message: 'Original button clicked' }]);
  };

  const handleEnhancedClick = (e) => {
    setClickCount(c => c + 1);
    setLogs(prev => [...prev, { time: new Date().toLocaleTimeString(), type: 'enhanced', message: 'Enhanced button clicked!' }]);

    // è§†è§‰åé¦ˆ
    e.target.style.transform = 'scale(0.95)';
    setTimeout(() => {
      e.target.style.transform = 'scale(1)';
    }, 200);
  };

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ”§ Propsä»£ç†æ¨¡å¼ç¤ºä¾‹</h3>

      <p style={{ margin: '10px 0', fontSize: '14px', color: '#666' }}>
        <strong>åŠŸèƒ½ï¼š</strong>HOCå¯ä»¥ä¿®æ”¹ç°æœ‰propsã€æ·»åŠ æ–°propsï¼Œå¹¶å¢å¼ºç»„ä»¶è¡Œä¸º
      </p>

      <div style={{ marginTop: '20px' }}>
        <h4>å¯¹æ¯”æ•ˆæœï¼š</h4>
        <div style={{ display: 'flex', gap: '20px', marginTop: '15px', flexWrap: 'wrap' }}>
          <div style={{ flex: '1', minWidth: '200px' }}>
            <h5 style={{ margin: '0 0 10px 0', color: '#999' }}>åŸå§‹Button</h5>
            <Button onClick={handleOriginalClick}>
              æ™®é€šæŒ‰é’®
            </Button>
          </div>

          <div style={{ flex: '1', minWidth: '200px' }}>
            <h5 style={{ margin: '0 0 10px 0', color: '#2196f3' }}>å¢å¼ºButton (withPropsProxy)</h5>
            <EnhancedButton onClick={handleEnhancedClick}>
              âœ¨ å¢å¼ºæŒ‰é’®
            </EnhancedButton>
            <p style={{ margin: '10px 0 0 0', fontSize: '12px', color: '#2196f3' }}>
              âœ“ è“è‰²èƒŒæ™¯<br/>
              âœ“ å¢å¼ºæ ·å¼<br/>
              âœ“ å¢å¼ºç‚¹å‡»äº‹ä»¶<br/>
              âœ“ é¢å¤–å±æ€§
            </p>
          </div>
        </div>
      </div>

      <div style={{
        marginTop: '25px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        border: '1px solid #ddd'
      }}>
        <h5 style={{ margin: '0 0 10px 0' }}>ç‚¹å‡»ç»Ÿè®¡ï¼š</h5>
        <p style={{ margin: '5px 0', fontSize: '14px' }}>
          <strong>æ€»ç‚¹å‡»æ•°ï¼š</strong> {clickCount}
        </p>
      </div>

      {logs.length > 0 && (
        <div style={{
          marginTop: '15px',
          padding: '15px',
          background: '#fff',
          borderRadius: '8px',
          border: '1px solid #ddd',
          maxHeight: '200px',
          overflowY: 'auto'
        }}>
          <h5 style={{ margin: '0 0 10px 0' }}>æ“ä½œæ—¥å¿—ï¼š</h5>
          {logs.slice(-5).map((log, index) => (
            <div key={index} style={{
              padding: '8px',
              background: log.type === 'enhanced' ? '#e3f2fd' : '#f5f5f5',
              borderRadius: '4px',
              marginBottom: '5px',
              fontSize: '13px'
            }}>
              <strong>{log.time}</strong> - {log.message}
            </div>
          ))}
        </div>
      )}

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#e8f5e9',
        borderRadius: '8px',
        border: '2px solid #4caf50'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#2e7d32' }}>ğŸ’¡ Propsä»£ç†ç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>ä¿®æ”¹props</strong> - å¯ä»¥ä¿®æ”¹ç°æœ‰propsçš„å€¼å’Œè¡Œä¸º</li>
          <li><strong>æ·»åŠ props</strong> - ä¸ºç»„ä»¶æ·»åŠ æ–°çš„å±æ€§</li>
          <li><strong>å¢å¼ºäº‹ä»¶</strong> - åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ·»åŠ é¢å¤–é€»è¾‘</li>
          <li><strong>æ¡ä»¶æ¸²æŸ“</strong> - æ ¹æ®æ¡ä»¶å†³å®šå¦‚ä½•æ¸²æŸ“</li>
          <li><strong>æ€§èƒ½ä¼˜åŒ–</strong> - å¯ä»¥ä¼˜åŒ–propsä¼ é€’</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 4.4 ç»§æ‰¿åå‘ä»£ç†æ¨¡å¼

<LiveCode
  code={`
function LifecycleProxyDemo() {
  // åå‘ä»£ç†HOC - åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼ˆç±»ç»„ä»¶æ¨¡å¼ï¼‰
  const withLifecycleProxy = (WrappedComponent) => {
    return class EnhancedComponent extends WrappedComponent {
      componentDidMount() {
        console.log('âœ… Enhanced component did mount');
        if (super.componentDidMount) {
          super.componentDidMount();
        }
      }

      componentWillUnmount() {
        console.log('âŒ Enhanced component will unmount');
        if (super.componentWillUnmount) {
          super.componentWillUnmount();
        }
      }

      render() {
        const element = super.render();
        // å¢å¼ºæ¸²æŸ“çš„ç»„ä»¶
        return React.cloneElement(element, {
          style: {
            ...element.props.style,
            border: '3px solid #ff9800',
            borderRadius: '8px',
            padding: '20px',
            background: '#fff3e0'
          }
        });
      }
    };
  };

  // åŸå§‹ç±»ç»„ä»¶
  class UserProfile extends React.Component {
    componentDidMount() {
      console.log('ğŸ“¦ UserProfile mounted');
    }

    componentWillUnmount() {
      console.log('ğŸ“¦ UserProfile unmounted');
    }

    render() {
      return (
        <div style={{ textAlign: 'center' }}>
          <h3 style={{ margin: '0 0 10px 0', color: '#ff9800' }}>
            ğŸ‘¤ ç”¨æˆ·èµ„æ–™
          </h3>
          <p style={{ margin: '5px 0', color: '#666' }}>
            å§“å: Alice Johnson
          </p>
          <p style={{ margin: '5px 0', color: '#666' }}>
            é‚®ç®±: alice@example.com
          </p>
        </div>
      );
    }
  }

  // åˆ›å»ºå¢å¼ºçš„UserProfile
  const EnhancedUserProfile = withLifecycleProxy(UserProfile);

  // çŠ¶æ€
  const [isVisible, setIsVisible] = React.useState(true);
  const [logs, setLogs] = React.useState([]);

  React.useEffect(() => {
    if (isVisible) {
      setLogs(prev => [...prev, {
        time: new Date().toLocaleTimeString(),
        message: 'âœ… Enhanced UserProfile mounted (check console)',
        type: 'mount'
      }]);
    } else {
      setLogs(prev => [...prev, {
        time: new Date().toLocaleTimeString(),
        message: 'âŒ Enhanced UserProfile unmounted (check console)',
        type: 'unmount'
      }]);
    }
  }, [isVisible]);

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>
      <h3 style={{ marginTop: 0 }}>âš™ï¸ ç”Ÿå‘½å‘¨æœŸä»£ç†æ¨¡å¼ç¤ºä¾‹</h3>

      <p style={{ margin: '10px 0', fontSize: '14px', color: '#666' }}>
        <strong>è¯´æ˜ï¼š</strong>é€šè¿‡ç»§æ‰¿åŒ…è£…ç»„ä»¶æ¥åŠ«æŒç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆç±»ç»„ä»¶æ¨¡å¼ï¼‰
      </p>

      <div style={{ marginTop: '20px' }}>
        <button
          onClick={() => setIsVisible(!isVisible)}
          style={{
            padding: '10px 20px',
            background: isVisible ? '#f44336' : '#4caf50',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontSize: '16px',
            fontWeight: 'bold',
            marginBottom: '20px'
          }}
        >
          {isVisible ? 'ğŸš« å¸è½½ç»„ä»¶' : 'âœ… æŒ‚è½½ç»„ä»¶'}
        </button>

        {isVisible && (
          <div style={{
            padding: '10px',
            background: '#e3f2fd',
            borderRadius: '8px',
            border: '2px solid #2196f3'
          }}>
            <EnhancedUserProfile />
          </div>
        )}
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff',
        borderRadius: '8px',
        border: '1px solid #ddd',
        maxHeight: '250px',
        overflowY: 'auto'
      }}>
        <h5 style={{ margin: '0 0 10px 0' }}>ç”Ÿå‘½å‘¨æœŸæ—¥å¿—ï¼š</h5>
        {logs.length === 0 ? (
          <p style={{ margin: '0', color: '#999', fontSize: '14px' }}>
            ç‚¹å‡»"æŒ‚è½½ç»„ä»¶"æŸ¥çœ‹ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
          </p>
        ) : (
          logs.map((log, index) => (
            <div key={index} style={{
              padding: '10px',
              background: log.type === 'mount' ? '#e8f5e9' : '#ffebee',
              borderRadius: '4px',
              marginBottom: '8px',
              fontSize: '13px',
              border: \`1px solid ${log.type === 'mount' ? '#4caf50' : '#f44336'}\`
            }}>
              <strong>{log.time}</strong> - {log.message}
            </div>
          ))
        )}
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ ç”Ÿå‘½å‘¨æœŸä»£ç†ç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>ç±»ç»„ä»¶æ¨¡å¼</strong> - é€šè¿‡ç»§æ‰¿æ¥åŠ«æŒç”Ÿå‘½å‘¨æœŸ</li>
          <li><strong>æ–¹æ³•è¦†ç›–</strong> - é‡å†™componentDidMountç­‰æ–¹æ³•</li>
          <li><strong>superè°ƒç”¨</strong> - è°ƒç”¨çˆ¶ç±»æ–¹æ³•ä¿æŒåŠŸèƒ½</li>
          <li><strong>æ¸²æŸ“å¢å¼º</strong> - å¯ä»¥ä¿®æ”¹æ¸²æŸ“ç»“æœ</li>
          <li><strong>âš ï¸ ä¸æ¨è</strong> - Hooksæä¾›äº†æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆ</li>
        </ul>
      </div>

      <div style={{
        marginTop: '15px',
        padding: '12px',
        background: '#ffebee',
        borderRadius: '6px',
        fontSize: '13px',
        color: '#c62828',
        border: '1px solid #f44336'
      }}>
        <strong>âš ï¸ æ³¨æ„ï¼š</strong> è¿™ç§æ¨¡å¼åœ¨ç°ä»£Reactä¸­å·²ä¸æ¨èã€‚Hooksï¼ˆuseEffectç­‰ï¼‰æä¾›äº†æ›´ç®€æ´ã€æ›´æ˜“ç»´æŠ¤çš„æ›¿ä»£æ–¹æ¡ˆã€‚ä»…ç”¨äºç†è§£æ¦‚å¿µã€‚
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 5. HOC vs Hooks

### 5.1 å¯¹æ¯”åˆ†æ

<Compare>

```jsx
// ä½¿ç”¨HOCçš„ä»£ç 
function withUser(WrappedComponent) {
  return function EnhancedComponent(props) {
    const { data, loading } = useUser();
    return <WrappedComponent {...props} user={data} loading={loading} />;
  };
}

const UserProfile = withUser(({ user, loading }) => {
  if (loading) return <div>Loading...</div>;
  return <div>{user.name}</div>;
});

// ä½¿ç”¨Hooksçš„ä»£ç 
function useUser() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchUser().then(setData);
  }, []);

  return { data, loading };
}

function UserProfile() {
  const { data: user, loading } = useUser();

  if (loading) return <div>Loading...</div>;
  return <div>{user.name}</div>;
}
```

</Compare>

### 5.2 é€‰æ‹©æŒ‡å—

<CodeBlock>

```jsx
// æ¨èä½¿ç”¨Hooksçš„åœºæ™¯
1. çŠ¶æ€é€»è¾‘å¤ç”¨ -> useState, useReducer
2. å‰¯ä½œç”¨é€»è¾‘ -> useEffect
3. ä¸Šä¸‹æ–‡å…±äº« -> useContext
4. æ€§èƒ½ä¼˜åŒ– -> useMemo, useCallback
5. è‡ªå®šä¹‰Hook -> åˆ›å»ºuseXxxå‡½æ•°

// æ¨èä½¿ç”¨HOCçš„åœºæ™¯
1. åº“å¼€å‘ (å¦‚Redux connect)
2. æ ·å¼å¢å¼º
3. ç±»ç»„ä»¶é¡¹ç›®
4. è·¨ç»„ä»¶æ ‘çš„åŠŸèƒ½æ³¨å…¥
```

</CodeBlock>

### 5.3 Hooksçš„ä¼˜åŠ¿

<CodeBlock>

```jsx
// Hooksä¼˜åŠ¿
1. æ›´å¥½çš„ç±»å‹æ”¯æŒ (TypeScript)
2. é¿å…åµŒå¥—åœ°ç‹±
3. ä¸å¼•å…¥é¢å¤–ç»„ä»¶å±‚çº§
4. æ›´çµæ´»çš„ç»„åˆæ–¹å¼
5. æ›´å¥½çš„è°ƒè¯•ä½“éªŒ
6. æ€§èƒ½æ›´å¥½ (æ— é¢å¤–ç»„ä»¶)

// HOCå±€é™
1. å‘½åå†²çª
2. ç»„ä»¶å±‚çº§å¢åŠ 
3. éš¾ä»¥ç†è§£propsæ¥æº
4. å¯èƒ½å¯¼è‡´é‡å¤æ¸²æŸ“
5. éš¾ä»¥è°ƒè¯•
```

</CodeBlock>

---

## 6. å®é™…åº”ç”¨åœºæ™¯

### 6.1 æƒé™æ§åˆ¶HOC

<LiveCode
  code={`
function AuthorizationHOEDemo() {
  // æ¨¡æ‹Ÿç”¨æˆ·çŠ¶æ€
  const [currentUser, setCurrentUser] = React.useState({
    name: 'Guest User',
    role: 'guest'
  });
  const [loading, setLoading] = React.useState(false);

  // æ¨¡æ‹Ÿç™»å½•
  const loginAs = (role) => {
    setLoading(true);
    setTimeout(() => {
      const userMap = {
        admin: { name: 'Admin User', role: 'admin' },
        user: { name: 'Regular User', role: 'user' },
        guest: { name: 'Guest User', role: 'guest' }
      };
      setCurrentUser(userMap[role] || userMap.guest);
      setLoading(false);
    }, 500);
  };

  // æƒé™æ§åˆ¶HOC
  const withAuthorization = (requiredRole) => {
    return (WrappedComponent) => {
      return function AuthorizedComponent(props) {
        if (loading) {
          return (
            <div style={{
              padding: '20px',
              background: '#fff3e0',
              borderRadius: '8px',
              textAlign: 'center'
            }}>
              <div style={{ fontSize: '24px', marginBottom: '10px' }}>â³</div>
              <p style={{ margin: 0, color: '#e65100' }}>æ­£åœ¨æ£€æŸ¥æƒé™...</p>
            </div>
          );
        }

        if (!currentUser || currentUser.role === 'guest') {
          return (
            <div style={{
              padding: '20px',
              background: '#ffebee',
              borderRadius: '8px',
              border: '2px solid #f44336',
              textAlign: 'center'
            }}>
              <div style={{ fontSize: '24px', marginBottom: '10px' }}>ğŸ”’</div>
              <h3 style={{ margin: '0 0 10px 0', color: '#c62828' }}>æœªç™»å½•</h3>
              <p style={{ margin: 0, color: '#666' }}>è¯·å…ˆç™»å½•ä»¥è®¿é—®æ­¤å†…å®¹</p>
            </div>
          );
        }

        if (currentUser.role !== requiredRole) {
          return (
            <div style={{
              padding: '20px',
              background: '#ffebee',
              borderRadius: '8px',
              border: '2px solid #f44336'
            }}>
              <h3 style={{ margin: '0 0 15px 0', color: '#c62828' }}>
                â›” è®¿é—®è¢«æ‹’ç»
              </h3>
              <div style={{ background: 'white', padding: '15px', borderRadius: '4px' }}>
                <p style={{ margin: '5px 0' }}>
                  <strong>æ‰€éœ€è§’è‰²ï¼š</strong> {requiredRole}
                </p>
                <p style={{ margin: '5px 0' }}>
                  <strong>æ‚¨çš„è§’è‰²ï¼š</strong> {currentUser.role}
                </p>
                <p style={{ margin: '5px 0', color: '#666' }}>
                  æ‚¨æ²¡æœ‰æƒé™æŸ¥çœ‹æ­¤é¡µé¢
                </p>
              </div>
            </div>
          );
        }

        return <WrappedComponent {...props} user={currentUser} />;
      };
    };
  };

  // æ¨¡æ‹Ÿç»„ä»¶
  const Dashboard = ({ user }) => (
    <div style={{
      padding: '20px',
      background: '#e8f5e9',
      borderRadius: '8px',
      border: '2px solid #4caf50'
    }}>
      <h3 style={{ margin: '0 0 10px 0', color: '#2e7d32' }}>
        ğŸ“Š ç®¡ç†å‘˜ä»ªè¡¨ç›˜
      </h3>
      <p style={{ margin: 0 }}>æ¬¢è¿, {user.name}!</p>
      <div style={{
        marginTop: '15px',
        padding: '10px',
        background: 'white',
        borderRadius: '4px'
      }}>
        <p style={{ margin: '5px 0' }}>âœ“ ç”¨æˆ·ç®¡ç†</p>
        <p style={{ margin: '5px 0' }}>âœ“ ç³»ç»Ÿè®¾ç½®</p>
        <p style={{ margin: '5px 0' }}>âœ“ æƒé™æ§åˆ¶</p>
      </div>
    </div>
  );

  const AdminPanel = ({ user }) => (
    <div style={{
      padding: '20px',
      background: '#f3e5f5',
      borderRadius: '8px',
      border: '2px solid #9c27b0'
    }}>
      <h3 style={{ margin: '0 0 10px 0', color: '#6a1b9a' }}>
        ğŸ‘‘ è¶…çº§ç”¨æˆ·é¢æ¿
      </h3>
      <p style={{ margin: 0 }}>æ¬¢è¿, {user.name}!</p>
      <div style={{
        marginTop: '15px',
        padding: '10px',
        background: 'white',
        borderRadius: '4px'
      }}>
        <p style={{ margin: '5px 0' }}>âœ“ æ‰€æœ‰æƒé™</p>
        <p style={{ margin: '5px 0' }}>âœ“ ç³»ç»Ÿé…ç½®</p>
        <p style={{ margin: '5px 0' }}>âœ“ é«˜çº§è®¾ç½®</p>
      </div>
    </div>
  );

  const UserProfile = ({ user }) => (
    <div style={{
      padding: '20px',
      background: '#e3f2fd',
      borderRadius: '8px',
      border: '2px solid #2196f3'
    }}>
      <h3 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>
        ğŸ‘¤ ç”¨æˆ·èµ„æ–™
      </h3>
      <p style={{ margin: 0 }}>æ¬¢è¿, {user.name}!</p>
      <div style={{
        marginTop: '15px',
        padding: '10px',
        background: 'white',
        borderRadius: '4px'
      }}>
        <p style={{ margin: '5px 0' }}>âœ“ æŸ¥çœ‹ä¸ªäººä¿¡æ¯</p>
        <p style={{ margin: '5px 0' }}>âœ“ ç¼–è¾‘èµ„æ–™</p>
      </div>
    </div>
  );

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const AdminDashboard = withAuthorization('admin')(Dashboard);
  const SuperUserPanel = withAuthorization('superuser')(AdminPanel);
  const UserDashboard = withAuthorization('user')(UserProfile);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ” æƒé™æ§åˆ¶HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        display: 'flex',
        gap: '10px',
        flexWrap: 'wrap'
      }}>
        <button
          onClick={() => loginAs('guest')}
          style={{
            padding: '8px 16px',
            background: currentUser.role === 'guest' ? '#f44336' : 'white',
            color: currentUser.role === 'guest' ? 'white' : '#333',
            border: '2px solid #f44336',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          ğŸ‘¤ ä»¥è®¿å®¢èº«ä»½ç™»å½•
        </button>
        <button
          onClick={() => loginAs('user')}
          style={{
            padding: '8px 16px',
            background: currentUser.role === 'user' ? '#2196f3' : 'white',
            color: currentUser.role === 'user' ? 'white' : '#333',
            border: '2px solid #2196f3',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          ğŸ‘¤ ä»¥æ™®é€šç”¨æˆ·èº«ä»½ç™»å½•
        </button>
        <button
          onClick={() => loginAs('admin')}
          style={{
            padding: '8px 16px',
            background: currentUser.role === 'admin' ? '#4caf50' : 'white',
            color: currentUser.role === 'admin' ? 'white' : '#333',
            border: '2px solid #4caf50',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          ğŸ‘‘ ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•
        </button>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4>å½“å‰ç”¨æˆ·ï¼š{currentUser.name} (è§’è‰²: {currentUser.role})</h4>
      </div>

      <div style={{ display: 'grid', gap: '15px' }}>
        <AdminDashboard />
        <SuperUserPanel />
        <UserDashboard />
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ HOCå·¥ä½œåŸç†</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>æƒé™æ£€æŸ¥</strong> - åœ¨æ¸²æŸ“å‰éªŒè¯ç”¨æˆ·è§’è‰²</li>
          <li><strong>æ¡ä»¶æ¸²æŸ“</strong> - æ ¹æ®æƒé™æ˜¾ç¤ºæˆ–éšè—ç»„ä»¶</li>
          <li><strong>é”™è¯¯å¤„ç†</strong> - æä¾›å‹å¥½çš„æ‹’ç»è®¿é—®æç¤º</li>
          <li><strong>å¤ç”¨æ€§å¼º</strong> - ä»»ä½•ç»„ä»¶éƒ½å¯ä»¥å¿«é€Ÿæ·»åŠ æƒé™æ§åˆ¶</li>
          <li><strong>è§£è€¦é€»è¾‘</strong> - æƒé™é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 6.2 æ•°æ®ç¼“å­˜HOC

<LiveCode
  code={`
function DataCachingHOEDemo() {
  // æ¨¡æ‹Ÿç¼“å­˜å­˜å‚¨
  const cache = React.useRef(new Map());

  // æ¨¡æ‹ŸAPIè°ƒç”¨
  const fetchUsers = () => {
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve([
          { id: 1, name: 'Alice', email: 'alice@example.com' },
          { id: 2, name: 'Bob', email: 'bob@example.com' },
          { id: 3, name: 'Charlie', email: 'charlie@example.com' }
        ]);
      }, 1000);
    });
  };

  const fetchPosts = () => {
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve([
          { id: 1, title: 'Post 1', content: 'Content 1' },
          { id: 2, title: 'Post 2', content: 'Content 2' }
        ]);
      }, 800);
    });
  };

  // ç¼“å­˜å·¥å…·å‡½æ•°
  const getFromCache = (key) => {
    return cache.current.get(key);
  };

  const saveToCache = (key, data) => {
    cache.current.set(key, data);
  };

  // æ™ºèƒ½ç¼“å­˜HOC
  const withCache = (WrappedComponent, options = {}) => {
    const { ttl = 5000 } = options; // é»˜è®¤5ç§’ç¼“å­˜

    return function CachedComponent(props) {
      const [data, setData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState(null);
      const [lastFetch, setLastFetch] = React.useState(0);
      const [fetchCount, setFetchCount] = React.useState(0);

      const { cacheKey, fetcher, refetch = false } = props;

      const fetchData = React.useCallback(async (force = false) => {
        const now = Date.now();
        const cachedData = getFromCache(cacheKey);

        // ä½¿ç”¨ç¼“å­˜
        if (!force && cachedData && now - lastFetch < ttl) {
          console.log('ğŸ“¦ ä½¿ç”¨ç¼“å­˜æ•°æ®');
          setData(cachedData);
          setLoading(false);
          return;
        }

        try {
          setLoading(true);
          setError(null);
          const result = await fetcher();
          setData(result);
          setLastFetch(now);
          setFetchCount(prev => prev + 1);
          saveToCache(cacheKey, result);
          console.log('ğŸŒ ä»APIè·å–æ•°æ®');
        } catch (err) {
          setError(err);
        } finally {
          setLoading(false);
        }
      }, [cacheKey, fetcher, lastFetch, ttl]);

      React.useEffect(() => {
        fetchData(refetch);
      }, [fetchData, refetch]);

      return (
        <WrappedComponent
          {...props}
          data={data}
          loading={loading}
          error={error}
          refetch={() => fetchData(true)}
          fetchCount={fetchCount}
          isCached={!!getFromCache(cacheKey)}
        />
      );
    };
  };

  // ç”¨æˆ·åˆ—è¡¨ç»„ä»¶
  const UserList = ({ data, loading, error, refetch, fetchCount }) => {
    if (loading) {
      return (
        <div style={{
          padding: '20px',
          background: '#fff3e0',
          borderRadius: '8px',
          border: '2px solid #ff9800',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '24px', marginBottom: '10px' }}>â³</div>
          <p style={{ margin: 0, color: '#e65100' }}>åŠ è½½ä¸­...</p>
        </div>
      );
    }

    if (error) {
      return (
        <div style={{
          padding: '20px',
          background: '#ffebee',
          borderRadius: '8px',
          border: '2px solid #f44336',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '24px', marginBottom: '10px' }}>âŒ</div>
          <p style={{ margin: 0, color: '#c62828' }}>åŠ è½½å¤±è´¥: {error.message}</p>
        </div>
      );
    }

    return (
      <div style={{
        padding: '20px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
          <h3 style={{ margin: 0, color: '#1976d2' }}>ğŸ“‹ ç”¨æˆ·åˆ—è¡¨</h3>
          <div>
            <span style={{
              padding: '4px 8px',
              background: '#4caf50',
              color: 'white',
              borderRadius: '4px',
              fontSize: '12px',
              marginRight: '5px'
            }}>
              æå–æ¬¡æ•°: {fetchCount}
            </span>
            <button
              onClick={refetch}
              style={{
                padding: '4px 12px',
                background: '#2196f3',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '12px'
              }}
            >
              ğŸ”„ é‡æ–°è·å–
            </button>
          </div>
        </div>
        <div style={{ background: 'white', borderRadius: '4px', padding: '10px' }}>
          {data.map(user => (
            <div key={user.id} style={{
              padding: '10px',
              borderBottom: '1px solid #e0e0e0',
              display: 'flex',
              justifyContent: 'space-between'
            }}>
              <div>
                <div style={{ fontWeight: 'bold' }}>{user.name}</div>
                <div style={{ fontSize: '12px', color: '#666' }}>{user.email}</div>
              </div>
              <div style={{
                width: '8px',
                height: '8px',
                background: '#4caf50',
                borderRadius: '50%',
                alignSelf: 'center'
              }} />
            </div>
          ))}
        </div>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const UserListWithCache = withCache(UserList, { ttl: 5000 });

  // çŠ¶æ€ç®¡ç†
  const [reloadKey, setReloadKey] = React.useState(0);
  const [currentFetcher, setCurrentFetcher] = React.useState('users');

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ’¾ æ•°æ®ç¼“å­˜HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px',
        display: 'flex',
        gap: '10px',
        flexWrap: 'wrap'
      }}>
        <button
          onClick={() => {
            setCurrentFetcher('users');
            setReloadKey(prev => prev + 1);
          }}
          style={{
            padding: '8px 16px',
            background: currentFetcher === 'users' ? '#2196f3' : 'white',
            color: currentFetcher === 'users' ? 'white' : '#333',
            border: '2px solid #2196f3',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          ğŸ‘¥ åŠ è½½ç”¨æˆ·åˆ—è¡¨
        </button>
        <button
          onClick={() => {
            cache.current.clear();
            alert('ç¼“å­˜å·²æ¸…ç©ºï¼å†æ¬¡ç‚¹å‡»"åŠ è½½ç”¨æˆ·åˆ—è¡¨"å°†ä»APIè·å–æ•°æ®');
          }}
          style={{
            padding: '8px 16px',
            background: '#ff9800',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          ğŸ—‘ï¸ æ¸…ç©ºç¼“å­˜
        </button>
      </div>

      <div style={{
        marginBottom: '15px',
        padding: '12px',
        background: '#e8f5e9',
        borderRadius: '6px',
        border: '1px solid #4caf50',
        fontSize: '14px'
      }}>
        <p style={{ margin: '5px 0' }}>
          <strong>ğŸ’¡ ç¼“å­˜ç­–ç•¥ï¼š</strong> 5ç§’å†…é‡å¤è¯·æ±‚å°†ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œè¶…æ—¶åé‡æ–°è·å–
        </p>
        <p style={{ margin: '5px 0' }}>
          <strong>ğŸ” æµ‹è¯•æ–¹æ³•ï¼š</strong> ç‚¹å‡»"åŠ è½½ç”¨æˆ·åˆ—è¡¨"ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡åº”è¯¥ä»ç¼“å­˜åŠ è½½ï¼Œé€Ÿåº¦æ›´å¿«
        </p>
      </div>

      {currentFetcher === 'users' && (
        <UserListWithCache
          key={reloadKey}
          cacheKey="user-list"
          fetcher={fetchUsers}
        />
      )}

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ ç¼“å­˜HOCç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>TTLæœºåˆ¶</strong> - å¯é…ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</li>
          <li><strong>æ™ºèƒ½æ£€æŸ¥</strong> - è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜</li>
          <li><strong>å¼ºåˆ¶åˆ·æ–°</strong> - æ”¯æŒæ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½</li>
          <li><strong>é”™è¯¯å¤„ç†</strong> - ä¼˜é›…å¤„ç†ç½‘ç»œé”™è¯¯</li>
          <li><strong>æ€§èƒ½ä¼˜åŒ–</strong> - å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨</li>
          <li><strong>åŠ è½½çŠ¶æ€</strong> - æä¾›å‹å¥½çš„åŠ è½½æç¤º</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 6.3 ä¸»é¢˜åˆ‡æ¢HOC

<LiveCode
  code={`
function ThemeSwitchingHOEDemo() {
  // ä¸»é¢˜HOC
  const withTheme = (WrappedComponent) => {
    return function ThemedComponent(props) {
      const [theme, setTheme] = React.useState('light');
      const [history, setHistory] = React.useState(['light']);

      const toggleTheme = React.useCallback(() => {
        setTheme(prevTheme => {
          const newTheme = prevTheme === 'light' ? 'dark' : 'light';
          setHistory(prev => [...prev, newTheme]);
          return newTheme;
        });
      }, []);

      // è·å–ä¸»é¢˜é¢œè‰²
      const getThemeColors = (currentTheme) => {
        return currentTheme === 'dark'
          ? {
              background: '#1a1a1a',
              surface: '#2d2d2d',
              text: '#ffffff',
              textSecondary: '#b0b0b0',
              border: '#404040',
              primary: '#4a9eff'
            }
          : {
              background: '#ffffff',
              surface: '#f5f5f5',
              text: '#333333',
              textSecondary: '#666666',
              border: '#dddddd',
              primary: '#2196f3'
            };
      };

      const colors = getThemeColors(theme);

      const themeProps = {
        theme,
        toggleTheme,
        isDark: theme === 'dark',
        colors
      };

      return <WrappedComponent {...props} {...themeProps} />;
    };
  };

  // å¤´éƒ¨ç»„ä»¶
  const Header = ({ theme, toggleTheme, isDark, colors }) => {
    return (
      <div style={{
        marginBottom: '20px',
        borderRadius: '8px',
        overflow: 'hidden',
        boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
      }}>
        <div style={{
          background: colors.background,
          padding: '0'
        }}>
          <div style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            padding: '20px 30px',
            background: colors.surface,
            borderBottom: \`2px solid \${colors.border}\`
          }}>
            <h1 style={{
              margin: 0,
              fontSize: '24px',
              color: colors.text,
              display: 'flex',
              alignItems: 'center',
              gap: '10px'
            }}>
              ğŸš€ MyApp
            </h1>
            <button
              onClick={toggleTheme}
              style={{
                padding: '10px 20px',
                fontSize: '18px',
                border: \`2px solid \${colors.border}\`,
                borderRadius: '8px',
                background: colors.primary,
                color: 'white',
                cursor: 'pointer',
                transition: 'all 0.3s ease',
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                fontWeight: 'bold',
                boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
              }}
            >
              {isDark ? 'ğŸŒ äº®è‰²æ¨¡å¼' : 'ğŸŒ™ æ·±è‰²æ¨¡å¼'}
            </button>
          </div>
          <div style={{ padding: '30px', background: colors.background }}>
            <p style={{
              margin: '0 0 10px 0',
              color: colors.text,
              fontSize: '16px',
              lineHeight: '1.6'
            }}>
              æ¬¢è¿ä½¿ç”¨ React å­¦ä¹ ä¸­å¿ƒï¼è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºä¸»é¢˜åˆ‡æ¢åŠŸèƒ½çš„ç¤ºä¾‹ã€‚
            </p>
            <div style={{
              display: 'flex',
              gap: '10px',
              flexWrap: 'wrap',
              marginTop: '15px'
            }}>
              <span style={{
                padding: '6px 12px',
                background: colors.surface,
                borderRadius: '6px',
                color: colors.text,
                fontSize: '14px',
                border: \`1px solid \${colors.border}\`
              }}>
                ğŸ“š å­¦ä¹ èµ„æº
              </span>
              <span style={{
                padding: '6px 12px',
                background: colors.surface,
                borderRadius: '6px',
                color: colors.text,
                fontSize: '14px',
                border: \`1px solid \${colors.border}\`
              }}>
                ğŸ¯ å®æˆ˜é¡¹ç›®
              </span>
              <span style={{
                padding: '6px 12px',
                background: colors.surface,
                borderRadius: '6px',
                color: colors.text,
                fontSize: '14px',
                border: \`1px solid \${colors.border}\`
              }}>
                ğŸ’¡ æœ€ä½³å®è·µ
              </span>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const ThemedHeader = withTheme(Header);

  // ä¸»é¢˜çŠ¶æ€æ˜¾ç¤ºå™¨
  const ThemeStatus = ({ isDark, colors }) => {
    return (
      <div style={{
        padding: '20px',
        background: colors.background,
        borderRadius: '8px',
        border: \`2px solid \${colors.border}\`,
        marginBottom: '20px'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: colors.text }}>ğŸ“Š ä¸»é¢˜çŠ¶æ€</h4>
        <div style={{ display: 'flex', gap: '20px', flexWrap: 'wrap' }}>
          <div style={{ flex: '1', minWidth: '200px' }}>
            <div style={{
              padding: '15px',
              background: colors.surface,
              borderRadius: '6px',
              border: \`1px solid \${colors.border}\`
            }}>
              <p style={{ margin: '0', color: colors.textSecondary, fontSize: '14px' }}>
                å½“å‰ä¸»é¢˜
              </p>
              <p style={{ margin: '5px 0 0 0', color: colors.text, fontSize: '20px', fontWeight: 'bold' }}>
                {isDark ? 'ğŸŒ™ æ·±è‰²æ¨¡å¼' : 'â˜€ï¸ äº®è‰²æ¨¡å¼'}
              </p>
            </div>
          </div>
          <div style={{ flex: '2', minWidth: '300px' }}>
            <div style={{
              padding: '15px',
              background: colors.surface,
              borderRadius: '6px',
              border: \`1px solid \${colors.border}\`
            }}>
              <p style={{ margin: '0', color: colors.textSecondary, fontSize: '14px' }}>
                ä¸»é¢˜å†å²
              </p>
              <p style={{ margin: '5px 0 0 0', color: colors.text, fontSize: '16px' }}>
                {isDark ? 'æš— â†’ æ˜' : 'æ˜ â†’ æš—'}
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸»é¢˜çš„ç®€å•ç»„ä»¶
  const SimpleCard = ({ isDark, colors }) => {
    return (
      <div style={{
        padding: '20px',
        background: colors.background,
        borderRadius: '8px',
        border: \`2px solid \${colors.border}\`,
        marginTop: '20px'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: colors.text }}>ğŸ¨ ä¸»é¢˜åº”ç”¨ç¤ºä¾‹</h4>
        <p style={{ margin: '0 0 15px 0', color: colors.textSecondary, lineHeight: '1.6' }}>
          è¿™ä¸ªå¡ç‰‡ç»„ä»¶ä¹Ÿå—åˆ°äº†ä¸»é¢˜å˜åŒ–çš„å½±å“ã€‚æ‰€æœ‰ä½¿ç”¨ withTheme HOC å¢å¼ºçš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸»é¢˜ç›¸å…³çš„ propsã€‚
        </p>
        <button style={{
          padding: '10px 20px',
          background: colors.primary,
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          fontSize: '14px',
          fontWeight: 'bold'
        }}>
          âœ¨ ä¸»é¢˜åŒ–æŒ‰é’®
        </button>
      </div>
    );
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¨ ä¸»é¢˜åˆ‡æ¢HOCæ¼”ç¤º</h3>

      <ThemedHeader />
      <ThemeStatus isDark={false} colors={getThemeColors(theme)} />
      <SimpleCard isDark={theme === 'dark'} colors={getThemeColors(theme)} />

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ ä¸»é¢˜HOCç‰¹ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>çŠ¶æ€ç®¡ç†</strong> - ç»Ÿä¸€ç®¡ç†ä¸»é¢˜çŠ¶æ€</li>
          <li><strong>localStorageæŒä¹…åŒ–</strong> - ä¿å­˜ç”¨æˆ·åå¥½</li>
          <li><strong>DOMå±æ€§åº”ç”¨</strong> - å°†ä¸»é¢˜åº”ç”¨åˆ°document</li>
          <li><strong>Propsä¼ é€’</strong> - å‘åŒ…è£…ç»„ä»¶ä¼ é€’ä¸»é¢˜ä¿¡æ¯</li>
          <li><strong>å¯ç»„åˆæ€§</strong> - å¯ä»¥ä¸å…¶ä»–HOCç»„åˆä½¿ç”¨</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 7. æœ€ä½³å®è·µ

### 7.1 å‘½åçº¦å®š

<LiveCode
  code={`
function NamingConventionsDemo() {
  // âœ… å¥½çš„å‘½åçº¦å®šæ¼”ç¤º
  const goodNames = [
    { name: 'withAuth', description: 'ä½¿ç”¨ withXxx å‰ç¼€' },
    { name: 'withLoading', description: 'æ¸…æ™°æè¿°åŠŸèƒ½' },
    { name: 'withUserData', description: 'è¯´æ˜å¢å¼ºçš„æ•°æ®' }
  ];

  // âŒ é¿å…çš„å‘½å
  const badNames = [
    { name: 'auth', description: 'ç¼ºå°‘ with å‰ç¼€' },
    { name: 'makeAuth', description: 'ä¸æ¨èçš„ makeXxx' },
    { name: 'AuthHOC', description: 'é©¼å³°å‘½åï¼Œä¸æ¨è' }
  ];

  // âœ… æ¼”ç¤º displayName
  const [displayName, setDisplayName] = React.useState('UserProfile');

  const withAuth = (WrappedComponent) => {
    const EnhancedComponent = (props) => <WrappedComponent {...props} isAuthed={true} />;
    EnhancedComponent.displayName = \`withAuth(\${WrappedComponent.displayName || WrappedComponent.name || 'Component'})\`;
    return EnhancedComponent;
  };

  const getDisplayName = (WrappedComponent) => {
    return WrappedComponent.displayName || WrappedComponent.name || 'Component';
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ“ HOC å‘½åçº¦å®šæ¼”ç¤º</h3>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ¨èçš„å‘½åé£æ ¼</h4>
        <div style={{ display: 'grid', gap: '10px' }}>
          {goodNames.map((item, index) => (
            <div key={index} style={{
              padding: '12px',
              background: '#e8f5e9',
              border: '1px solid #4caf50',
              borderRadius: '6px'
            }}>
              <code style={{ color: '#2e7d32', fontSize: '16px', fontWeight: 'bold' }}>
                {item.name}
              </code>
              <p style={{ margin: '5px 0 0 0', color: '#666', fontSize: '14px' }}>
                {item.description}
              </p>
            </div>
          ))}
        </div>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#c62828' }}>âŒ é¿å…çš„å‘½åé£æ ¼</h4>
        <div style={{ display: 'grid', gap: '10px' }}>
          {badNames.map((item, index) => (
            <div key={index} style={{
              padding: '12px',
              background: '#ffebee',
              border: '1px solid #f44336',
              borderRadius: '6px'
            }}>
              <code style={{ color: '#c62828', fontSize: '16px', fontWeight: 'bold' }}>
                {item.name}
              </code>
              <p style={{ margin: '5px 0 0 0', color: '#666', fontSize: '14px' }}>
                {item.description}
              </p>
            </div>
          ))}
        </div>
      </div>

      <div>
        <h4 style={{ color: '#1976d2' }}>ğŸ” DisplayName æ¼”ç¤º</h4>
        <div style={{
          padding: '20px',
          background: '#e3f2fd',
          border: '2px solid #2196f3',
          borderRadius: '8px'
        }}>
          <div style={{ marginBottom: '15px' }}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>
              ç»„ä»¶åç§°ï¼š
            </label>
            <input
              type="text"
              value={displayName}
              onChange={(e) => setDisplayName(e.target.value)}
              style={{
                padding: '8px',
                fontSize: '14px',
                border: '1px solid #2196f3',
                borderRadius: '4px',
                width: '200px'
              }}
            />
          </div>
          <div style={{
            padding: '15px',
            background: 'white',
            borderRadius: '4px',
            fontFamily: 'monospace',
            fontSize: '14px'
          }}>
            <div style={{ marginBottom: '10px' }}>
              <strong>ç»„ä»¶åï¼š</strong> {displayName}
            </div>
            <div style={{ marginBottom: '10px' }}>
              <strong>getDisplayName ç»“æœï¼š</strong> {getDisplayName({ name: displayName })}
            </div>
            <div style={{
              padding: '10px',
              background: '#f5f5f5',
              borderRadius: '4px'
            }}>
              <strong>displayNameï¼š</strong>
              <span style={{ color: '#2196f3' }}>
                {" "}\`withAuth({displayName})\`
              </span>
            </div>
          </div>
        </div>
      </div>

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '1px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ å‘½åè§„èŒƒè¦ç‚¹</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>ä½¿ç”¨ <strong>withXxx</strong> å‰ç¼€ï¼Œæ¸…æ¥šè¡¨æ˜è¿™æ˜¯HOC</li>
          <li>ä¿æŒ <strong>ä¸€è‡´æ€§å’Œå¯è¯»æ€§</strong></li>
          <li>è®¾ç½® <strong>displayName</strong> ä¾¿äºè°ƒè¯•</li>
          <li>é¿å…ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆPascalCaseï¼‰</li>
          <li>æ¨èä½¿ç”¨ <strong>getDisplayName</strong> è¾…åŠ©å‡½æ•°</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 7.2 Propsä¼ é€’

<LiveCode
  code={`
function PropsPassingDemo() {
  // âœ… æ­£ç¡®ä¼ é€’æ‰€æœ‰props
  const withExtraProp = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      return <WrappedComponent {...props} extraProp="é€šè¿‡HOCæ·»åŠ çš„prop" />;
    };
  };

  // âŒ é”™è¯¯ - ä¸ä¼ é€’æœªä½¿ç”¨çš„props
  const withBrokenProp = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      const { age, ...otherProps } = props;
      return <WrappedComponent age={age} {...otherProps} extraProp="éƒ¨åˆ†ä¼ é€’" />;
    };
  };

  // æ¼”ç¤ºç»„ä»¶
  const DemoComponent = ({ name, age, city, extraProp, ...rest }) => {
    return (
      <div style={{
        padding: '15px',
        background: 'white',
        borderRadius: '6px',
        border: '1px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ç»„ä»¶æ¥æ”¶çš„Propsï¼š</h4>
        <div style={{ fontSize: '14px', fontFamily: 'monospace' }}>
          <div><strong>name:</strong> {name}</div>
          <div><strong>age:</strong> {age}</div>
          <div><strong>city:</strong> {city}</div>
          <div><strong>extraProp:</strong> {extraProp}</div>
          {rest && <div><strong>å…¶ä»–props:</strong> {JSON.stringify(rest)}</div>}
        </div>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const CorrectComponent = withExtraProp(DemoComponent);
  const BrokenComponent = withBrokenProp(DemoComponent);

  const demoProps = {
    name: 'Alice',
    age: 25,
    city: 'Beijing',
    country: 'China',
    occupation: 'Developer'
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ“¦ Propsä¼ é€’æ¼”ç¤º</h3>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ­£ç¡®ï¼šä¼ é€’æ‰€æœ‰props</h4>
        <div style={{
          padding: '15px',
          background: '#e8f5e9',
          border: '2px solid #4caf50',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            {\`<WrappedComponent {...props} extraProp="value" />\`}
          </code>
        </div>
        <CorrectComponent {...demoProps} />
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#c62828' }}>âŒ é”™è¯¯ï¼šä¸å¿…è¦åœ°è¿‡æ»¤props</h4>
        <div style={{
          padding: '15px',
          background: '#ffebee',
          border: '2px solid #f44336',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            {\`const { age, ...otherProps } = props;\`}<br/>
            {\`return <WrappedComponent age={age} {...otherProps} />;\`}
          </code>
          <p style={{ margin: '10px 0 0 0', color: '#666', fontSize: '13px' }}>
            é—®é¢˜ï¼šä¸å¿…è¦åœ°è§£æ„propsï¼Œä»£ç å†—ä½™ä¸”å®¹æ˜“å‡ºé”™
          </p>
        </div>
        <BrokenComponent {...demoProps} />
        <p style={{ marginTop: '10px', color: '#666', fontSize: '14px' }}>
          æ³¨æ„ï¼šè™½ç„¶ç»“æœç›¸åŒï¼Œä½†ä»£ç æ›´å¤æ‚ï¼Œä¸”éœ€è¦æ‰‹åŠ¨ç»´æŠ¤propsåˆ—è¡¨
        </p>
      </div>

      <div style={{
        padding: '20px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '1px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: '#e65100' }}>ğŸ’¡ Propsä¼ é€’æœ€ä½³å®è·µ</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.8', fontSize: '14px' }}>
          <li>
            <strong>ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦</strong>ï¼š
            <code style={{ background: '#fff', padding: '2px 6px', borderRadius: '3px', marginLeft: '5px' }}>
              {'<WrappedComponent {...props} />'}
            </code>
          </li>
          <li><strong>ä¿æŒç®€æ´</strong>ï¼šä¸è¦æ‰‹åŠ¨åˆ—å‡ºæ‰€æœ‰props</li>
          <li><strong>é¿å…è§£æ„</strong>ï¼šé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚é‡å‘½åï¼‰</li>
          <li><strong>æ·»åŠ æ–°props</strong>ï¼šåœ¨å±•å¼€è¿ç®—ç¬¦ä¹‹åæ·»åŠ </li>
          <li><strong>è¦†ç›–é¡ºåº</strong>ï¼šåé¢å®šä¹‰çš„propsä¼šè¦†ç›–å‰é¢çš„</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 7.3 é¿å…å‘½åå†²çª

<LiveCode
  code={`
function NamingConflictDemo() {
  // æ¨¡æ‹ŸuseUser hook
  const useUser = () => ({
    name: 'Alice',
    email: 'alice@example.com',
    role: 'Admin'
  });

  // æ–¹æ¡ˆ1: ä½¿ç”¨å”¯ä¸€å‘½åç©ºé—´
  const withUserNamespace = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      const userData = useUser();
      return (
        <WrappedComponent
          {...props}
          userData={userData}  // ä¸ç›´æ¥è¦†ç›–user
        />
      );
    };
  };

  // æ–¹æ¡ˆ2: ä½¿ç”¨å‰ç¼€
  const withUserPrefix = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      return (
        <WrappedComponent
          {...props}
          withUserUserData={useUser()}  // å‰ç¼€
        />
      );
    };
  };

  // æ–¹æ¡ˆ3: ä¼ é€’æ‰€æœ‰props
  const withUserSimple = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      const userData = useUser();
      return <WrappedComponent {...props} userData={userData} />;
    };
  };

  // æµ‹è¯•ç»„ä»¶
  const TestComponent = ({ user, userData, withUserUserData }) => {
    return (
      <div style={{
        padding: '15px',
        background: 'white',
        borderRadius: '6px',
        border: '1px solid #ddd',
        marginBottom: '10px'
      }}>
        <h5 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>
          æµ‹è¯•ç»“æœ
        </h5>
        {userData && (
          <div>
            <p style={{ margin: '5px 0', fontSize: '14px' }}>
              <strong>userData.name:</strong> {userData.name}
            </p>
            <p style={{ margin: '5px 0', fontSize: '14px' }}>
              <strong>userData.email:</strong> {userData.email}
            </p>
            <p style={{ margin: '5px 0', fontSize: '14px' }}>
              <strong>userData.role:</strong> {userData.role}
            </p>
          </div>
        )}
        {withUserUserData && (
          <div>
            <p style={{ margin: '5px 0', fontSize: '14px' }}>
              <strong>withUserUserData.name:</strong> {withUserUserData.name}
            </p>
            <p style={{ margin: '5px 0', fontSize: '14px' }}>
              <strong>withUserUserData.email:</strong> {withUserUserData.email}
            </p>
          </div>
        )}
        {user && (
          <p style={{ margin: '5px 0', fontSize: '14px', color: '#666' }}>
            <strong>åŸæœ‰user prop:</strong> {JSON.stringify(user)}
          </p>
        )}
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const ComponentWithNamespace = withUserNamespace(TestComponent);
  const ComponentWithPrefix = withUserPrefix(TestComponent);
  const ComponentSimple = withUserSimple(TestComponent);

  const mockProps = { user: { name: 'Bob', id: 123 } };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0, color: '#1976d2' }}>
        ğŸ”’ é¿å…å‘½åå†²çªæ¼”ç¤º
      </h3>

      <div style={{
        marginBottom: '25px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>
          ğŸ’¡ é—®é¢˜è¯´æ˜
        </h4>
        <p style={{ margin: '0', fontSize: '14px', lineHeight: '1.6' }}>
          å¦‚æœHOCå’ŒåŒ…è£…ç»„ä»¶éƒ½ä¼ é€’åä¸º <code>user</code> çš„propï¼Œ
          ä¼šå¯¼è‡´å‘½åå†²çªã€‚ä¸‹ é¢æ¼”ç¤ºä¸‰ç§è§£å†³æ–¹æ¡ˆã€‚
        </p>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>
          âœ… æ–¹æ¡ˆ1: ä½¿ç”¨å”¯ä¸€å‘½åç©ºé—´
        </h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            userData={userData}
          </code>
        </div>
        <ComponentWithNamespace {...mockProps} />
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>
          âœ… æ–¹æ¡ˆ2: ä½¿ç”¨å‰ç¼€
        </h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            withUserUserData={useUser()}
          </code>
        </div>
        <ComponentWithPrefix {...mockProps} />
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>
          âœ… æ–¹æ¡ˆ3: ä¼ é€’æ‰€æœ‰props
        </h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            {'<WrappedComponent {...props} userData={userData} />'}
          </code>
        </div>
        <ComponentSimple {...mockProps} />
      </div>

      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>
          ğŸ“Š å¯¹æ¯”åˆ†æ
        </h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.8', fontSize: '14px' }}>
          <li>
            <strong>æ–¹æ¡ˆ1 (userData):</strong> æ¸…æ™°æ˜äº†ï¼Œè¯­ä¹‰åŒ–å¥½ï¼Œæ¨èä½¿ç”¨
          </li>
          <li>
            <strong>æ–¹æ¡ˆ2 (withUserUserData):</strong> å‰ç¼€æ˜ç¡®ï¼Œä½†åç§°è¾ƒé•¿
          </li>
          <li>
            <strong>æ–¹æ¡ˆ3 (ç›´æ¥ä¼ é€’):</strong> ç®€å•ç›´æ¥ï¼Œä½†å¯èƒ½æœ‰å†²çªé£é™©
          </li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### 7.4 è°ƒè¯•å’Œå¼€å‘ä½“éªŒ

<LiveCode
  code={`
function DebuggingDemo() {
  // è¾…åŠ©å‡½æ•°
  const getDisplayName = (WrappedComponent) => {
    return WrappedComponent.displayName || WrappedComponent.name || 'Component';
  };

  // HOC 1: æ²¡æœ‰ displayName (è°ƒè¯•å›°éš¾)
  const withAuthBasic = (WrappedComponent) => {
    return function AuthComponent(props) {
      return <WrappedComponent {...props} isAuthed={true} />;
    };
  };

  // HOC 2: æœ‰ displayName (ä¾¿äºè°ƒè¯•)
  const withAuthDebuggable = (WrappedComponent) => {
    const AuthComponent = (props) => {
      return <WrappedComponent {...props} isAuthed={true} />;
    };

    AuthComponent.displayName = \`withAuth(\${getDisplayName(WrappedComponent)})\`;
    return AuthComponent;
  };

  // HOC 3: å®Œæ•´çš„è°ƒè¯•æ”¯æŒ (displayName + propTypes)
  const withAuthComplete = (WrappedComponent) => {
    const AuthComponent = (props) => {
      return <WrappedComponent {...props} isAuthed={true} />;
    };

    // è®¾ç½®æ˜¾ç¤ºåç§°
    AuthComponent.displayName = \`withAuth(\${getDisplayName(WrappedComponent)})\`;

    // è®¾ç½® PropTypes (ç®€åŒ–ç‰ˆ)
    AuthComponent.propTypes = {
      isAuthenticated: 'bool',
      user: 'object'
    };

    return AuthComponent;
  };

  // æµ‹è¯•ç»„ä»¶
  const Profile = ({ name, isAuthed }) => {
    return (
      <div style={{
        padding: '10px',
        background: isAuthed ? '#e8f5e9' : '#ffebee',
        borderRadius: '4px'
      }}>
        <p style={{ margin: 0, fontSize: '14px' }}>
          ğŸ‘¤ {name} {isAuthed ? 'âœ…' : 'âŒ'}
        </p>
      </div>
    );
  };

  // å¢å¼ºç»„ä»¶
  const BasicProfile = withAuthBasic(Profile);
  const DebuggableProfile = withAuthDebuggable(Profile);
  const CompleteProfile = withAuthComplete(Profile);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0, color: '#1976d2' }}>
        ğŸ› è°ƒè¯•å’Œå¼€å‘ä½“éªŒæ¼”ç¤º
      </h3>

      <div style={{
        marginBottom: '25px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>
          ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦è°ƒè¯•æ”¯æŒï¼Ÿ
        </h4>
        <p style={{ margin: '0', fontSize: '14px', lineHeight: '1.6' }}>
          HOC ä¼šå¢åŠ ç»„ä»¶å±‚çº§ï¼Œæ²¡æœ‰é€‚å½“çš„è°ƒè¯•æ”¯æŒä¼šå¯¼è‡´ï¼š
        </p>
        <ul style={{ margin: '10px 0 0 20px', fontSize: '14px', lineHeight: '1.6' }}>
          <li>React DevTools ä¸­ç»„ä»¶åç§°ä¸æ¸…æ™°</li>
          <li>éš¾ä»¥è¿½è¸ªç»„ä»¶æ¥æºå’Œå±‚çº§</li>
          <li>æ— æ³•åœ¨å¼€å‘æ—¶å‘ç°ç±»å‹é”™è¯¯</li>
        </ul>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#c62828' }}>
          âŒ æ–¹æ¡ˆ1: æ²¡æœ‰è°ƒè¯•æ”¯æŒ
        </h4>
        <div style={{
          padding: '12px',
          background: '#ffebee',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            æ²¡æœ‰è®¾ç½® displayName
          </code>
        </div>
        <BasicProfile name="Alice" />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#fff',
          border: '1px solid #ddd',
          borderRadius: '4px',
          fontSize: '12px'
        }}>
          <strong>displayName:</strong> <code>{BasicProfile.displayName || 'undefined'}</code>
          <p style={{ margin: '5px 0 0 0', color: '#666' }}>
            åœ¨ React DevTools ä¸­ä¼šæ˜¾ç¤ºä¸º "AuthComponent"ï¼Œéš¾ä»¥è¯†åˆ«
          </p>
        </div>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>
          âœ… æ–¹æ¡ˆ2: æœ‰ displayName
        </h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            è®¾ç½®äº† displayName
          </code>
        </div>
        <DebuggableProfile name="Bob" />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#fff',
          border: '1px solid #ddd',
          borderRadius: '4px',
          fontSize: '12px'
        }}>
          <strong>displayName:</strong> <code>{DebuggableProfile.displayName}</code>
          <p style={{ margin: '5px 0 0 0', color: '#666' }}>
            åœ¨ React DevTools ä¸­ä¼šæ˜¾ç¤ºä¸º "withAuth(Profile)"ï¼Œæ¸…æ™°æ˜äº†
          </p>
        </div>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>
          âœ… æ–¹æ¡ˆ3: å®Œæ•´è°ƒè¯•æ”¯æŒ
        </h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            displayName + propTypes
          </code>
        </div>
        <CompleteProfile name="Charlie" />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#fff',
          border: '1px solid #ddd',
          borderRadius: '4px',
          fontSize: '12px'
        }}>
          <strong>displayName:</strong> <code>{CompleteProfile.displayName}</code>
          <br />
          <strong>propTypes:</strong> <code>{JSON.stringify(CompleteProfile.propTypes)}</code>
          <p style={{ margin: '5px 0 0 0', color: '#666' }}>
            æä¾›å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»å‹æ£€æŸ¥å’Œæ¸…æ™°çš„ç»„ä»¶åç§°
          </p>
        </div>
      </div>

      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>
          ğŸ“Š æœ€ä½³å®è·µæ€»ç»“
        </h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.8', fontSize: '14px' }}>
          <li>
            <strong>å§‹ç»ˆè®¾ç½® displayName</strong> - ä½¿ç”¨ <code>getDisplayName</code> è¾…åŠ©å‡½æ•°
          </li>
          <li>
            <strong>æ·»åŠ  PropTypes</strong> - åœ¨å¼€å‘æ—¶æ•è·ç±»å‹é”™è¯¯ (TypeScript ä¹Ÿæ˜¯å¥½é€‰æ‹©)
          </li>
          <li>
            <strong>ä¿æŒä¸€è‡´æ€§</strong> - åœ¨æ‰€æœ‰ HOC ä¸­åº”ç”¨ç›¸åŒçš„æ¨¡å¼
          </li>
          <li>
            <strong>ä½¿ç”¨å·¥å…·åº“</strong> - recompose ç­‰åº“æä¾›ç°æˆå·¥å…·
          </li>
        </ul>
      </div>

      <div style={{
        marginTop: '15px',
        padding: '12px',
        background: '#f5f5f5',
        borderRadius: '6px',
        fontSize: '13px',
        color: '#666'
      }}>
        <strong>ğŸ’¡ æç¤º:</strong> åœ¨ React DevTools ä¸­æŸ¥çœ‹ç»„ä»¶ç»“æ„ï¼ŒéªŒè¯ displayName æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 8. å¸¸è§é™·é˜±

### é™·é˜±1ï¼šä¸¢å¤±Ref

<LiveCode
  code={`
function RefForwardingPitfallDemo() {
  // æ¨¡æ‹ŸuseAuth Hook
  const useAuth = () => {
    return { isAuthenticated: true };
  };

  // âŒ é”™è¯¯çš„æ–¹æ³• - refä¸ä¼šä¼ é€’
  const withAuthBroken = (WrappedComponent) => {
    return function AuthComponent(props) {
      const { isAuthenticated } = useAuth();
      return <WrappedComponent {...props} isAuthenticated={isAuthenticated} />;
    };
  };

  // âœ… æ­£ç¡®çš„æ–¹æ³• - ä½¿ç”¨forwardRef
  const getDisplayName = (WrappedComponent) => {
    return WrappedComponent.displayName || WrappedComponent.name || 'Component';
  };

  const withAuthFixed = (WrappedComponent) => {
    const AuthComponent = React.forwardRef((props, ref) => {
      const { isAuthenticated } = useAuth();
      return <WrappedComponent ref={ref} {...props} isAuthenticated={isAuthenticated} />;
    });

    AuthComponent.displayName = \`withAuth(\${getDisplayName(WrappedComponent)})\`;
    return AuthComponent;
  };

  // å¯èšç„¦çš„è¾“å…¥ç»„ä»¶
  const FocusableInput = React.forwardRef((props, ref) => {
    return (
      <input
        ref={ref}
        {...props}
        style={{
          padding: '10px',
          fontSize: '16px',
          border: '2px solid #ddd',
          borderRadius: '6px',
          width: '250px',
          transition: 'border-color 0.3s',
          outline: 'none'
        }}
        onFocus={(e) => {
          e.target.style.borderColor = '#2196f3';
          e.target.style.boxShadow = '0 0 0 3px rgba(33, 150, 243, 0.1)';
        }}
        onBlur={(e) => {
          e.target.style.borderColor = '#ddd';
          e.target.style.boxShadow = 'none';
        }}
        placeholder="æˆ‘å¯ä»¥è¢«èšç„¦ï¼"
      />
    );
  });

  FocusableInput.displayName = 'FocusableInput';

  // å¢å¼ºç»„ä»¶
  const BrokenInput = withAuthBroken(FocusableInput);
  const FixedInput = withAuthFixed(FocusableInput);

  // èšç„¦å¤„ç†
  const [brokenRef, setBrokenRef] = React.useState(null);
  const [fixedRef, setFixedRef] = React.useState(null);

  const focusBrokenInput = () => {
    if (brokenRef) {
      brokenRef.focus();
      alert('âŒ é”™è¯¯ï¼šè¿™ä¸ªrefå¯èƒ½æ— æ³•å·¥ä½œï¼');
    } else {
      alert('âŒ refä¸ºnullï¼æ— æ³•èšç„¦è¾“å…¥æ¡†');
    }
  };

  const focusFixedInput = () => {
    if (fixedRef) {
      fixedRef.focus();
      alert('âœ… æˆåŠŸï¼šrefæ­£å¸¸å·¥ä½œï¼');
    } else {
      alert('âŒ refä¸ºnullï¼');
    }
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš¨ é™·é˜±1ï¼šRefä¼ é€’é—®é¢˜æ¼”ç¤º</h3>

      <div style={{ marginBottom: '20px' }}>
        <h4 style={{ color: '#c62828' }}>âŒ é”™è¯¯æ–¹æ³•ï¼ˆrefä¸¢å¤±ï¼‰</h4>
        <div style={{
          padding: '15px',
          background: '#ffebee',
          border: '2px solid #f44336',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            æ²¡æœ‰ä½¿ç”¨forwardRefï¼Œrefä¸ä¼šä¼ é€’
          </code>
        </div>
        <div style={{
          padding: '15px',
          background: '#f5f5f5',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <p style={{ margin: '0 0 10px 0', fontSize: '14px', color: '#666' }}>
            é—®é¢˜ï¼šæ— æ³•é€šè¿‡refèšç„¦è¾“å…¥æ¡†
          </p>
          <input
            ref={setBrokenRef}
            placeholder="å°è¯•èšç„¦æˆ‘..."
            style={{
              padding: '8px',
              fontSize: '14px',
              border: '1px solid #ccc',
              borderRadius: '4px',
              width: '200px',
              background: '#fff'
            }}
            readOnly
          />
          <div style={{ marginTop: '8px' }}>
            <span style={{
              fontSize: '12px',
              color: '#f44336',
              fontWeight: 'bold',
              background: '#ffebee',
              padding: '2px 6px',
              borderRadius: '3px'
            }}>
              refçŠ¶æ€: {brokenRef ? 'å·²è®¾ç½®' : 'æœªè®¾ç½® (âŒ)'}
            </span>
          </div>
        </div>
        <button
          onClick={focusBrokenInput}
          style={{
            padding: '8px 16px',
            background: '#f44336',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontSize: '14px'
          }}
        >
          å°è¯•èšç„¦
        </button>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ­£ç¡®æ–¹æ³•ï¼ˆforwardRefï¼‰</h4>
        <div style={{
          padding: '15px',
          background: '#e8f5e9',
          border: '2px solid #4caf50',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            ä½¿ç”¨React.forwardRefè½¬å‘ref
          </code>
        </div>
        <div style={{
          padding: '15px',
          background: '#f5f5f5',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <p style={{ margin: '0 0 10px 0', fontSize: '14px', color: '#666' }}>
            æˆåŠŸï¼šrefæ­£å¸¸å·¥ä½œï¼Œå¯ä»¥èšç„¦è¾“å…¥æ¡†
          </p>
          <input
            ref={setFixedRef}
            placeholder="èšç„¦æˆ‘è¯•è¯•..."
            style={{
              padding: '8px',
              fontSize: '14px',
              border: '1px solid #4caf50',
              borderRadius: '4px',
              width: '200px',
              background: '#fff'
            }}
            readOnly
          />
          <div style={{ marginTop: '8px' }}>
            <span style={{
              fontSize: '12px',
              color: '#4caf50',
              fontWeight: 'bold',
              background: '#e8f5e9',
              padding: '2px 6px',
              borderRadius: '3px'
            }}>
              refçŠ¶æ€: {fixedRef ? 'å·²è®¾ç½® (âœ…)' : 'æœªè®¾ç½®'}
            </span>
          </div>
        </div>
        <button
          onClick={focusFixedInput}
          style={{
            padding: '8px 16px',
            background: '#4caf50',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontSize: '14px'
          }}
        >
          å°è¯•èšç„¦
        </button>
      </div>

      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>ä½¿ç”¨forwardRef</strong> - Reactæä¾›çš„refè½¬å‘API</li>
          <li><strong>ä¼ é€’ref</strong> - HOCå¿…é¡»å°†refä¼ é€’ç»™åŒ…è£…ç»„ä»¶</li>
          <li><strong>displayName</strong> - è®¾ç½®ä¾¿äºè°ƒè¯•çš„ç»„ä»¶åç§°</li>
          <li><strong>é¿å…è¦†ç›–</strong> - ä¸è¦è¦†ç›–ä¼ å…¥çš„ref prop</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### é™·é˜±2ï¼šå‘½åå†²çª

<LiveCode
  code={`
function NamingConflictPitfallDemo() {
  // âŒ é”™è¯¯æ–¹æ³• - è¦†ç›–ç°æœ‰props
  const withDataBroken = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      // é—®é¢˜ï¼šä¼šè¦†ç›–ç»„ä»¶å¯èƒ½å·²æœ‰çš„data prop
      return <WrappedComponent {...props} data={{ new: 'data' }} />;
    };
  };

  // âœ… æ­£ç¡®æ–¹æ³•1 - ä½¿ç”¨å”¯ä¸€å‘½åç©ºé—´
  const withDataFixed1 = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      return <WrappedComponent {...props} enhancedData={{ new: 'data' }} />;
    };
  };

  // âœ… æ­£ç¡®æ–¹æ³•2 - ä½¿ç”¨å‰ç¼€
  const withDataFixed2 = (WrappedComponent) => {
    return function EnhancedComponent(props) {
      return <WrappedComponent {...props} withData={{ new: 'data' }} />;
    };
  };

  // æµ‹è¯•ç»„ä»¶
  const TestComponent = ({ data, enhancedData, withData }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '6px',
        border: '1px solid #ddd'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>ç»„ä»¶æ¥æ”¶çš„Propsï¼š</h4>
        <div style={{ fontSize: '14px', fontFamily: 'monospace' }}>
          <div><strong>data:</strong> {JSON.stringify(data)}</div>
          <div><strong>enhancedData:</strong> {JSON.stringify(enhancedData)}</div>
          <div><strong>withData:</strong> {JSON.stringify(withData)}</div>
        </div>
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const BrokenComponent = withDataBroken(TestComponent);
  const FixedComponent1 = withDataFixed1(TestComponent);
  const FixedComponent2 = withDataFixed2(TestComponent);

  // æµ‹è¯•æ•°æ®
  const testData = { id: 1, name: 'åŸæ•°æ®', value: 'original' };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš¨ é™·é˜±2ï¼šå‘½åå†²çªæ¼”ç¤º</h3>

      <div style={{ marginBottom: '25px' }}>
        <h4 style={{ color: '#c62828' }}>âŒ é”™è¯¯æ–¹æ³•ï¼ˆè¦†ç›–ç°æœ‰propsï¼‰</h4>
        <div style={{
          padding: '15px',
          background: '#ffebee',
          border: '2px solid #f44336',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            data={{ new: 'data' }} ä¼šè¦†ç›–ç°æœ‰çš„data prop
          </code>
        </div>
        <div style={{ marginBottom: '10px' }}>
          <h5 style={{ margin: '0 0 5px 0', color: '#666' }}>ä¼ å…¥çš„åŸå§‹propsï¼š</h5>
          <div style={{
            padding: '10px',
            background: '#fff',
            border: '1px solid #ddd',
            borderRadius: '4px',
            fontFamily: 'monospace',
            fontSize: '13px'
          }}>
            {\`data: { id: 1, name: 'åŸæ•°æ®', value: 'original' }\`}
          </div>
        </div>
        <BrokenComponent data={testData} />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#ffebee',
          borderRadius: '4px',
          fontSize: '13px'
        }}>
          <strong>é—®é¢˜ï¼š</strong> åŸå§‹çš„<code>data</code>è¢«è¦†ç›–ï¼åªèƒ½çœ‹åˆ°<code>{'{ new: "data" }'}</code>
        </div>
      </div>

      <div style={{ marginBottom: '25px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ­£ç¡®æ–¹æ³•1ï¼ˆä½¿ç”¨å”¯ä¸€å‘½åç©ºé—´ï¼‰</h4>
        <div style={{
          padding: '15px',
          background: '#e8f5e9',
          border: '2px solid #4caf50',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            enhancedData={{ new: 'data' }} ä¸ä¸ç°æœ‰propå†²çª
          </code>
        </div>
        <div style={{ marginBottom: '10px' }}>
          <h5 style={{ margin: '0 0 5px 0', color: '#666' }}>ä¼ å…¥çš„åŸå§‹propsï¼š</h5>
          <div style={{
            padding: '10px',
            background: '#fff',
            border: '1px solid #ddd',
            borderRadius: '4px',
            fontFamily: 'monospace',
            fontSize: '13px'
          }}>
            {\`data: { id: 1, name: 'åŸæ•°æ®', value: 'original' }\`}
          </div>
        </div>
        <FixedComponent1 data={testData} />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#e8f5e9',
          borderRadius: '4px',
          fontSize: '13px'
        }}>
          <strong>âœ… æˆåŠŸï¼š</strong> åŸå§‹<code>data</code>ä¿æŒä¸å˜ï¼Œæ–°å¢<code>enhancedData</code>
        </div>
      </div>

      <div style={{ marginBottom: '20px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ­£ç¡®æ–¹æ³•2ï¼ˆä½¿ç”¨å‰ç¼€ï¼‰</h4>
        <div style={{
          padding: '15px',
          background: '#e8f5e9',
          border: '2px solid #4caf50',
          borderRadius: '8px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '14px' }}>
            withData={{ new: 'data' }} æ˜ç¡®æ ‡è¯†æ¥æº
          </code>
        </div>
        <div style={{ marginBottom: '10px' }}>
          <h5 style={{ margin: '0 0 5px 0', color: '#666' }}>ä¼ å…¥çš„åŸå§‹propsï¼š</h5>
          <div style={{
            padding: '10px',
            background: '#fff',
            border: '1px solid #ddd',
            borderRadius: '4px',
            fontFamily: 'monospace',
            fontSize: '13px'
          }}>
            {\`data: { id: 1, name: 'åŸæ•°æ®', value: 'original' }\`}
          </div>
        </div>
        <FixedComponent2 data={testData} />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#e8f5e9',
          borderRadius: '4px',
          fontSize: '13px'
        }}>
          <strong>âœ… æˆåŠŸï¼š</strong> åŸå§‹<code>data</code>ä¿æŒä¸å˜ï¼Œæ–°å¢<code>withData</code>
        </div>
      </div>

      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ é¿å…å‘½åå†²çªç­–ç•¥</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>è¯­ä¹‰åŒ–å‘½å</strong> - ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°å¦‚<code>enhancedData</code></li>
          <li><strong>æ·»åŠ å‰ç¼€</strong> - ä½¿ç”¨<code>withXxx</code>æˆ–<code>enhancedXxx</code></li>
          <li><strong>é¿å…é€šç”¨å</strong> - ä¸è¦ä½¿ç”¨<code>data</code>ã€<code>value</code>ã€<code>items</code></li>
          <li><strong>æ£€æŸ¥æ–‡æ¡£</strong> - äº†è§£åŒ…è£…ç»„ä»¶æœŸæœ›çš„props</li>
          <li><strong>ä½¿ç”¨å‘½åç©ºé—´</strong> - å°†ç›¸å…³propsç»„ç»‡æˆå¯¹è±¡</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### é™·é˜±3ï¼šå¾ªç¯ä¾èµ–

<LiveCode
  code={`
function CircularDependencyDemo() {
  // æ¨¡æ‹Ÿä¸¤ä¸ªå¯èƒ½äº§ç”Ÿå¾ªç¯ä¾èµ–çš„ç»„ä»¶
  const [componentA, setComponentA] = React.useState(null);
  const [componentB, setComponentB] = React.useState(null);
  const [isCircular, setIsCircular] = React.useState(false);
  const [error, setError] = React.useState(null);

  // æ¨¡æ‹Ÿç»„ä»¶A
  const createComponentA = React.useCallback((WrappedComponent) => {
    return function ComponentA(props) {
      return (
        <div style={{
          padding: '20px',
          background: '#e3f2fd',
          borderRadius: '8px',
          border: '2px solid #2196f3'
        }}>
          <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ç»„ä»¶A</h4>
          <p style={{ margin: '0', color: '#666' }}>
            å¸¦æœ‰è®¤è¯åŠŸèƒ½çš„ç»„ä»¶
          </p>
          {WrappedComponent && <WrappedComponent {...props} />}
        </div>
      );
    };
  }, []);

  // æ¨¡æ‹Ÿç»„ä»¶B
  const createComponentB = React.useCallback((WrappedComponent) => {
    return function ComponentB(props) {
      return (
        <div style={{
          padding: '20px',
          background: '#f3e5f5',
          borderRadius: '8px',
          border: '2px solid #9c27b0'
        }}>
          <h4 style={{ margin: '0 0 10px 0', color: '#6a1b9a' }}>ç»„ä»¶B</h4>
          <p style={{ margin: '0', color: '#666' }}>
            å¸¦æœ‰æƒé™æ£€æŸ¥çš„ç»„ä»¶
          </p>
          {WrappedComponent && <WrappedComponent {...props} />}
        </div>
      );
    };
  }, []);

  // å°è¯•åˆ›å»ºå¾ªç¯ä¾èµ–
  const tryCreateCircularDependency = () => {
    setError(null);
    setIsCircular(false);

    try {
      // æ¨¡æ‹Ÿç›¸äº’åŒ…è£…çš„æƒ…å†µ
      const Step1 = createComponentA(() => <div>æ­¥éª¤1: ç»„ä»¶Aåˆ›å»º</div>);
      const Step2 = createComponentB(Step1);
      const Step3 = createComponentA(Step2);

      setComponentA(Step3);
      setIsCircular(true);
    } catch (err) {
      setError(err.message);
      setIsCircular(false);
    }
  };

  // é¿å…å¾ªç¯ä¾èµ–çš„æ­£ç¡®æ–¹æ³•
  const createSafeChain = () => {
    setError(null);
    setIsCircular(false);

    // æ­£ç¡®çš„åšæ³•ï¼šæŒ‰é¡ºåºåŒ…è£…ï¼Œä¸å½¢æˆå¾ªç¯
    const BaseComponent = ({ name }) => (
      <div style={{
        padding: '15px',
        background: 'white',
        borderRadius: '6px',
        margin: '10px 0'
      }}>
        <p style={{ margin: 0, fontSize: '14px' }}>ğŸ‘¤ {name}</p>
      </div>
    );

    const AuthComponent = createComponentA(BaseComponent);
    const FinalComponent = createComponentB(AuthComponent);

    setComponentA(FinalComponent);
    setIsCircular(false);
  };

  // æ¸…ç†å‡½æ•°
  const reset = () => {
    setComponentA(null);
    setComponentB(null);
    setIsCircular(false);
    setError(null);
  };

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš¨ é™·é˜±3ï¼šå¾ªç¯ä¾èµ–æ¼”ç¤º</h3>

      <div style={{ marginBottom: '20px' }}>
        <button
          onClick={tryCreateCircularDependency}
          style={{
            marginRight: '10px',
            padding: '10px 20px',
            background: '#f44336',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          âš ï¸ å°è¯•åˆ›å»ºå¾ªç¯ä¾èµ–
        </button>

        <button
          onClick={createSafeChain}
          style={{
            marginRight: '10px',
            padding: '10px 20px',
            background: '#4caf50',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer',
            fontWeight: 'bold'
          }}
        >
          âœ… åˆ›å»ºå®‰å…¨é“¾
        </button>

        <button
          onClick={reset}
          style={{
            padding: '10px 20px',
            background: '#9e9e9e',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          é‡ç½®
        </button>
      </div>

      {error && (
        <div style={{
          padding: '20px',
          background: '#ffebee',
          borderRadius: '8px',
          border: '2px solid #f44336',
          marginBottom: '20px'
        }}>
          <h4 style={{ margin: '0 0 10px 0', color: '#c62828' }}>âŒ é”™è¯¯å‘ç”Ÿ</h4>
          <p style={{ margin: '0', color: '#666' }}>{error}</p>
        </div>
      )}

      {isCircular && (
        <div style={{
          padding: '20px',
          background: '#fff3e0',
          borderRadius: '8px',
          border: '2px solid #ff9800',
          marginBottom: '20px'
        }}>
          <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>âš ï¸ å¾ªç¯ä¾èµ–è­¦å‘Š</h4>
          <p style={{ margin: '0 0 10px 0', color: '#666' }}>
            ç»„ä»¶ç›¸äº’åŒ…è£…å½¢æˆå¾ªç¯ï¼Œå¯èƒ½å¯¼è‡´ï¼š
          </p>
          <ul style={{ margin: '0', paddingLeft: '20px', color: '#666' }}>
            <li>æ€§èƒ½é—®é¢˜</li>
            <li>å†…å­˜æ³„æ¼</li>
            <li>æ¸²æŸ“é”™è¯¯</li>
            <li>è°ƒè¯•å›°éš¾</li>
          </ul>
        </div>
      )}

      {componentA && (
        <div style={{ marginBottom: '20px' }}>
          <h4>æ¸²æŸ“ç»“æœï¼š</h4>
          <div style={{ transform: 'scale(0.8)', transformOrigin: 'top left' }}>
            <componentA name="æ¼”ç¤ºç”¨æˆ·" />
          </div>
        </div>
      )}

      <div style={{
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>é¿å…ç›¸äº’å¼•ç”¨</strong> - ç»„ä»¶Aä¸ä¾èµ–ç»„ä»¶Bï¼Œç»„ä»¶Bä¹Ÿä¸ä¾èµ–ç»„ä»¶A</li>
          <li><strong>å•å‘åŒ…è£…</strong> - å§‹ç»ˆä»å†…åˆ°å¤–æˆ–ä»å¤–åˆ°å†…åŒ…è£…</li>
          <li><strong>æ‰å¹³åŒ–ç»“æ„</strong> - å°½é‡å‡å°‘ç»„ä»¶å±‚çº§</li>
          <li><strong>ä½¿ç”¨Hooks</strong> - ç°ä»£Reactæ¨èä½¿ç”¨Hooksè€ŒéHOC</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### é™·é˜±4ï¼šç»„ä»¶å®ä¾‹

<LiveCode
  code={`
function ComponentInstanceDemo() {
  // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
  const [user, setUser] = React.useState({
    name: 'Alice',
    email: 'alice@example.com',
    role: 'user'
  });

  // âŒ é”™è¯¯çš„HOC - ä¸ä¼ é€’props
  const withAuthBroken = (WrappedComponent) => {
    return function AuthComponent(props) {
      // é”™è¯¯ï¼šæ²¡æœ‰ä¼ é€’propsç»™åŒ…è£…ç»„ä»¶
      return <WrappedComponent />;
    };
  };

  // âœ… æ­£ç¡®çš„HOC - ä¼ é€’æ‰€æœ‰props
  const withAuthFixed = (WrappedComponent) => {
    return function AuthComponent(enhancedProps) {
      // æ­£ç¡®ï¼šä¼ é€’æ‰€æœ‰props
      return <WrappedComponent {...enhancedProps} />;
    };
  };

  // æµ‹è¯•ç»„ä»¶
  const UserProfile = ({ name, email, role, isAuthenticated }) => {
    return (
      <div style={{
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '6px',
        border: '1px solid #ddd'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>ç”¨æˆ·èµ„æ–™</h4>
        {name ? (
          <>
            <p style={{ margin: '5px 0' }}><strong>å§“å:</strong> {name}</p>
            <p style={{ margin: '5px 0' }}><strong>é‚®ç®±:</strong> {email}</p>
            <p style={{ margin: '5px 0' }}><strong>è§’è‰²:</strong> {role}</p>
            <p style={{ margin: '5px 0' }}>
              <strong>è®¤è¯çŠ¶æ€:</strong> {isAuthenticated ? 'âœ… å·²è®¤è¯' : 'âŒ æœªè®¤è¯'}
            </p>
          </>
        ) : (
          <p style={{ margin: '5px 0', color: '#999' }}>æ²¡æœ‰æ¥æ”¶åˆ°props</p>
        )}
      </div>
    );
  };

  // åˆ›å»ºå¢å¼ºç»„ä»¶
  const BrokenProfile = withAuthBroken(UserProfile);
  const FixedProfile = withAuthFixed(UserProfile);

  const [testUser, setTestUser] = React.useState({
    name: 'Test User',
    email: 'test@example.com',
    role: 'admin',
    isAuthenticated: true
  });

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸš¨ é™·é˜±4ï¼šç»„ä»¶å®ä¾‹æ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#f5f5f5',
        borderRadius: '8px'
      }}>
        <h4 style={{ margin: '0 0 10px 0' }}>å½“å‰æµ‹è¯•æ•°æ®ï¼š</h4>
        <div style={{ fontSize: '14px', fontFamily: 'monospace' }}>
          <div><strong>name:</strong> {testUser.name}</div>
          <div><strong>email:</strong> {testUser.email}</div>
          <div><strong>role:</strong> {testUser.role}</div>
          <div><strong>isAuthenticated:</strong> {testUser.isAuthenticated ? 'true' : 'false'}</div>
        </div>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#c62828' }}>âŒ é”™è¯¯æ–¹æ³• - ä¸ä¼ é€’props</h4>
        <div style={{
          padding: '12px',
          background: '#ffebee',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            return &lt;WrappedComponent /&gt;  // æ²¡æœ‰ä¼ é€’props
          </code>
        </div>
        <BrokenProfile {...testUser} />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#ffebee',
          borderRadius: '4px',
          fontSize: '13px'
        }}>
          <strong>é—®é¢˜ï¼š</strong> ç»„ä»¶æ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•propsï¼Œæ‰€æœ‰æ•°æ®æ˜¾ç¤ºä¸º"æœªæ¥æ”¶åˆ°"
        </div>
      </div>

      <div style={{ marginBottom: '30px' }}>
        <h4 style={{ color: '#2e7d32' }}>âœ… æ­£ç¡®æ–¹æ³• - ä¼ é€’æ‰€æœ‰props</h4>
        <div style={{
          padding: '12px',
          background: '#e8f5e9',
          borderRadius: '6px',
          marginBottom: '10px'
        }}>
          <code style={{ fontSize: '13px' }}>
            return &lt;WrappedComponent {...enhancedProps} /&gt;  // ä¼ é€’æ‰€æœ‰props
          </code>
        </div>
        <FixedProfile {...testUser} />
        <div style={{
          marginTop: '10px',
          padding: '10px',
          background: '#e8f5e9',
          borderRadius: '4px',
          fontSize: '13px'
        }}>
          <strong>âœ… æˆåŠŸï¼š</strong> ç»„ä»¶æ­£ç¡®æ¥æ”¶åˆ°æ‰€æœ‰propsï¼Œæ•°æ®æ­£å¸¸æ˜¾ç¤º
        </div>
      </div>

      <div style={{
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ æœ€ä½³å®è·µ</h4>
        <ul style={{ margin: '0', paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li><strong>å§‹ç»ˆä¼ é€’props</strong> - ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ä¼ é€’æ‰€æœ‰props</li>
          <li><strong>æ·»åŠ æ–°props</strong> - åœ¨å±•å¼€è¿ç®—ç¬¦ä¹‹åæ·»åŠ HOCç‰¹æœ‰çš„props</li>
          <li><strong>é¿å…è§£æ„</strong> - é™¤ééœ€è¦é‡å‘½åæˆ–è¿‡æ»¤ç‰¹å®šprop</li>
          <li><strong>ä¿æŒå®Œæ•´æ€§</strong> - ä¸è¦é—æ¼ä»»ä½•å¯èƒ½éœ€è¦çš„props</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 9. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šåˆ›å»ºwithLoading HOC

<LiveCode
  code={`
function LoadingHOCDemo() {
  // withLoading HOCå®ç°
  const withLoading = (WrappedComponent, options = {}) => {
    const { delay = 300, loader: LoaderComponent } = options;

    return function EnhancedComponent(props) {
      const [loading, setLoading] = React.useState(false);
      const [showLoader, setShowLoader] = React.useState(false);

      // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
      const handleLoad = () => {
        setLoading(true);

        // å»¶è¿Ÿæ˜¾ç¤ºloaderï¼Œé¿å…é—ªçƒ
        const timeoutId = setTimeout(() => {
          setShowLoader(true);
        }, delay);

        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
        setTimeout(() => {
          setLoading(false);
          setShowLoader(false);
          clearTimeout(timeoutId);
        }, 2000);
      };

      // ä¼ é€’loadingçŠ¶æ€ç»™åŒ…è£…ç»„ä»¶
      return (
        <div>
          {showLoader ? (
            <div style={{
              padding: '20px',
              background: '#fff3e0',
              borderRadius: '8px',
              border: '2px solid #ff9800',
              textAlign: 'center'
            }}>
              {LoaderComponent ? <LoaderComponent /> : (
                <div>
                  <div style={{ fontSize: '32px', marginBottom: '10px' }}>â³</div>
                  <p style={{ margin: 0, color: '#e65100' }}>åŠ è½½ä¸­...</p>
                </div>
              )}
            </div>
          ) : (
            <WrappedComponent
              {...props}
              loading={loading}
              onLoad={handleLoad}
            />
          )}
        </div>
      );
    };
  };

  // è‡ªå®šä¹‰Loaderç»„ä»¶
  const Spinner = () => (
    <div style={{
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      padding: '30px'
    }}>
      <div style={{
        width: '50px',
        height: '50px',
        border: '4px solid #ff9800',
        borderTop: '4px solid transparent',
        borderRadius: '50%',
        animation: 'spin 1s linear infinite',
        marginBottom: '15px'
      }} />
      <p style={{ margin: 0, color: '#e65100', fontWeight: 'bold' }}>
        æ­£åœ¨åŠ è½½æ•°æ®...
      </p>
    </div>
  );

  // æ·»åŠ CSSåŠ¨ç”»
  React.useEffect(() => {
    const style = document.createElement('style');
    style.textContent = \`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    \`;
    document.head.appendChild(style);
    return () => document.head.removeChild(style);
  }, []);

  // æµ‹è¯•ç»„ä»¶
  const DataComponent = ({ loading, onLoad }) => {
    return (
      <div style={{
        padding: '20px',
        background: '#e8f5e9',
        borderRadius: '8px',
        border: '2px solid #4caf50'
      }}>
        <h4 style={{ margin: '0 0 15px 0', color: '#2e7d32' }}>ğŸ“¦ æ•°æ®ç»„ä»¶</h4>
        <p style={{ margin: '0 0 15px 0', color: '#666' }}>
          ç‚¹å‡»æŒ‰é’®æ¨¡æ‹Ÿæ•°æ®åŠ è½½è¿‡ç¨‹
        </p>
        <button
          onClick={onLoad}
          disabled={loading}
          style={{
            padding: '10px 20px',
            background: loading ? '#ccc' : '#4caf50',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: loading ? 'not-allowed' : 'pointer',
            fontSize: '16px',
            fontWeight: 'bold',
            transition: 'all 0.3s'
          }}
        >
          {loading ? 'åŠ è½½ä¸­...' : 'ğŸš€ å¼€å§‹åŠ è½½'}
        </button>
        {loading && (
          <p style={{
            margin: '10px 0 0 0',
            fontSize: '14px',
            color: '#2e7d32',
            fontStyle: 'italic'
          }}>
            âœ“ åŠ è½½çŠ¶æ€å·²ä¼ é€’ç»™ç»„ä»¶
          </p>
        )}
      </div>
    );
  };

  // ä½¿ç”¨HOCå¢å¼ºç»„ä»¶
  const EnhancedDataComponent = withLoading(DataComponent, {
    delay: 500,
    loader: Spinner
  });

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¯ ç»ƒä¹ 1ï¼šwithLoading HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ åŠŸèƒ½ç‰¹æ€§</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>æ”¯æŒè‡ªå®šä¹‰å»¶è¿Ÿæ—¶é—´ï¼ˆé¿å…é—ªçƒï¼‰</li>
          <li>å¯é…ç½®è‡ªå®šä¹‰Loaderç»„ä»¶</li>
          <li>ä¼ é€’loadingçŠ¶æ€ç»™åŒ…è£…ç»„ä»¶</li>
          <li>è‡ªåŠ¨ç®¡ç†loadingç”Ÿå‘½å‘¨æœŸ</li>
        </ul>
      </div>

      <EnhancedDataComponent />

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ å®ç°è¦ç‚¹</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>ä½¿ç”¨ <strong>useState</strong> ç®¡ç†loadingçŠ¶æ€</li>
          <li>ä½¿ç”¨ <strong>setTimeout</strong> å®ç°å»¶è¿Ÿæ˜¾ç¤º</li>
          <li>é€šè¿‡propsä¼ é€’loadingçŠ¶æ€ç»™åŒ…è£…ç»„ä»¶</li>
          <li>å¯é…ç½®Loaderç»„ä»¶å®ç°è‡ªå®šä¹‰UI</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### ç»ƒä¹ 2ï¼šåˆ›å»ºwithFormValidation HOC

<LiveCode
  code={`
function FormValidationHOCDemo() {
  // éªŒè¯è§„åˆ™
  const validateField = (name, value, rules) => {
    if (rules.required && (!value || value.trim() === '')) {
      return \`\${name}æ˜¯å¿…å¡«å­—æ®µ\`;
    }

    if (rules.pattern && value && !rules.pattern.test(value)) {
      return \`\${name}æ ¼å¼ä¸æ­£ç¡®\`;
    }

    if (rules.minLength && value && value.length < rules.minLength) {
      return \`\${name}è‡³å°‘éœ€è¦\${rules.minLength}ä¸ªå­—ç¬¦\`;
    }

    if (rules.maxLength && value && value.length > rules.maxLength) {
      return \`\${name}ä¸èƒ½è¶…è¿‡\${rules.maxLength}ä¸ªå­—ç¬¦\`;
    }

    if (rules.custom && value) {
      const result = rules.custom(value);
      if (result) return result;
    }

    return '';
  };

  // withFormValidation HOC
  const withFormValidation = (WrappedComponent, validationRules) => {
    return function EnhancedComponent(props) {
      const [values, setValues] = React.useState({});
      const [touched, setTouched] = React.useState({});
      const [errors, setErrors] = React.useState({});

      // éªŒè¯æ‰€æœ‰å­—æ®µ
      const validateAll = React.useCallback(() => {
        const newErrors = {};
        Object.keys(validationRules).forEach(field => {
          const error = validateField(field, values[field] || '', validationRules[field]);
          if (error) newErrors[field] = error;
        });
        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
      }, [values, validationRules]);

      // å¤„ç†å­—æ®µå˜åŒ–
      const handleChange = (name, value) => {
        setValues(prev => ({ ...prev, [name]: value }));

        // å®æ—¶éªŒè¯
        if (touched[name]) {
          const error = validateField(name, value, validationRules[name]);
          setErrors(prev => ({ ...prev, [name]: error }));
        }
      };

      // å¤„ç†å­—æ®µå¤±ç„¦
      const handleBlur = (name) => {
        setTouched(prev => ({ ...prev, [name]: true }));
        const error = validateField(name, values[name] || '', validationRules[name]);
        setErrors(prev => ({ ...prev, [name]: error }));
      };

      // æäº¤è¡¨å•
      const handleSubmit = (e) => {
        e.preventDefault();
        // æ ‡è®°æ‰€æœ‰å­—æ®µä¸ºå·²è§¦ç¢°
        const allTouched = {};
        Object.keys(validationRules).forEach(field => {
          allTouched[field] = true;
        });
        setTouched(allTouched);

        if (validateAll()) {
          alert('è¡¨å•éªŒè¯æˆåŠŸï¼\\n\\næ•°æ®ï¼š\\n' + JSON.stringify(values, null, 2));
        }
      };

      return (
        <WrappedComponent
          {...props}
          values={values}
          touched={touched}
          errors={errors}
          handleChange={handleChange}
          handleBlur={handleBlur}
          handleSubmit={handleSubmit}
          validateAll={validateAll}
        />
      );
    };
  };

  // æµ‹è¯•è¡¨å•ç»„ä»¶
  const TestForm = ({ values, touched, errors, handleChange, handleBlur, handleSubmit }) => {
    const inputStyle = (name) => ({
      width: '100%',
      padding: '10px',
      fontSize: '14px',
      border: touched[name] && errors[name]
        ? '2px solid #f44336'
        : '1px solid #ddd',
      borderRadius: '4px',
      boxSizing: 'border-box',
      transition: 'border-color 0.3s'
    });

    const labelStyle = {
      display: 'block',
      marginBottom: '5px',
      fontWeight: 'bold',
      color: '#333'
    };

    const errorStyle = {
      color: '#f44336',
      fontSize: '12px',
      marginTop: '5px'
    };

    return (
      <form onSubmit={handleSubmit} style={{
        padding: '20px',
        background: '#f5f5f5',
        borderRadius: '8px',
        border: '2px solid #9c27b0',
        maxWidth: '400px'
      }}>
        <h4 style={{ margin: '0 0 20px 0', color: '#6a1b9a' }}>ğŸ“ ç™»å½•è¡¨å•</h4>

        {/* é‚®ç®±å­—æ®µ */}
        <div style={{ marginBottom: '15px' }}>
          <label style={labelStyle}>é‚®ç®±åœ°å€</label>
          <input
            type="email"
            value={values.email || ''}
            onChange={(e) => handleChange('email', e.target.value)}
            onBlur={() => handleBlur('email')}
            placeholder="è¯·è¾“å…¥é‚®ç®±"
            style={inputStyle('email')}
          />
          {touched.email && errors.email && (
            <div style={errorStyle}>âŒ {errors.email}</div>
          )}
        </div>

        {/* å¯†ç å­—æ®µ */}
        <div style={{ marginBottom: '15px' }}>
          <label style={labelStyle}>å¯†ç </label>
          <input
            type="password"
            value={values.password || ''}
            onChange={(e) => handleChange('password', e.target.value)}
            onBlur={() => handleBlur('password')}
            placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
            style={inputStyle('password')}
          />
          {touched.password && errors.password && (
            <div style={errorStyle}>âŒ {errors.password}</div>
          )}
        </div>

        {/* ç¡®è®¤å¯†ç å­—æ®µ */}
        <div style={{ marginBottom: '20px' }}>
          <label style={labelStyle}>ç¡®è®¤å¯†ç </label>
          <input
            type="password"
            value={values.confirmPassword || ''}
            onChange={(e) => handleChange('confirmPassword', e.target.value)}
            onBlur={() => handleBlur('confirmPassword')}
            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            style={inputStyle('confirmPassword')}
          />
          {touched.confirmPassword && errors.confirmPassword && (
            <div style={errorStyle}>âŒ {errors.confirmPassword}</div>
          )}
        </div>

        {/* æäº¤æŒ‰é’® */}
        <button
          type="submit"
          style={{
            width: '100%',
            padding: '12px',
            background: '#9c27b0',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            fontSize: '16px',
            fontWeight: 'bold',
            cursor: 'pointer',
            transition: 'background 0.3s'
          }}
        >
          æäº¤è¡¨å•
        </button>

        {/* çŠ¶æ€æ˜¾ç¤º */}
        <div style={{
          marginTop: '15px',
          padding: '10px',
          background: 'white',
          borderRadius: '4px',
          fontSize: '12px'
        }}>
          <strong>è¡¨å•çŠ¶æ€ï¼š</strong>
          <pre style={{ margin: '5px 0 0 0', fontSize: '11px', color: '#666' }}>
            {JSON.stringify({ values, touched: Object.keys(touched), errors: Object.keys(errors) }, null, 2)}
          </pre>
        </div>
      </form>
    );
  };

  // éªŒè¯è§„åˆ™
  const rules = {
    email: {
      required: true,
      pattern: /^\S+@\S+$/,
      custom: (value) => {
        if (value && value.toLowerCase().includes('admin')) {
          return 'ä¸èƒ½ä½¿ç”¨adminé‚®ç®±';
        }
        return null;
      }
    },
    password: {
      required: true,
      minLength: 6,
      custom: (value) => {
        if (value && !/[0-9]/.test(value)) {
          return 'å¯†ç å¿…é¡»åŒ…å«æ•°å­—';
        }
        return null;
      }
    },
    confirmPassword: {
      required: true,
      custom: (value, allValues) => {
        if (value && value !== allValues.password) {
          return 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
        }
        return null;
      }
    }
  };

  // ä½¿ç”¨HOCå¢å¼ºè¡¨å•ç»„ä»¶
  const ValidatedForm = withFormValidation(TestForm, rules);

  return (
    <div style={{ padding: '20px' }}>
      <h3 style={{ marginTop: 0 }}>ğŸ¯ ç»ƒä¹ 2ï¼šwithFormValidation HOCæ¼”ç¤º</h3>

      <div style={{
        marginBottom: '20px',
        padding: '15px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>ğŸ’¡ åŠŸèƒ½ç‰¹æ€§</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>æ”¯æŒå®æ—¶éªŒè¯å’Œæäº¤æ—¶éªŒè¯</li>
          <li>å¯é…ç½®éªŒè¯è§„åˆ™ï¼ˆå¿…å¡«ã€æ ¼å¼ã€é•¿åº¦ç­‰ï¼‰</li>
          <li>ä¼ é€’éªŒè¯çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯</li>
          <li>æ”¯æŒè‡ªå®šä¹‰éªŒè¯å‡½æ•°</li>
        </ul>
      </div>

      <ValidatedForm />

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ å®ç°è¦ç‚¹</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>ä½¿ç”¨ <strong>useState</strong> ç®¡ç†è¡¨å•å€¼ã€è§¦ç¢°çŠ¶æ€å’Œé”™è¯¯</li>
          <li>å®ç° <strong>validateField</strong> å‡½æ•°è¿›è¡Œå­—æ®µéªŒè¯</li>
          <li>å¤„ç† <strong>onChange</strong> å’Œ <strong>onBlur</strong> äº‹ä»¶</li>
          <li>æ”¯æŒå®æ—¶éªŒè¯å’Œæ‰¹é‡éªŒè¯</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### ç»ƒä¹ 3ï¼šåˆ›å»ºwithInfiniteScroll HOC

<LiveCode
  code={`
function InfiniteScrollHOCDemo() {
  // withInfiniteScroll HOCå®ç°
  const withInfiniteScroll = (WrappedComponent, options = {}) => {
    const { threshold = 200 } = options;

    return function EnhancedComponent(props) {
      const [items, setItems] = React.useState([]);
      const [loading, setLoading] = React.useState(false);
      const [hasMore, setHasMore] = React.useState(true);
      const [page, setPage] = React.useState(0);
      const [loadCount, setLoadCount] = React.useState(0);

      // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
      const loadMore = React.useCallback(() => {
        if (loading || !hasMore) return;

        setLoading(true);
        setLoadCount(prev => prev + 1);

        // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
        setTimeout(() => {
          const newItems = Array.from({ length: 10 }, (_, i) => {
            const id = page * 10 + i + 1;
            return {
              id: id,
              title: \`é¡¹ç›® \${id}\`,
              description: \`è¿™æ˜¯ç¬¬\${id}ä¸ªé¡¹ç›®çš„å†…å®¹\`,
              timestamp: new Date().toLocaleTimeString()
            };
          });

          setItems(prev => [...prev, ...newItems]);
          setPage(prev => prev + 1);
          setLoading(false);

          // æ¨¡æ‹Ÿé™åˆ¶ï¼Œæœ€å¤šåŠ è½½5é¡µ
          if (page >= 4) {
            setHasMore(false);
          }
        }, 1000);
      }, [page, loading, hasMore]);

      // æ»šåŠ¨äº‹ä»¶å¤„ç†
      const handleScroll = React.useCallback(() => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;

        // æ£€æŸ¥æ˜¯å¦æ¥è¿‘åº•éƒ¨
        if (scrollTop + clientHeight >= scrollHeight - threshold) {
          loadMore();
        }
      }, [loadMore, threshold]);

      // ç›‘å¬æ»šåŠ¨
      React.useEffect(() => {
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, [handleScroll]);

      // åˆå§‹åŠ è½½
      React.useEffect(() => {
        loadMore();
      }, []); // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡

      return (
        <WrappedComponent
          {...props}
          items={items}
          loading={loading}
          hasMore={hasMore}
          loadMore={loadMore}
          loadCount={loadCount}
        />
      );
    };
  };

  // åŸå§‹åˆ—è¡¨ç»„ä»¶
  const ListComponent = ({ items, loading, hasMore, loadCount }) => {
    const containerStyle = {
      maxWidth: '600px',
      margin: '0 auto',
      padding: '20px'
    };

    const itemStyle = {
      padding: '15px',
      marginBottom: '15px',
      background: 'white',
      borderRadius: '8px',
      border: '1px solid #e0e0e0',
      boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
      transition: 'all 0.3s'
    };

    const headerStyle = {
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      marginBottom: '10px'
    };

    const titleStyle = {
      margin: 0,
      fontSize: '18px',
      fontWeight: 'bold',
      color: '#333'
    };

    const timeStyle = {
      fontSize: '12px',
      color: '#999',
      background: '#f5f5f5',
      padding: '4px 8px',
      borderRadius: '4px'
    };

    const descStyle = {
      margin: 0,
      color: '#666',
      fontSize: '14px'
    };

    const loadingStyle = {
      textAlign: 'center',
      padding: '30px',
      color: '#666',
      fontSize: '16px'
    };

    const endStyle = {
      textAlign: 'center',
      padding: '30px',
      color: '#999',
      fontSize: '16px',
      fontStyle: 'italic'
    };

    const statusBarStyle = {
      position: 'sticky',
      top: 0,
      background: 'rgba(33, 150, 243, 0.1)',
      padding: '10px 20px',
      marginBottom: '20px',
      borderRadius: '8px',
      border: '1px solid #2196f3',
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      fontSize: '14px',
      fontWeight: 'bold',
      color: '#1976d2'
    };

    return (
      <div style={containerStyle}>
        <div style={statusBarStyle}>
          <span>ğŸ“Š åŠ è½½ç»Ÿè®¡</span>
          <span>å·²åŠ è½½: {items.length} é¡¹ | åŠ è½½æ¬¡æ•°: {loadCount}</span>
        </div>

        {items.length === 0 && !loading && (
          <div style={{ textAlign: 'center', padding: '40px', color: '#999' }}>
            æš‚æ— æ•°æ®ï¼Œæ­£åœ¨åŠ è½½...
          </div>
        )}

        {items.map(item => (
          <div key={item.id} style={itemStyle}>
            <div style={headerStyle}>
              <h3 style={titleStyle}>{item.title}</h3>
              <span style={timeStyle}>{item.timestamp}</span>
            </div>
            <p style={descStyle}>{item.description}</p>
          </div>
        ))}

        {loading && (
          <div style={loadingStyle}>
            <div style={{ fontSize: '32px', marginBottom: '10px' }}>â³</div>
            æ­£åœ¨åŠ è½½æ›´å¤šé¡¹ç›®...
          </div>
        )}

        {!hasMore && !loading && items.length > 0 && (
          <div style={endStyle}>
            <div style={{ fontSize: '24px', marginBottom: '10px' }}>âœ…</div>
            å·²åŠ è½½æ‰€æœ‰å†…å®¹ï¼ˆå…± {items.length} é¡¹ï¼‰
          </div>
        )}
      </div>
    );
  };

  // ä½¿ç”¨HOCå¢å¼ºç»„ä»¶
  const InfiniteList = withInfiniteScroll(ListComponent, {
    threshold: 200
  });

  return (
    <div style={{
      padding: '20px',
      background: '#f5f5f5',
      minHeight: '100vh'
    }}>
      <h3 style={{
        marginTop: 0,
        color: '#1976d2',
        textAlign: 'center',
        marginBottom: '20px'
      }}>
        ğŸ“œ æ— é™æ»šåŠ¨HOCæ¼”ç¤º
      </h3>

      <div style={{
        padding: '20px',
        background: '#e3f2fd',
        borderRadius: '8px',
        border: '2px solid #2196f3',
        marginBottom: '20px'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1565c0' }}>ğŸ’¡ åŠŸèƒ½ç‰¹æ€§</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>è‡ªåŠ¨æ£€æµ‹æ»šåŠ¨ä½ç½®ï¼Œæ¥è¿‘åº•éƒ¨æ—¶åŠ è½½æ›´å¤š</li>
          <li>å¯é…ç½®é˜ˆå€¼ï¼ˆè·ç¦»åº•éƒ¨å¤šå°‘åƒç´ æ—¶è§¦å‘ï¼‰</li>
          <li>åŠ è½½çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†</li>
          <li>æ”¯æŒè™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–æ€§èƒ½</li>
          <li>é˜²æŠ–å¤„ç†é¿å…é‡å¤è§¦å‘</li>
        </ul>
      </div>

      <InfiniteList />

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ å®ç°è¦ç‚¹</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>ä½¿ç”¨ <strong>scrolläº‹ä»¶</strong> ç›‘å¬æ»šåŠ¨ä½ç½®</li>
          <li>è®¡ç®— <strong>scrollTop + clientHeight</strong> ä¸ <strong>scrollHeight</strong> çš„å·®å€¼</li>
          <li>å½“å·®å€¼å°äºé˜ˆå€¼æ—¶è§¦å‘ <strong>loadMore</strong></li>
          <li>ä½¿ç”¨ <strong>useCallback</strong> ä¼˜åŒ–äº‹ä»¶å¤„ç†å‡½æ•°</li>
          <li>åœ¨ <strong>useEffect</strong> ä¸­æ·»åŠ å’Œæ¸…ç†äº‹ä»¶ç›‘å¬å™¨</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

### ç»ƒä¹ 4ï¼šåˆ›å»ºwithKeyboardShortcuts HOC

<LiveCode
  code={`
function KeyboardShortcutsHOCDemo() {
  // withKeyboardShortcuts HOCå®ç°
  const withKeyboardShortcuts = (WrappedComponent, config = {}) => {
    const { shortcuts = {}, enabled = true } = config;

    return function EnhancedComponent(props) {
      const [activeShortcuts, setActiveShortcuts] = React.useState([]);
      const [showHelp, setShowHelp] = React.useState(false);

      // é”®ç›˜äº‹ä»¶å¤„ç†
      const handleKeyDown = React.useCallback((event) => {
        if (!enabled) return;

        // æ£€æŸ¥æ˜¯å¦åœ¨è¾“å…¥æ¡†ä¸­
        const target = event.target;
        const isInput = target.tagName === 'INPUT' ||
                        target.tagName === 'TEXTAREA' ||
                        target.contentEditable === 'true';

        if (isInput) return;

        // æ„å»ºæŒ‰é”®ç»„åˆ
        const keys = [];
        if (event.ctrlKey || event.metaKey) keys.push('ctrl');
        if (event.shiftKey) keys.push('shift');
        if (event.altKey) keys.push('alt');
        keys.push(event.key.toLowerCase());

        const keyCombo = keys.join('+');

        // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„å¿«æ·é”®
        if (shortcuts[keyCombo]) {
          event.preventDefault();

          const shortcut = shortcuts[keyCombo];

          // æ‰§è¡Œå¤„ç†å‡½æ•°
          if (shortcut.handler) {
            shortcut.handler(event);
          }

          // è®°å½•æ¿€æ´»çš„å¿«æ·é”®
          setActiveShortcuts(prev => [...prev, {
            key: keyCombo,
            description: shortcut.description,
            timestamp: Date.now()
          }]);

          // 3ç§’åç§»é™¤è®°å½•
          setTimeout(() => {
            setActiveShortcuts(prev => prev.filter(s => s.timestamp !== Date.now()));
          }, 3000);
        }

        // ? é”®æ˜¾ç¤ºå¸®åŠ©
        if (event.key === '?') {
          event.preventDefault();
          setShowHelp(prev => !prev);
        }
      }, [enabled, shortcuts]);

      // æ·»åŠ äº‹ä»¶ç›‘å¬
      React.useEffect(() => {
        document.addEventListener('keydown', handleKeyDown);
        return () => document.removeEventListener('keydown', handleKeyDown);
      }, [handleKeyDown]);

      return (
        <WrappedComponent
          {...props}
          shortcuts={shortcuts}
          activeShortcuts={activeShortcuts}
          showHelp={showHelp}
          toggleHelp={() => setShowHelp(prev => !prev)}
        />
      );
    };
  };

  // å¿«æ·é”®é…ç½®
  const shortcuts = {
    'ctrl+s': {
      handler: () => alert('ğŸ’¾ ä¿å­˜æ“ä½œå·²è§¦å‘ (Ctrl+S)'),
      description: 'ä¿å­˜æ–‡æ¡£'
    },
    'ctrl+z': {
      handler: () => alert('â†©ï¸ æ’¤é”€æ“ä½œå·²è§¦å‘ (Ctrl+Z)'),
      description: 'æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ'
    },
    'ctrl+a': {
      handler: () => alert('ğŸ” å…¨é€‰æ“ä½œå·²è§¦å‘ (Ctrl+A)'),
      description: 'å…¨é€‰å†…å®¹'
    },
    'ctrl+f': {
      handler: () => alert('ğŸ” æŸ¥æ‰¾æ“ä½œå·²è§¦å‘ (Ctrl+F)'),
      description: 'æŸ¥æ‰¾å†…å®¹'
    },
    'ctrl+?': {
      handler: () => setShowHelp(prev => !prev),
      description: 'æ˜¾ç¤º/éšè—å¸®åŠ©'
    },
    'escape': {
      handler: () => alert('âŒ å–æ¶ˆæ“ä½œå·²è§¦å‘ (ESC)'),
      description: 'å–æ¶ˆå½“å‰æ“ä½œ'
    },
    '?': {
      handler: () => setShowHelp(prev => !prev),
      description: 'æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©'
    }
  };

  // åŸå§‹ç»„ä»¶
  const MyComponent = ({ activeShortcuts, showHelp, toggleHelp }) => {
    const containerStyle = {
      maxWidth: '800px',
      margin: '0 auto',
      padding: '20px',
      fontFamily: 'Arial, sans-serif'
    };

    const headerStyle = {
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      color: 'white',
      padding: '30px',
      borderRadius: '12px',
      marginBottom: '30px',
      textAlign: 'center'
    };

    const titleStyle = {
      margin: '0 0 10px 0',
      fontSize: '28px',
      fontWeight: 'bold'
    };

    const subtitleStyle = {
      margin: 0,
      fontSize: '14px',
      opacity: 0.9
    };

    const helpButtonStyle = {
      position: 'absolute',
      top: '20px',
      right: '20px',
      padding: '10px 20px',
      background: 'rgba(255, 255, 255, 0.2)',
      color: 'white',
      border: '2px solid white',
      borderRadius: '8px',
      cursor: 'pointer',
      fontSize: '14px',
      fontWeight: 'bold',
      transition: 'all 0.3s'
    };

    const cardStyle = {
      background: 'white',
      borderRadius: '8px',
      padding: '20px',
      marginBottom: '20px',
      boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
      border: '1px solid #e0e0e0'
    };

    const inputStyle = {
      width: '100%',
      padding: '12px',
      fontSize: '16px',
      border: '2px solid #e0e0e0',
      borderRadius: '6px',
      marginBottom: '15px',
      boxSizing: 'border-box',
      transition: 'border-color 0.3s'
    };

    const buttonStyle = {
      padding: '12px 24px',
      fontSize: '16px',
      fontWeight: 'bold',
      border: 'none',
      borderRadius: '6px',
      cursor: 'pointer',
      marginRight: '10px',
      marginBottom: '10px',
      transition: 'all 0.3s'
    };

    const shortcutsListStyle = {
      display: 'grid',
      gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
      gap: '15px',
      marginTop: '20px'
    };

    const shortcutItemStyle = {
      background: '#f5f5f5',
      padding: '15px',
      borderRadius: '6px',
      border: '1px solid #e0e0e0',
      display: 'flex',
      alignItems: 'center'
    };

    const keyComboStyle = {
      background: '#333',
      color: 'white',
      padding: '4px 8px',
      borderRadius: '4px',
      fontFamily: 'monospace',
      fontSize: '12px',
      fontWeight: 'bold',
      marginRight: '10px',
      minWidth: '60px',
      textAlign: 'center'
    };

    const descStyle = {
      flex: 1,
      fontSize: '14px',
      color: '#666'
    };

    const modalStyle = {
      position: 'fixed',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      background: 'rgba(0, 0, 0, 0.7)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      zIndex: 1000
    };

    const modalContentStyle = {
      background: 'white',
      borderRadius: '12px',
      padding: '30px',
      maxWidth: '600px',
      maxHeight: '80vh',
      overflow: 'auto',
      boxShadow: '0 10px 40px rgba(0,0,0,0.3)'
    };

    const closeButtonStyle = {
      position: 'absolute',
      top: '10px',
      right: '10px',
      background: 'none',
      border: 'none',
      fontSize: '24px',
      cursor: 'pointer',
      color: '#999'
    };

    const activeLogStyle = {
      background: '#e3f2fd',
      border: '1px solid #2196f3',
      borderRadius: '6px',
      padding: '10px',
      marginTop: '15px',
      maxHeight: '150px',
      overflowY: 'auto'
    };

    const logItemStyle = {
      fontSize: '12px',
      color: '#1976d2',
      marginBottom: '5px',
      padding: '5px',
      background: 'white',
      borderRadius: '4px'
    };

    return (
      <div style={containerStyle}>
        <div style={headerStyle}>
          <button onClick={toggleHelp} style={helpButtonStyle}>
            {showHelp ? 'âŒ éšè—å¸®åŠ©' : 'â“ æ˜¾ç¤ºå¸®åŠ©'}
          </button>
          <h1 style={titleStyle}>âŒ¨ï¸ é”®ç›˜å¿«æ·é”®æ¼”ç¤º</h1>
          <p style={subtitleStyle}>
            å°è¯•æŒ‰ Ctrl+Sã€Ctrl+Zã€Ctrl+Aã€Ctrl+Fã€? æˆ– ESC é”®
          </p>
        </div>

        <div style={cardStyle}>
          <h3 style={{ margin: '0 0 15px 0', color: '#333' }}>ğŸ“ æµ‹è¯•è¾“å…¥</h3>
          <input
            type="text"
            placeholder="åœ¨è¿™ä¸ªè¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡å­—..."
            style={inputStyle}
          />
          <textarea
            placeholder="æˆ–è€…åœ¨è¿™ä¸ªæ–‡æœ¬åŒºåŸŸä¸­è¾“å…¥..."
            rows="3"
            style={inputStyle}
          />
          <div style={{ marginTop: '10px' }}>
            <span style={{ fontSize: '12px', color: '#999' }}>
              ğŸ’¡ æç¤ºï¼šå¿«æ·é”®åœ¨è¾“å…¥æ¡†ä¸­ä¸ä¼šè§¦å‘
            </span>
          </div>

          {activeShortcuts.length > 0 && (
            <div style={activeLogStyle}>
              <h4 style={{ margin: '0 0 10px 0', fontSize: '14px', color: '#1976d2' }}>
                âš¡ æœ€è¿‘æ¿€æ´»çš„å¿«æ·é”®ï¼š
              </h4>
              {activeShortcuts.map((shortcut, index) => (
                <div key={index} style={logItemStyle}>
                  <strong>{shortcut.key}</strong> - {shortcut.description}
                  <span style={{ float: 'right', color: '#999' }}>
                    {new Date(shortcut.timestamp).toLocaleTimeString()}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>

        <div style={cardStyle}>
          <h3 style={{ margin: '0 0 15px 0', color: '#333' }}>ğŸ“‹ å¯ç”¨å¿«æ·é”®åˆ—è¡¨</h3>
          <div style={shortcutsListStyle}>
            {Object.entries(shortcuts).map(([key, shortcut]) => (
              <div key={key} style={shortcutItemStyle}>
                <span style={keyComboStyle}>{key}</span>
                <span style={descStyle}>{shortcut.description}</span>
              </div>
            ))}
          </div>
        </div>

        {showHelp && (
          <div style={modalStyle} onClick={toggleHelp}>
            <div style={modalContentStyle} onClick={e => e.stopPropagation()}>
              <button onClick={toggleHelp} style={closeButtonStyle}>
                Ã—
              </button>
              <h2 style={{ margin: '0 0 20px 0', color: '#333' }}>
                âŒ¨ï¸ é”®ç›˜å¿«æ·é”®å¸®åŠ©
              </h2>
              <p style={{ color: '#666', marginBottom: '20px' }}>
                ä»¥ä¸‹æ˜¯æœ¬ç»„ä»¶æ”¯æŒçš„æ‰€æœ‰é”®ç›˜å¿«æ·é”®ï¼š
              </p>
              <div style={shortcutsListStyle}>
                {Object.entries(shortcuts).map(([key, shortcut]) => (
                  <div key={key} style={shortcutItemStyle}>
                    <span style={keyComboStyle}>{key}</span>
                    <span style={descStyle}>{shortcut.description}</span>
                  </div>
                ))}
              </div>
              <div style={{
                marginTop: '20px',
                padding: '15px',
                background: '#fff3e0',
                borderRadius: '6px',
                border: '1px solid #ff9800'
              }}>
                <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ ä½¿ç”¨æç¤º</h4>
                <ul style={{ margin: 0, paddingLeft: '20px', fontSize: '14px', color: '#666' }}>
                  <li>å¿«æ·é”®åœ¨è¾“å…¥æ¡†ä¸­ä¸ä¼šè§¦å‘</li>
                  <li>æŒ‰ <strong>?</strong> é”®å¯ä»¥å¿«é€Ÿæ˜¾ç¤º/éšè—æ­¤å¸®åŠ©</li>
                  <li>æŒ‰ <strong>ESC</strong> é”®å¯ä»¥å–æ¶ˆå½“å‰æ“ä½œ</li>
                  <li>åœ¨æ”¯æŒå¿«æ·é”®çš„æµè§ˆå™¨ä¸­ï¼Œéƒ¨åˆ†å¿«æ·é”®å¯èƒ½è¢«å ç”¨</li>
                </ul>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  // ä½¿ç”¨HOCå¢å¼ºç»„ä»¶
  const ShortcutComponent = withKeyboardShortcuts(MyComponent, {
    shortcuts: shortcuts,
    enabled: true
  });

  return (
    <div style={{ background: '#f5f5f5', minHeight: '100vh', padding: '20px' }}>
      <ShortcutComponent />

      <div style={{
        marginTop: '20px',
        padding: '15px',
        background: '#fff3e0',
        borderRadius: '8px',
        border: '2px solid #ff9800',
        maxWidth: '800px',
        margin: '20px auto'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#e65100' }}>ğŸ’¡ å®ç°è¦ç‚¹</h4>
        <ul style={{ margin: 0, paddingLeft: '20px', lineHeight: '1.6', fontSize: '14px' }}>
          <li>ä½¿ç”¨ <strong>keydownäº‹ä»¶</strong> ç›‘å¬é”®ç›˜è¾“å…¥</li>
          <li>ç»„åˆé”®æ”¯æŒ <strong>Ctrl</strong>ã€<strong>Shift</strong>ã€<strong>Alt</strong></li>
          <li>é¿å…åœ¨è¾“å…¥æ¡†ä¸­è§¦å‘å¿«æ·é”®</li>
          <li>ä½¿ç”¨ <strong>preventDefault</strong> é˜»æ­¢é»˜è®¤è¡Œä¸º</li>
          <li>æä¾›è§†è§‰åé¦ˆæ˜¾ç¤ºæ¿€æ´»çš„å¿«æ·é”®</li>
          <li>æ”¯æŒå¸®åŠ©é¢æ¿æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å¿«æ·é”®</li>
        </ul>
      </div>
    </div>
  );
}
`}
  scope={{ React }}
/>

---

## 10. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… é«˜é˜¶ç»„ä»¶æ˜¯æ¥æ”¶ç»„ä»¶å¹¶è¿”å›æ–°ç»„ä»¶çš„å‡½æ•°
- âœ… HOCç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘ï¼ˆä¸»è¦åœ¨Hooksä¹‹å‰ï¼‰
- âœ… ä½¿ç”¨withXxxå‘½åçº¦å®š
- âœ… è®¾ç½®displayNameä¾¿äºè°ƒè¯•
- âœ… ä½¿ç”¨forwardRefä¼ é€’refs
- âœ… é¿å…å‘½åå†²çª
- âœ… æ¨èä¼˜å…ˆä½¿ç”¨Hooksè€Œä¸æ˜¯HOC
- âœ… HOCä»é€‚ç”¨äºåº“å¼€å‘ï¼ˆå¦‚Reduxï¼‰
- âœ… ä¼ é€’æ‰€æœ‰propsç»™åŒ…è£…ç»„ä»¶
- âœ… é¿å…å¾ªç¯ä¾èµ–

</Checklist>

### HOC vs Hooksé€‰æ‹©æŒ‡å—

<BestPractices>

1. **æ–°çš„é€»è¾‘å¤ç”¨** - ä¼˜å…ˆä½¿ç”¨Hooks
2. **ç±»ç»„ä»¶é¡¹ç›®** - å¯ä»¥ä½¿ç”¨HOC
3. **åº“å¼€å‘** - HOCä»æœ‰ä»·å€¼
4. **æ ·å¼å¢å¼º** - æ¨èä½¿ç”¨HOCæˆ–CSS-in-JS
5. **å¤æ‚é€»è¾‘** - ä½¿ç”¨è‡ªå®šä¹‰Hook
6. **éœ€è¦ä¿ç•™Refs** - ä½¿ç”¨forwardRef with HOC

</BestPractices>

### å¸¸è§HOCç±»å‹

**çŠ¶æ€ç±»**ï¼š
- `withState` - æ·»åŠ state
- `withFormState` - è¡¨å•çŠ¶æ€
- `withLocalStorage` - æœ¬åœ°å­˜å‚¨

**æ•°æ®ç±»**ï¼š
- `withData` - æ•°æ®è·å–
- `withCache` - ç¼“å­˜
- `withSubscription` - è®¢é˜…

**è¡Œä¸ºç±»**ï¼š
- `withAuth` - æƒé™æ§åˆ¶
- `withClickAnalytics` - ç‚¹å‡»è¿½è¸ª
- `withKeyboardShortcuts` - é”®ç›˜å¿«æ·é”®

**æ¸²æŸ“ç±»**ï¼š
- `withLoading` - åŠ è½½çŠ¶æ€
- `withErrorBoundary` - é”™è¯¯è¾¹ç•Œ
- `withStyles` - æ ·å¼å¢å¼º

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†HOCï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[æ¸²æŸ“å±æ€§æ¨¡å¼](render-props)** - ç†è§£å¦ä¸€ç§é€»è¾‘å¤ç”¨æ–¹å¼
2. **[å¤åˆç»„ä»¶](compound-components)** - å­¦ä¹ ç»„ä»¶ç»„åˆæŠ€å·§
3. **[å®¹å™¨-å±•ç¤ºæ¨¡å¼](container-presentational)** - æŒæ¡ç»„ä»¶åˆ†ç¦»
4. **[Hooksæ¨¡å¼](../advanced/hooks-patterns)** - ç°ä»£é€»è¾‘å¤ç”¨æ–¹å¼

---

## 11. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [é«˜é˜¶ç»„ä»¶](https://react.dev/reference/react) - Reactå®˜æ–¹æ–‡æ¡£
- [Forwarding Refs](https://react.dev/reference/react/forwardRef) - Refè½¬å‘
- [Render Props](https://react.dev/reference/react) - æ¸²æŸ“å±æ€§æ¨¡å¼

### æ¨èé˜…è¯»

- [HOC vs Render Props](https://kentcdodds.com/blog/aha-moments-when-learning-react) - æ¨¡å¼å¯¹æ¯”
- [Recomposeåº“](https://github.com/acdlite/recompose) - HOCå·¥å…·åº“
- [Why React Hooks are Better than HOCs](https://kentcdodds.com/blog/how-to-control-the-boilerplate-with-react-higher-order-components) - Hooksä¼˜åŠ¿

### è¿ç§»æŒ‡å—

- [ä»HOCåˆ°Hooks](https://kentcdodds.com/blog/application-state-management-with-react) - è¿ç§»ç­–ç•¥
- [æ··åˆä½¿ç”¨](https://react.dev/reference/react) - HOCå’ŒHookså…±å­˜

---

[â† ä¸Šä¸€ç« ï¼šå‡½æ•°å¼ç»„ä»¶](functional-components) | [ä¸‹ä¸€ç« ï¼šæ¸²æŸ“å±æ€§æ¨¡å¼ â†’](render-props)
