# å¤åˆç»„ä»¶ (Compound Components) - çµæ´»ç»„åˆæ¨¡å¼

import { Tabs, TabItem } from '@docusaurus/theme-common';

å¤åˆç»„ä»¶ï¼ˆCompound Componentsï¼‰æ˜¯Reactä¸­ä¸€ç§å¼ºå¤§è€Œä¼˜é›…çš„æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ å°†ç»„ä»¶çš„åˆ›å»ºé€»è¾‘æ‹†åˆ†åˆ°å¤šä¸ªå­ç»„ä»¶ä¸­ï¼ŒåŒæ—¶ä¿æŒå¯¹ç»„ä»¶ç»„åˆçš„å®Œå…¨æ§åˆ¶ã€‚è¿™ç§æ¨¡å¼æä¾›äº†å‡ºè‰²çš„çµæ´»æ€§ï¼Œè®©ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±ç»„åˆç»„ä»¶çš„å„ä¸ªéƒ¨åˆ†ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¤åˆç»„ä»¶çš„æ¦‚å¿µã€å®ç°æ–¹å¼ã€æœ€ä½³å®è·µå’Œä½¿ç”¨åœºæ™¯ã€‚

## æœ¬ç« å­¦ä¹ ç›®æ ‡

- ç†è§£å¤åˆç»„ä»¶æ¨¡å¼çš„æ ¸å¿ƒæ¦‚å¿µ
- æŒæ¡Context APIåœ¨å¤åˆç»„ä»¶ä¸­çš„åº”ç”¨
- å­¦ä¼šå®ç°å¯å¤ç”¨çš„å¤åˆç»„ä»¶
- ç†è§£children propçš„é«˜çº§ç”¨æ³•
- æŒæ¡ç»„ä»¶é—´é€šä¿¡çš„æœ€ä½³å®è·µ
- å­¦ä¼šæ„å»ºçµæ´»çš„ç»„ä»¶API
- ç†è§£å¤åˆç»„ä»¶ä¸ç»„åˆæ¨¡å¼çš„åŒºåˆ«
- æŒæ¡å¤åˆç»„ä»¶çš„TypeScriptæ”¯æŒ

---

## 1. ä»€ä¹ˆæ˜¯å¤åˆç»„ä»¶ï¼Ÿ

å¤åˆç»„ä»¶æ˜¯ä¸€ç»„ç›¸äº’åä½œçš„ç»„ä»¶ï¼Œå®ƒä»¬ä¸€èµ·å·¥ä½œæ¥å®ç°ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·ç•Œé¢ã€‚ä¸å•ä¸€ç»„ä»¶ä¸åŒï¼Œå¤åˆç»„ä»¶å°†å¤æ‚çš„UIæ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å­ç»„ä»¶ï¼Œä½†è¿™äº›å­ç»„ä»¶å¿…é¡»ä¸€èµ·ä½¿ç”¨æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚

<Box style={{ padding: '20px', background: '#e3f2fd', borderRadius: '8px', margin: '20px 0' }}>
  <h4 style={{ margin: 0, color: '#1976d2' }}>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
  <p style={{ margin: '10px 0 0 0' }}>
    <strong>å¤åˆç»„ä»¶</strong>æ˜¯ç”±å¤šä¸ªç»„ä»¶ç»„åˆè€Œæˆçš„ç»„ä»¶æ—ï¼Œå®ƒä»¬å…±äº«çŠ¶æ€å’Œé€»è¾‘ï¼Œä½†å¯ä»¥ç‹¬ç«‹åœ°æ¸²æŸ“ä¸åŒçš„éƒ¨åˆ†ã€‚
  </p>
</Box>

<CodeBlock>

```jsx
// åŸºç¡€ç¤ºä¾‹ï¼šSelectç»„ä»¶
<Select>
  <Select.Button>Choose an option</Select.Button>
  <Select.Options>
    <Select.Option value="option1">Option 1</Select.Option>
    <Select.Option value="option2">Option 2</Select.Option>
  </Select.Options>
</Select>

// å®é™…æ¸²æŸ“ç»“æ„
<div className="select">
  <button className="select-button">Choose an option</button>
  <ul className="select-options">
    <li className="select-option">Option 1</li>
    <li className="select-option">Option 2</li>
  </ul>
</div>
```

</CodeBlock>

### 1.1 å¤åˆç»„ä»¶çš„ç‰¹ç‚¹

<Grid>

<div>
  <h4>ä¼˜åŠ¿</h4>
  <ul>
    <li>âœ… é«˜åº¦çµæ´»å’Œå¯ç»„åˆ</li>
    <li>âœ… æ¸…æ™°çš„ç»„ä»¶å±‚æ¬¡</li>
    <li>âœ… å…±äº«çŠ¶æ€å’Œé€»è¾‘</li>
    <li>âœ… ä¼˜ç§€çš„TypeScriptæ”¯æŒ</li>
    <li>âœ… æ˜“äºæ‰©å±•å’Œç»´æŠ¤</li>
    <li>âœ… è‡ªç„¶çš„APIè®¾è®¡</li>
  </ul>
</div>

<div>
  <h4>ä½¿ç”¨åœºæ™¯</h4>
  <ul>
    <li>ğŸ“Œ Select/Dropdownç»„ä»¶</li>
    <li>ğŸ“Œ Tabsç»„ä»¶</li>
    <li>ğŸ“Œ Modal/Dialogç»„ä»¶</li>
    <li>ğŸ“Œ Accordionç»„ä»¶</li>
    <li>ğŸ“Œ Formç»„ä»¶ç»„</li>
    <li>ğŸ“Œ Menu/Navigationç»„ä»¶</li>
  </ul>
</div>

</Grid>

### 1.2 å¸¸è§æ¡ˆä¾‹

<CodeBlock>

```jsx
// Tabsç»„ä»¶ç¤ºä¾‹
<Tabs>
  <Tabs.List>
    <Tabs.Tab id="tab1">Tab 1</Tabs.Tab>
    <Tabs.Tab id="tab2">Tab 2</Tabs.Tab>
  </Tabs.List>
  <Tabs.Panels>
    <Tabs.Panel id="tab1">Content 1</Tabs.Panel>
    <Tabs.Panel id="tab2">Content 2</Tabs.Panel>
  </Tabs.Panels>
</Tabs>

// Menuç»„ä»¶ç¤ºä¾‹
<Menu>
  <Menu.Button>Menu</Menu.Button>
  <Menu.Items>
    <Menu.Item onSelect={handleEdit}>Edit</Menu.Item>
    <Menu.Item onSelect={handleDelete}>Delete</Menu.Item>
    <Menu.Divider />
    <Menu.Item onSelect={handleExport}>Export</Menu.Item>
  </Menu.Items>
</Menu>
```

</CodeBlock>

---

## 2. å®ç°å¤åˆç»„ä»¶åŸºç¡€

### 2.1 ä½¿ç”¨React.Childrenå’ŒReact.cloneElement

<CodeBlock>

```jsx
// ç®€å•çš„Selectç»„ä»¶
class Select extends React.Component {
  constructor(props) {
    super(props);
    this.state = { isOpen: false, selectedValue: null };
  }

  toggle = () => {
    this.setState(prev => ({ isOpen: !prev.isOpen }));
  };

  selectOption = (value) => {
    this.setState({ selectedValue: value, isOpen: false });
  };

  render() {
    const { children } = this.props;
    const { isOpen, selectedValue } = this.state;

    return (
      <div className="select">
        {React.Children.map(children, child => {
          return React.cloneElement(child, {
            isOpen,
            selectedValue,
            onToggle: this.toggle,
            onSelect: this.selectOption
          });
        })}
      </div>
    );
  }
}

// Buttonå­ç»„ä»¶
const SelectButton = ({ children, selectedValue, onToggle, isOpen }) => {
  return (
    <button className="select-button" onClick={onToggle}>
      {selectedValue || children}
      <span className="arrow">{isOpen ? 'â–²' : 'â–¼'}</span>
    </button>
  );
};

// Optionså®¹å™¨
const SelectOptions = ({ children, isOpen, onSelect }) => {
  if (!isOpen) return null;

  return (
    <ul className="select-options">
      {React.Children.map(children, child => {
        return React.cloneElement(child, { onSelect });
      })}
    </ul>
  );
};

// Optioné¡¹
const SelectOption = ({ value, children, onSelect }) => {
  return (
    <li
      className="select-option"
      onClick={() => onSelect(value)}
    >
      {children}
    </li>
  );
};

// ç»„åˆä½¿ç”¨
<Select>
  <SelectButton>Choose an option</SelectButton>
  <SelectOptions>
    <SelectOption value="option1">Option 1</SelectOption>
    <SelectOption value="option2">Option 2</SelectOption>
  </SelectOptions>
</Select>
```

</CodeBlock>

### 2.2 ä½¿ç”¨Context APIï¼ˆæ¨èï¼‰

<CodeBlock>

```jsx
// ä½¿ç”¨Contextå…±äº«çŠ¶æ€
const SelectContext = React.createContext();

function Select({ children, defaultValue, onChange }) {
  const [isOpen, setIsOpen] = React.useState(false);
  const [selectedValue, setSelectedValue] = React.useState(defaultValue);

  const toggle = () => setIsOpen(prev => !prev);
  const close = () => setIsOpen(false);
  const selectOption = (value) => {
    setSelectedValue(value);
    onChange?.(value);
    close();
  };

  return (
    <SelectContext.Provider
      value={{
        isOpen,
        selectedValue,
        onToggle: toggle,
        onSelect: selectOption
      }}
    >
      <div className="select">{children}</div>
    </SelectContext.Provider>
  );
}

// Buttonå­ç»„ä»¶
const SelectButton = ({ children }) => {
  const { isOpen, selectedValue, onToggle } = React.useContext(SelectContext);

  return (
    <button className="select-button" onClick={onToggle}>
      {selectedValue || children}
      <span className="arrow">{isOpen ? 'â–²' : 'â–¼'}</span>
    </button>
  );
};

// ä½¿ç”¨
<Select defaultValue="option1" onChange={(value) => console.log(value)}>
  <SelectButton>Choose an option</SelectButton>
  <SelectOptions>
    <SelectOption value="option1">Option 1</SelectOption>
    <SelectOption value="option2">Option 2</SelectOption>
  </SelectOptions>
</Select>
```

</CodeBlock>

### 2.3 æ·»åŠ Display Namesï¼ˆè°ƒè¯•å‹å¥½ï¼‰

<CodeBlock>

```jsx
// æ·»åŠ displayNameä¾¿äºè°ƒè¯•
const SelectContext = React.createContext();

function Select({ children, defaultValue, onChange }) {
  const [isOpen, setIsOpen] = React.useState(false);
  const [selectedValue, setSelectedValue] = React.useState(defaultValue);

  const toggle = () => setIsOpen(prev => !prev);
  const selectOption = (value) => {
    setSelectedValue(value);
    onChange?.(value);
    setIsOpen(false);
  };

  return (
    <SelectContext.Provider value={{ isOpen, selectedValue, onToggle: toggle, onSelect: selectOption }}>
      <div className="select">{children}</div>
    </SelectContext.Provider>
  );
}

Select.Button = SelectButton;
Select.Options = SelectOptions;
Select.Option = SelectOption;

SelectButton.displayName = 'Select.Button';
SelectOptions.displayName = 'Select.Options';
SelectOption.displayName = 'Select.Option';

// åœ¨React DevToolsä¸­æ˜¾ç¤ºä¸ºSelect.Button
```

</CodeBlock>

---

## 3. é«˜çº§å¤åˆç»„ä»¶æ¨¡å¼

### 3.1 çµæ´»å­ç»„ä»¶ç±»å‹

<CodeBlock>

```jsx
// æ”¯æŒå¤šç§å­ç»„ä»¶ç»„åˆæ–¹å¼
function Menu({ children }) {
  const { isOpen, onClose } = React.useContext(MenuContext);

  // ç‚¹å‡»å¤–éƒ¨å…³é—­
  useEffect(() => {
    if (!isOpen) return;

    const handleClickOutside = (event) => {
      if (event.target.closest('.menu')) return;
      onClose();
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <div className="menu">
      {children}
    </div>
  );
}

Menu.Button = MenuButton;
Menu.Items = MenuItems;
Menu.Item = MenuItem;
Menu.Divider = MenuDivider;
Menu.Label = MenuLabel;

// çµæ´»çš„APIè®¾è®¡
<Menu>
  <Menu.Item onSelect={handleNew}>New File</Menu.Item>
  <Menu.Item onSelect={handleOpen}>Open File</Menu.Item>
  <Menu.Divider />
  <Menu.Label>Recent</Menu.Label>
  <Menu.Item onSelect={handleRecent1}>file1.txt</Menu.Item>
  <Menu.Item onSelect={handleRecent2}>file2.txt</Menu.Item>
</Menu>
```

</CodeBlock>

### 3.2 å­ç»„ä»¶çŠ¶æ€ç®¡ç†

<CodeBlock>

```jsx
// Accordionç»„ä»¶ - ç®¡ç†å±•å¼€/æŠ˜å çŠ¶æ€
const AccordionContext = React.createContext();

function Accordion({ type = 'single', children }) {
  const [openItems, setOpenItems] = React.useState(new Set());

  const toggleItem = (value) => {
    if (type === 'single') {
      setOpenItems(prev => {
        const newSet = new Set();
        if (!prev.has(value)) {
          newSet.add(value);
        }
        return newSet;
      });
    } else {
      setOpenItems(prev => {
        const newSet = new Set(prev);
        if (newSet.has(value)) {
          newSet.delete(value);
        } else {
          newSet.add(value);
        }
        return newSet;
      });
    }
  };

  const isOpen = (value) => openItems.has(value);

  return (
    <AccordionContext.Provider value={{ isOpen, toggleItem, type }}>
      <div className="accordion">{children}</div>
    </AccordionContext.Provider>
  );
}

Accordion.Item = function AccordionItem({ value, children }) {
  const { isOpen } = React.useContext(AccordionContext);
  return (
    <div className="accordion-item" data-open={isOpen(value)}>
      {children}
    </div>
  );
};

Accordion.Header = function AccordionHeader({ children, value }) {
  const { isOpen, toggleItem } = React.useContext(AccordionContext);
  return (
    <button
      className="accordion-header"
      onClick={() => toggleItem(value)}
      aria-expanded={isOpen(value)}
    >
      {children}
      <span className="arrow">{isOpen(value) ? 'âˆ’' : '+'}</span>
    </button>
  );
};

Accordion.Panel = function AccordionPanel({ value, children }) {
  const { isOpen } = React.useContext(AccordionContext);

  if (!isOpen(value)) return null;

  return (
    <div className="accordion-panel">
      {children}
    </div>
  );
};

// ä½¿ç”¨
<Accordion type="multiple">
  <Accordion.Item value="item1">
    <Accordion.Header value="item1">Section 1</Accordion.Header>
    <Accordion.Panel value="item1">Content 1</Accordion.Panel>
  </Accordion.Item>
  <Accordion.Item value="item2">
    <Accordion.Header value="item2">Section 2</Accordion.Header>
    <Accordion.Panel value="item2">Content 2</Accordion.Panel>
  </Accordion.Item>
</Accordion>
```

</CodeBlock>

### 3.3 åŠ¨æ€å­ç»„ä»¶æ¸²æŸ“

<CodeBlock>

```jsx
// æ­¥éª¤æ¡ç»„ä»¶ - åŠ¨æ€æ¸²æŸ“
const StepperContext = React.createContext();

function Stepper({ currentStep = 0, onStepChange, children }) {
  const [activeStep, setActiveStep] = React.useState(currentStep);

  useEffect(() => {
    onStepChange?.(activeStep);
  }, [activeStep, onStepChange]);

  const next = () => {
    setActiveStep(prev => prev + 1);
  };

  const prev = () => {
    setActiveStep(prev => prev - 1);
  };

  const goTo = (step) => {
    setActiveStep(step);
  };

  return (
    <StepperContext.Provider value={{ activeStep, next, prev, goTo }}>
      <div className="stepper">
        {React.Children.map(children, (child, index) => {
          return React.cloneElement(child, {
            isActive: index === activeStep,
            isCompleted: index < activeStep,
            isClickable: index <= activeStep
          });
        })}
      </div>
    </StepperContext.Provider>
  );
}

Stepper.Step = function Step({ children, isActive, isCompleted, isClickable }) {
  return (
    <div
      className={`step ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''} ${isClickable ? 'clickable' : ''}`}
    >
      {children}
    </div>
  );
};

// ä½¿ç”¨
<Stepper currentStep={1}>
  <Stepper.Step>Step 1</Stepper.Step>
  <Stepper.Step>Step 2</Stepper.Step>
  <Stepper.Step>Step 3</Stepper.Step>
</Stepper>
```

</CodeBlock>

### 3.4 åµŒå¥—å¤åˆç»„ä»¶

<CodeBlock>

```jsx
// Treeç»„ä»¶ - æ”¯æŒåµŒå¥—
const TreeContext = React.createContext();

function Tree({ children, defaultExpanded = [] }) {
  const [expandedItems, setExpandedItems] = React.useState(new Set(defaultExpanded));

  const toggleItem = (itemId) => {
    setExpandedItems(prev => {
      const newSet = new Set(prev);
      if (newSet.has(itemId)) {
        newSet.delete(itemId);
      } else {
        newSet.add(itemId);
      }
      return newSet;
    });
  };

  const isExpanded = (itemId) => expandedItems.has(itemId);

  return (
    <TreeContext.Provider value={{ isExpanded, toggleItem }}>
      <ul className="tree">{children}</ul>
    </TreeContext.Provider>
  );
}

Tree.Item = function TreeItem({ id, children }) {
  return <li className="tree-item">{children}</li>;
};

Tree.Node = function TreeNode({ id, label, children }) {
  const { isExpanded, toggleItem } = React.useContext(TreeContext);
  const hasChildren = React.Children.count(children) > 0;

  return (
    <li className="tree-node">
      <div className="tree-node-header">
        {hasChildren && (
          <button
            className="tree-toggle"
            onClick={() => toggleItem(id)}
          >
            {isExpanded(id) ? 'âˆ’' : '+'}
          </button>
        )}
        <span className="tree-label">{label}</span>
      </div>
      {hasChildren && isExpanded(id) && (
        <ul className="tree-children">
          {children}
        </ul>
      )}
    </li>
  );
};

// ä½¿ç”¨
<Tree defaultExpanded={['root']}>
  <Tree.Item>
    <Tree.Node id="root" label="Root">
      <Tree.Item>
        <Tree.Node id="child1" label="Child 1" />
      </Tree.Item>
      <Tree.Item>
        <Tree.Node id="child2" label="Child 2">
          <Tree.Item>
            <Tree.Node id="grandchild" label="Grandchild" />
          </Tree.Item>
        </Tree.Node>
      </Tree.Item>
    </Tree.Node>
  </Tree.Item>
</Tree>
```

</CodeBlock>

---

## 4. TypeScriptæ”¯æŒ

### 4.1 ç±»å‹å®šä¹‰

<CodeBlock>

```tsx
// TypeScriptç±»å‹å®šä¹‰
interface SelectContextType {
  isOpen: boolean;
  selectedValue: string | null;
  onToggle: () => void;
  onSelect: (value: string) => void;
}

const SelectContext = React.createContext<SelectContextType | undefined>(undefined);

function Select({
  children,
  defaultValue,
  onChange
}: {
  children: React.ReactNode;
  defaultValue?: string;
  onChange?: (value: string) => void;
}) {
  // ...å®ç°
  return (
    <SelectContext.Provider value={contextValue}>
      <div className="select">{children}</div>
    </SelectContext.Provider>
  );
}

interface SelectButtonProps {
  children: React.ReactNode;
}

const SelectButton: React.FC<SelectButtonProps> = ({ children }) => {
  const context = React.useContext(SelectContext);
  if (!context) {
    throw new Error('SelectButton must be used within a Select component');
  }

  return <button onClick={context.onToggle}>{children}</button>;
};

interface SelectOptionProps {
  value: string;
  children: React.ReactNode;
}

const SelectOption: React.FC<SelectOptionProps> = ({ value, children }) => {
  const context = React.useContext(SelectContext);
  if (!context) {
    throw new Error('SelectOption must be used within a Select component');
  }

  return (
    <li onClick={() => context.onSelect(value)}>
      {children}
    </li>
  );
};

// ç»„åˆç±»å‹
export interface SelectProps {
  children: React.ReactNode;
  defaultValue?: string;
  onChange?: (value: string) => void;
}

export type SelectComponent = React.FC<SelectProps> & {
  Button: React.FC<SelectButtonProps>;
  Options: React.FC<SelectOptionsProps>;
  Option: React.FC<SelectOptionProps>;
};

// ä½¿ç”¨
const Select: SelectComponent = ({ children, defaultValue, onChange }) => {
  // å®ç°
  return <div>{children}</div>;
};

Select.Button = SelectButton;
Select.Options = SelectOptions;
Select.Option = SelectOption;
```

</CodeBlock>

### 4.2 æ³›å‹æ”¯æŒ

<CodeBlock>

```tsx
// æ³›å‹Selectç»„ä»¶
interface GenericSelectProps<T> {
  children: React.ReactNode;
  defaultValue?: T;
  onChange?: (value: T) => void;
  renderValue?: (value: T) => React.ReactNode;
}

const GenericSelectContext = React.createContext<any>(undefined);

function GenericSelect<T>({
  children,
  defaultValue,
  onChange,
  renderValue
}: GenericSelectProps<T>) {
  const [isOpen, setIsOpen] = React.useState(false);
  const [selectedValue, setSelectedValue] = React.useState<T | undefined>(defaultValue);

  const toggle = () => setIsOpen(prev => !prev);
  const selectOption = (value: T) => {
    setSelectedValue(value);
    onChange?.(value);
    setIsOpen(false);
  };

  return (
    <GenericSelectContext.Provider value={{ isOpen, selectedValue, onToggle: toggle, onSelect: selectOption, renderValue }}>
      <div className="select">{children}</div>
    </GenericSelectContext.Provider>
  );
}

interface SelectButtonProps {
  children: React.ReactNode;
}

const GenericSelectButton: React.FC<SelectButtonProps> = ({ children }) => {
  const { isOpen, selectedValue, onToggle, renderValue } = React.useContext(GenericSelectContext);

  const displayValue = selectedValue !== undefined && renderValue
    ? renderValue(selectedValue)
    : children;

  return (
    <button onClick={onToggle}>
      {displayValue}
    </button>
  );
};

// ä½¿ç”¨
<GenericSelect<User>
  defaultValue={users[0]}
  onChange={(user) => console.log(user)}
  renderValue={(user) => user.name}
>
  <GenericSelectButton>Select User</GenericSelectButton>
  <GenericSelectOptions>
    {users.map(user => (
      <GenericSelectOption key={user.id} value={user}>
        {user.name} - {user.email}
      </GenericSelectOption>
    ))}
  </GenericSelectOptions>
</GenericSelect>
```

</CodeBlock>

---

## 5. å®é™…åº”ç”¨æ¡ˆä¾‹

### 5.1 å®Œæ•´çš„Modalç»„ä»¶

<CodeBlock>

```jsx
// Modalå¤åˆç»„ä»¶
const ModalContext = React.createContext();

function Modal({ isOpen, onClose, children }) {
  // ESCé”®å…³é—­
  useEffect(() => {
    if (!isOpen) return;

    const handleEsc = (event) => {
      if (event.key === 'Escape') {
        onClose?.();
      }
    };

    document.addEventListener('keydown', handleEsc);
    document.body.style.overflow = 'hidden';

    return () => {
      document.removeEventListener('keydown', handleEsc);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <ModalContext.Provider value={{ onClose }}>
      <div className="modal-overlay" onClick={onClose}>
        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
          {children}
        </div>
      </div>
    </ModalContext.Provider>
  );
}

Modal.Header = function ModalHeader({ children }) {
  const { onClose } = React.useContext(ModalContext);
  return (
    <div className="modal-header">
      <h2 className="modal-title">{children}</h2>
      <button className="modal-close" onClick={onClose}>Ã—</button>
    </div>
  );
};

Modal.Body = function ModalBody({ children }) {
  return <div className="modal-body">{children}</div>;
};

Modal.Footer = function ModalFooter({ children }) {
  return <div className="modal-footer">{children}</div>;
};

// ä½¿ç”¨
<Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)}>
  <Modal.Header>Edit Profile</Modal.Header>
  <Modal.Body>
    <form>
      <input type="text" placeholder="Name" />
      <input type="email" placeholder="Email" />
    </form>
  </Modal.Body>
  <Modal.Footer>
    <button onClick={() => setIsModalOpen(false)}>Cancel</button>
    <button onClick={handleSave}>Save</button>
  </Modal.Footer>
</Modal>
```

</CodeBlock>

### 5.2 Tabsç»„ä»¶ï¼ˆå®Œæ•´å®ç°ï¼‰

<CodeBlock>

```jsx
// Tabsç»„ä»¶
const TabsContext = React.createContext();

function Tabs({ defaultTab, children, onChange }) {
  const [activeTab, setActiveTab] = React.useState(defaultTab);

  useEffect(() => {
    onChange?.(activeTab);
  }, [activeTab, onChange]);

  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      <div className="tabs">{children}</div>
    </TabsContext.Provider>
  );
}

Tabs.List = function TabList({ children }) {
  return <div className="tab-list">{children}</div>;
};

Tabs.Tab = function Tab({ id, children }) {
  const { activeTab, setActiveTab } = React.useContext(TabsContext);
  const isActive = activeTab === id;

  return (
    <button
      className={`tab ${isActive ? 'active' : ''}`}
      onClick={() => setActiveTab(id)}
      role="tab"
      aria-selected={isActive}
      aria-controls={`panel-${id}`}
      id={`tab-${id}`}
    >
      {children}
    </button>
  );
};

Tabs.Panels = function TabPanels({ children }) {
  return <div className="tab-panels">{children}</div>;
};

Tabs.Panel = function TabPanel({ id, children }) {
  const { activeTab } = React.useContext(TabsContext);
  const isActive = activeTab === id;

  return (
    <div
      className={`tab-panel ${isActive ? 'active' : ''}`}
      role="tabpanel"
      id={`panel-${id}`}
      aria-labelledby={`tab-${id}`}
      hidden={!isActive}
    >
      {children}
    </div>
  );
};

// ä½¿ç”¨
<Tabs defaultTab="tab1" onChange={(tab) => console.log('Active tab:', tab)}>
  <Tabs.List>
    <Tabs.Tab id="tab1">Profile</Tabs.Tab>
    <Tabs.Tab id="tab2">Settings</Tabs.Tab>
    <Tabs.Tab id="tab3">Notifications</Tabs.Tab>
  </Tabs.List>
  <Tabs.Panels>
    <Tabs.Panel id="tab1">
      <div>Profile content</div>
    </Tabs.Panel>
    <Tabs.Panel id="tab2">
      <div>Settings content</div>
    </Tabs.Panel>
    <Tabs.Panel id="tab3">
      <div>Notifications content</div>
    </Tabs.Panel>
  </Tabs.Panels>
</Tabs>
```

</CodeBlock>

### 5.3 Form Fieldç»„ä»¶

<CodeBlock>

```jsx
// Form Fieldç»„ä»¶
const FormFieldContext = React.createContext();

function FormField({ name, label, error, children }) {
  const fieldId = React.useId();
  const errorId = `${fieldId}-error`;

  return (
    <FormFieldContext.Provider value={{ fieldId, errorId, name, label, error }}>
      <div className="form-field">
        {children}
      </div>
    </FormFieldContext.Provider>
  );
}

FormField.Label = function FieldLabel({ children }) {
  const { fieldId, label } = React.useContext(FormFieldContext);
  return (
    <label htmlFor={fieldId} className="form-label">
      {children || label}
    </label>
  );
};

FormField.Input = function FieldInput({ type = 'text', ...props }) {
  const { fieldId, error, errorId } = React.useContext(FormFieldContext);

  return (
    <input
      id={fieldId}
      type={type}
      className={`form-input ${error ? 'error' : ''}`}
      aria-invalid={!!error}
      aria-describedby={error ? errorId : undefined}
      {...props}
    />
  );
};

FormField.Error = function FieldError() {
  const { error, errorId } = React.useContext(FormFieldContext);
  if (!error) return null;

  return (
    <div id={errorId} className="form-error" role="alert">
      {error}
    </div>
  );
};

FormField.Help = function FieldHelp({ children }) {
  return <div className="form-help">{children}</div>;
};

// ä½¿ç”¨
<Form>
  <FormField
    name="email"
    label="Email Address"
    error={errors.email}
  >
    <FormField.Input type="email" placeholder="your@email.com" />
    <FormField.Help>We'll never share your email</Form.Help>
    <FormField.Error />
  </FormField>

  <FormField
    name="password"
    label="Password"
    error={errors.password}
  >
    <FormField.Input type="password" />
    <FormField.Error />
  </FormField>
</Form>
```

</CodeBlock>

---

## 6. æœ€ä½³å®è·µ

### 6.1 ç»„ä»¶ç»“æ„è®¾è®¡

<CodeBlock>

```jsx
// âœ… æ¸…æ™°çš„æ–‡ä»¶ç»„ç»‡
// Select/
//   â”œâ”€â”€ index.tsx          // ä¸»ç»„ä»¶å’Œå¯¼å‡º
//   â”œâ”€â”€ Select.tsx         // Selectç»„ä»¶
//   â”œâ”€â”€ SelectButton.tsx   // Buttonå­ç»„ä»¶
//   â”œâ”€â”€ SelectOptions.tsx  // Optionså­ç»„ä»¶
//   â”œâ”€â”€ SelectOption.tsx   // Optionå­ç»„ä»¶
//   â”œâ”€â”€ SelectContext.tsx  // Context
//   â””â”€â”€ types.ts           // ç±»å‹å®šä¹‰

// index.tsx
export { default as Select } from './Select';
export { SelectButton } from './SelectButton';
export { SelectOptions } from './SelectOptions';
export { SelectOption } from './SelectOption';
export type { SelectProps, SelectOptionProps } from './types';
```

</CodeBlock>

### 6.2 é”™è¯¯å¤„ç†

<CodeBlock>

```jsx
// âœ… æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
function useSelectContext() {
  const context = React.useContext(SelectContext);
  if (!context) {
    throw new Error(
      'This component must be used within a <Select> component. ' +
      'Make sure all <SelectButton>, <SelectOptions>, and <SelectOption> ' +
      'components are wrapped in a <Select> component.'
    );
  }
  return context;
}

// ä½¿ç”¨
const SelectButton = () => {
  const context = useSelectContext(); // æŠ›é”™è€Œä¸æ˜¯è¿”å›undefined
  // ...
};
```

</CodeBlock>

### 6.3 å‘ä¸‹ä¼ é€’Props

<CodeBlock>

```jsx
// âœ… å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å­ç»„ä»¶
function Select({ children, className, ...props }) {
  return (
    <div className={className} {...props}>
      {children}
    </div>
  );
}

Select.Option = function SelectOption({ value, children, className, ...props }) {
  // ç”¨æˆ·å¯ä»¥ä¼ é€’é¢å¤–çš„classNameå’Œprops
  return (
    <li className={`option ${className || ''}`} {...props}>
      {children}
    </li>
  );
};

// ä½¿ç”¨
<Select>
  <Select.Option
    value="option1"
    className="custom-option"
    onMouseEnter={() => console.log('hovered')}
  >
    Custom Option
  </Select.Option>
</Select>
```

</CodeBlock>

### 6.4 å¯è®¿é—®æ€§æ”¯æŒ

<CodeBlock>

```jsx
// âœ… æ·»åŠ é€‚å½“çš„ARIAå±æ€§
function Select({ children }) {
  const { isOpen, onToggle } = React.useContext(SelectContext);

  return (
    <div className="select">
      {React.Children.map(children, child =>
        React.cloneElement(child, { isOpen, onToggle })
      )}
    </div>
  );
}

const SelectButton = ({ children, isOpen, onToggle }) => {
  return (
    <button
      onClick={onToggle}
      aria-haspopup="listbox"
      aria-expanded={isOpen}
      aria-label="Select an option"
    >
      {children}
      <span aria-hidden="true">{isOpen ? 'â–²' : 'â–¼'}</span>
    </button>
  );
};

const SelectOptions = ({ children, isOpen, onSelect }) => {
  if (!isOpen) return null;

  return (
    <ul
      role="listbox"
      className="options-list"
    >
      {React.Children.map(children, child =>
        React.cloneElement(child, { onSelect })
      )}
    </ul>
  );
};

const SelectOption = ({ value, children, onSelect }) => {
  return (
    <li
      role="option"
      onClick={() => onSelect(value)}
      tabIndex={-1}
    >
      {children}
    </li>
  );
};
```

</CodeBlock>

---

## 7. ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”

### 7.1 Render Props vs å¤åˆç»„ä»¶

<Compare>

```jsx
// Render Propsæ–¹å¼
<Select
  render={({ isOpen, onToggle, selectedValue, onSelect }) => (
    <>
      <button onClick={onToggle}>{selectedValue || 'Select'}</button>
      {isOpen && (
        <ul>
          <li onClick={() => onSelect('option1')}>Option 1</li>
          <li onClick={() => onSelect('option2')}>Option 2</li>
        </ul>
      )}
    </>
  )}
/>

// å¤åˆç»„ä»¶æ–¹å¼
<Select>
  <Select.Button>Select</Select.Button>
  <Select.Options>
    <Select.Option value="option1">Option 1</Select.Option>
    <Select.Option value="option2">Option 2</Select.Option>
  </Select.Options>
</Select>

// å¯¹æ¯”
1. è¯­æ³•: å¤åˆç»„ä»¶æ›´ç›´è§‚
2. å¯è¯»æ€§: å¤åˆç»„ä»¶æ›´å¥½
3. çµæ´»æ€§: Render Propsæ›´çµæ´»
4. TypeScript: å¤åˆç»„ä»¶ç±»å‹æ”¯æŒæ›´å¥½
5. å­¦ä¹ æ›²çº¿: å¤åˆç»„ä»¶æ›´å®¹æ˜“ç†è§£
```

</Compare>

### 7.2 HOC vs å¤åˆç»„ä»¶

<Compare>

```jsx
// HOCæ–¹å¼
const EnhancedSelect = withState(Select, 'isOpen', 'setIsOpen', false);

// å¤åˆç»„ä»¶æ–¹å¼
<Select>
  <Select.Button />
  <Select.Options />
</Select>

// å¯¹æ¯”
1. ç»„ä»¶å±‚çº§: å¤åˆç»„ä»¶æ— é¢å¤–å±‚çº§
2. Propsä¼ é€’: å¤åˆç»„ä»¶è‡ªåŠ¨ä¼ é€’
3. è°ƒè¯•: å¤åˆç»„ä»¶æ›´æ˜“è°ƒè¯•
4. å¤ç”¨æ€§: HOCå¯å¤ç”¨ï¼Œå¤åˆç»„ä»¶éœ€è®¾è®¡
```

</Compare>

---

## 8. å®è·µç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå®ç°Tooltipç»„ä»¶

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæç¤º
- æ”¯æŒå››ä¸ªæ–¹å‘ï¼štop, right, bottom, left
- å¯é…ç½®å»¶è¿Ÿæ—¶é—´
- å“åº”å¼å®šä½

**APIè®¾è®¡**ï¼š
```jsx
<Tooltip content="This is a tooltip" position="top" delay={500}>
  <button>Hover me</button>
</Tooltip>
```

**æç¤º**ï¼š
- ä½¿ç”¨useStateç®¡ç†æ˜¾ç¤ºçŠ¶æ€
- è®¡ç®—æç¤ºæ¡†ä½ç½®
- ç›‘å¬é¼ æ ‡äº‹ä»¶
- ä½¿ç”¨portalæ¸²æŸ“åˆ°body

</Expandable>

### ç»ƒä¹ 2ï¼šå®ç°Popoverç»„ä»¶

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ˜¾ç¤º
- ç‚¹å‡»å¤–éƒ¨å…³é—­
- æ”¯æŒåµŒå¥—å†…å®¹
- å¯é…ç½®é”šç‚¹ä½ç½®

**APIè®¾è®¡**ï¼š
```jsx
<Popover>
  <Popover.Button>Toggle</Popover.Button>
  <Popover.Panel>
    <h3>Panel Title</h3>
    <p>Some content</p>
  </Popover.Panel>
</Popover>
```

**æç¤º**ï¼š
- ä½¿ç”¨useRefè·å–å…ƒç´ ä½ç½®
- è®¡ç®—panelæ˜¾ç¤ºä½ç½®
- ç›‘å¬documentç‚¹å‡»äº‹ä»¶
- ä½¿ç”¨CSS transformå®šä½

</Expandable>

### ç»ƒä¹ 3ï¼šå®ç°Breadcrumbç»„ä»¶

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- æ˜¾ç¤ºå¯¼èˆªè·¯å¾„
- æ”¯æŒå¯ç‚¹å‡»å’Œä¸å¯ç‚¹å‡»é¡¹
- è‡ªåŠ¨ç”Ÿæˆåˆ†éš”ç¬¦
- å“åº”å¼æŠ˜å 

**APIè®¾è®¡**ï¼š
```jsx
<Breadcrumb separator="/">
  <Breadcrumb.Item href="/">Home</Breadcrumb.Item>
  <Breadcrumb.Item href="/products">Products</Breadcrumb.Item>
  <Breadcrumb.Item>Current Page</Breadcrumb.Item>
</Breadcrumb>
```

**æç¤º**ï¼š
- ä½¿ç”¨React.Childrenéå†
- æ·»åŠ åˆ†éš”ç¬¦ï¼ˆé™¤æœ€åä¸€é¡¹ï¼‰
- å¯ç‚¹å‡»é¡¹ä½¿ç”¨Linkç»„ä»¶
- ç§»åŠ¨ç«¯æ˜¾ç¤º"..."

</Expandable>

### ç»ƒä¹ 4ï¼šå®ç°Progressç»„ä»¶

<Expandable title="ç‚¹å‡»æŸ¥çœ‹è¦æ±‚">

**åŠŸèƒ½è¦æ±‚**ï¼š
- çº¿æ€§è¿›åº¦æ¡
- åœ†å½¢è¿›åº¦æ¡
- å¯é…ç½®å¤§å°å’Œé¢œè‰²
- æ˜¾ç¤ºç™¾åˆ†æ¯”

**APIè®¾è®¡**ï¼š
```jsx
<Progress value={75} max={100} type="linear" showLabel>
  <Progress.Bar />
  <Progress.Label>75%</Progress.Label>
</Progress>

<Progress value={60} max={100} type="circular" size="large">
  <Progress.Circle />
  <Progress.Label>60%</Progress.Label>
</Progress>
```

**æç¤º**ï¼š
- è®¡ç®—ç™¾åˆ†æ¯”
- åœ†å½¢ä½¿ç”¨SVG stroke-dasharray
- æ·»åŠ åŠ¨ç”»æ•ˆæœ
- ä½¿ç”¨CSSå˜é‡æ”¯æŒä¸»é¢˜

</Expandable>

---

## 9. å¸¸è§é™·é˜±

### é™·é˜±1ï¼šå­ç»„ä»¶ç‹¬ç«‹æ¸²æŸ“

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - å­ç»„ä»¶åœ¨å¤–éƒ¨ä½¿ç”¨
<Select>
  <SelectButton>Select</SelectButton>
</Select>
<SelectOptions>
  <SelectOption value="1">Option 1</SelectOption>
</SelectOptions>

// è§£å†³æ–¹æ¡ˆï¼šå¼ºåˆ¶å­ç»„ä»¶åœ¨å†…éƒ¨ä½¿ç”¨
function SelectOptions({ children, ...props }) {
  const context = useSelectContext();
  if (!context) {
    throw new Error('SelectOptions must be used within Select');
  }
  // ...
}
```

</ErrorBox>

### é™·é˜±2ï¼šContextå€¼å˜åŒ–å¯¼è‡´é‡æ¸²æŸ“

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
function Select({ children }) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <SelectContext.Provider value={{ isOpen, setIsOpen }}>
      {children}
    </SelectContext.Provider>
  );
}

// âœ… æ­£ç¡® - ä½¿ç”¨useMemoç¼“å­˜
function Select({ children }) {
  const [isOpen, setIsOpen] = useState(false);
  const contextValue = useMemo(() => ({ isOpen, setIsOpen }), [isOpen]);

  return (
    <SelectContext.Provider value={contextValue}>
      {children}
    </SelectContext.Provider>
  );
}
```

</ErrorBox>

### é™·é˜±3ï¼šç¼ºå°‘ç±»å‹å®šä¹‰

<ErrorBox>

```jsx
// âŒ é”™è¯¯ - æ²¡æœ‰ç±»å‹æ£€æŸ¥
<Select>
  <SelectButton />          // ç¼ºå°‘children
  <Select.Option value="1" /> // æ²¡æœ‰children
  <CustomComponent />        // ä¸æ˜¯Selectçš„å­ç»„ä»¶
</Select>

// âœ… æ­£ç¡® - ä½¿ç”¨TypeScript
interface SelectProps {
  children: React.ReactNode;
}

const Select: React.FC<SelectProps> = ({ children }) => {
  // ...
};

Select.Button = function SelectButton({ children }: { children: React.ReactNode }) {
  // ...
};
```

</ErrorBox>

---

## 10. æœ¬ç« å°ç»“

### å…³é”®è¦ç‚¹

<Checklist>

- âœ… å¤åˆç»„ä»¶æ˜¯ç›¸äº’åä½œçš„ç»„ä»¶ç»„ï¼Œå…±åŒå®ç°å®Œæ•´UI
- âœ… ä½¿ç”¨Context APIåœ¨å­ç»„ä»¶é—´å…±äº«çŠ¶æ€
- âœ… å­ç»„ä»¶é€šè¿‡React.cloneElementæ¥æ”¶props
- âœ… ç»„åˆä½¿ç”¨React.Children.mapå¤„ç†å­ç»„ä»¶
- âœ… æ·»åŠ displayNameä¾¿äºè°ƒè¯•
- âœ… æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯ï¼ˆContextæœªæ‰¾åˆ°ï¼‰
- âœ… ä½¿ç”¨TypeScriptå¢å¼ºç±»å‹å®‰å…¨
- âœ… æ”¯æŒæ³›å‹å®ç°å¯å¤ç”¨ç»„ä»¶
- âœ… æ·»åŠ ARIAå±æ€§æé«˜å¯è®¿é—®æ€§
- âœ… ä½¿ç”¨useMemoé¿å…ä¸å¿…è¦é‡æ¸²æŸ“

</Checklist>

### æœ€ä½³å®è·µ

<BestPractices>

1. **æ¸…æ™°APIè®¾è®¡** - è®©ç»„ä»¶çš„ç»„åˆæ–¹å¼ç›´è§‚æ˜äº†
2. **é”™è¯¯å¤„ç†** - æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
3. **ç±»å‹å®‰å…¨** - ä½¿ç”¨TypeScriptå®šä¹‰å®Œæ•´ç±»å‹
4. **å¯è®¿é—®æ€§** - æ·»åŠ é€‚å½“çš„ARIAå±æ€§
5. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨useMemoç¼“å­˜Contextå€¼
6. **æµ‹è¯•è¦†ç›–** - æµ‹è¯•ç»„ä»¶çš„å„ç§ç»„åˆæ–¹å¼
7. **æ–‡æ¡£å®Œæ•´** - æä¾›ä½¿ç”¨ç¤ºä¾‹å’ŒAPIæ–‡æ¡£
8. **å‘ä¸‹ä¼ é€’** - å…è®¸ç”¨æˆ·ä¼ é€’è‡ªå®šä¹‰props

</BestPractices>

### å¸¸è§å¤åˆç»„ä»¶ç±»å‹

**å¯¼èˆªç±»**ï¼š
- Tabs, Breadcrumb, Menu, Pagination

**å±•ç¤ºç±»**ï¼š
- Modal, Tooltip, Popover, Accordion

**è¡¨å•ç±»**ï¼š
- FormField, InputGroup, CheckboxGroup

**è¿›åº¦ç±»**ï¼š
- Progress, Stepper, Slider

**é€‰æ‹©ç±»**ï¼š
- Select, Dropdown, RadioGroup, Switch

### ä¸‹ä¸€æ­¥å­¦ä¹ 

ç°åœ¨ä½ å·²ç»æŒæ¡äº†å¤åˆç»„ä»¶ï¼Œæ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **[å®¹å™¨-å±•ç¤ºæ¨¡å¼](container-presentational)** - æŒæ¡çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
2. **[Props Gettersæ¨¡å¼](../advanced/props-getters)** - å­¦ä¹ é«˜çº§propså¤„ç†
3. **[Controlled vs Uncontrolled](../advanced/controlled-uncontrolled)** - ç†è§£çŠ¶æ€æ§åˆ¶
4. **[ç»„åˆæ¨¡å¼](../advanced/composition-vs-inheritance)** - æ·±å…¥ç»„ä»¶ç»„åˆ

---

## 11. å»¶ä¼¸é˜…è¯»

### å®˜æ–¹èµ„æº

- [Composition](https://react.dev/learn/thinking-in-react) - ç»„åˆæ€ç»´
- [Context API](https://react.dev/reference/react) - Contextä½¿ç”¨
- [React.cloneElement](https://react.dev/reference/react.cloneElement) - å…ƒç´ å…‹éš†

### æ¨èé˜…è¯»

- [Headless UI](https://headlessui.com/) - æ— æ ·å¼å¤åˆç»„ä»¶åº“
- [Radix UI](https://www.radix-ui.com/) - é«˜çº§å¤åˆç»„ä»¶
- [Reakit](https://reakit.io/) - å¯ç»„åˆReactç»„ä»¶

### ç›¸å…³è¯é¢˜

- [Compound Components](https://kentcdodds.com/blog/compound-components-with-react) - å¤åˆç»„ä»¶è¯¦è§£
- [Build Your Own Compound Components](https://www.youtube.com/watch?v=zylP68e_rVo) - è§†é¢‘æ•™ç¨‹
- [TypeScript React](https://react.dev/reference/react/TypeScript) - TypeScriptæ”¯æŒ

---

[â† ä¸Šä¸€ç« ï¼šæ¸²æŸ“å±æ€§æ¨¡å¼](render-props) | [ä¸‹ä¸€ç« ï¼šå®¹å™¨-å±•ç¤ºæ¨¡å¼ â†’](container-presentational)
